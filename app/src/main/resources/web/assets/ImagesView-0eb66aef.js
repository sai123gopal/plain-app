import{u as Fe,_ as Ue,a as qe,b as Ne}from"./list-18c9d8b7.js";import{d as Le,ay as Qe,a as xe,r as V,u as Ge,c as He,s as Ke,B as Oe,D as We,p as Xe,C as je,az as Je,ab as Pe,aA as Ye,E as Ze,G as et,H as tt,I as v,J as st,K as ot,e as a,f as s,x as c,h as t,F as S,L as m,w as u,j as k,M as N,y as lt,A as L,t as r,N as nt,O as at,k as it,aB as dt,aC as ct,n as ce,Q as ue,o as n,R as ut,m as _e,z as _t,at as re,aD as B,au as rt,av as pt,ag as mt,X as ht,Y as gt,V as ft,W as vt,ao as kt,aE as yt,a9 as bt,ah as wt,Z as Ct,$ as $t,a0 as Tt,_ as It}from"./index-391e08bf.js";import{_ as Vt,a as St}from"./ConfirmModal.vuevuetypescriptsetuptruelang-17d82a17.js";import{_ as Dt,a as At}from"./grid-view-outline-rounded-e37715a5.js";import{_ as Rt}from"./Breadcrumb-db40a1f3.js";import{n as pe}from"./list-6498ebd9.js";import{u as zt,a as Et}from"./tags-8c2303eb.js";import"./vee-validate.esm-910387f0.js";const _=A=>(rt("data-v-f6915bf0"),A=A(),pt(),A),Mt={class:"v-toolbar"},Bt=_(()=>s("md-ripple",null,null,-1)),Ft=_(()=>s("md-ripple",null,null,-1)),Ut=_(()=>s("md-ripple",null,null,-1)),qt=["onClick"],Nt=_(()=>s("md-ripple",null,null,-1)),Lt=["onClick"],Qt=_(()=>s("md-ripple",null,null,-1)),xt={class:"filters"},Gt=["label"],Ht={class:"form-label"},Kt={type:"filter"},Ot=["label","selected","onClick"],Wt={class:"buttons"},Xt=["onClick"],jt={key:0,class:"image-container",style:{"margin-bottom":"24px"}},Jt=["onClick","onContextmenu"],Pt=["src"],Yt={class:"duration"},Zt={key:1,class:"table-responsive"},es={class:"table"},ts=["checked","indeterminate"],ss=_(()=>s("th",null,"ID",-1)),os=_(()=>s("th",null,null,-1)),ls=_(()=>s("th",null,null,-1)),ns=["onClick"],as=["checked"],is=["src","onClick"],ds={class:"nowrap"},cs={class:"action-btns"},us=["onClick"],_s=_(()=>s("md-ripple",null,null,-1)),rs=["onClick"],ps=_(()=>s("md-ripple",null,null,-1)),ms=["onClick"],hs=_(()=>s("md-ripple",null,null,-1)),gs={class:"nowrap"},fs={key:0},vs={colspan:"7"},ks={class:"no-data-placeholder"},ys={key:2,class:"no-data-placeholder"},D=48,bs=Le({__name:"ImagesView",setup(A){var ne,ae;const me=Qe(),i=xe(),h=V([]),Q=V(),{t:C}=Ge(),x=He(),{app:G,urlTokenKey:F}=Ke(x),g=Oe({text:"",tags:[]}),d=We.IMAGE,H=Xe().query,$=V(parseInt(((ne=H.page)==null?void 0:ne.toString())??"1")),y=V(je(((ae=H.q)==null?void 0:ae.toString())??"")),T=V(""),{tags:R}=zt(d,y,g,async e=>{T.value=nt(e),await at(),be()}),{addToTags:he}=Et(d,h,R),{deleteItems:ge,deleteItem:K}=Je(),{allChecked:O,realAllChecked:z,selectRealAll:fe,allCheckedAlertVisible:ve,clearSelection:E,toggleAllChecked:W,toggleItemChecked:X,toggleRow:ke,total:b,checked:j}=Fe(h),{downloadItems:ye}=Pe(F,d,h,E,"images.zip"),{downloadFile:J}=mt(F),U=Ye(()=>h.value.map(e=>({src:re(e.fileId),name:B(e.path),duration:0,size:e.size,path:e.path,type:d,data:e})));function P(e){x.lightbox={sources:U.value,index:e,visible:!0}}function Y(e){ht(gt,{type:d,tags:R.value,item:{key:e.id,title:e.title,size:e.size},selected:R.value.filter(l=>e.tags.some(w=>w.id===l.id))})}const{loading:Z,load:be,refetch:q}=Ze({handle:async(e,l)=>{if(l)it(C(l),"error");else if(e){const w=[];for(const I of e.images)w.push({...I,checked:!1,fileId:dt(F.value,I.path)});h.value=w,b.value=e.imageCount}},document:ct,variables:()=>({offset:($.value-1)*D,limit:D,query:T.value}),appApi:!0});function we(){ce(i,`/images?page=${$.value}&q=${ue(y.value)}`)}et($,()=>{we()});function Ce(e){g.tags.includes(e)?ft(g.tags,l=>l.id===e.id):g.tags.push(e)}function $e(){y.value=vt(g),ee(),Q.value.dismiss()}function ee(){ce(i,`/images?q=${ue(y.value)}`)}function Te(){i.imageViewType==="grid"?i.imageViewType="list":i.imageViewType="grid"}function Ie(){me.push("/files"),kt(Vt,{message:C("upload_images")})}function Ve(e,l){e.preventDefault(),yt({x:e.x,y:e.y,items:[{label:C("add_to_tags"),onClick:()=>{Y(l)}},{label:C("download"),onClick:()=>{J(l.path,B(l.path).replace(" ","-"))}},{label:C("delete"),onClick:()=>{K(d,l)}}]})}const te=e=>{e.type===d&&(E(),q())},se=e=>{e.type===d&&q()},oe=e=>{e.type===d&&(E(),q())},le=()=>{b.value--};return tt(()=>{v.on("item_tags_updated",se),v.on("items_tags_updated",te),v.on("media_item_deleted",le),v.on("media_items_deleted",oe)}),st(()=>{v.off("item_tags_updated",se),v.off("items_tags_updated",te),v.off("media_item_deleted",le),v.off("media_items_deleted",oe)}),(e,l)=>{const w=Rt,I=bt,ie=wt,de=Ct,Se=Dt,De=At,Ae=St,Re=Ue,ze=qe,Ee=$t,Me=Tt,Be=Ne,f=ot("tooltip");return n(),a(S,null,[s("div",Mt,[c(w,{current:()=>`${e.$t("page_title.images")} (${t(b)})`},null,8,["current"]),t(j)&&t(i).imageViewType==="list"?(n(),a(S,{key:0},[m((n(),a("button",{class:"icon-button",onClick:l[0]||(l[0]=u(o=>t(ge)(t(d),h.value,t(z),T.value),["stop"]))},[Bt,c(I)])),[[f,e.$t("delete")]]),m((n(),a("button",{class:"icon-button",onClick:l[1]||(l[1]=u(o=>t(ye)(t(z),T.value),["stop"]))},[Ft,c(ie)])),[[f,e.$t("download")]]),m((n(),a("button",{class:"icon-button",onClick:l[2]||(l[2]=u(o=>t(he)(t(z),T.value),["stop"]))},[Ut,c(de)])),[[f,e.$t("add_to_tags")]])],64)):k("",!0),m((n(),a("button",{class:"icon-button",onClick:u(Te,["stop"])},[Nt,t(i).imageViewType==="list"?(n(),N(Se,{key:0})):k("",!0),t(i).imageViewType==="grid"?(n(),N(De,{key:1})):k("",!0)],8,qt)),[[f,e.$t(t(i).imageViewType==="list"?"view_as_grid":"view_as_list")]]),m((n(),a("button",{class:"icon-button",onClick:u(Ie,["prevent"])},[Qt,c(Ae)],8,Lt)),[[f,e.$t("upload")]]),c(Re,{ref_key:"searchInputRef",ref:Q,modelValue:y.value,"onUpdate:modelValue":l[4]||(l[4]=o=>y.value=o),search:ee},{filters:lt(()=>[s("div",xt,[m(s("md-outlined-text-field",{label:e.$t("keywords"),"onUpdate:modelValue":l[3]||(l[3]=o=>g.text=o),"keyup.enter":"applyAndDoSearch"},null,8,Gt),[[ut,g.text]]),s("label",Ht,r(e.$t("tags")),1),s("md-chip-set",Kt,[(n(!0),a(S,null,L(t(R),o=>(n(),a("md-filter-chip",{key:o.id,label:o.name,selected:g.tags.includes(o),onClick:M=>Ce(o)},null,8,Ot))),128))]),s("div",Wt,[s("md-filled-button",{onClick:u($e,["stop"])},r(e.$t("search")),9,Xt)])])]),_:1},8,["modelValue"])]),t(i).imageViewType==="grid"?(n(),a("div",jt,[(n(!0),a(S,null,L(U.value,(o,M)=>(n(),a("div",{class:"item",onClick:p=>P(M),onContextmenu:p=>Ve(p,o.data)},[s("img",{class:"image",src:o.src+"&w=300&h=300"},null,8,Pt),s("span",Yt,r(t(_e)(o.size)),1)],40,Jt))),256))])):k("",!0),c(ze,{limit:D,total:t(b),"all-checked-alert-visible":t(ve),"real-all-checked":t(z),"select-real-all":t(fe),"clear-selection":t(E)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),t(i).imageViewType==="list"?(n(),a("div",Zt,[s("table",es,[s("thead",null,[s("tr",null,[s("th",null,[s("md-checkbox",{"touch-target":"wrapper",onChange:l[5]||(l[5]=(...o)=>t(W)&&t(W)(...o)),checked:t(O),indeterminate:!t(O)&&t(j)},null,40,ts)]),ss,os,s("th",null,r(e.$t("name")),1),ls,s("th",null,r(e.$t("tags")),1),s("th",null,r(e.$t("file_size")),1)])]),s("tbody",null,[(n(!0),a(S,null,L(h.value,(o,M)=>(n(),a("tr",{key:o.id,class:_t({selected:o.checked}),onClick:u(p=>t(ke)(o),["stop"])},[s("td",null,[s("md-checkbox",{"touch-target":"wrapper",onChange:l[6]||(l[6]=(...p)=>t(X)&&t(X)(...p)),checked:o.checked},null,40,as)]),s("td",null,[c(Ee,{id:o.id,raw:o},null,8,["id","raw"])]),s("td",null,[s("img",{src:t(re)(o.fileId)+"&w=300&h=300",width:"50",height:"50",onClick:u(p=>P(M),["stop"]),style:{cursor:"pointer"}},null,8,is)]),s("td",null,r(t(B)(o.path)),1),s("td",ds,[s("div",cs,[m((n(),a("button",{class:"icon-button",onClick:u(p=>t(K)(t(d),o),["stop"])},[_s,c(I)],8,us)),[[f,e.$t("delete")]]),m((n(),a("button",{class:"icon-button",onClick:u(p=>t(J)(o.path,t(B)(o.path).replace(" ","-")),["stop"])},[ps,c(ie)],8,rs)),[[f,e.$t("download")]]),m((n(),a("button",{class:"icon-button",onClick:u(p=>Y(o),["stop"])},[hs,c(de)],8,ms)),[[f,e.$t("add_to_tags")]])])]),s("td",null,[c(Me,{tags:o.tags,type:t(d)},null,8,["tags","type"])]),s("td",gs,r(t(_e)(o.size)),1)],10,ns))),128))]),h.value.length?k("",!0):(n(),a("tfoot",fs,[s("tr",null,[s("td",vs,[s("div",ks,r(e.$t(t(pe)(t(Z),t(G).permissions,"WRITE_EXTERNAL_STORAGE"))),1)])])]))])])):k("",!0),t(i).imageViewType==="grid"&&U.value.length===0?(n(),a("div",ys,r(e.$t(t(pe)(t(Z),t(G).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):k("",!0),t(b)>D?(n(),N(Be,{key:3,modelValue:$.value,"onUpdate:modelValue":l[7]||(l[7]=o=>$.value=o),total:t(b),limit:D},null,8,["modelValue","total"])):k("",!0)],64)}}});const Rs=It(bs,[["__scopeId","data-v-f6915bf0"]]);export{Rs as default};
