import{u as ie,_ as ue,a as ce}from"./list-ecca0f33.js";import{_ as de}from"./FieldId-7a42c5ae.js";import{_ as pe}from"./download-rounded-2da2fb73.js";import{_ as re}from"./Breadcrumb-d5bdebe4.js";import{d as _e,a3 as fe,q as he,r as f,u as me,s as ve,a as ke,C as ye,H as ge,a4 as be,p as $e,D as we,a5 as Ce,E as N,i as Se,t as Ve,a6 as Ie,K as Ae,Z as De,a7 as Ue,I as qe,a8 as Qe,L as Be,M as Le,o as u,c as d,e as t,f as h,j as o,w as _,l as A,g as n,y as Me,N as D,O as Te,P as ze,Q as x,R as Fe,F as R,A as Pe,z as Ke,k as Ne,m as xe,S as G,T as E,U as Re,a9 as Ge,B as C,V as S,aa as Ee,ab as je,_ as He}from"./index-5f5c60b6.js";import{n as Oe}from"./list-6498ebd9.js";import"./VModal.vuevuetypescriptsetuptruelang-61cd4dae.js";function Ze(c,V){const m=c.findIndex(v=>v.id===V);m!==-1&&c.splice(m,1)}const Je=c=>(Ee("data-v-5ba739a6"),c=c(),je(),c),We={class:"v-toolbar"},Xe={class:"right-actions"},Ye=["title"],et=["onClick"],tt={class:"row mb-3"},st={class:"col-md-3 col-form-label"},at={class:"col-md-9"},nt=["onKeyup"],ot={class:"actions"},lt=["onClick"],it={class:"table"},ut={class:"actions"},ct=["onClick"],dt=["onUpdate:modelValue"],pt=Je(()=>t("br",null,null,-1)),rt={class:"nowrap"},_t=["title"],ft=["title"],ht={class:"actions one"},mt={key:0},vt=["onClick"],kt={key:0},yt={colspan:"8"},gt={class:"no-data-placeholder"},bt=_e({__name:"AppsView",setup(c){var F,P;const{input:V,upload:m,uploadChanged:v}=fe(),k=he(),l=f([]),{t:j}=me(),{app:U}=ve(ke()),y=ye({text:"",tags:[]}),H=ge(()=>l.value.some(e=>e.checked)),{downloadItems:q}=be(l,"apps.zip"),{downloadFile:O}=Ge(U),Q=$e(),B=Q.query,g=f(parseInt(((F=B.page)==null?void 0:F.toString())??"1")),b=50,$=f(0),i=f(we(((P=B.q)==null?void 0:P.toString())??"")),L=Ce(i.value),p=Q.params.type;p&&L.push({name:"type",op:"",value:p});const Z=f(N(L)),J=()=>{m(U.value.downloadsDir)},{selectAll:I,toggleSelect:M}=ie(l),{loading:W}=Se({handle:(e,a)=>{a?Ve(j(a),"error"):e&&(l.value=e.packages.map(r=>({...r,checked:!1})),$.value=e.packageCount)},document:Ie,variables:()=>({offset:(g.value-1)*b,limit:b,query:Z.value}),appApi:!0});Ae(g,e=>{p?C(k,`/apps/${p}?page=${e}&q=${S(i.value)}`):C(k,`/apps?page=${e}&q=${S(i.value)}`)});function T(){const e=[];y.text&&e.push({name:"text",op:"",value:y.text}),i.value=N(e),z()}function z(){p?C(k,`/apps/${p}?q=${S(i.value)}`):C(k,`/apps?q=${S(i.value)}`)}const{mutate:X,onDone:Y}=De({document:Ue,appApi:!0});function ee(e){Y(()=>{e.isUninstalling=!0}),X({id:e.id})}const{loading:te,load:se,refetch:ae}=qe({handle:(e,a)=>{if(e)for(const r of e.packageStatuses)r.exist||Ze(l.value,r.id)},document:Qe,variables:()=>({ids:l.value.filter(e=>e.isUninstalling).map(e=>e.id)}),appApi:!0});return Be(()=>{Le.on("upload_task_done",a=>{a.status});let e=!0;setInterval(()=>{l.value.some(a=>a.isUninstalling)&&!te.value&&(e?(se(),e=!1):ae())},1e3)}),(e,a)=>{const r=re,K=pe,ne=ue,oe=de,le=ce;return u(),d(R,null,[t("div",We,[h(r,{current:()=>`${e.$t("page_title.apps")} (${$.value})`},null,8,["current"]),t("div",Xe,[o(H)?(u(),d("button",{key:0,type:"button",class:"btn btn-action",onClick:a[0]||(a[0]=_((...s)=>o(q)&&o(q)(...s),["stop"])),title:e.$t("download")},[h(K,{class:"bi"})],8,Ye)):A("",!0),t("button",{type:"button",class:"btn btn-action",onClick:_(J,["stop"]),style:{display:"none"}},n(e.$t("install")),9,et),h(ne,{modelValue:i.value,"onUpdate:modelValue":a[2]||(a[2]=s=>i.value=s),search:z},{filters:Me(()=>[t("div",tt,[t("label",st,n(e.$t("keywords")),1),t("div",at,[D(t("input",{type:"text","onUpdate:modelValue":a[1]||(a[1]=s=>y.text=s),class:"form-control",onKeyup:ze(T,["enter"])},null,40,nt),[[Te,y.text]])])]),t("div",ot,[t("button",{type:"button",class:"btn",onClick:_(T,["stop"])},n(e.$t("search")),9,lt)])]),_:1},8,["modelValue"])])]),t("table",it,[t("thead",null,[t("tr",null,[t("th",null,[D(t("input",{class:"form-check-input",type:"checkbox",onChange:a[3]||(a[3]=(...s)=>o(M)&&o(M)(...s)),"onUpdate:modelValue":a[4]||(a[4]=s=>Fe(I)?I.value=s:null)},null,544),[[x,o(I)]])]),t("th",null,n(e.$t("name")),1),t("th",null,n(e.$t("version")),1),t("th",null,n(e.$t("size")),1),t("th",null,n(e.$t("type")),1),t("th",null,n(e.$t("installed_at")),1),t("th",null,n(e.$t("updated_at")),1),t("th",ut,n(e.$t("actions")),1)])]),t("tbody",null,[(u(!0),d(R,null,Pe(l.value,s=>(u(),d("tr",{key:s.id,class:Ke({checked:s.checked}),onClick:_(w=>s.checked=!s.checked,["stop"])},[t("td",null,[D(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":w=>s.checked=w},null,8,dt),[[x,s.checked]])]),t("td",null,[t("strong",null,[Ne(n(s.name)+" ",1),h(K,{class:"bi bi-btn",onClick:_(w=>o(O)(s.path,`${s.name.replace(" ","")}-${s.id}.apk`),["stop"])},null,8,["onClick"])]),pt,h(oe,{id:s.id,raw:s},null,8,["id","raw"])]),t("td",null,n(s.version),1),t("td",null,n(o(xe)(s.size)),1),t("td",rt,n(e.$t("app_type."+s.type)),1),t("td",{class:"nowrap",title:o(G)(s.installedAt)},n(o(E)(s.installedAt)),9,_t),t("td",{class:"nowrap",title:o(G)(s.updatedAt)},n(o(E)(s.updatedAt)),9,ft),t("td",ht,[s.isUninstalling?(u(),d("span",mt,n(e.$t("uninstalling")),1)):(u(),d("a",{key:1,href:"#",class:"v-link",onClick:_(w=>ee(s),["stop"])},n(e.$t("uninstall")),9,vt))])],10,ct))),128))]),l.value.length?A("",!0):(u(),d("tfoot",kt,[t("tr",null,[t("td",yt,[t("div",gt,n(e.$t(o(Oe)(o(W)))),1)])])]))]),$.value>b?(u(),Re(le,{key:0,modelValue:g.value,"onUpdate:modelValue":a[5]||(a[5]=s=>g.value=s),total:$.value,limit:b},null,8,["modelValue","total"])):A("",!0),t("input",{ref_key:"fileInput",ref:V,style:{display:"none"},type:"file",accept:".apk",multiple:"",onChange:a[6]||(a[6]=(...s)=>o(v)&&o(v)(...s))},null,544)],64)}}});const Dt=He(bt,[["__scopeId","data-v-5ba739a6"]]);export{Dt as default};
