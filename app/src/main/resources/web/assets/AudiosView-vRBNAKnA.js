import{_ as Tt}from"./VPagination.vuevuetypescriptsetuptruelang-goYu96wT.js";import{o as a,c,a as n,j as Ve,a$ as wt,g as Ue,a1 as F,C as ze,h as V,b0 as It,d as At,u as Et,s as Le,I as St,i as Dt,ai as Me,aF as qt,J as Ft,aG as Lt,aH as Mt,aI as Bt,aM as Rt,aj as Pt,K as Vt,aJ as Ut,aK as zt,L as Nt,M as Ht,m as e,t as k,O as q,x as r,v as p,q as d,w as l,e as z,p as i,aL as Qt,N as Be,P as te,Q as Kt,f as Gt,b1 as jt,aP as Ot,ao as Wt,S as xt,aQ as se,aR as oe,aZ as Jt,aC as Xt,E as Zt,ab as Yt,aS as Re,U as es,V as ts,W as ss,X as os,Y as as,ar as ns,aq as ls,Z as is,$ as ds,a0 as cs,ae as rs,aT as us,as as ps,aU as _s,a2 as ms,a3 as vs,a4 as gs,F as ks,G as hs,aW as fs,H as ys}from"./index-R8dLcqG_.js";import{_ as $s,a as bs}from"./SearchInput-DhaE-3h8.js";import{_ as Cs}from"./sort-rounded-CsJpi3ce.js";import{_ as Ts}from"./upload-rounded-CQIzYelP.js";import{u as ws}from"./search-ByVbj6Ls.js";import{u as Is,a as As}from"./key-events-BNCM8SMB.js";import{a as Es}from"./tags-Dbpv368M.js";import"./search-rounded-CULEMJ2O.js";import"./rss-feed-rounded-BCiGdgJ5.js";import"./vee-validate.esm-vpr6zxQb.js";const Ss={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Ds=n("path",{fill:"currentColor",d:"M10 16q.425 0 .713-.288T11 15V9q0-.425-.288-.712T10 8t-.712.288T9 9v6q0 .425.288.713T10 16m4 0q.425 0 .713-.288T15 15V9q0-.425-.288-.712T14 8t-.712.288T13 9v6q0 .425.288.713T14 16m-2 6q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m0-8"},null,-1),qs=[Ds];function Fs(f,T){return a(),c("svg",Ss,[...qs])}const Ls={name:"material-symbols-pause-circle-outline-rounded",render:Fs},Ms={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Bs=n("path",{fill:"currentColor",d:"M3 16v-2h7v2zm0-4v-2h11v2zm0-4V6h11v2zm13 12v-4h-4v-2h4v-4h2v4h4v2h-4v4z"},null,-1),Rs=[Bs];function Ps(f,T){return a(),c("svg",Ms,[...Rs])}const Vs={name:"material-symbols-playlist-add",render:Ps};function Pe(f,T,w=500){const _=f.cloneNode(!0),y=f.getBoundingClientRect(),B=T.getBoundingClientRect();_.style.position="absolute",_.style.top=y.top+"px",_.style.left=y.left+"px",_.style.opacity=1,document.body.appendChild(_);let $=0;function h(D){$||($=D);const M=D-$,A=Math.min(M/w,1);_.style.top=y.top+(B.top-y.top)*A+"px",_.style.left=y.left+(B.left-y.left)*A+"px",A<1?requestAnimationFrame(h):document.body.removeChild(_)}requestAnimationFrame(h)}const Us=(f,T)=>{const{mutate:w,loading:_,onDone:y}=Ve({document:wt,appApi:!0}),{t:B}=Ue();return y(()=>{F.emit("refetch_app"),T()}),{loading:_,addItemsToPlaylist:($,h,D,M)=>{let A=M;if(!D){if(h.length===0){ze(B("select_first"),"error");return}A=`ids:${h.join(",")}`}const K=$.target,G=document.getElementById("quick-audio");Pe(K,G),w({query:A})},addToPlaylist:($,h)=>{const D=$.target,M=document.getElementById("quick-audio");Pe(D,M),w({query:`ids:${h.id}`})}}},zs=()=>{const f=V(""),{mutate:T,loading:w,onDone:_}=Ve({document:It,appApi:!0});return _(()=>{F.emit("play_audio")}),{loading:w,playPath:f,play:y=>{f.value=y.path,T({path:y.path})},pause:()=>{F.emit("pause_audio")}}},Ns=f=>(ks("data-v-4fa682b3"),f=f(),hs(),f),Hs={class:"top-app-bar"},Qs=["checked","indeterminate"],Ks={class:"title"},Gs={key:0},js={key:1},Os={class:"actions"},Ws=["onClick"],xs={slot:"headline"},Js=["onClick"],Xs={slot:"headline"},Zs={class:"menu-items"},Ys=["onClick","selected"],eo={slot:"headline"},to=["onClick","onMouseover"],so={class:"start"},oo=["onClick","checked"],ao=["onClick","checked"],no={class:"number"},lo={class:"image"},io=["src"],co=["src","onError"],ro={class:"title"},uo={class:"subtitle"},po={class:"duration"},_o=["onClick"],mo={class:"actions"},vo={key:2,indeterminate:"",class:"spinner-sm"},go={class:"artist"},ko={class:"time"},ho={class:"start"},fo=Ns(()=>n("div",{class:"checkbox"},[n("div",{class:"skeleton-checkbox"})],-1)),yo={class:"number"},$o=as('<div class="image" data-v-4fa682b3><div class="skeleton-image" data-v-4fa682b3></div></div><div class="title" data-v-4fa682b3><div class="skeleton-text skeleton-title" data-v-4fa682b3></div></div><div class="subtitle" data-v-4fa682b3><div class="skeleton-text skeleton-subtitle" data-v-4fa682b3></div></div><div class="actions" data-v-4fa682b3><div class="skeleton-text skeleton-actions" data-v-4fa682b3></div></div><div class="artist" data-v-4fa682b3><div class="skeleton-text skeleton-artist" data-v-4fa682b3></div></div><div class="time" data-v-4fa682b3><div class="skeleton-text skeleton-time" data-v-4fa682b3></div></div>',6),bo={key:0,class:"no-data-placeholder"},P=50,Co=At({__name:"AudiosView",setup(f){var Ae;const T=Et(),{audioSortBy:w}=Le(T),_=V([]),{t:y}=Ue(),{parseQ:B}=ws(),$=St({tagIds:[]}),{app:h,urlTokenKey:D,audioPlaying:M,uploads:A}=Le(Dt()),K=t=>{var o;return M.value&&((o=h.value)==null?void 0:o.audioCurrent)===t.path},{input:G,upload:Ne,uploadChanged:ae}=Me(A),{input:He,upload:Qe,uploadChanged:ne}=Me(A),{dropping:Ke,fileDragEnter:le,fileDragLeave:ie,dropFiles:Ge}=qt(A),j=V(!1),m=Ft.AUDIO,de=Kt(),ce=de.query,O=V(parseInt(((Ae=ce.page)==null?void 0:Ae.toString())??"1")),{tags:N,buckets:W,fetch:je}=Lt(m),Oe=Mt(()=>{const t={};return W.value.forEach(o=>{t[o.id]=o}),t}),I=V(""),{addToTags:We}=Es(m,N),{deleteItems:x,deleteItem:re}=Bt(),{view:xe}=Rt(m),{selectedIds:b,allChecked:ue,realAllChecked:E,selectRealAll:Je,allCheckedAlertVisible:Xe,clearSelection:R,toggleAllChecked:pe,toggleSelect:_e,total:S,checked:J,shiftEffectingIds:me,handleItemClick:Ze,handleMouseOver:Ye,selectAll:et,shouldSelect:tt}=Is(_),{downloadItems:ve}=Pt(D,m,R,"audios.zip"),{downloadFile:ge}=ns(D),ke=t=>{const o=de.query.q;Gt(T,o?`/audios?page=${t}&q=${o}`:`/audios?page=${t}`)},{keyDown:he,keyUp:fe}=As(S,P,O,et,R,ke,()=>{se(oe.MEDIA_TRASH,h.value.osVersion)?Z(m,U()):x(m,b.value,E.value,S.value,I.value)}),{addItemsToPlaylist:st,addToPlaylist:ot}=Us(_,R),at=ls(),ye=V([]),{play:nt,playPath:lt,loading:it,pause:dt}=zs(),ct=t=>{ye.value.push(t)},{loading:X,fetch:H}=Vt({handle:(t,o)=>{j.value=!1,o?ze(y(o),"error"):t&&(_.value=t.items,S.value=t.total)},document:jt,variables:()=>({offset:(O.value-1)*P,limit:P,query:I.value,sortBy:w.value}),appApi:!0}),{trashLoading:$e,trash:Z}=Ut(),{restoreLoading:be,restore:Ce}=zt();function rt(t){return t?`/audios?q=${t}`:"/audios"}function ut(t,o){if(w.value===o){t.close();return}j.value=!0,w.value=o,t.close()}function Y(){const t=W.value.find(o=>o.id===$.bucketId);return t?fs(t.topItems[0]):`${h.value.internalStoragePath}/Music`}function pt(t){Ne(Y()),t.close()}function _t(t){Qe(Y()),t.close()}function mt(t){Ge(t,Y(),"audio")}const U=()=>{let t=I.value;return E.value||(t=`ids:${b.value.join(",")}`),t},Te=t=>{t.type===m&&(R(),H())},we=t=>{t.type===m&&H()},Ie=t=>{t.type===m&&(R(),H())};function vt(t){const o=t.tags.map(L=>L.id);is(ds,{type:m,tags:N.value,item:{key:t.id,title:t.title,size:t.size},selected:N.value.filter(L=>o.includes(L.id))})}return Nt(()=>{var t;I.value=cs(((t=ce.q)==null?void 0:t.toString())??""),B($,I.value),je(),H(),F.on("item_tags_updated",we),F.on("items_tags_updated",Te),F.on("media_items_actioned",Ie),window.addEventListener("keydown",he),window.addEventListener("keyup",fe)}),Ht(()=>{F.off("item_tags_updated",we),F.off("items_tags_updated",Te),F.off("media_items_actioned",Ie),window.removeEventListener("keydown",he),window.removeEventListener("keyup",fe)}),(t,o)=>{const L=rs,v=Ot,Ee=us,Q=ps,Se=_s,De=Vs,qe=ms,gt=$s,kt=Ts,Fe=Wt,ht=Cs,ft=bs,yt=vs,$t=gs,bt=Ls,Ct=Tt,u=xt("tooltip");return a(),c(q,null,[n("div",Hs,[n("md-checkbox",{"touch-target":"wrapper",onChange:o[0]||(o[0]=(...s)=>e(pe)&&e(pe)(...s)),checked:e(ue),indeterminate:!e(ue)&&e(J)},null,40,Qs),n("div",Ks,[e(b).length?(a(),c("span",Gs,k(t.$t("x_selected",{count:e(E)?e(S).toLocaleString():e(b).length.toLocaleString()})),1)):(a(),c("span",js,k(t.$t("page_title.audios"))+" ("+k(e(S).toLocaleString())+")",1)),e(J)?(a(),c(q,{key:2},[$.trash?(a(),c(q,{key:0},[r((a(),p(v,{onClick:o[1]||(o[1]=l(s=>e(x)(e(m),e(b),e(E),e(S),I.value),["stop"]))},{icon:d(()=>[i(L)]),_:1})),[[u,t.$t("delete")]]),r((a(),p(v,{onClick:o[2]||(o[2]=l(s=>e(Ce)(e(m),U()),["stop"])),loading:e(be)(U())},{icon:d(()=>[i(Ee)]),_:1},8,["loading"])),[[u,t.$t("restore")]]),r((a(),p(v,{onClick:o[3]||(o[3]=l(s=>e(ve)(e(E),e(b),I.value),["stop"]))},{icon:d(()=>[i(Q)]),_:1})),[[u,t.$t("download")]])],64)):(a(),c(q,{key:1},[e(se)(e(oe).MEDIA_TRASH,e(h).osVersion)?r((a(),p(v,{key:0,onClick:o[4]||(o[4]=l(s=>e(Z)(e(m),U()),["stop"])),loading:e($e)(U())},{icon:d(()=>[i(Se)]),_:1},8,["loading"])),[[u,t.$t("move_to_trash")]]):r((a(),p(v,{key:1,onClick:o[5]||(o[5]=l(s=>e(x)(e(m),e(b),e(E),e(S),I.value),["stop"]))},{icon:d(()=>[i(L)]),_:1})),[[u,t.$t("delete")]]),r((a(),p(v,{onClick:o[6]||(o[6]=l(s=>e(ve)(e(E),e(b),I.value),["stop"]))},{icon:d(()=>[i(Q)]),_:1})),[[u,t.$t("download")]]),r((a(),p(v,{onClick:o[7]||(o[7]=l(s=>e(st)(s,e(b),e(E),I.value),["stop"]))},{icon:d(()=>[i(De)]),_:1})),[[u,t.$t("add_to_playlist")]]),r((a(),p(v,{onClick:o[8]||(o[8]=l(s=>e(We)(e(b),e(E),I.value),["stop"]))},{icon:d(()=>[i(qe)]),_:1})),[[u,t.$t("add_to_tags")]])],64))],64)):z("",!0)]),n("div",Os,[i(gt,{filter:$,tags:e(N),buckets:e(W),"get-url":rt},null,8,["filter","tags","buckets"]),i(Fe,null,{content:d(s=>[n("md-menu-item",{onClick:l(C=>pt(s),["stop"])},[n("div",xs,k(t.$t("upload_files")),1)],8,Ws),n("md-menu-item",{onClick:l(C=>_t(s),["stop"])},[n("div",Xs,k(t.$t("upload_folder")),1)],8,Js)]),default:d(()=>[r((a(),p(v,null,{icon:d(()=>[i(kt)]),_:1})),[[u,t.$t("upload")]])]),_:1}),i(Fe,null,{content:d(s=>[n("div",Zs,[(a(!0),c(q,null,te(e(at),C=>(a(),c("md-menu-item",{key:C.value,onClick:ee=>ut(s,C.value),selected:C.value===e(w)},[n("div",eo,k(t.$t(C.label)),1)],8,Ys))),128))])]),default:d(()=>[r((a(),p(v,{loading:j.value},{icon:d(()=>[i(ht)]),_:1},8,["loading"])),[[u,t.$t("sort")]])]),_:1})])]),i(ft,{limit:P,total:e(S),"all-checked-alert-visible":e(Xe),"real-all-checked":e(E),"select-real-all":e(Je),"clear-selection":e(R)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),n("div",{class:"scroll-content",onDragover:o[13]||(o[13]=l((...s)=>e(le)&&e(le)(...s),["stop","prevent"]))},[r(n("div",{class:"drag-mask",onDrop:l(mt,["stop","prevent"]),onDragleave:o[9]||(o[9]=l((...s)=>e(ie)&&e(ie)(...s),["stop","prevent"]))},k(t.$t("release_to_send_files")),545),[[Qt,e(Ke)]]),n("div",{class:Be(["audio-list",{"select-mode":e(J)}])},[(a(!0),c(q,null,te(_.value,(s,C)=>{var ee;return a(),c("section",{class:Be(["media-item selectable-card",{selected:e(b).includes(s.id),selecting:e(me).includes(s.id)}]),key:s.id,onClick:l(g=>e(Ze)(g,s,C,()=>{e(nt)(s)}),["stop"]),onMouseover:g=>e(Ye)(g,C)},[n("div",so,[e(me).includes(s.id)?(a(),c("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",onClick:l(g=>e(_e)(g,s,C),["stop"]),checked:e(tt)},null,8,oo)):(a(),c("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",onClick:l(g=>e(_e)(g,s,C),["stop"]),checked:e(b).includes(s.id)},null,8,ao)),n("span",no,[i(yt,{id:C+1,raw:s},null,8,["id","raw"])])]),n("div",lo,[ye.value.includes(s.id)?(a(),c("img",{key:0,src:`/ficons/${e(Jt)(s.path)}.svg`,class:"svg"},null,8,io)):(a(),c("img",{key:1,class:"image-thumb",src:e(Xt)(s.albumFileId,"&w=200&h=200"),onError:g=>ct(s.id)},null,40,co))]),n("div",ro,k(s.title),1),n("div",uo,[n("span",null,k(e(Zt)(s.size)),1),n("span",po,k(e(Yt)(s.duration)),1),n("a",{onClick:l(g=>e(xe)(e(T),s.bucketId),["stop","prevent"])},k((ee=Oe.value[s.bucketId])==null?void 0:ee.name),9,_o),i($t,{tags:s.tags,type:e(m),"only-links":!0},null,8,["tags","type"])]),n("div",mo,[$.trash?(a(),c(q,{key:0},[r((a(),p(v,{class:"sm",onClick:l(g=>e(re)(e(m),s),["stop"])},{icon:d(()=>[i(L)]),_:2},1032,["onClick"])),[[u,t.$t("delete")]]),r((a(),p(v,{class:"sm",onClick:l(g=>e(Ce)(e(m),`ids:${s.id}`),["stop"]),loading:e(be)(`ids:${s.id}`)},{icon:d(()=>[i(Ee)]),_:2},1032,["onClick","loading"])),[[u,t.$t("restore")]]),r((a(),p(v,{class:"sm",onClick:l(g=>e(ge)(s.path,e(Re)(s.path).replace(" ","-")),["stop"])},{icon:d(()=>[i(Q)]),_:2},1032,["onClick"])),[[u,t.$t("download")]])],64)):(a(),c(q,{key:1},[e(se)(e(oe).MEDIA_TRASH,e(h).osVersion)?r((a(),p(v,{key:0,class:"sm",onClick:l(g=>e(Z)(e(m),`ids:${s.id}`),["stop"]),loading:e($e)(`ids:${s.id}`)},{icon:d(()=>[i(Se)]),_:2},1032,["onClick","loading"])),[[u,t.$t("move_to_trash")]]):r((a(),p(v,{key:1,class:"sm",onClick:l(g=>e(re)(e(m),s),["stop"])},{icon:d(()=>[i(L)]),_:2},1032,["onClick"])),[[u,t.$t("delete")]]),r((a(),p(v,{class:"sm",onClick:l(g=>e(ge)(s.path,e(Re)(s.path).replace(" ","-")),["stop"])},{icon:d(()=>[i(Q)]),_:2},1032,["onClick"])),[[u,t.$t("download")]]),r((a(),p(v,{class:"sm",onClick:l(g=>e(ot)(g,s),["stop","prevent"])},{icon:d(()=>[i(De)]),_:2},1032,["onClick"])),[[u,t.$t("add_to_playlist")]]),r((a(),p(v,{class:"sm",onClick:l(g=>vt(s),["stop"])},{icon:d(()=>[i(qe)]),_:2},1032,["onClick"])),[[u,t.$t("add_to_tags")]])],64)),e(it)&&s.path===e(lt)?(a(),c("md-circular-progress",vo)):K(s)?r((a(),p(v,{key:3,class:"sm",onClick:o[10]||(o[10]=l(g=>e(dt)(),["stop"]))},{icon:d(()=>[i(bt)]),_:1})),[[u,t.$t("pause")]]):z("",!0)]),n("div",go,k(s.artist),1),n("div",ko,[r((a(),c("span",null,[ts(k(e(ss)(s.createdAt)),1)])),[[u,e(es)(s.createdAt)]])])],42,to)}),128)),e(X)&&_.value.length===0?(a(),c(q,{key:0},te(20,s=>n("section",{class:"media-item selectable-card-skeleton",key:s},[n("div",ho,[fo,n("span",yo,k(s),1)]),$o])),64)):z("",!0)],2),!e(X)&&_.value.length===0?(a(),c("div",bo,k(t.$t(e(os)(e(X),e(h).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):z("",!0),e(S)>P?(a(),p(Ct,{key:1,page:O.value,go:ke,total:e(S),limit:P},null,8,["page","total"])):z("",!0),n("input",{ref_key:"fileInput",ref:G,style:{display:"none"},type:"file",accept:"audio/*",multiple:"",onChange:o[11]||(o[11]=(...s)=>e(ae)&&e(ae)(...s))},null,544),n("input",{ref_key:"dirFileInput",ref:He,style:{display:"none"},type:"file",accept:"audio/*",multiple:"",webkitdirectory:"",mozdirectory:"",directory:"",onChange:o[12]||(o[12]=(...s)=>e(ne)&&e(ne)(...s))},null,544)],32)],64)}}}),Bo=ys(Co,[["__scopeId","data-v-4fa682b3"]]);export{Bo as default};
