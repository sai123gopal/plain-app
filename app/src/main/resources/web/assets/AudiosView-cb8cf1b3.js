import{u as kt,_ as $t,a as Ct}from"./list-ecca0f33.js";import{o as u,c as p,e as t,Z as Y,aw as wt,u as tt,M as g,t as D,r as f,ax as Tt,d as qt,q as Vt,s as At,a as It,C as St,H as I,p as Mt,D as Dt,E as Lt,G as Qt,a4 as Bt,aq as Pt,I as Rt,ay as Ut,K as Zt,L as zt,f as i,j as n,F as T,w as d,l as S,g as a,y as Ft,N as M,O as Nt,P as Et,Q as O,R as Gt,A as W,z as Kt,az as Ht,U as j,a0 as xt,m as Ot,a9 as Wt,B as X,V as J,ai as jt,W as Xt,a1 as Jt,aA as Yt,aa as te,ab as ee,_ as oe}from"./index-5f5c60b6.js";import{_ as se}from"./FieldId-7a42c5ae.js";import{_ as ne}from"./Multiselect-6a97b930.js";import{_ as ae,a as le}from"./label-outline-rounded-f959da46.js";import{_ as ie}from"./download-rounded-2da2fb73.js";import{_ as de}from"./delete-outline-rounded-fee50069.js";import{_ as ue}from"./Breadcrumb-d5bdebe4.js";import{n as ce}from"./list-6498ebd9.js";import{u as re,a as _e,b as pe}from"./tags-d534ff65.js";import{u as me,_ as he}from"./ConfirmModal.vuevuetypescriptsetuptruelang-27a0159b.js";import{_ as be}from"./DeleteConfirm.vuevuetypescriptsetuptruelang-42857978.js";import"./VModal.vuevuetypescriptsetuptruelang-61cd4dae.js";import"./vee-validate.esm-e0a551fe.js";const ye={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},ve=t("path",{fill:"currentColor",d:"M9.5 9.325v5.35q0 .6.525.875t1.025-.05l4.15-2.65q.475-.275.475-.85t-.475-.85L11.05 8.5q-.5-.325-1.025-.05t-.525.875ZM12 22q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22Zm0-10Zm0 8q3.325 0 5.663-2.337T20 12q0-3.325-2.337-5.663T12 4Q8.675 4 6.337 6.337T4 12q0 3.325 2.337 5.663T12 20Z"},null,-1),fe=[ve];function ge(c,m){return u(),p("svg",ye,fe)}const ke={name:"material-symbols-play-circle-outline-rounded",render:ge},$e={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Ce=t("path",{fill:"currentColor",d:"M3 16v-2h7v2H3Zm0-4v-2h11v2H3Zm0-4V6h11v2H3Zm13 12v-4h-4v-2h4v-4h2v4h4v2h-4v4h-2Z"},null,-1),we=[Ce];function Te(c,m){return u(),p("svg",$e,we)}const qe={name:"material-symbols-playlist-add",render:Te},Ve=c=>{const{mutate:m,loading:l,onDone:y}=Y({document:wt,appApi:!0}),{t:_}=tt();return y(()=>{g.emit("refetch_app"),D(_("added_to_playlist"))}),{loading:l,addItemsToPlaylist:()=>{const r=c.value.filter(k=>k.checked);if(r.length===0){D(_("select_first"),"error");return}m({paths:r.map(k=>k.path)})},addToPlaylist:r=>{m({paths:[r.path]})}}},Ae=()=>{const c=f(""),{mutate:m,loading:l,onDone:y}=Y({document:Tt,appApi:!0});return y(()=>{g.emit("refetch_app"),g.emit("play_audio")}),{loading:l,playing:c,play:_=>{c.value=_.path,m({path:_.path})}}},et=c=>(te("data-v-78eede3c"),c=c(),ee(),c),Ie={class:"v-toolbar"},Se={class:"right-actions"},Me=["title"],De=["title"],Le=["title"],Qe=["title"],Be=["title"],Pe=["onClick"],Re={class:"row mb-3"},Ue={class:"col-md-3 col-form-label"},Ze={class:"col-md-9"},ze=["onKeyup"],Fe={class:"row mb-3"},Ne={class:"col-md-3 col-form-label"},Ee={class:"col-md-9"},Ge={class:"actions"},Ke=["onClick"],He={class:"table"},xe=et(()=>t("th",null,"ID",-1)),Oe=et(()=>t("th",null,null,-1)),We=["onClick"],je=["onUpdate:modelValue"],Xe={class:"nowrap"},Je={class:"audio-btns"},Ye={key:0,class:"spinner spinner-sm"},to={class:"badge"},eo={class:"nowrap"},oo={key:0},so={colspan:"8"},no={class:"no-data-placeholder"},ao=qt({__name:"AudiosView",setup(c){var E,G;const m=Vt(),l=f([]),{t:y}=tt(),{app:_}=At(It()),r=St({text:"",tags:[]}),k=I(()=>_.value.audios??[]);I(()=>{const o=_.value.audioCurrent;return k.value.find(s=>s.path==o)});const ot=I(()=>l.value.some(o=>o.checked)),b="AUDIO",L=Mt().query,$=f(parseInt(((E=L.page)==null?void 0:E.toString())??"1")),C=50,w=f(0),v=f(Dt(((G=L.q)==null?void 0:G.toString())??"")),Q=f(""),{tags:q}=re(b,v,r,async o=>{Q.value=Lt(o),await Qt(),ct()}),{addItemsToPlaylist:B,addToPlaylist:st}=Ve(l),{addToTags:P}=_e(b,l,q),{removeFromTags:R}=pe(b,l,q),{deleteItems:U}=me(b,l),{downloadItems:Z}=Bt(l,"audios.zip"),{downloadFile:nt}=Wt(_),at=Pt(),{play:lt,playing:it,loading:dt}=Ae(),{selectAll:V,toggleSelect:z}=kt(l),{loading:ut,load:ct,refetch:rt}=Rt({handle:(o,s)=>{s?D(y(s),"error"):o&&(l.value=o.audios.map(A=>({...A,checked:!1})),w.value=o.audioCount)},document:Ut,variables:()=>({offset:($.value-1)*C,limit:C,query:Q.value}),appApi:!0});Zt($,o=>{X(m,`/audios?page=${o}&q=${J(v.value)}`)});function _t(){at.push("/files"),jt(he,{message:y("upload_audios")})}function F(){v.value=Xt(r),N()}function N(){X(m,`/audios?q=${J(v.value)}`)}zt(()=>{g.on("refetch_by_tag_type",o=>{o===b&&rt()})});function pt(o){Jt(be,{id:o.id,name:o.title,gql:Yt,variables:()=>({tagType:b,id:o.id}),appApi:!0,typeName:"Audio",done:()=>{g.emit("refetch_app"),g.emit("refetch_by_tag_type",b)}})}return(o,s)=>{const A=ue,K=de,H=ie,x=qe,mt=ae,ht=le,bt=ne,yt=$t,vt=se,ft=ke,gt=Ct;return u(),p(T,null,[t("div",Ie,[i(A,{current:()=>`${o.$t("page_title.audios")} (${w.value})`},null,8,["current"]),t("div",Se,[n(ot)?(u(),p(T,{key:0},[t("button",{type:"button",class:"btn btn-action",onClick:s[0]||(s[0]=d((...e)=>n(U)&&n(U)(...e),["stop"])),title:o.$t("delete")},[i(K,{class:"bi"})],8,Me),t("button",{type:"button",class:"btn btn-action",onClick:s[1]||(s[1]=d((...e)=>n(Z)&&n(Z)(...e),["stop"])),title:o.$t("download")},[i(H,{class:"bi"})],8,De),t("button",{type:"button",class:"btn btn-action",onClick:s[2]||(s[2]=d((...e)=>n(B)&&n(B)(...e),["stop"])),title:o.$t("add_to_playlist")},[i(x,{class:"bi"})],8,Le),t("button",{type:"button",class:"btn btn-action",onClick:s[3]||(s[3]=d((...e)=>n(P)&&n(P)(...e),["stop"])),title:o.$t("add_to_tags")},[i(mt,{class:"bi"})],8,Qe),t("button",{type:"button",class:"btn btn-action",onClick:s[4]||(s[4]=d((...e)=>n(R)&&n(R)(...e),["stop"])),title:o.$t("remove_from_tags")},[i(ht,{class:"bi"})],8,Be)],64)):S("",!0),t("button",{type:"button",class:"btn btn-action",onClick:d(_t,["stop"])},a(o.$t("upload")),9,Pe),i(yt,{modelValue:v.value,"onUpdate:modelValue":s[7]||(s[7]=e=>v.value=e),search:N},{filters:Ft(()=>[t("div",Re,[t("label",Ue,a(o.$t("keywords")),1),t("div",Ze,[M(t("input",{type:"text","onUpdate:modelValue":s[5]||(s[5]=e=>r.text=e),class:"form-control",onKeyup:Et(F,["enter"])},null,40,ze),[[Nt,r.text]])])]),t("div",Fe,[t("label",Ne,a(o.$t("tags")),1),t("div",Ee,[i(bt,{modelValue:r.tags,"onUpdate:modelValue":s[6]||(s[6]=e=>r.tags=e),label:"name","track-by":"id",options:n(q)},null,8,["modelValue","options"])])]),t("div",Ge,[t("button",{type:"button",class:"btn",onClick:d(F,["stop"])},a(o.$t("search")),9,Ke)])]),_:1},8,["modelValue"])])]),t("table",He,[t("thead",null,[t("tr",null,[t("th",null,[M(t("input",{class:"form-check-input",type:"checkbox",onChange:s[8]||(s[8]=(...e)=>n(z)&&n(z)(...e)),"onUpdate:modelValue":s[9]||(s[9]=e=>Gt(V)?V.value=e:null)},null,544),[[O,n(V)]])]),xe,t("th",null,a(o.$t("name")),1),Oe,t("th",null,a(o.$t("artist")),1),t("th",null,a(o.$t("tags")),1),t("th",null,a(o.$t("duration")),1),t("th",null,a(o.$t("file_size")),1)])]),t("tbody",null,[(u(!0),p(T,null,W(l.value,e=>(u(),p("tr",{key:e.id,class:Kt({checked:e.checked}),onClick:d(h=>e.checked=!e.checked,["stop"])},[t("td",null,[M(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":h=>e.checked=h},null,8,je),[[O,e.checked]])]),t("td",null,[i(vt,{id:e.id,raw:e},null,8,["id","raw"])]),t("td",null,a(e.title),1),t("td",Xe,[t("span",Je,[i(K,{class:"bi bi-btn",onClick:d(h=>pt(e),["stop"])},null,8,["onClick"]),i(H,{class:"bi bi-btn",onClick:d(h=>n(nt)(e.path,n(Ht)(e.path).replace(" ","-")),["stop"])},null,8,["onClick"]),i(x,{class:"bi bi-btn",onClick:d(h=>n(st)(e),["stop"])},null,8,["onClick"]),n(dt)&&e.path===n(it)?(u(),p("i",Ye)):(u(),j(ft,{key:1,class:"bi bi-btn",onClick:d(h=>n(lt)(e),["stop"])},null,8,["onClick"]))])]),t("td",null,a(e.artist),1),t("td",null,[(u(!0),p(T,null,W(e.tags,h=>(u(),p("span",to,a(h.name),1))),256))]),t("td",eo,a(n(xt)(e.duration)),1),t("td",null,a(n(Ot)(e.size)),1)],10,We))),128))]),l.value.length?S("",!0):(u(),p("tfoot",oo,[t("tr",null,[t("td",so,[t("div",no,a(o.$t(n(ce)(n(ut),n(_).permissions,"WRITE_EXTERNAL_STORAGE"))),1)])])]))]),w.value>C?(u(),j(gt,{key:0,modelValue:$.value,"onUpdate:modelValue":s[10]||(s[10]=e=>$.value=e),total:w.value,limit:C},null,8,["modelValue","total"])):S("",!0)],64)}}});const $o=oe(ao,[["__scopeId","data-v-78eede3c"]]);export{$o as default};
