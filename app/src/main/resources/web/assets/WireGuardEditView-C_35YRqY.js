import{_ as M}from"./MonacoEditor.vuevuetypescriptsetuptruelang-DhAxQ-me.js";import{_ as P}from"./EditToolbar.vuevuetypescriptsetuptruelang-Cj6nFd54.js";import{_ as S}from"./Breadcrumb-nTZpptou.js";import{d as j,g as D,h as _,l as O,C as h,ac as x,bW as U,j as T,c as Q,p as A,m as F,O as R,Q as q,o as N}from"./index-Dn0O6zoH.js";import{p as G,g as W}from"./parser-DNY2aV9Q.js";function s(a){const t=new Float64Array(16);if(a)for(let r=0;r<a.length;++r)t[r]=a[r];return t}function z(a,t){let r,e=s(),o=s();for(var n=0;n<16;++n)o[n]=t[n];v(o),v(o),v(o);for(let i=0;i<2;++i){e[0]=o[0]-65517;for(var n=1;n<15;++n)e[n]=o[n]-65535-(e[n-1]>>16&1),e[n-1]&=65535;e[15]=o[15]-32767-(e[14]>>16&1),r=e[15]>>16&1,e[14]&=65535,y(o,e,1-r)}for(var n=0;n<16;++n)a[2*n]=o[n]&255,a[2*n+1]=o[n]>>8}function v(a){for(let t=0;t<16;++t)a[(t+1)%16]+=(t<15?1:38)*Math.floor(a[t]/65536),a[t]&=65535}function y(a,t,r){let e,o=~(r-1);for(let n=0;n<16;++n)e=o&(a[n]^t[n]),a[n]^=e,t[n]^=e}function w(a,t,r){for(let e=0;e<16;++e)a[e]=t[e]+r[e]|0}function K(a,t,r){for(let e=0;e<16;++e)a[e]=t[e]-r[e]|0}function l(a,t,r){const e=new Float64Array(31);for(let o=0;o<16;++o)for(let n=0;n<16;++n)e[o+n]+=t[o]*r[n];for(let o=0;o<15;++o)e[o]+=38*e[o+16];for(let o=0;o<16;++o)a[o]=e[o];v(a),v(a)}function H(a,t){const r=s();for(let e=0;e<16;++e)r[e]=t[e];for(let e=253;e>=0;--e)l(r,r,r),e!==2&&e!==4&&l(r,r,t);for(let e=0;e<16;++e)a[e]=r[e]}function k(a){a[31]=a[31]&127|64,a[0]&=248}function J(a){let t;const r=new Uint8Array(32),e=s([1]),o=s([9]),n=s(),i=s([1]),f=s(),g=s(),$=s([56129,1]),I=s([9]);for(var u=0;u<32;++u)r[u]=a[u];k(r);for(var u=254;u>=0;--u)t=r[u>>>3]>>>(u&7)&1,y(e,o,t),y(n,i,t),w(f,e,n),K(e,e,n),w(n,o,i),K(o,o,i),l(i,f,f),l(g,e,e),l(e,n,e),l(n,o,f),w(f,e,n),K(e,e,n),l(o,e,e),K(n,i,g),l(e,n,$),w(e,e,i),l(n,n,e),l(e,i,g),l(i,o,I),l(o,f,f),y(e,o,t),y(n,i,t);return H(n,n),l(e,e,n),z(r,e),r}function L(){const a=new Uint8Array(32);return crypto.getRandomValues(a),a}function X(){const a=L();return k(a),a}function B(a,t){const r=Uint8Array.from([t[0]>>2&63,(t[0]<<4|t[1]>>4)&63,(t[1]<<2|t[2]>>6)&63,t[2]&63]);for(let e=0;e<4;++e)a[e]=r[e]+65+(25-r[e]>>8&6)-(51-r[e]>>8&75)-(61-r[e]>>8&15)+(62-r[e]>>8&3)}function C(a){let t;const r=new Uint8Array(44);for(t=0;t<32/3;++t)B(r.subarray(t*4),a.subarray(t*3));return B(r.subarray(t*4),Uint8Array.from([a[t*3+0],a[t*3+1],0])),r[43]=61,new TextDecoder().decode(r)}const Y=()=>{const a=X(),t=J(a);return{publicKey:C(t),privateKey:C(a)}},re=j({__name:"WireGuardEditView",setup(a){const{t}=D(),r=_(0),o=q().params.id,n=_(""),i=_(""),f=_(!1),g=[{id:"add-peer",label:"Add peer",precondition:null,keybindingContext:null,contextMenuGroupId:"navigation",contextMenuOrder:0,run:function(){var b;const c=G(n.value);c.wgInterface.table="off";const d=((b=c.wgInterface.address)==null?void 0:b[0])??"",m=Y(),p=c.peers.length;c.peers.push({name:`Peer ${p+1}`,allowedIps:[d.substring(0,d.lastIndexOf("."))+`.${p+2}/32`],privateKey:m.privateKey,publicKey:m.publicKey}),n.value=W(c)}}];O({handle:(c,d)=>{if(d)h(t(d),"error");else{const m=c.wireGuards.find(p=>p.id===o);if(m){n.value=m.config;const p=G(m.config);i.value=(p==null?void 0:p.wgInterface.name)??"",f.value=m.isEnabled}}},document:x`
    query {
      wireGuards {
        ...WireGuardFragment
      }
    }
    ${U}
  `});const{mutate:$,loading:I,onDone:u}=T({document:x`
    mutation applyWireGuard($id: ID!, $config: String!, $enable: Boolean!) {
      applyWireGuard(id: $id, config: $config, enable: $enable) {
        ...WireGuardFragment
      }
    }
    ${U}
  `});u(()=>{h(t("saved"))});const E=async()=>{if(!n.value)return;const c=G(n.value);c.wgInterface.table="off",n.value=W(c),$({id:o,config:n.value,enable:f.value})};return(c,d)=>{const m=S,p=P,b=M;return N(),Q(R,null,[A(m,{paths:["/wireguard"],current:i.value},null,8,["current"]),A(p,{modelValue:r.value,"onUpdate:modelValue":d[0]||(d[0]=V=>r.value=V),save:E,loading:F(I),tabs:[`/etc/wireguard/${F(o)}.conf`]},null,8,["modelValue","loading","tabs"]),A(b,{language:"ini",height:"700",modelValue:n.value,"onUpdate:modelValue":d[1]||(d[1]=V=>n.value=V),actions:g},null,8,["modelValue"])],64)}}});export{re as default};
