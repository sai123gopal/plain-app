import{u as $e,_ as be,a as Ce,b as we}from"./list-bea8e7b0.js";import{P,d as Se,ae as Ae,e as De,r as g,u as Ie,s as Ve,f as Ue,K as Te,af as qe,L as Pe,D as Qe,M as Be,ag as Fe,T as Y,g as Le,w as ze,i as Me,N as Re,O as Ne,Q as Ge,R as Ke,c as i,a as t,p as r,j as n,m as p,l as _,k as T,h as A,t as a,H as je,F as q,J as xe,S as Ee,x as He,ah as Je,ai as Oe,C as D,W as I,aj as We,ak as Ye,o,v as Ze,I as Xe,z as et,Y as Z,Z as X,$ as tt,al as st,am as nt,a5 as lt,ad as at}from"./index-9c78c93b.js";import{_ as ot}from"./Breadcrumb-56c0fca0.js";const ee=m=>{P.emit("tap_phone",m)};function it(m,V){const $=m.findIndex(b=>b.id===V);$!==-1&&m.splice($,1)}const ct={class:"v-toolbar"},dt=t("md-ripple",null,null,-1),ut=["onClick"],rt=t("md-ripple",null,null,-1),pt={class:"filters"},_t={class:"form-row"},ht=["label"],ft={class:"buttons"},mt=["onClick"],kt={class:"table-responsive"},vt={class:"table"},gt=["checked","indeterminate"],yt=t("th",null,null,-1),$t=t("th",null,null,-1),bt=["onClick"],Ct=["checked"],wt=["src"],St={class:"v-center"},At={class:"nowrap"},Dt={class:"action-btns"},It={indeterminate:"",class:"spinner-sm"},Vt=["onClick"],Ut=["onClick"],Tt=t("md-ripple",null,null,-1),qt=["onClick"],Pt=t("md-ripple",null,null,-1),Qt={class:"nowrap"},Bt={class:"nowrap"},Ft={class:"nowrap"},Lt={class:"nowrap"},zt={key:0},Mt={colspan:"8"},Rt={class:"no-data-placeholder"},y=50,jt=Se({__name:"AppsView",setup(m){var J,O;const{input:V,upload:$,uploadChanged:b}=Ae(),C=De(),c=g([]),Q=g(),{t:B}=Ie(),{app:te,urlTokenKey:U}=Ve(Ue()),w=Te({text:"",tags:[]}),{allChecked:F,realAllChecked:L,selectRealAll:se,allCheckedAlertVisible:ne,clearSelection:z,toggleAllChecked:M,toggleItemChecked:R,toggleRow:le,total:k,checked:N}=$e(c),{downloadItems:ae}=qe(U,Pe.PACKAGE,c,z,"apps.zip"),{downloadFile:oe}=st(U),G=Qe(),K=G.query,S=g(parseInt(((J=K.page)==null?void 0:J.toString())??"1")),d=g(Be(((O=K.q)==null?void 0:O.toString())??"")),j=Fe(d.value),h=G.params.type;h&&j.push({name:"type",op:"",value:h});const x=g(Y(j)),ie=()=>{$(te.value.downloadsDir)},ce=e=>{e.isUninstalling=!1},{loading:de}=Le({handle:(e,l)=>{l?He(B(l),"error"):e&&(c.value=e.packages.map(u=>({...u,checked:!1,icon:Je(U.value,"pkgicon://"+u.id)})),k.value=e.packageCount)},document:Oe,variables:()=>({offset:(S.value-1)*y,limit:y,query:x.value}),appApi:!0});ze(S,e=>{h?D(C,`/apps/${h}?page=${e}&q=${I(d.value)}`):D(C,`/apps?page=${e}&q=${I(d.value)}`)});function ue(){const e=[];w.text&&e.push({name:"text",op:"",value:w.text}),d.value=Y(e),E(),Q.value.dismiss()}function E(){h?D(C,`/apps/${h}?q=${I(d.value)}`):D(C,`/apps?q=${I(d.value)}`)}const{mutate:re}=Me({document:We,appApi:!0});function pe(e){e.isUninstalling=!0,ee(B("confirm_uninstallation_on_phone")),re({id:e.id})}const{loading:_e,load:he,refetch:fe}=Re({handle:(e,l)=>{if(e)for(const u of e.packageStatuses)u.exist||(it(c.value,u.id),ee(""))},document:Ye,variables:()=>({ids:c.value.filter(e=>e.isUninstalling).map(e=>e.id)}),appApi:!0}),H=e=>{e.status};return Ne(()=>{P.on("upload_task_done",H);let e=!0;setInterval(()=>{c.value.some(l=>l.isUninstalling)&&!_e.value&&(e?(he(),e=!1):fe())},1e3)}),Ge(()=>{P.off("upload_task_done",H)}),(e,l)=>{const u=ot,W=nt,me=be,ke=Ce,ve=lt,ge=at,ye=we,f=Ke("tooltip");return o(),i(q,null,[t("div",ct,[r(u,{current:()=>`${e.$t("page_title.apps")} (${n(k)})`},null,8,["current"]),n(N)?p((o(),i("button",{key:0,class:"icon-button",onClick:l[0]||(l[0]=_(s=>n(ae)(n(L),x.value),["stop"]))},[dt,r(W)])),[[f,e.$t("download")]]):T("",!0),t("button",{class:"icon-button",onClick:_(ie,["stop"]),style:{display:"none"}},[rt,A(" "+a(e.$t("install")),1)],8,ut),r(me,{ref_key:"searchInputRef",ref:Q,modelValue:d.value,"onUpdate:modelValue":l[2]||(l[2]=s=>d.value=s),search:E},{filters:je(()=>[t("div",pt,[t("div",_t,[p(t("md-outlined-text-field",{label:e.$t("keywords"),"onUpdate:modelValue":l[1]||(l[1]=s=>w.text=s),"keyup.enter":"applyAndDoSearch"},null,8,ht),[[Ze,w.text]])]),t("div",ft,[t("md-filled-button",{onClick:_(ue,["stop"])},a(e.$t("search")),9,mt)])])]),_:1},8,["modelValue"])]),r(ke,{limit:y,total:n(k),"all-checked-alert-visible":n(ne),"real-all-checked":n(L),"select-real-all":n(se),"clear-selection":n(z)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),t("div",kt,[t("table",vt,[t("thead",null,[t("tr",null,[t("th",null,[t("md-checkbox",{"touch-target":"wrapper",onChange:l[3]||(l[3]=(...s)=>n(M)&&n(M)(...s)),checked:n(F),indeterminate:!n(F)&&n(N)},null,40,gt)]),yt,t("th",null,a(e.$t("name")),1),$t,t("th",null,a(e.$t("size")),1),t("th",null,a(e.$t("type")),1),t("th",null,a(e.$t("installed_at")),1),t("th",null,a(e.$t("updated_at")),1)])]),t("tbody",null,[(o(!0),i(q,null,xe(c.value,s=>(o(),i("tr",{key:s.id,class:Xe({selected:s.checked}),onClick:_(v=>n(le)(s),["stop"])},[t("td",null,[t("md-checkbox",{"touch-target":"wrapper",onChange:l[4]||(l[4]=(...v)=>n(R)&&n(R)(...v)),checked:s.checked},null,40,Ct)]),t("td",null,[t("img",{width:"50",height:"50",src:s.icon},null,8,wt)]),t("td",null,[t("strong",St,a(s.name)+" ("+a(s.version)+")",1),r(ve,{id:s.id,raw:s},null,8,["id","raw"])]),t("td",At,[t("div",Dt,[s.isUninstalling?(o(),i(q,{key:0},[p(t("md-circular-progress",It,null,512),[[f,e.$t("uninstalling")]]),A(" Â "),t("md-outlined-button",{class:"btn-sm",onClick:_(v=>ce(s),["stop"])},a(e.$t("cancel")),9,Vt)],64)):p((o(),i("button",{key:1,class:"icon-button",onClick:_(v=>pe(s),["stop"])},[Tt,r(ge)],8,Ut)),[[f,e.$t("uninstall")]]),p((o(),i("button",{class:"icon-button",onClick:_(v=>n(oe)(s.path,`${s.name.replace(" ","")}-${s.id}.apk`),["stop"])},[Pt,r(W)],8,qt)),[[f,e.$t("download")]])])]),t("td",Qt,a(n(et)(s.size)),1),t("td",Bt,a(e.$t("app_type."+s.type)),1),t("td",Ft,[p((o(),i("span",null,[A(a(n(X)(s.installedAt)),1)])),[[f,n(Z)(s.installedAt)]])]),t("td",Lt,[p((o(),i("span",null,[A(a(n(X)(s.updatedAt)),1)])),[[f,n(Z)(s.updatedAt)]])])],10,bt))),128))]),c.value.length?T("",!0):(o(),i("tfoot",zt,[t("tr",null,[t("td",Mt,[t("div",Rt,a(e.$t(n(tt)(n(de)))),1)])])]))])]),n(k)>y?(o(),Ee(ye,{key:0,modelValue:S.value,"onUpdate:modelValue":l[5]||(l[5]=s=>S.value=s),total:n(k),limit:y},null,8,["modelValue","total"])):T("",!0),t("input",{ref_key:"fileInput",ref:V,style:{display:"none"},type:"file",accept:".apk",multiple:"",onChange:l[6]||(l[6]=(...s)=>n(b)&&n(b)(...s))},null,544)],64)}}});export{jt as default};
