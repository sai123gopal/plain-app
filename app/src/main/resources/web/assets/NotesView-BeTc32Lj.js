import{_ as Ee}from"./VPagination.vuevuetypescriptsetuptruelang-CFupeDJR.js";import{o as s,c as o,a as n,d as Qe,u as He,h as z,g as Be,I as Ue,J as Ge,K as Ke,j as E,b5 as je,a1 as S,L as Re,M as Fe,m as t,t as k,O as g,x as p,w as i,p as c,e as T,P as Oe,v as oe,q as ne,N as ae,Q as Pe,C as Je,b6 as We,b7 as Xe,b8 as Ye,b9 as Ze,ba as et,S as tt,bb as st,U as ot,V as nt,W as at,bc as lt,X as it,F as ct,G as dt,Y as rt,f as le,Z as ie,$ as ut,b1 as _t,ac as pt,ad as ht,a6 as ce,a0 as mt,ae as vt,a2 as kt,a3 as gt,a4 as ft,H as yt}from"./index-Dn0O6zoH.js";import{_ as bt,a as qt,b as Tt}from"./SearchInput-aem6tEJK.js";import{u as $t,b as Ct,a as wt}from"./key-events-CgPzNP0J.js";import{u as Nt,a as St}from"./tags-CvPqo38V.js";import{u as Lt}from"./search-DrT1IjAg.js";import"./search-rounded-C8Nl_ZR1.js";import"./rss-feed-rounded-Dqku7i1k.js";import"./vee-validate.esm-0lx5owW0.js";const Vt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},At=n("path",{fill:"currentColor",d:"M19 17.7v1.8q0 .2.15.35t.35.15t.35-.15t.15-.35v-3q0-.2-.15-.35T19.5 16h-3q-.2 0-.35.15t-.15.35t.15.35t.35.15h1.8l-2.45 2.45q-.15.15-.15.35t.15.35t.35.15t.35-.15zM5 21q-.825 0-1.412-.587T3 19V5q0-.825.588-1.412T5 3h14q.825 0 1.413.588T21 5v5q0 .425-.288.713T20 11t-.712-.288T19 10V5H5v14h5q.425 0 .713.288T11 20t-.288.713T10 21zm0-3v1V5v6.075V11zm2-2q0 .425.288.713T8 17h2.075q.425 0 .713-.288t.287-.712t-.287-.712t-.713-.288H8q-.425 0-.712.288T7 16m0-4q0 .425.288.713T8 13h5q.425 0 .713-.288T14 12t-.288-.712T13 11H8q-.425 0-.712.288T7 12m0-4q0 .425.288.713T8 9h8q.425 0 .713-.288T17 8t-.288-.712T16 7H8q-.425 0-.712.288T7 8m11 15q-2.075 0-3.537-1.463T13 18t1.463-3.537T18 13t3.538 1.463T23 18t-1.463 3.538T18 23"},null,-1),Dt=[At];function It($,L){return s(),o("svg",Vt,[...Dt])}const Mt={name:"material-symbols-export-notes-outline-rounded",render:It},xt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},zt=n("path",{fill:"currentColor",d:"M7 21q-.825 0-1.412-.587T5 19V6q-.425 0-.712-.288T4 5t.288-.712T5 4h4q0-.425.288-.712T10 3h4q.425 0 .713.288T15 4h4q.425 0 .713.288T20 5t-.288.713T19 6v13q0 .825-.587 1.413T17 21zM17 6H7v13h10zM7 6v13zm4 5.85V15q0 .425.288.713T12 16t.713-.288T13 15v-3.15l.9.875q.275.275.688.275t.712-.3q.275-.275.275-.7t-.275-.7l-2.6-2.6q-.3-.3-.7-.3t-.7.3l-2.6 2.6q-.275.275-.287.688t.287.712q.275.275.688.288t.712-.263z"},null,-1),Et=[zt];function Qt($,L){return s(),o("svg",xt,[...Et])}const Ht={name:"material-symbols-restore-from-trash-outline-rounded",render:Qt},h=$=>(ct("data-v-9cf46d41"),$=$(),dt(),$),Bt={class:"top-app-bar"},Ut=["checked","indeterminate"],Gt={class:"title"},Kt={key:0},jt={key:1},Rt=h(()=>n("md-ripple",null,null,-1)),Ft=h(()=>n("md-ripple",null,null,-1)),Ot=h(()=>n("md-ripple",null,null,-1)),Pt=h(()=>n("md-ripple",null,null,-1)),Jt=h(()=>n("md-ripple",null,null,-1)),Wt={class:"actions"},Xt={key:0,class:"scroller"},Yt={class:"start"},Zt=h(()=>n("div",{class:"checkbox"},[n("div",{class:"skeleton-checkbox"})],-1)),es={class:"number"},ts=rt('<div class="title" data-v-9cf46d41><div class="skeleton-text skeleton-title" data-v-9cf46d41></div></div><div class="subtitle" data-v-9cf46d41><div class="skeleton-text skeleton-subtitle" data-v-9cf46d41></div></div><div class="actions" data-v-9cf46d41><div class="skeleton-text skeleton-actions" data-v-9cf46d41></div></div><div class="time" data-v-9cf46d41><div class="skeleton-text skeleton-time" data-v-9cf46d41></div></div>',4),ss=["href"],os=["onClick","onMouseover"],ns={class:"start"},as=["onClick","checked"],ls=["onClick","checked"],is={class:"number"},cs={class:"title"},ds={class:"subtitle"},rs={class:"actions"},us=["onClick"],_s=h(()=>n("md-ripple",null,null,-1)),ps=["onClick"],hs=h(()=>n("md-ripple",null,null,-1)),ms=["onClick"],vs=h(()=>n("md-ripple",null,null,-1)),ks=["onClick"],gs=h(()=>n("md-ripple",null,null,-1)),fs={class:"time"},ys={key:2,class:"no-data-placeholder"},N=50,bs=Qe({__name:"NotesView",setup($){var Z;const L=He(),f=z([]),{t:de}=Be(),{parseQ:re}=Lt(),y=Ue({tagIds:[],trash:!1}),b=Ge.NOTE,Q=Pe(),H=Q.query,I=z(parseInt(((Z=H.page)==null?void 0:Z.toString())??"1")),m=z(""),{tags:V,fetch:ue}=Nt(b),{selectedIds:v,allChecked:B,realAllChecked:C,selectRealAll:_e,allCheckedAlertVisible:pe,clearSelection:q,toggleAllChecked:U,toggleSelect:G,total:u,checked:A,shiftEffectingIds:K,handleItemClick:he,handleMouseOver:me,selectAll:ve,shouldSelect:ke}=$t(f),{addToTags:ge}=St(b,V),j=e=>{const l=Q.query.q;le(L,l?`/notes?page=${e}&q=${l}`:`/notes?page=${e}`)},{keyDown:R,keyUp:F}=wt(u,N,I,ve,q,j,()=>{P(v.value,C.value,u.value,m.value)}),{loading:M,fetch:w}=Ke({handle:(e,l)=>{l?Je(de(l),"error"):e&&(f.value=e.notes,u.value=e.noteCount)},document:We,variables:()=>({offset:(I.value-1)*N,limit:N,query:m.value?m.value:"trash:false"}),appApi:!0});function fe(e){ie(ut,{type:b,tags:V.value,item:{key:e.id,title:"",size:0},selected:V.value.filter(l=>e.tags.some(D=>D.id===l.id))})}function ye(e){return e?`/notes?q=${e}`:"/notes"}const{mutate:be,onDone:qe}=E({document:Xe,appApi:!0}),Te=()=>{be({query:x()})},x=()=>{let e=m.value;return C.value||(e=`ids:${v.value.join(",")}`),e};qe(e=>{je(e.data.exportNotes,"application/json","notes.json")});const{mutate:O,onDone:$e}=E({document:Ye,appApi:!0});function Ce(){O({query:x()})}const{deleteItems:P}=Ct(Ze,()=>{q(),w()});$e(()=>{q(),w(),f.value.some(e=>e.tags.length)&&S.emit("refetch_tags",b)});const{mutate:J,onDone:we}=E({document:et,appApi:!0});function Ne(){J({query:x()})}we(()=>{q(),w()});function Se(e){ie(ht,{id:e.id,name:_t(e.title,{length:20}),gql:pt`
      mutation DeleteNote($query: String!) {
        deleteNotes(query: $query)
      }
    `,variables:()=>({query:`ids:${e.id}`}),done:()=>{q(),u.value--},appApi:!0,typeName:"Note"})}function Le(e){le(L,W(e))}function W(e){const l=ce.currentRoute.value.query.q;return l?`/notes/${e.id}?q=${l}`:`/notes/${e.id}`}function Ve(){ce.push("/notes/create")}const X=e=>{e.type===b&&(q(),w())},Y=e=>{e.type===b&&w()};return Re(()=>{var e;m.value=mt(((e=H.q)==null?void 0:e.toString())??""),re(y,m.value),y.trash===void 0&&(y.trash=!1),ue(),w(),S.on("item_tags_updated",Y),S.on("items_tags_updated",X),window.addEventListener("keydown",R),window.addEventListener("keyup",F)}),Fe(()=>{S.off("item_tags_updated",Y),S.off("items_tags_updated",X),window.removeEventListener("keydown",R),window.removeEventListener("keyup",F)}),(e,l)=>{const D=vt,ee=Ht,te=Tt,se=kt,Ae=Mt,De=bt,Ie=qt,Me=gt,xe=ft,ze=Ee,_=tt("tooltip");return s(),o(g,null,[n("div",Bt,[n("md-checkbox",{"touch-target":"wrapper",onChange:l[0]||(l[0]=(...d)=>t(U)&&t(U)(...d)),checked:t(B),indeterminate:!t(B)&&t(A)},null,40,Ut),n("div",Gt,[t(v).length?(s(),o("span",Kt,k(e.$t("x_selected",{count:t(C)?t(u).toLocaleString():t(v).length.toLocaleString()})),1)):(s(),o("span",jt,k(e.$t("page_title.notes"))+" ("+k(t(u).toLocaleString())+")",1)),y.trash?(s(),o(g,{key:2},[t(A)?(s(),o(g,{key:0},[p((s(),o("button",{class:"btn-icon",onClick:l[1]||(l[1]=i(d=>t(P)(t(v),t(C),t(u),m.value),["stop"]))},[Rt,c(D)])),[[_,e.$t("delete")]]),p((s(),o("button",{class:"btn-icon",onClick:i(Ne,["stop"])},[Ft,c(ee)])),[[_,e.$t("restore")]])],64)):T("",!0)],64)):(s(),o(g,{key:3},[t(A)?(s(),o(g,{key:0},[p((s(),o("button",{class:"btn-icon",onClick:i(Ce,["stop"])},[Ot,c(te)])),[[_,e.$t("move_to_trash")]]),p((s(),o("button",{class:"btn-icon",onClick:l[2]||(l[2]=i(d=>t(ge)(t(v),t(C),m.value),["stop"]))},[Pt,c(se)])),[[_,e.$t("add_to_tags")]]),p((s(),o("button",{class:"btn-icon",onClick:i(Te,["stop"])},[Jt,c(Ae)])),[[_,e.$t("export_notes")]])],64)):T("",!0)],64))]),n("div",Wt,[c(De,{filter:y,tags:t(V),"get-url":ye,"show-trash":!0},null,8,["filter","tags"]),y.trash?T("",!0):(s(),o("md-outlined-button",{key:0,class:"btn-sm",onClick:i(Ve,["prevent"])},k(e.$t("create")),1))])]),c(Ie,{limit:N,total:t(u),"all-checked-alert-visible":t(pe),"real-all-checked":t(C),"select-real-all":t(_e),"clear-selection":t(q)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),t(M)&&f.value.length===0?(s(),o("div",Xt,[(s(),o(g,null,Oe(20,d=>n("article",{class:"note-item selectable-card-skeleton",key:d},[n("div",Yt,[Zt,n("span",es,k(d),1)]),ts])),64))])):T("",!0),f.value.length?(s(),oe(t(lt),{key:1,class:ae(["scroller",{"select-mode":t(A)}]),"data-key":"id","data-sources":f.value,"estimate-size":100},{item:ne(({index:d,item:a})=>[(s(),o("a",{class:"item-link",key:a.id,href:W(a)},[n("article",{class:ae(["note-item selectable-card",{selected:t(v).includes(a.id)||a.id==e.$route.params.id,selecting:t(K).includes(a.id)}]),onClick:i(r=>t(he)(r,a,d,()=>{Le(a)}),["stop","prevent"]),onMouseover:r=>t(me)(r,d)},[n("div",ns,[t(K).includes(a.id)?(s(),o("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",onClick:i(r=>t(G)(r,a,d),["stop"]),checked:t(ke)},null,8,as)):(s(),o("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",onClick:i(r=>t(G)(r,a,d),["stop"]),checked:t(v).includes(a.id)},null,8,ls)),n("span",is,[c(Me,{id:d+1,raw:a},null,8,["id","raw"])])]),n("div",cs,k(t(st)(a.title.split(`
`)[0].trimStart())||e.$t("meta_no_title")),1),n("div",ds,[c(xe,{tags:a.tags,type:t(b),"only-links":!0},null,8,["tags","type"])]),n("div",rs,[y.trash?(s(),o(g,{key:0},[p((s(),o("button",{class:"btn-icon sm",onClick:i(r=>Se(a),["stop","prevent"])},[_s,c(D)],8,us)),[[_,e.$t("delete")]]),p((s(),o("button",{class:"btn-icon sm",onClick:i(r=>t(J)({query:`ids:${a.id}`}),["stop","prevent"])},[hs,c(ee)],8,ps)),[[_,e.$t("restore")]])],64)):(s(),o(g,{key:1},[p((s(),o("button",{class:"btn-icon sm",onClick:i(r=>t(O)({query:`ids:${a.id}`}),["stop","prevent"])},[vs,c(te)],8,ms)),[[_,e.$t("move_to_trash")]]),p((s(),o("button",{class:"btn-icon sm",onClick:i(r=>fe(a),["stop","prevent"])},[gs,c(se)],8,ks)),[[_,e.$t("add_to_tags")]])],64))]),n("div",fs,[p((s(),o("span",null,[nt(k(t(at)(a.updatedAt)),1)])),[[_,t(ot)(a.updatedAt)]])])],42,os)],8,ss))]),footer:ne(()=>[t(u)>N?(s(),oe(ze,{key:0,page:I.value,go:j,total:t(u),limit:N},null,8,["page","total"])):T("",!0)]),_:1},8,["data-sources","class"])):T("",!0),!t(M)&&f.value.length===0?(s(),o("div",ys,k(e.$t(t(it)(t(M)))),1)):T("",!0)],64)}}}),As=yt(bs,[["__scopeId","data-v-9cf46d41"]]);export{As as default};
