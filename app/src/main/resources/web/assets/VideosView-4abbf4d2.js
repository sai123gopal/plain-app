import{u as Me,_ as Ue,a as qe,b as Ne}from"./list-ff7cbbcd.js";import{d as Le,ay as Qe,a as He,r as I,u as xe,c as Ge,s as Oe,B as Ke,D as We,p as Xe,C as je,az as Je,ab as Pe,aA as Ye,E as Ze,G as et,H as tt,I as f,J as ot,K as st,e as a,f as o,x as c,h as t,F as S,L as m,w as _,j as k,M as q,y as lt,A as N,t as u,N as nt,O as at,k as it,aB as dt,aF as ct,n as ce,Q as ue,o as n,R as ut,a5 as _e,z as _t,at as re,aD as L,m as rt,au as pt,av as mt,ag as ht,V as vt,X as gt,Y as ft,W as kt,ao as yt,aE as bt,a9 as wt,ah as $t,Z as Ct,$ as Tt,a0 as Vt,_ as It}from"./index-6d72ad8d.js";import{_ as St,a as Dt}from"./ConfirmModal.vuevuetypescriptsetuptruelang-b429c7cc.js";import{_ as At,a as Rt}from"./grid-view-outline-rounded-c5151e86.js";import{_ as zt}from"./Breadcrumb-2d824363.js";import{n as pe}from"./list-6498ebd9.js";import{u as Et,a as Ft}from"./tags-f635763f.js";import"./vee-validate.esm-ab7e8eb7.js";const r=A=>(pt("data-v-032619d2"),A=A(),mt(),A),Bt={class:"v-toolbar"},Mt=r(()=>o("md-ripple",null,null,-1)),Ut=r(()=>o("md-ripple",null,null,-1)),qt=r(()=>o("md-ripple",null,null,-1)),Nt=["onClick"],Lt=r(()=>o("md-ripple",null,null,-1)),Qt=["onClick"],Ht=r(()=>o("md-ripple",null,null,-1)),xt={class:"filters"},Gt=["label"],Ot={class:"form-label"},Kt={type:"filter"},Wt=["label","selected","onClick"],Xt={class:"buttons"},jt=["onClick"],Jt={key:0,class:"image-container",style:{"margin-bottom":"24px"}},Pt=["onClick","onContextmenu"],Yt=["src"],Zt={class:"duration"},eo={key:1,class:"no-data-placeholder"},to={key:2,class:"table-responsive"},oo={class:"table"},so=["checked","indeterminate"],lo=r(()=>o("th",null,"ID",-1)),no=r(()=>o("th",null,null,-1)),ao=r(()=>o("th",null,null,-1)),io=["onClick"],co=["checked"],uo=["src","onClick"],_o={class:"nowrap"},ro={class:"action-btns"},po=["onClick"],mo=r(()=>o("md-ripple",null,null,-1)),ho=["onClick"],vo=r(()=>o("md-ripple",null,null,-1)),go=["onClick"],fo=r(()=>o("md-ripple",null,null,-1)),ko={class:"nowrap"},yo={class:"nowrap"},bo={key:0},wo={colspan:"8"},$o={class:"no-data-placeholder"},D=48,Co=Le({__name:"VideosView",setup(A){var ne,ae;const me=Qe(),i=He(),h=I([]),Q=I(),{t:$}=xe(),H=Ge(),{app:x,urlTokenKey:B}=Oe(H),v=Ke({text:"",tags:[]}),d=We.VIDEO,G=Xe().query,C=I(parseInt(((ne=G.page)==null?void 0:ne.toString())??"1")),y=I(je(((ae=G.q)==null?void 0:ae.toString())??"")),T=I(""),{tags:R}=Et(d,y,v,async e=>{T.value=nt(e),await at(),be()}),{addToTags:he}=Ft(d,h,R),{deleteItems:ve,deleteItem:O}=Je(),{allChecked:K,realAllChecked:z,selectRealAll:ge,allCheckedAlertVisible:fe,clearSelection:E,toggleAllChecked:W,toggleItemChecked:X,toggleRow:ke,total:b,checked:j}=Me(h),{downloadItems:ye}=Pe(B,d,h,E,"videos.zip"),{downloadFile:J}=ht(B),M=Ye(()=>h.value.map(e=>({src:re(e.fileId),name:L(e.path),duration:e.duration,size:e.size,path:e.path,data:e,type:d}))),{loading:P,load:be,refetch:U}=Ze({handle:async(e,l)=>{if(l)it($(l),"error");else if(e){const w=[];for(const V of e.videos)w.push({...V,checked:!1,fileId:dt(B.value,V.path)});h.value=w,b.value=e.videoCount}},document:ct,variables:()=>({offset:(C.value-1)*D,limit:D,query:T.value}),appApi:!0});function we(){ce(i,`/videos?page=${C.value}&q=${ue(y.value)}`)}function Y(e){H.lightbox={sources:M.value,index:e,visible:!0}}et(C,()=>{we()});function $e(e){v.tags.includes(e)?vt(v.tags,l=>l.id===e.id):v.tags.push(e)}function Z(e){gt(ft,{type:d,tags:R.value,item:{key:e.id,title:e.title,size:e.size},selected:R.value.filter(l=>e.tags.some(w=>w.id===l.id))})}function Ce(){y.value=kt(v),ee(),Q.value.dismiss()}function ee(){ce(i,`/videos?q=${ue(y.value)}`)}function Te(){i.videoViewType==="grid"?i.videoViewType="list":i.videoViewType="grid"}function Ve(){me.push("/files"),yt(St,{message:$("upload_videos")})}function Ie(e,l){e.preventDefault(),bt({x:e.x,y:e.y,items:[{label:$("add_to_tags"),onClick:()=>{Z(l)}},{label:$("download"),onClick:()=>{J(l.path,L(l.path).replace(" ","-"))}},{label:$("delete"),onClick:()=>{O(d,l)}}]})}const te=e=>{e.type===d&&(E(),U())},oe=e=>{e.type===d&&U()},se=e=>{e.type===d&&(E(),U())},le=()=>{b.value--};return tt(()=>{f.on("item_tags_updated",oe),f.on("items_tags_updated",te),f.on("media_item_deleted",le),f.on("media_items_deleted",se)}),ot(()=>{f.off("item_tags_updated",oe),f.off("items_tags_updated",te),f.off("media_item_deleted",le),f.off("media_items_deleted",se)}),(e,l)=>{const w=zt,V=wt,ie=$t,de=Ct,Se=At,De=Rt,Ae=Dt,Re=Ue,ze=qe,Ee=Tt,Fe=Vt,Be=Ne,g=st("tooltip");return n(),a(S,null,[o("div",Bt,[c(w,{current:()=>`${e.$t("page_title.videos")} (${t(b)})`},null,8,["current"]),t(j)&&t(i).videoViewType==="list"?(n(),a(S,{key:0},[m((n(),a("button",{class:"icon-button",onClick:l[0]||(l[0]=_(s=>t(ve)(t(d),h.value,t(z),T.value),["stop"]))},[Mt,c(V)])),[[g,e.$t("delete")]]),m((n(),a("button",{class:"icon-button",onClick:l[1]||(l[1]=_(s=>t(ye)(t(z),T.value),["stop"]))},[Ut,c(ie)])),[[g,e.$t("download")]]),m((n(),a("button",{class:"icon-button",onClick:l[2]||(l[2]=_(s=>t(he)(t(z),T.value),["stop"]))},[qt,c(de)])),[[g,e.$t("add_to_tags")]])],64)):k("",!0),m((n(),a("button",{class:"icon-button",onClick:_(Te,["prevent"])},[Lt,t(i).videoViewType==="list"?(n(),q(Se,{key:0})):k("",!0),t(i).videoViewType==="grid"?(n(),q(De,{key:1})):k("",!0)],8,Nt)),[[g,e.$t(t(i).videoViewType==="list"?"view_as_grid":"view_as_list")]]),m((n(),a("button",{class:"icon-button",onClick:_(Ve,["prevent"])},[Ht,c(Ae)],8,Qt)),[[g,e.$t("upload")]]),c(Re,{ref_key:"searchInputRef",ref:Q,modelValue:y.value,"onUpdate:modelValue":l[4]||(l[4]=s=>y.value=s),search:ee},{filters:lt(()=>[o("div",xt,[m(o("md-outlined-text-field",{label:e.$t("keywords"),"onUpdate:modelValue":l[3]||(l[3]=s=>v.text=s),"keyup.enter":"applyAndDoSearch"},null,8,Gt),[[ut,v.text]]),o("label",Ot,u(e.$t("tags")),1),o("md-chip-set",Kt,[(n(!0),a(S,null,N(t(R),s=>(n(),a("md-filter-chip",{key:s.id,label:s.name,selected:v.tags.includes(s),onClick:F=>$e(s)},null,8,Wt))),128))]),o("div",Xt,[o("md-filled-button",{onClick:_(Ce,["stop"])},u(e.$t("search")),9,jt)])])]),_:1},8,["modelValue"])]),t(i).videoViewType==="grid"?(n(),a("div",Jt,[(n(!0),a(S,null,N(M.value,(s,F)=>(n(),a("div",{class:"item",onClick:p=>Y(F),onContextmenu:p=>Ie(p,s.data)},[o("img",{class:"image",src:s.src+"&w=300&h=300"},null,8,Yt),o("span",Zt,u(t(_e)(s.duration)),1)],40,Pt))),256))])):k("",!0),t(i).videoViewType==="grid"&&M.value.length===0?(n(),a("div",eo,u(e.$t(t(pe)(t(P),t(x).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):k("",!0),c(ze,{limit:D,total:t(b),"all-checked-alert-visible":t(fe),"real-all-checked":t(z),"select-real-all":t(ge),"clear-selection":t(E)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),t(i).videoViewType==="list"?(n(),a("div",to,[o("table",oo,[o("thead",null,[o("tr",null,[o("th",null,[o("md-checkbox",{"touch-target":"wrapper",onChange:l[5]||(l[5]=(...s)=>t(W)&&t(W)(...s)),checked:t(K),indeterminate:!t(K)&&t(j)},null,40,so)]),lo,no,o("th",null,u(e.$t("name")),1),ao,o("th",null,u(e.$t("tags")),1),o("th",null,u(e.$t("duration")),1),o("th",null,u(e.$t("file_size")),1)])]),o("tbody",null,[(n(!0),a(S,null,N(h.value,(s,F)=>(n(),a("tr",{key:s.id,class:_t({selected:s.checked}),onClick:_(p=>t(ke)(s),["stop"])},[o("td",null,[o("md-checkbox",{"touch-target":"wrapper",onChange:l[6]||(l[6]=(...p)=>t(X)&&t(X)(...p)),checked:s.checked},null,40,co)]),o("td",null,[c(Ee,{id:s.id,raw:s},null,8,["id","raw"])]),o("td",null,[o("img",{class:"img-video",src:t(re)(s.fileId)+"&w=300&h=300",width:"50",height:"50",style:{cursor:"pointer"},onClick:_(p=>Y(F),["stop"])},null,8,uo)]),o("td",null,u(s.title),1),o("td",_o,[o("div",ro,[m((n(),a("button",{class:"icon-button",onClick:_(p=>t(O)(t(d),s),["stop"])},[mo,c(V)],8,po)),[[g,e.$t("delete")]]),m((n(),a("button",{class:"icon-button",onClick:_(p=>t(J)(s.path,t(L)(s.path).replace(" ","-")),["stop"])},[vo,c(ie)],8,ho)),[[g,e.$t("download")]]),m((n(),a("button",{class:"icon-button",onClick:_(p=>Z(s),["stop"])},[fo,c(de)],8,go)),[[g,e.$t("add_to_tags")]])])]),o("td",null,[c(Fe,{tags:s.tags,type:t(d)},null,8,["tags","type"])]),o("td",ko,u(t(_e)(s.duration)),1),o("td",yo,u(t(rt)(s.size)),1)],10,io))),128))]),h.value.length?k("",!0):(n(),a("tfoot",bo,[o("tr",null,[o("td",wo,[o("div",$o,u(e.$t(t(pe)(t(P),t(x).permissions,"WRITE_EXTERNAL_STORAGE"))),1)])])]))])])):k("",!0),t(b)>D?(n(),q(Be,{key:3,modelValue:C.value,"onUpdate:modelValue":l[7]||(l[7]=s=>C.value=s),total:t(b),limit:D},null,8,["modelValue","total"])):k("",!0)],64)}}});const Fo=It(Co,[["__scopeId","data-v-032619d2"]]);export{Fo as default};
