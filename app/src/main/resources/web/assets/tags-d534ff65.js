import{d as k,u as v,bM as A,Z as V,bN as R,M as _,t as y,ad as I,o as M,U as $,y as b,f as F,j as n,R as q,N as D,e as T,g as h,ae as S,bO as B,r as G,i as L,a5 as O,bu as z,bt as E,a1 as C}from"./index-5f5c60b6.js";import{_ as Q}from"./VModal.vuevuetypescriptsetuptruelang-61cd4dae.js";import{_ as U}from"./Multiselect-6a97b930.js";import{u as w,a as N}from"./vee-validate.esm-e0a551fe.js";const j=["disabled"],Z=k({__name:"AddToTagsModal",props:{tagType:{type:String,required:!0},tags:{type:Array,default:()=>[]},items:{type:Array,default:()=>[]}},setup(l){const o=l,{handleSubmit:i}=w(),{t:r}=v(),{value:a,errorMessage:t}=N("selectedTags",A().test("required",()=>"valid.required",s=>s.length),{initialValue:[]}),{mutate:u,loading:m,onDone:g}=V({document:R,appApi:!0});g(()=>{o.tagType==="AUDIO"&&_.emit("refetch_app"),_.emit("refetch_by_tag_type",o.tagType),y(r("saved")),I()});const d=i(()=>{u({tagType:o.tagType,tagIds:a.value.map(s=>s.id),items:o.items})});return(s,e)=>{const c=U,f=Q;return M(),$(f,{title:s.$t("add_to_tags")},{body:b(()=>[F(c,{modelValue:n(a),"onUpdate:modelValue":e[0]||(e[0]=p=>q(a)?a.value=p:null),label:"name","track-by":"id",options:l.tags},null,8,["modelValue","options"]),D(T("div",{class:"invalid-feedback"},h(n(t)?s.$t(n(t)):""),513),[[S,n(t)]])]),action:b(()=>[T("button",{type:"button",disabled:n(m),class:"btn",onClick:e[1]||(e[1]=(...p)=>n(d)&&n(d)(...p))},h(s.$t("save")),9,j)]),_:1},8,["title"])}}}),x=["disabled"],H=k({__name:"RemoveFromTagsModal",props:{tagType:{type:String,required:!0},tags:{type:Array,default:()=>[]},ids:{type:Array,default:()=>[]}},setup(l){const o=l,{handleSubmit:i}=w(),{t:r}=v(),{value:a,errorMessage:t}=N("selectedTags",A().test("required",()=>"valid.required",s=>s.length),{initialValue:[]}),{mutate:u,loading:m,onDone:g}=V({document:B,appApi:!0});g(()=>{o.tagType==="AUDIO"&&_.emit("refetch_app"),_.emit("refetch_by_tag_type",o.tagType),y(r("saved")),I()});const d=i(()=>{u({tagIds:a.value.map(s=>s.id),keys:o.ids})});return(s,e)=>{const c=U,f=Q;return M(),$(f,{title:s.$t("remove_from_tags")},{body:b(()=>[F(c,{modelValue:n(a),"onUpdate:modelValue":e[0]||(e[0]=p=>q(a)?a.value=p:null),label:"name","track-by":"id",options:l.tags},null,8,["modelValue","options"]),D(T("div",{class:"invalid-feedback"},h(n(t)?s.$t(n(t)):""),513),[[S,n(t)]])]),action:b(()=>[T("button",{type:"button",disabled:n(m),class:"btn",onClick:e[1]||(e[1]=(...p)=>n(d)&&n(d)(...p))},h(s.$t("save")),9,x)]),_:1},8,["title"])}}}),X=(l,o,i)=>{const{t:r}=v();return{addToTags:()=>{const a=o.value.filter(t=>t.checked);if(a.length===0){y(r("select_first"),"error");return}C(Z,{tagType:l,tags:i.value,items:a.map(t=>({key:t.id,title:t.title,size:t.size}))})}}},Y=(l,o,i)=>{const{t:r}=v();return{removeFromTags:()=>{const a=o.value.filter(t=>t.checked);if(a.length===0){y(r("select_first"),"error");return}C(H,{tagType:l,tags:i.value,ids:a.map(t=>t.id)})}}},ee=(l,o,i,r)=>{const a=G([]),{t}=v();return L({handle:async(u,m)=>{if(m)y(t(m),"error");else if(u){a.value=u.tags;const g=O(o.value);i.tags=[];const d=[];g.forEach(e=>{if(e.name==="text")i.text=e.value;else if(e.name==="tag"){const c=u.tags.find(f=>z(f.name)===e.value);c?(i.tags.push(c),d.push(c.id)):d.push("invalid")}else e.name==="bucket_id"&&(i.bucketId=e.value)});const s=[...g].filter(e=>e.name!=="tag");d.forEach(e=>{s.push({name:"tag_id",op:"",value:e})}),r(s)}},document:E,variables:{type:l},appApi:!0}),{tags:a}};export{X as a,Y as b,ee as u};
