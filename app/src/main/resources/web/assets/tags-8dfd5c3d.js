import{d as k,u as v,bO as A,Z as V,bP as B,M as _,t as y,ad as I,o as $,U as M,y as b,f as F,j as n,R as q,N as D,e as T,g as h,ae as Q,bQ as G,r as L,i as N,a5 as O,bw as z,bv as E,a1 as S}from"./index-cf22a9d8.js";import{_ as w}from"./VModal.vuevuetypescriptsetuptruelang-83ac7574.js";import{_ as C}from"./Multiselect-94708f99.js";import{u as U,a as R}from"./vee-validate.esm-dd3b5249.js";const j=["disabled"],P=k({__name:"AddToTagsModal",props:{tagType:{type:String,required:!0},tags:{type:Array,default:()=>[]},items:{type:Array,default:()=>[]}},setup(l){const o=l,{handleSubmit:i}=U(),{t:r}=v(),{value:a,errorMessage:t}=R("selectedTags",A().test("required",()=>"valid.required",s=>s.length),{initialValue:[]}),{mutate:u,loading:m,onDone:g}=V({document:B,appApi:!0});g(()=>{o.tagType==="AUDIO"&&_.emit("refetch_app"),_.emit("refetch_by_tag_type",o.tagType),y(r("saved")),I()});const d=i(()=>{u({tagType:o.tagType,tagIds:a.value.map(s=>s.id),items:o.items})});return(s,e)=>{const c=C,f=w;return $(),M(f,{title:s.$t("add_to_tags")},{body:b(()=>[F(c,{modelValue:n(a),"onUpdate:modelValue":e[0]||(e[0]=p=>q(a)?a.value=p:null),label:"name","track-by":"id",options:l.tags},null,8,["modelValue","options"]),D(T("div",{class:"invalid-feedback"},h(n(t)?s.$t(n(t)):""),513),[[Q,n(t)]])]),action:b(()=>[T("button",{type:"button",disabled:n(m),class:"btn",onClick:e[1]||(e[1]=(...p)=>n(d)&&n(d)(...p))},h(s.$t("save")),9,j)]),_:1},8,["title"])}}}),Z=["disabled"],x=k({__name:"RemoveFromTagsModal",props:{tagType:{type:String,required:!0},tags:{type:Array,default:()=>[]},ids:{type:Array,default:()=>[]}},setup(l){const o=l,{handleSubmit:i}=U(),{t:r}=v(),{value:a,errorMessage:t}=R("selectedTags",A().test("required",()=>"valid.required",s=>s.length),{initialValue:[]}),{mutate:u,loading:m,onDone:g}=V({document:G,appApi:!0});g(()=>{o.tagType==="AUDIO"&&_.emit("refetch_app"),_.emit("refetch_by_tag_type",o.tagType),y(r("saved")),I()});const d=i(()=>{u({tagIds:a.value.map(s=>s.id),keys:o.ids})});return(s,e)=>{const c=C,f=w;return $(),M(f,{title:s.$t("remove_from_tags")},{body:b(()=>[F(c,{modelValue:n(a),"onUpdate:modelValue":e[0]||(e[0]=p=>q(a)?a.value=p:null),label:"name","track-by":"id",options:l.tags},null,8,["modelValue","options"]),D(T("div",{class:"invalid-feedback"},h(n(t)?s.$t(n(t)):""),513),[[Q,n(t)]])]),action:b(()=>[T("button",{type:"button",disabled:n(m),class:"btn",onClick:e[1]||(e[1]=(...p)=>n(d)&&n(d)(...p))},h(s.$t("save")),9,Z)]),_:1},8,["title"])}}}),X=(l,o,i)=>{const{t:r}=v();return{addToTags:()=>{const a=o.value.filter(t=>t.checked);if(a.length===0){y(r("select_first"),"error");return}S(P,{tagType:l,tags:i.value,items:a.map(t=>({key:t.id,title:t.title,size:t.size}))})}}},Y=(l,o,i)=>{const{t:r}=v();return{removeFromTags:()=>{const a=o.value.filter(t=>t.checked);if(a.length===0){y(r("select_first"),"error");return}S(x,{tagType:l,tags:i.value,ids:a.map(t=>t.id)})}}},ee=(l,o,i,r)=>{const a=L([]),{t}=v();return N({handle:async(u,m)=>{if(m)y(t(m),"error");else if(u){a.value=u.tags;const g=O(o.value);i.tags=[];const d=[];g.forEach(e=>{if(e.name==="text")i.text=e.value;else if(e.name==="tag"){const c=u.tags.find(f=>z(f.name)===e.value);c?(i.tags.push(c),d.push(c.id)):d.push("invalid")}else e.name==="bucket_id"&&(i.bucketId=e.value)});const s=[...g].filter(e=>e.name!=="tag");d.forEach(e=>{s.push({name:"tag_id",op:"",value:e})}),r(s)}},document:E,variables:{type:l},appApi:!0}),{tags:a}};export{X as a,Y as b,ee as u};
