import{_ as Fe}from"./VPagination.vuevuetypescriptsetuptruelang-goYu96wT.js";import{a1 as T,d as Me,s as Z,i as Pe,ai as Te,u as Ke,h as I,g as Ne,I as Qe,aj as ze,J as Ge,K as ee,j as Re,L as je,M as He,c as l,a,m as t,t as i,x as k,w as r,p as h,e as A,V as D,q as te,N as se,O as w,P,v as ae,Q as Oe,f as Je,C as Xe,ak as Ye,al as We,am as Ze,an as et,ao as tt,S as st,o as n,E as at,ap as ne,U as oe,X as nt,F as ot,G as lt,Y as it,aq as ct,ar as dt,a0 as pt,as as ut,a3 as rt,ae as _t,H as vt}from"./index-R8dLcqG_.js";import{_ as kt,a as ht}from"./SearchInput-DhaE-3h8.js";import{_ as mt}from"./sort-rounded-CsJpi3ce.js";import{u as gt,a as ft}from"./key-events-BNCM8SMB.js";import{u as yt}from"./search-ByVbj6Ls.js";import"./search-rounded-CULEMJ2O.js";import"./rss-feed-rounded-BCiGdgJ5.js";const le=p=>{T.emit("tap_phone",p)};function bt(p,L){const m=p.findIndex(U=>U.id===L);m!==-1&&p.splice(m,1)}const f=p=>(ot("data-v-992101a5"),p=p(),lt(),p),wt={class:"top-app-bar"},Ct=["checked","indeterminate"],$t={class:"title"},St={key:0},It={key:1},At=f(()=>a("md-ripple",null,null,-1)),Dt={class:"actions"},Lt=f(()=>a("md-ripple",null,null,-1)),Ut=["disabled"],qt=f(()=>a("md-ripple",null,null,-1)),Bt={key:0,indeterminate:""},Et={class:"menu-items"},Vt=["onClick","selected"],xt={slot:"headline"},Ft={class:"scroll-content"},Mt=["onClick","onMouseover"],Pt={class:"start"},Tt=["onClick","checked"],Kt=["onClick","checked"],Nt={class:"number"},Qt=["src"],zt={class:"title"},Gt={class:"subtitle"},Rt={class:"actions"},jt={indeterminate:"",class:"spinner-sm"},Ht=["onClick"],Ot=["onClick"],Jt=f(()=>a("md-ripple",null,null,-1)),Xt=["onClick"],Yt=f(()=>a("md-ripple",null,null,-1)),Wt={class:"time"},Zt={class:"start"},es=f(()=>a("div",{class:"checkbox"},[a("div",{class:"skeleton-checkbox"})],-1)),ts={class:"number"},ss=it('<div class="image" data-v-992101a5><div class="skeleton-image" data-v-992101a5></div></div><div class="title" data-v-992101a5><div class="skeleton-text skeleton-title" data-v-992101a5></div></div><div class="subtitle" data-v-992101a5><div class="skeleton-text skeleton-subtitle" data-v-992101a5></div></div><div class="actions" data-v-992101a5><div class="skeleton-text skeleton-actions" data-v-992101a5></div></div><div class="time" data-v-992101a5><div class="skeleton-text skeleton-time" data-v-992101a5></div><div class="skeleton-text skeleton-time" data-v-992101a5></div></div>',5),as={key:0,class:"no-data-placeholder"},g=50,ns=Me({__name:"AppsView",setup(p){var W;const{app:L,urlTokenKey:m,uploads:U}=Z(Pe()),{input:ie,upload:ce,uploadChanged:K}=Te(U),N=Ke(),u=I([]),{t:q}=Ne(),{appSortBy:C}=Z(N),{parseQ:de}=yt(),Q=Qe({tagIds:[]}),pe=ct(),$=I(!1),z=Oe(),G=z.query,B=I(parseInt(((W=G.page)==null?void 0:W.toString())??"1")),S=I(""),{selectedIds:y,allChecked:R,realAllChecked:E,selectRealAll:ue,allCheckedAlertVisible:re,clearSelection:V,toggleAllChecked:j,toggleSelect:H,total:_,checked:x,shiftEffectingIds:O,handleItemClick:_e,handleMouseOver:ve,selectAll:ke,shouldSelect:he}=gt(u),{downloadItems:me}=ze(m,Ge.PACKAGE,V,"apps.zip"),{downloadFile:ge}=dt(m),F=e=>{const o=z.query.q;Je(N,o?`/apps?page=${e}&q=${o}`:`/apps?page=${e}`)},{keyDown:J,keyUp:X}=ft(_,g,B,ke,V,F,()=>{}),fe=()=>{ce(L.value.downloadsDir)},ye=["user","system"].map(e=>({id:e,name:q("app_type."+e)})),be=e=>{e.isUninstalling=!1},{loading:M,fetch:we}=ee({handle:(e,o)=>{$.value=!1,o?Xe(q(o),"error"):e&&(u.value=e.packages.map(b=>({...b,isUninstalling:!1,icon:Ye(m.value,"pkgicon://"+b.id)})),_.value=e.packageCount)},document:We,variables:()=>({offset:(B.value-1)*g,limit:g,query:S.value,sortBy:C.value}),appApi:!0});function Ce(e){return e?`/apps?q=${e}`:"/apps"}function $e(e,o){if(C.value===o){e.close();return}$.value=!0,C.value=o,F(1),e.close()}const{mutate:Se}=Re({document:Ze,appApi:!0});function Ie(e){e.isUninstalling=!0,le(q("confirm_uninstallation_on_phone")),Se({id:e.id})}const{loading:Ae,fetch:De}=ee({handle:e=>{if(e)for(const o of e.packageStatuses)o.exist||(bt(u.value,o.id),le(""))},document:et,variables:()=>({ids:u.value.filter(e=>e.isUninstalling).map(e=>e.id)}),appApi:!0}),Y=e=>{e.status};return je(()=>{var e;setInterval(()=>{u.value.some(o=>o.isUninstalling)&&!Ae.value&&De()},1e3),S.value=pt(((e=G.q)==null?void 0:e.toString())??""),de(Q,S.value),we(),T.on("upload_task_done",Y),window.addEventListener("keydown",J),window.addEventListener("keyup",X)}),He(()=>{T.off("upload_task_done",Y),window.removeEventListener("keydown",J),window.removeEventListener("keyup",X)}),(e,o)=>{const b=ut,Le=kt,Ue=mt,qe=tt,Be=ht,Ee=rt,Ve=_t,xe=Fe,v=st("tooltip");return n(),l(w,null,[a("div",wt,[a("md-checkbox",{"touch-target":"wrapper",onChange:o[0]||(o[0]=(...s)=>t(j)&&t(j)(...s)),checked:t(R),indeterminate:!t(R)&&t(x)},null,40,Ct),a("div",$t,[t(y).length?(n(),l("span",St,i(e.$t("x_selected",{count:t(E)?t(_).toLocaleString():t(y).length.toLocaleString()})),1)):(n(),l("span",It,i(e.$t("page_title.apps"))+" ("+i(t(_).toLocaleString())+")",1)),t(x)?k((n(),l("button",{key:2,class:"btn-icon",onClick:o[1]||(o[1]=r(s=>t(me)(t(E),t(y),S.value),["stop"]))},[At,h(b)])),[[v,e.$t("download")]]):A("",!0)]),a("div",Dt,[h(Le,{filter:Q,types:t(ye),"get-url":Ce},null,8,["filter","types"]),a("button",{class:"btn-icon",onClick:r(fe,["stop"]),style:{display:"none"}},[Lt,D(" "+i(e.$t("install")),1)]),h(qe,null,{content:te(s=>[a("div",Et,[(n(!0),l(w,null,P(t(pe),d=>(n(),l("md-menu-item",{onClick:c=>$e(s,d.value),key:d.value,selected:d.value===t(C)},[a("div",xt,i(e.$t(d.label)),1)],8,Vt))),128))])]),default:te(()=>[k((n(),l("button",{class:"btn-icon btn-sort",disabled:$.value},[qt,$.value?(n(),l("md-circular-progress",Bt)):(n(),ae(Ue,{key:1}))],8,Ut)),[[v,e.$t("sort")]])]),_:1})])]),h(Be,{limit:g,total:t(_),"all-checked-alert-visible":t(re),"real-all-checked":t(E),"select-real-all":t(ue),"clear-selection":t(V)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),a("div",Ft,[a("div",{class:se(["app-list",{"select-mode":t(x)}])},[(n(!0),l(w,null,P(u.value,(s,d)=>(n(),l("section",{class:se(["app-item selectable-card",{selected:t(y).includes(s.id),selecting:t(O).includes(s.id)}]),key:s.id,onClick:r(c=>t(_e)(c,s,d,()=>{}),["stop"]),onMouseover:c=>t(ve)(c,d)},[a("div",Pt,[t(O).includes(s.id)?(n(),l("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",onClick:r(c=>t(H)(c,s,d),["stop"]),checked:t(he)},null,8,Tt)):(n(),l("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",onClick:r(c=>t(H)(c,s,d),["stop"]),checked:t(y).includes(s.id)},null,8,Kt)),a("span",Nt,[h(Ee,{id:d+1,raw:s},null,8,["id","raw"])])]),a("img",{class:"image",width:"50",height:"50",src:s.icon},null,8,Qt),a("div",zt,i(s.name)+" ("+i(s.version)+")",1),a("div",Gt,[a("span",null,i(s.id),1),a("span",null,i(t(at)(s.size)),1),a("span",null,i(e.$t("app_type."+s.type)),1)]),a("div",Rt,[s.isUninstalling?(n(),l(w,{key:0},[k(a("md-circular-progress",jt,null,512),[[v,e.$t("uninstalling")]]),D(" Â "),a("md-outlined-button",{class:"btn-sm",onClick:r(c=>be(s),["stop"])},i(e.$t("cancel")),9,Ht)],64)):k((n(),l("button",{key:1,class:"btn-icon sm",onClick:r(c=>Ie(s),["stop"])},[Jt,h(Ve)],8,Ot)),[[v,e.$t("uninstall")]]),k((n(),l("button",{class:"btn-icon sm",onClick:r(c=>t(ge)(s.path,`${s.name.replace(" ","")}-${s.id}.apk`),["stop"])},[Yt,h(b)],8,Xt)),[[v,e.$t("download")]])]),a("div",Wt,[k((n(),l("span",null,[D(i(e.$t("installed_at"))+": "+i(t(oe)(s.installedAt)),1)])),[[v,t(ne)(s.installedAt)]]),k((n(),l("span",null,[D(i(e.$t("updated_at"))+": "+i(t(oe)(s.updatedAt)),1)])),[[v,t(ne)(s.updatedAt)]])])],42,Mt))),128)),t(M)&&u.value.length===0?(n(),l(w,{key:0},P(20,s=>a("section",{class:"app-item selectable-card-skeleton",key:s},[a("div",Zt,[es,a("span",ts,i(s),1)]),ss])),64)):A("",!0)],2),!t(M)&&u.value.length===0?(n(),l("div",as,i(e.$t(t(nt)(t(M)))),1)):A("",!0),t(_)>g?(n(),ae(xe,{key:1,page:B.value,go:F,total:t(_),limit:g},null,8,["page","total"])):A("",!0),a("input",{ref_key:"fileInput",ref:ie,style:{display:"none"},type:"file",accept:".apk",multiple:"",onChange:o[2]||(o[2]=(...s)=>t(K)&&t(K)(...s))},null,544)])],64)}}}),_s=vt(ns,[["__scopeId","data-v-992101a5"]]);export{_s as default};
