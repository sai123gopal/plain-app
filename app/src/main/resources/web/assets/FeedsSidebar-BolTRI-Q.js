import{_ as ye}from"./LeftSidebar.vuevuetypescriptsetuptruelang-BWG8gajF.js";import{a as be,_ as Ce}from"./TagFilter.vuevuetypescriptsetuptruelang-DySu9lzm.js";import{_ as Fe}from"./more-vert-zjmMMiPD.js";import{d as N,h as c,j as T,cD as we,au as W,aw as X,av as A,o as p,c as _,a as e,t as l,x as D,y as ee,m as o,z as te,A as oe,V as I,e as L,H as Ee,cE as Me,g as xe,u as Ae,s as Le,i as Ie,I as Se,K as Ve,k as Te,l as De,be as Qe,C as j,af as Re,a1 as S,ag as qe,v as Ge,q as Q,cF as Ne,a6 as J,a0 as Be,cG as He,cH as Ke,cI as Oe,S as Pe,p as R,P as Y,O as Z,w as V,N as q,Z as G,cJ as ze,f as Ue,ad as je}from"./index-R8dLcqG_.js";import{u as ne,a as se}from"./vee-validate.esm-vpr6zxQb.js";import{u as Je}from"./feeds-bp5iUXJ_.js";import{u as Ye}from"./search-ByVbj6Ls.js";import"./EditValueModal-O1aAFYgx.js";const Ze={slot:"headline"},We={slot:"content"},Xe={class:"form-row"},et=["label","error","error-text"],tt={class:"form-row"},ot={class:"form-check-label"},nt=["checked"],st={slot:"actions"},at=["disabled"],lt={key:0,indeterminate:"",slot:"icon"},dt=N({__name:"AddFeedModal",props:{done:{type:Function}},setup(M){const{handleSubmit:b}=ne(),k=c(),i=c(!1);function x(t){i.value=t.target.checked}const v=M,{mutate:w,loading:C,onDone:F}=T({document:we,appApi:!0}),{value:d,resetField:f,errorMessage:u}=se("inputValue",W().required());f();function g(){A()}(async()=>{var t;await X(),(t=k.value)==null||t.focus()})();const h=b(()=>{w({url:d.value??"",fetchContent:i.value})});return F(()=>{var t;(t=v.done)==null||t.call(this),A()}),(t,a)=>(p(),_("md-dialog",null,[e("div",Ze,l(t.$t("add_subscription")),1),e("div",We,[e("div",Xe,[D(e("md-outlined-text-field",{ref_key:"inputRef",ref:k,label:t.$t("rss_url"),"onUpdate:modelValue":a[0]||(a[0]=m=>te(d)?d.value=m:null),onKeyup:a[1]||(a[1]=oe((...m)=>o(h)&&o(h)(...m),["enter"])),error:o(u),"error-text":o(u)?t.$t(o(u)):""},null,40,et),[[ee,o(d)]])]),e("div",tt,[e("label",ot,[e("md-checkbox",{"touch-target":"wrapper",onChange:x,checked:i.value},null,40,nt),I(" "+l(t.$t("fetch_content_automatically")),1)])])]),e("div",st,[e("md-outlined-button",{value:"cancel",onClick:g},l(t.$t("cancel")),1),e("md-filled-button",{value:"save",disabled:o(C),onClick:a[2]||(a[2]=(...m)=>o(h)&&o(h)(...m)),autofocus:""},[o(C)?(p(),_("md-circular-progress",lt)):L("",!0),I(" "+l(t.$t("save")),1)],8,at)])]))}}),it=Ee(dt,[["__scopeId","data-v-1e144d60"]]),rt={slot:"headline"},ut={slot:"content"},ct={class:"form-label"},pt={class:"form-row"},ft=["label","error","error-text"],mt={class:"form-row"},_t={class:"form-check-label"},vt=["checked"],ht={slot:"actions"},$t=["disabled"],kt={key:0,indeterminate:"",slot:"icon"},gt=N({__name:"FeedModal",props:{data:{type:Object}},setup(M){var g,h;const{handleSubmit:b}=ne(),k=c(),i=c(!1);function x(t){i.value=t.target.checked}const v=M,{mutate:w,loading:C,onDone:F}=T({document:Me,appApi:!0}),{value:d,errorMessage:f}=se("inputValue",W().required());d.value=((g=v.data)==null?void 0:g.name)??"",i.value=((h=v.data)==null?void 0:h.fetchContent)??!1,(async()=>{var t;await X(),(t=k.value)==null||t.focus()})();const u=b(()=>{var t;w({id:(t=v.data)==null?void 0:t.id,name:d.value,fetchContent:i.value})});return F(()=>{A()}),(t,a)=>{var m;return p(),_("md-dialog",null,[e("div",rt,l(t.$t("update_subscription")),1),e("div",ut,[e("div",ct,l((m=M.data)==null?void 0:m.url),1),e("div",pt,[D(e("md-outlined-text-field",{ref_key:"inputRef",ref:k,class:"form-control",label:t.$t("name"),error:o(f),"error-text":o(f)?t.$t(o(f)):"","onUpdate:modelValue":a[0]||(a[0]=$=>te(d)?d.value=$:null),onKeyup:a[1]||(a[1]=oe((...$)=>o(u)&&o(u)(...$),["enter"]))},null,40,ft),[[ee,o(d)]])]),e("div",mt,[e("label",_t,[e("md-checkbox",{"touch-target":"wrapper",onChange:x,checked:i.value},null,40,vt),I(" "+l(t.$t("fetch_content_automatically")),1)])])]),e("div",ht,[e("md-outlined-button",{value:"cancel",onClick:a[2]||(a[2]=(...$)=>o(A)&&o(A)(...$))},l(t.$t("cancel")),1),e("md-filled-button",{value:"save",disabled:o(C),onClick:a[3]||(a[3]=(...$)=>o(u)&&o(u)(...$)),autofocus:""},[o(C)?(p(),_("md-circular-progress",kt)):L("",!0),I(" "+l(t.$t("save")),1)],8,$t)])])}}}),yt=e("md-ripple",null,null,-1),bt=["open"],Ct=["onClick"],Ft={slot:"headline"},wt={class:"nav"},Et={class:"title"},Mt={key:0,class:"count"},xt={class:"title"},At={key:0,class:"count"},Lt=["onClick"],It={class:"title"},St=["id","onClick"],Vt=e("md-ripple",null,null,-1),Tt={key:0,class:"count"},Dt=["anchor","open"],Qt={slot:"headline"},Rt={slot:"headline"},zt=N({__name:"FeedsSidebar",setup(M){const{t:b}=xe(),k=Ae(),{counter:i}=Le(Ie()),{parseQ:x}=Ye(),v=Se({tagIds:[]}),w=c([]),C=[{text:"add_subscription",click:de},{text:"import_opml_file",click:pe},{text:"export_opml_file",click:fe}],F=c(!1),d=c(""),f=c(""),u=c(!1),g=c(),h=c(new Map),t=c(!1),a=c(),{fetch:m}=Ve({handle:n=>{n&&(i.value.feedEntries=n.total,i.value.feedEntriesToday=n.today,n.feedsCount.forEach(s=>{h.value.set(s.id,s.count)}))},document:Ne,variables:()=>({}),appApi:!0});function $(n){return h.value.get(n)??-1}function B(){var y;const n=J.currentRoute.value,s=Be(((y=n.query.q)==null?void 0:y.toString())??"");x(v,s),d.value=v.tagIds.length===1?v.tagIds[0]:"",f.value=v.feedId??"",u.value=v.today??!1,u.value?(d.value="",f.value=""):d.value&&f.value&&(d.value=""),m()}B(),Te(()=>J.currentRoute.value,()=>{B()});const{viewFeed:ae,viewAll:H,viewToday:K}=Je(k),{refetch:O}=De({handle:(n,s)=>{s?j(b(s),"error"):n&&(w.value=n.feeds)},document:He,appApi:!0});function le(n){const s=n.target.files;if(!s)return;const y=new FileReader;y.addEventListener("load",()=>{ue({content:y.result})},!1),y.readAsText(s[0])}function de(){G(it,{done:()=>{O()}})}const{mutate:ie,onDone:re}=T({document:Ke,appApi:!0});re(n=>{Qe(n.data.exportFeeds,"application/xml","feeds.xml")});const{mutate:ue,onDone:ce}=T({document:Oe,appApi:!0});ce(()=>{j(b("imported")),O()});function pe(){g.value.value="",g.value.click()}function fe(){ie()}function me(n){a.value=n,t.value=!0}function _e(n){G(gt,{data:n})}function ve(n){G(je,{id:n.id,name:n.name,gql:ze,appApi:!0,typeName:"Feed",done:()=>{Ue(k,"/feeds")}})}const P=()=>{m()},z=()=>{m()};return Re(()=>{S.on("feed_entries_deleted",P),S.on("feeds_fetched",z)}),qe(()=>{S.off("feed_entries_deleted",P),S.off("feeds_fetched",z)}),(n,s)=>{const y=be,he=Fe,$e=Ce,ke=ye,U=Pe("tooltip");return p(),Ge(ke,null,{title:Q(()=>[I(l(n.$t("page_title.feeds")),1)]),actions:Q(()=>[D((p(),_("button",{class:"btn-icon",id:"add-feed-ref",onClick:s[0]||(s[0]=()=>F.value=!0)},[yt,R(y)])),[[U,o(b)("add_subscription")]]),e("md-menu",{anchor:"add-feed-ref",positioning:"fixed","stay-open-on-focusout":"",quick:"",open:F.value,onClosed:s[1]||(s[1]=()=>F.value=!1)},[(p(),_(Z,null,Y(C,E=>e("md-menu-item",{key:E.text,onClick:E.click},[e("div",Ft,l(n.$t(E.text)),1)],8,Ct)),64))],40,bt)]),body:Q(()=>{var E;return[e("ul",wt,[e("li",{onClick:s[2]||(s[2]=V((...r)=>o(H)&&o(H)(...r),["prevent"])),class:q({active:!u.value&&!d.value&&!f.value})},[e("span",Et,l(n.$t("all")),1),o(i).feedEntries>=0?(p(),_("span",Mt,l(o(i).feedEntries.toLocaleString()),1)):L("",!0)],2),e("li",{onClick:s[3]||(s[3]=V((...r)=>o(K)&&o(K)(...r),["prevent"])),class:q({active:u.value})},[e("span",xt,l(n.$t("today")),1),o(i).feedEntriesToday>=0?(p(),_("span",At,l(o(i).feedEntriesToday.toLocaleString()),1)):L("",!0)],2),(p(!0),_(Z,null,Y(w.value,r=>(p(),_("li",{key:r.id,onClick:V(ge=>o(ae)(r),["stop","prevent"]),class:q({active:f.value&&r.id===f.value})},[e("span",It,l(r.name),1),D((p(),_("button",{id:"feed-"+r.id,class:"btn-icon sm",onClick:V(ge=>me(r),["prevent","stop"])},[Vt,R(he)],8,St)),[[U,n.$t("actions")]]),$(r.id)>=0?(p(),_("span",Tt,l($(r.id).toLocaleString()),1)):L("",!0)],10,Lt))),128))]),e("md-menu",{positioning:"popover",anchor:"feed-"+((E=a.value)==null?void 0:E.id),"stay-open-on-focusout":"",quick:"",open:t.value,onClosed:s[6]||(s[6]=r=>t.value=!1)},[e("md-menu-item",{onClick:s[4]||(s[4]=r=>_e(a.value))},[e("div",Qt,l(n.$t("edit")),1)]),e("md-menu-item",{onClick:s[5]||(s[5]=r=>ve(a.value))},[e("div",Rt,l(n.$t("delete")),1)])],40,Dt),R($e,{type:"FEED_ENTRY",selected:d.value},null,8,["selected"]),e("input",{ref_key:"fileInput",ref:g,style:{display:"none"},accept:".xml",type:"file",onChange:le},null,544)]}),_:1})}}});export{zt as default};
