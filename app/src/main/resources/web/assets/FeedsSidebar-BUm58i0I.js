import{_ as $e}from"./LeftSidebar.vuevuetypescriptsetuptruelang-B6Ke7euJ.js";import{a as ke,_ as ye}from"./TagFilter.vuevuetypescriptsetuptruelang-uBMdMrN4.js";import{_ as ge}from"./more-vert-De1QBMLo.js";import{d as G,h as c,j as V,cu as be,as as Y,au as Z,at as E,o as p,c as m,a as e,t as l,x as T,y as J,m as o,z as W,A as X,V as S,e as L,H as Ce,cv as Fe,g as we,u as Me,s as xe,i as Ae,I as Ee,K as Le,k as Se,l as Ie,b5 as Ve,C as P,v as Te,q as Q,cw as Qe,a6 as j,a0 as Re,cx as qe,cy as De,cz as Ge,S as Ne,p as R,P as U,O as H,w as I,N as q,Z as D,cA as Be,f as ze,ad as Ke}from"./index-Dn0O6zoH.js";import{u as ee,a as te}from"./vee-validate.esm-0lx5owW0.js";import{u as Oe}from"./feeds-D1GKmDFN.js";import{u as Pe}from"./search-DrT1IjAg.js";import"./EditValueModal-Du2st8tU.js";const je={slot:"headline"},Ue={slot:"content"},He={class:"form-row"},Ye=["label","error","error-text"],Ze={class:"form-row"},Je={class:"form-check-label"},We=["checked"],Xe={slot:"actions"},et=["disabled"],tt={key:0,indeterminate:"",slot:"icon"},ot=G({__name:"AddFeedModal",props:{done:{type:Function}},setup(x){const{handleSubmit:b}=ee(),k=c(),d=c(!1);function A(t){d.value=t.target.checked}const v=x,{mutate:w,loading:C,onDone:F}=V({document:be,appApi:!0}),{value:i,resetField:f,errorMessage:u}=te("inputValue",Y().required());f();function y(){E()}(async()=>{var t;await Z(),(t=k.value)==null||t.focus()})();const _=b(()=>{w({url:i.value??"",fetchContent:d.value})});return F(()=>{var t;(t=v.done)==null||t.call(this),E()}),(t,a)=>(p(),m("md-dialog",null,[e("div",je,l(t.$t("add_subscription")),1),e("div",Ue,[e("div",He,[T(e("md-outlined-text-field",{ref_key:"inputRef",ref:k,label:t.$t("rss_url"),"onUpdate:modelValue":a[0]||(a[0]=h=>W(i)?i.value=h:null),onKeyup:a[1]||(a[1]=X((...h)=>o(_)&&o(_)(...h),["enter"])),error:o(u),"error-text":o(u)?t.$t(o(u)):""},null,40,Ye),[[J,o(i)]])]),e("div",Ze,[e("label",Je,[e("md-checkbox",{"touch-target":"wrapper",onChange:A,checked:d.value},null,40,We),S(" "+l(t.$t("fetch_content_automatically")),1)])])]),e("div",Xe,[e("md-outlined-button",{value:"cancel",onClick:y},l(t.$t("cancel")),1),e("md-filled-button",{value:"save",disabled:o(C),onClick:a[2]||(a[2]=(...h)=>o(_)&&o(_)(...h)),autofocus:""},[o(C)?(p(),m("md-circular-progress",tt)):L("",!0),S(" "+l(t.$t("save")),1)],8,et)])]))}}),nt=Ce(ot,[["__scopeId","data-v-1e144d60"]]),st={slot:"headline"},at={slot:"content"},lt={class:"form-label"},it={class:"form-row"},dt=["label","error","error-text"],rt={class:"form-row"},ut={class:"form-check-label"},ct=["checked"],pt={slot:"actions"},ft=["disabled"],mt={key:0,indeterminate:"",slot:"icon"},vt=G({__name:"FeedModal",props:{data:{type:Object}},setup(x){var y,_;const{handleSubmit:b}=ee(),k=c(),d=c(!1);function A(t){d.value=t.target.checked}const v=x,{mutate:w,loading:C,onDone:F}=V({document:Fe,appApi:!0}),{value:i,errorMessage:f}=te("inputValue",Y().required());i.value=((y=v.data)==null?void 0:y.name)??"",d.value=((_=v.data)==null?void 0:_.fetchContent)??!1,(async()=>{var t;await Z(),(t=k.value)==null||t.focus()})();const u=b(()=>{var t;w({id:(t=v.data)==null?void 0:t.id,name:i.value,fetchContent:d.value})});return F(()=>{E()}),(t,a)=>{var h;return p(),m("md-dialog",null,[e("div",st,l(t.$t("update_subscription")),1),e("div",at,[e("div",lt,l((h=x.data)==null?void 0:h.url),1),e("div",it,[T(e("md-outlined-text-field",{ref_key:"inputRef",ref:k,class:"form-control",label:t.$t("name"),error:o(f),"error-text":o(f)?t.$t(o(f)):"","onUpdate:modelValue":a[0]||(a[0]=$=>W(i)?i.value=$:null),onKeyup:a[1]||(a[1]=X((...$)=>o(u)&&o(u)(...$),["enter"]))},null,40,dt),[[J,o(i)]])]),e("div",rt,[e("label",ut,[e("md-checkbox",{"touch-target":"wrapper",onChange:A,checked:d.value},null,40,ct),S(" "+l(t.$t("fetch_content_automatically")),1)])])]),e("div",pt,[e("md-outlined-button",{value:"cancel",onClick:a[2]||(a[2]=(...$)=>o(E)&&o(E)(...$))},l(t.$t("cancel")),1),e("md-filled-button",{value:"save",disabled:o(C),onClick:a[3]||(a[3]=(...$)=>o(u)&&o(u)(...$)),autofocus:""},[o(C)?(p(),m("md-circular-progress",mt)):L("",!0),S(" "+l(t.$t("save")),1)],8,ft)])])}}}),_t=e("md-ripple",null,null,-1),ht=["open"],$t=["onClick"],kt={slot:"headline"},yt={class:"nav"},gt={class:"title"},bt={key:0,class:"count"},Ct={class:"title"},Ft={key:0,class:"count"},wt=["onClick"],Mt={class:"title"},xt=["id","onClick"],At=e("md-ripple",null,null,-1),Et={key:0,class:"count"},Lt=["anchor","open"],St={slot:"headline"},It={slot:"headline"},Bt=G({__name:"FeedsSidebar",setup(x){const{t:b}=we(),k=Me(),{counter:d}=xe(Ae()),{parseQ:A}=Pe(),v=Ee({tagIds:[]}),w=c([]),C=[{text:"add_subscription",click:se},{text:"import_opml_file",click:re},{text:"export_opml_file",click:ue}],F=c(!1),i=c(""),f=c(""),u=c(!1),y=c(),_=c(new Map),t=c(!1),a=c(),{fetch:h}=Le({handle:n=>{n&&(d.value.feedEntries=n.total,d.value.feedEntriesToday=n.today,n.feedsCount.forEach(s=>{_.value.set(s.id,s.count)}))},document:Qe,variables:()=>({}),appApi:!0});function $(n){return _.value.get(n)??-1}function N(){var g;const n=j.currentRoute.value,s=Re(((g=n.query.q)==null?void 0:g.toString())??"");A(v,s),i.value=v.tagIds.length===1?v.tagIds[0]:"",f.value=v.feedId??"",u.value=v.today??!1,u.value?(i.value="",f.value=""):i.value&&f.value&&(i.value=""),h()}N(),Se(()=>j.currentRoute.value,()=>{N()});const{viewFeed:oe,viewAll:B,viewToday:z}=Oe(k),{refetch:K}=Ie({handle:(n,s)=>{s?P(b(s),"error"):n&&(w.value=n.feeds)},document:qe,appApi:!0});function ne(n){const s=n.target.files;if(!s)return;const g=new FileReader;g.addEventListener("load",()=>{ie({content:g.result})},!1),g.readAsText(s[0])}function se(){D(nt,{done:()=>{K()}})}const{mutate:ae,onDone:le}=V({document:De,appApi:!0});le(n=>{Ve(n.data.exportFeeds,"application/xml","feeds.xml")});const{mutate:ie,onDone:de}=V({document:Ge,appApi:!0});de(()=>{P(b("imported")),K()});function re(){y.value.value="",y.value.click()}function ue(){ae()}function ce(n){a.value=n,t.value=!0}function pe(n){D(vt,{data:n})}function fe(n){D(Ke,{id:n.id,name:n.name,gql:Be,appApi:!0,typeName:"Feed",done:()=>{ze(k,"/feeds")}})}return(n,s)=>{const g=ke,me=ge,ve=ye,_e=$e,O=Ne("tooltip");return p(),Te(_e,null,{title:Q(()=>[S(l(n.$t("page_title.feeds")),1)]),actions:Q(()=>[T((p(),m("button",{class:"btn-icon",id:"add-feed-ref",onClick:s[0]||(s[0]=()=>F.value=!0)},[_t,R(g)])),[[O,o(b)("add_subscription")]]),e("md-menu",{anchor:"add-feed-ref",positioning:"fixed","stay-open-on-focusout":"",quick:"",open:F.value,onClosed:s[1]||(s[1]=()=>F.value=!1)},[(p(),m(H,null,U(C,M=>e("md-menu-item",{key:M.text,onClick:M.click},[e("div",kt,l(n.$t(M.text)),1)],8,$t)),64))],40,ht)]),body:Q(()=>{var M;return[e("ul",yt,[e("li",{onClick:s[2]||(s[2]=I((...r)=>o(B)&&o(B)(...r),["prevent"])),class:q({active:!u.value&&!i.value&&!f.value})},[e("span",gt,l(n.$t("all")),1),o(d).feedEntries>=0?(p(),m("span",bt,l(o(d).feedEntries.toLocaleString()),1)):L("",!0)],2),e("li",{onClick:s[3]||(s[3]=I((...r)=>o(z)&&o(z)(...r),["prevent"])),class:q({active:u.value})},[e("span",Ct,l(n.$t("today")),1),o(d).feedEntriesToday>=0?(p(),m("span",Ft,l(o(d).feedEntriesToday.toLocaleString()),1)):L("",!0)],2),(p(!0),m(H,null,U(w.value,r=>(p(),m("li",{key:r.id,onClick:I(he=>o(oe)(r),["stop","prevent"]),class:q({active:f.value&&r.id===f.value})},[e("span",Mt,l(r.name),1),T((p(),m("button",{id:"feed-"+r.id,class:"btn-icon sm",onClick:I(he=>ce(r),["prevent","stop"])},[At,R(me)],8,xt)),[[O,n.$t("actions")]]),$(r.id)>=0?(p(),m("span",Et,l($(r.id).toLocaleString()),1)):L("",!0)],10,wt))),128))]),e("md-menu",{positioning:"popover",anchor:"feed-"+((M=a.value)==null?void 0:M.id),"stay-open-on-focusout":"",quick:"",open:t.value,onClosed:s[6]||(s[6]=r=>t.value=!1)},[e("md-menu-item",{onClick:s[4]||(s[4]=r=>pe(a.value))},[e("div",St,l(n.$t("edit")),1)]),e("md-menu-item",{onClick:s[5]||(s[5]=r=>fe(a.value))},[e("div",It,l(n.$t("delete")),1)])],40,Lt),R(ve,{type:"FEED_ENTRY",selected:i.value},null,8,["selected"]),e("input",{ref_key:"fileInput",ref:y,style:{display:"none"},accept:".xml",type:"file",onChange:ne},null,544)]}),_:1})}}});export{Bt as default};
