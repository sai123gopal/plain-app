import{u as ve,_ as fe,a as ge,b as ke}from"./list-b0a0d32c.js";import{o as l,c as a,a as t,d as be,e as $e,r as f,u as ye,K as Te,L as Ce,D as qe,M as we,N as Ve,w as Se,i as Ae,P as g,O as De,Q as Me,R as Ie,p as d,j as s,F as C,m as k,l as r,k as A,t as i,H as Ne,J as O,S as Be,T as Qe,U as Ue,x as P,aX as ze,aY as Re,C as Z,W as x,v as Le,I as He,Z as J,$ as Fe,a2 as je,a3 as Ee,a0 as Ge,a1 as Ke,aZ as W,a4 as Oe,a6 as Pe}from"./index-e895cc69.js";import{_ as Ze}from"./Breadcrumb-d0e8b352.js";import{u as xe,a as Je}from"./tags-916cb9c2.js";import"./vee-validate.esm-9c2411c6.js";const We={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Xe=t("path",{fill:"currentColor",d:"M7 21q-.825 0-1.412-.587T5 19V6q-.425 0-.712-.288T4 5t.288-.712T5 4h4q0-.425.288-.712T10 3h4q.425 0 .713.288T15 4h4q.425 0 .713.288T20 5t-.288.713T19 6v13q0 .825-.587 1.413T17 21zM17 6H7v13h10zm-7 11q.425 0 .713-.288T11 16V9q0-.425-.288-.712T10 8t-.712.288T9 9v7q0 .425.288.713T10 17m4 0q.425 0 .713-.288T15 16V9q0-.425-.288-.712T14 8t-.712.288T13 9v7q0 .425.288.713T14 17M7 6v13z"},null,-1),Ye=[Xe];function et(X,q){return l(),a("svg",We,Ye)}const tt={name:"material-symbols-delete-outline-rounded",render:et},st={class:"v-toolbar"},ot=["onClick"],nt=t("md-ripple",null,null,-1),lt=t("md-ripple",null,null,-1),at=["onClick"],it={class:"filters"},ct=["label"],dt={class:"form-label"},rt=["label","selected","onClick"],ut={class:"buttons"},_t=["onClick"],pt={class:"table-responsive"},ht={class:"table"},mt=["checked","indeterminate"],vt=t("th",null,null,-1),ft=["onClick"],gt=["checked"],kt={style:{"min-width":"200px"}},bt=["onClick"],$t={class:"nowrap"},yt={class:"action-btns"},Tt=["onClick"],Ct=t("md-ripple",null,null,-1),qt=["onClick"],wt=t("md-ripple",null,null,-1),Vt={class:"nowrap"},St={class:"nowrap"},At={key:0},Dt={colspan:"6"},Mt={class:"no-data-placeholder"},b=50,Rt=be({__name:"NotesView",setup(X){var j,E;const q=$e(),u=f([]),D=f(),{t:M}=ye(),c=Te({text:"",tags:[]}),_=Ce.NOTE,I=qe().query,$=f(parseInt(((j=I.page)==null?void 0:j.toString())??"1")),p=f(we(((E=I.q)==null?void 0:E.toString())??"")),w=f(""),{tags:y}=xe(_,p,c,async e=>{e.push({name:"trash",op:"",value:"false"}),w.value=Qe(e),await Ue(),ne()}),{addToTags:Y}=Je(_,u,y),{allChecked:N,realAllChecked:B,selectRealAll:ee,allCheckedAlertVisible:te,clearSelection:V,toggleAllChecked:Q,toggleItemChecked:U,toggleRow:se,total:m,checked:z}=ve(u),{loading:oe,load:ne,refetch:S}=Ve({handle:(e,n)=>{n?P(M(n),"error"):e&&(u.value=e.notes.map(v=>({...v,checked:!1})),m.value=e.noteCount)},document:ze,variables:()=>({offset:($.value-1)*b,limit:b,query:w.value}),appApi:!0});function le(e){je(Ee,{type:_,tags:y.value,item:{key:e.id,title:"",size:0},selected:y.value.filter(n=>e.tags.some(v=>v.id===n.id))})}Se($,e=>{Z(q,`/notes?page=${e}&q=${x(p.value)}`)});const{mutate:R,onDone:ae}=Ae({document:Re,appApi:!0});function ie(){const e=u.value.filter(n=>n.checked);if(e.length===0){P(M("select_first"),"error");return}R({query:`ids:${e.map(n=>n.id).join(",")}`})}ae(()=>{V(),S(),u.value.some(e=>e.tags.length)&&g.emit("refetch_tags",_)});function ce(e){c.tags.includes(e)?Ge(c.tags,n=>n.id===e.id):c.tags.push(e)}function de(){p.value=Ke(c),L(),D.value.dismiss()}function L(){Z(q,`/notes?q=${x(p.value)}`)}const H=e=>{e.type===_&&(V(),S())},F=e=>{e.type===_&&S()};De(()=>{g.on("item_tags_updated",F),g.on("items_tags_updated",H)}),Me(()=>{g.off("item_tags_updated",F),g.off("items_tags_updated",H)});function re(e){W.push(`/notes/${e.id}`)}function ue(){W.push("/notes/create")}return(e,n)=>{const v=Ze,G=tt,K=Oe,_e=fe,pe=ge,he=Pe,me=ke,T=Ie("tooltip");return l(),a(C,null,[t("div",st,[d(v,{current:()=>`${e.$t("page_title.notes")} (${s(m)})`},null,8,["current"]),s(z)?(l(),a(C,{key:0},[k((l(),a("button",{class:"icon-button",onClick:r(ie,["stop"])},[nt,d(G)],8,ot)),[[T,e.$t("move_to_trash")]]),k((l(),a("button",{class:"icon-button",onClick:n[0]||(n[0]=r(o=>s(Y)(s(B),w.value),["stop"]))},[lt,d(K)])),[[T,e.$t("add_to_tags")]])],64)):A("",!0),t("md-outlined-button",{onClick:r(ue,["prevent"])},i(e.$t("create")),9,at),d(_e,{ref_key:"searchInputRef",ref:D,modelValue:p.value,"onUpdate:modelValue":n[2]||(n[2]=o=>p.value=o),search:L},{filters:Ne(()=>[t("div",it,[k(t("md-outlined-text-field",{label:e.$t("keywords"),"onUpdate:modelValue":n[1]||(n[1]=o=>c.text=o),"keyup.enter":"applyAndDoSearch"},null,8,ct),[[Le,c.text]]),t("label",dt,i(e.$t("tags")),1),t("md-chip-set",null,[(l(!0),a(C,null,O(s(y),o=>(l(),a("md-filter-chip",{key:o.id,label:o.name,selected:c.tags.includes(o),onClick:h=>ce(o)},null,8,rt))),128))]),t("div",ut,[t("md-filled-button",{onClick:r(de,["stop"])},i(e.$t("search")),9,_t)])])]),_:1},8,["modelValue"])]),d(pe,{limit:b,total:s(m),"all-checked-alert-visible":s(te),"real-all-checked":s(B),"select-real-all":s(ee),"clear-selection":s(V)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),t("div",pt,[t("table",ht,[t("thead",null,[t("tr",null,[t("th",null,[t("md-checkbox",{"touch-target":"wrapper",onChange:n[3]||(n[3]=(...o)=>s(Q)&&s(Q)(...o)),checked:s(N),indeterminate:!s(N)&&s(z)},null,40,mt)]),t("th",null,i(e.$t("title")),1),vt,t("th",null,i(e.$t("tags")),1),t("th",null,i(e.$t("updated_at")),1),t("th",null,i(e.$t("created_at")),1)])]),t("tbody",null,[(l(!0),a(C,null,O(u.value,o=>(l(),a("tr",{key:o.id,class:He({selected:o.checked}),onClick:r(h=>s(se)(o),["stop"])},[t("td",null,[t("md-checkbox",{"touch-target":"wrapper",onChange:n[4]||(n[4]=(...h)=>s(U)&&s(U)(...h)),checked:o.checked},null,40,gt)]),t("td",kt,[t("a",{style:{"text-overflow":"clip"},href:"#",onClick:r(h=>re(o),["stop","prevent"])},i(o.title.split(`
`)[0].trimStart()||e.$t("meta_no_title")),9,bt)]),t("td",$t,[t("div",yt,[k((l(),a("button",{class:"icon-button",onClick:r(h=>s(R)({query:`ids:${o.id}`}),["stop"])},[Ct,d(G)],8,Tt)),[[T,e.$t("move_to_trash")]]),k((l(),a("button",{class:"icon-button",onClick:r(h=>le(o),["stop"])},[wt,d(K)],8,qt)),[[T,e.$t("add_to_tags")]])])]),t("td",null,[d(he,{tags:o.tags,type:s(_)},null,8,["tags","type"])]),t("td",Vt,i(s(J)(o.updatedAt)),1),t("td",St,i(s(J)(o.createdAt)),1)],10,ft))),128))]),u.value.length?A("",!0):(l(),a("tfoot",At,[t("tr",null,[t("td",Dt,[t("div",Mt,i(e.$t(s(Fe)(s(oe)))),1)])])]))])]),s(m)>b?(l(),Be(me,{key:0,modelValue:$.value,"onUpdate:modelValue":n[5]||(n[5]=o=>$.value=o),total:s(m),limit:b},null,8,["modelValue","total"])):A("",!0)],64)}}});export{Rt as default};
