import{u as Kt,_ as Ot,a as jt,b as Wt}from"./list-bea8e7b0.js";import{o as l,c as a,a as t,i as ct,aL as xt,u as ut,P as b,x as _t,r as D,aM as Jt,d as Xt,e as Yt,s as lt,f as Zt,K as te,L as ee,D as oe,M as se,aB as ne,af as le,aA as ae,N as ie,w as de,O as ce,Q as ue,R as _e,p as d,j as o,F as M,m,l as h,k as Q,H as U,t as f,J as H,S as re,T as pe,U as me,aN as he,C as at,W as it,at as fe,v as ve,I as ge,aF as ye,a9 as be,z as ke,$ as $e,A as Te,B as Ce,al as we,aG as Ie,as as qe,aH as Ae,a0 as Se,a1 as Be,a2 as De,a3 as Ve,ad as Re,am as ze,a4 as Me,a5 as Pe,a6 as Ee,_ as Le}from"./index-9c78c93b.js";import{_ as Fe}from"./sort-rounded-f0a9a168.js";import{_ as Ne}from"./upload-rounded-03f23411.js";import{_ as Qe}from"./Breadcrumb-56c0fca0.js";import{u as Ue,a as He}from"./tags-2a301108.js";import"./vee-validate.esm-2d465d6a.js";const Ge={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Ke=t("path",{fill:"currentColor",d:"m10.65 15.75l4.875-3.125q.35-.225.35-.625t-.35-.625L10.65 8.25q-.375-.25-.763-.038t-.387.663v6.25q0 .45.388.663t.762-.038M12 22q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m0-8"},null,-1),Oe=[Ke];function je(c,v){return l(),a("svg",Ge,Oe)}const We={name:"material-symbols-play-circle-outline-rounded",render:je},xe={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Je=t("path",{fill:"currentColor",d:"M10 16q.425 0 .713-.288T11 15V9q0-.425-.288-.712T10 8t-.712.288T9 9v6q0 .425.288.713T10 16m4 0q.425 0 .713-.288T15 15V9q0-.425-.288-.712T14 8t-.712.288T13 9v6q0 .425.288.713T14 16m-2 6q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m0-8"},null,-1),Xe=[Je];function Ye(c,v){return l(),a("svg",xe,Xe)}const Ze={name:"material-symbols-pause-circle-outline-rounded",render:Ye},to={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},eo=t("path",{fill:"currentColor",d:"M3 16v-2h7v2zm0-4v-2h11v2zm0-4V6h11v2zm13 12v-4h-4v-2h4v-4h2v4h4v2h-4v4z"},null,-1),oo=[eo];function so(c,v){return l(),a("svg",to,oo)}const no={name:"material-symbols-playlist-add",render:so};function dt(c,v,k=500){const i=c.cloneNode(!0),_=c.getBoundingClientRect(),w=v.getBoundingClientRect();i.style.position="absolute",i.style.top=_.top+"px",i.style.left=_.left+"px",i.style.opacity=1,document.body.appendChild(i);let $=0;function T(C){$||($=C);const u=C-$,I=Math.min(u/k,1);i.style.top=_.top+(w.top-_.top)*I+"px",i.style.left=_.left+(w.left-_.left)*I+"px",I<1?requestAnimationFrame(T):document.body.removeChild(i)}requestAnimationFrame(T)}const lo=(c,v)=>{const{mutate:k,loading:i,onDone:_}=ct({document:xt,appApi:!0}),{t:w}=ut();return _(()=>{b.emit("refetch_app"),v()}),{loading:i,addItemsToPlaylist:($,T,C)=>{let u=C;if(!T){const F=c.value.filter(q=>q.checked);if(F.length===0){_t(w("select_first"),"error");return}u=`ids:${F.map(q=>q.id).join(",")}`}const I=$.target,g=document.getElementById("quick-audio");dt(I,g),k({query:u})},addToPlaylist:($,T)=>{const C=$.target,u=document.getElementById("quick-audio");dt(C,u),k({query:`ids:${T.id}`})}}},ao=()=>{const c=D(""),{mutate:v,loading:k,onDone:i}=ct({document:Jt,appApi:!0});return i(()=>{b.emit("play_audio")}),{loading:k,playPath:c,play:_=>{c.value=_.path,v({path:_.path})},pause:()=>{b.emit("pause_audio")}}},p=c=>(Te("data-v-71664859"),c=c(),Ce(),c),io={class:"v-toolbar"},co=p(()=>t("md-ripple",null,null,-1)),uo=p(()=>t("md-ripple",null,null,-1)),_o=p(()=>t("md-ripple",null,null,-1)),ro=p(()=>t("md-ripple",null,null,-1)),po=["onClick"],mo=p(()=>t("md-ripple",null,null,-1)),ho={class:"icon-button btn-sort"},fo=p(()=>t("md-ripple",null,null,-1)),vo={class:"menu-items"},go=["onClick","selected"],yo={slot:"headline"},bo={class:"filters"},ko=["label"],$o={class:"form-label"},To=["label","selected","onClick"],Co={class:"buttons"},wo=["onClick"],Io={class:"table-responsive"},qo={class:"table"},Ao=["checked","indeterminate"],So=p(()=>t("th",null,"ID",-1)),Bo=p(()=>t("th",null,null,-1)),Do={class:"artist"},Vo=["onClick"],Ro=["checked"],zo={class:"title"},Mo={class:"nowrap"},Po={class:"action-btns"},Eo=["onClick"],Lo=p(()=>t("md-ripple",null,null,-1)),Fo=["onClick"],No=p(()=>t("md-ripple",null,null,-1)),Qo=["onClick"],Uo=p(()=>t("md-ripple",null,null,-1)),Ho=["onClick"],Go=p(()=>t("md-ripple",null,null,-1)),Ko={key:0,indeterminate:"",class:"spinner-sm"},Oo=p(()=>t("md-ripple",null,null,-1)),jo=["onClick"],Wo=p(()=>t("md-ripple",null,null,-1)),xo={class:"nowrap"},Jo={class:"nowrap"},Xo={key:0},Yo={colspan:"8"},Zo={class:"no-data-placeholder"},P=50,ts=Xt({__name:"AudiosView",setup(c){var Z,tt;const v=Yt(),{audioSortBy:k}=lt(v),i=D([]),_=D(),{t:w}=ut(),{app:$,urlTokenKey:T,audioPlaying:C}=lt(Zt()),u=te({text:"",tags:[]}),I=e=>{var n;return C.value&&((n=$.value)==null?void 0:n.audioCurrent)===e.path},g=ee.AUDIO,q=oe().query,E=D(parseInt(((Z=q.page)==null?void 0:Z.toString())??"1")),A=D(se(((tt=q.q)==null?void 0:tt.toString())??"")),S=D(""),{tags:L}=Ue(g,A,u,async e=>{S.value=pe(e),await me(),St()}),{addToTags:rt}=He(g,i,L),{deleteItems:pt,deleteItem:mt}=ne(),{allChecked:G,realAllChecked:V,selectRealAll:ht,allCheckedAlertVisible:ft,clearSelection:R,toggleAllChecked:K,toggleRow:vt,toggleItemChecked:O,total:B,checked:j}=Kt(i),{downloadItems:gt}=le(T,g,i,R,"audios.zip"),{downloadFile:yt}=we(T),{addItemsToPlaylist:bt,addToPlaylist:kt}=lo(i,R),$t=Ie(),Tt=ae(),{play:Ct,playPath:wt,loading:It,pause:qt}=ao(),{loading:At,load:St,refetch:N}=ie({handle:(e,n)=>{n?_t(w(n),"error"):e&&(i.value=e.audios.map(z=>({...z,checked:!1})),B.value=e.audioCount)},document:he,variables:()=>({offset:(E.value-1)*P,limit:P,query:S.value,sortBy:k.value}),appApi:!0});de(E,e=>{at(v,`/audios?page=${e}&q=${it(A.value)}`)});function Bt(){Tt.push("/files"),qe(Ae,{message:w("upload_audios")})}function Dt(e,n){k.value=n,e.close()}function Vt(e){u.tags.includes(e)?Se(u.tags,n=>n.id===e.id):u.tags.push(e)}function Rt(){A.value=Be(u),W(),_.value.dismiss()}function W(){at(v,`/audios?q=${it(A.value)}`)}const x=e=>{e.type===g&&(R(),N())},J=e=>{e.type===g&&N()},X=e=>{e.type===g&&(R(),N())},Y=()=>{B.value--};ce(()=>{b.on("item_tags_updated",J),b.on("items_tags_updated",x),b.on("media_item_deleted",Y),b.on("media_items_deleted",X)}),ue(()=>{b.off("item_tags_updated",J),b.off("items_tags_updated",x),b.off("media_item_deleted",Y),b.off("media_items_deleted",X)});function zt(e){De(Ve,{type:g,tags:L.value,item:{key:e.id,title:e.title,size:e.size},selected:L.value.filter(n=>e.tags.some(z=>z.id===n.id))})}return(e,n)=>{const z=Qe,et=Re,ot=ze,st=no,nt=Me,Mt=Ne,Pt=Fe,Et=fe,Lt=Ot,Ft=jt,Nt=Pe,Qt=Ze,Ut=We,Ht=Ee,Gt=Wt,y=_e("tooltip");return l(),a(M,null,[t("div",io,[d(z,{current:()=>`${e.$t("page_title.audios")} (${o(B)})`},null,8,["current"]),o(j)?(l(),a(M,{key:0},[m((l(),a("button",{class:"icon-button",onClick:n[0]||(n[0]=h(s=>o(pt)(o(g),i.value,o(V),S.value),["stop"]))},[co,d(et)])),[[y,e.$t("delete")]]),m((l(),a("button",{class:"icon-button",onClick:n[1]||(n[1]=h(s=>o(gt)(o(V),S.value),["stop"]))},[uo,d(ot)])),[[y,e.$t("download")]]),m((l(),a("button",{class:"icon-button",onClick:n[2]||(n[2]=h(s=>o(bt)(s,o(V),S.value),["stop"]))},[_o,d(st)])),[[y,e.$t("add_to_playlist")]]),m((l(),a("button",{class:"icon-button",onClick:n[3]||(n[3]=h(s=>o(rt)(o(V),S.value),["stop"]))},[ro,d(nt)])),[[y,e.$t("add_to_tags")]])],64)):Q("",!0),m((l(),a("button",{class:"icon-button",onClick:h(Bt,["stop"])},[mo,d(Mt)],8,po)),[[y,e.$t("upload")]]),d(Et,null,{content:U(s=>[t("div",vo,[(l(!0),a(M,null,H(o($t),r=>(l(),a("md-menu-item",{onClick:es=>Dt(s,r.value),selected:r.value===o(k)},[t("div",yo,f(e.$t(r.label)),1)],8,go))),256))])]),default:U(()=>[m((l(),a("button",ho,[fo,d(Pt)])),[[y,e.$t("sort")]])]),_:1}),d(Lt,{ref_key:"searchInputRef",ref:_,modelValue:A.value,"onUpdate:modelValue":n[5]||(n[5]=s=>A.value=s),search:W},{filters:U(()=>[t("div",bo,[m(t("md-outlined-text-field",{label:e.$t("keywords"),"onUpdate:modelValue":n[4]||(n[4]=s=>u.text=s),"keyup.enter":"applyAndDoSearch"},null,8,ko),[[ve,u.text]]),t("label",$o,f(e.$t("tags")),1),t("md-chip-set",null,[(l(!0),a(M,null,H(o(L),s=>(l(),a("md-filter-chip",{key:s.id,label:s.name,selected:u.tags.includes(s),onClick:r=>Vt(s)},null,8,To))),128))]),t("div",Co,[t("md-filled-button",{onClick:h(Rt,["stop"])},f(e.$t("search")),9,wo)])])]),_:1},8,["modelValue"])]),d(Ft,{limit:P,total:o(B),"all-checked-alert-visible":o(ft),"real-all-checked":o(V),"select-real-all":o(ht),"clear-selection":o(R)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),t("div",Io,[t("table",qo,[t("thead",null,[t("tr",null,[t("th",null,[t("md-checkbox",{"touch-target":"wrapper",onChange:n[6]||(n[6]=(...s)=>o(K)&&o(K)(...s)),checked:o(G),indeterminate:!o(G)&&o(j)},null,40,Ao)]),So,t("th",null,f(e.$t("name")),1),Bo,t("th",Do,f(e.$t("artist")),1),t("th",null,f(e.$t("tags")),1),t("th",null,f(e.$t("duration")),1),t("th",null,f(e.$t("file_size")),1)])]),t("tbody",null,[(l(!0),a(M,null,H(i.value,s=>(l(),a("tr",{key:s.id,class:ge({selected:s.checked}),onClick:h(r=>o(vt)(s),["stop"])},[t("td",null,[t("md-checkbox",{"touch-target":"wrapper",onChange:n[7]||(n[7]=(...r)=>o(O)&&o(O)(...r)),checked:s.checked},null,40,Ro)]),t("td",null,[d(Nt,{id:s.id,raw:s},null,8,["id","raw"])]),t("td",zo,f(s.title),1),t("td",Mo,[t("div",Po,[m((l(),a("button",{class:"icon-button",onClick:h(r=>o(mt)(o(g),s),["stop"])},[Lo,d(et)],8,Eo)),[[y,e.$t("delete")]]),m((l(),a("button",{class:"icon-button",onClick:h(r=>o(yt)(s.path,o(ye)(s.path).replace(" ","-")),["stop"])},[No,d(ot)],8,Fo)),[[y,e.$t("download")]]),m((l(),a("button",{class:"icon-button",onClick:h(r=>o(kt)(r,s),["stop"])},[Uo,d(st)],8,Qo)),[[y,e.$t("add_to_playlist")]]),m((l(),a("button",{class:"icon-button",onClick:h(r=>zt(s),["stop"])},[Go,d(nt)],8,Ho)),[[y,e.$t("add_to_tags")]]),o(It)&&s.path===o(wt)?(l(),a("md-circular-progress",Ko)):I(s)?m((l(),a("button",{key:1,class:"icon-button",onClick:n[8]||(n[8]=h(r=>o(qt)(),["stop"]))},[Oo,d(Qt)])),[[y,e.$t("pause")]]):m((l(),a("button",{key:2,class:"icon-button",onClick:h(r=>o(Ct)(s),["stop"])},[Wo,d(Ut)],8,jo)),[[y,e.$t("play")]])])]),t("td",null,f(s.artist),1),t("td",null,[d(Ht,{tags:s.tags,type:o(g)},null,8,["tags","type"])]),t("td",xo,f(o(be)(s.duration)),1),t("td",Jo,f(o(ke)(s.size)),1)],10,Vo))),128))]),i.value.length?Q("",!0):(l(),a("tfoot",Xo,[t("tr",null,[t("td",Yo,[t("div",Zo,f(e.$t(o($e)(o(At),o($).permissions,"WRITE_EXTERNAL_STORAGE"))),1)])])]))])]),o(B)>P?(l(),re(Gt,{key:0,modelValue:E.value,"onUpdate:modelValue":n[9]||(n[9]=s=>E.value=s),total:o(B),limit:P},null,8,["modelValue","total"])):Q("",!0)],64)}}});const cs=Le(ts,[["__scopeId","data-v-71664859"]]);export{cs as default};
