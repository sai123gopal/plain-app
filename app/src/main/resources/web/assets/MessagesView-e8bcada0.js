import{u as ue,_ as _e,a as pe,b as me}from"./list-b0a0d32c.js";import{d as he,e as ge,s as fe,f as ke,r as g,u as ve,K as ye,L as be,D as $e,M as Te,N as Ce,w as Se,O as we,P as $,Q as Ve,R as De,c as d,a as e,p as r,j as a,m as T,l as C,k as M,H as Me,t as o,F as q,J as G,S as qe,T as Ae,U as Re,x as Ie,V as Le,C as S,W as w,o as n,v as Ue,I as Be,X as Qe,Y as He,h as Ne,Z as Fe,$ as ze,a0 as xe,a1 as Ee,a2 as Ke,a3 as Pe,a4 as je,a5 as Ge,a6 as Je}from"./index-e895cc69.js";import{_ as Oe}from"./Breadcrumb-d0e8b352.js";import{u as We,a as Xe}from"./tags-916cb9c2.js";import"./vee-validate.esm-9c2411c6.js";const Ye={class:"v-toolbar"},Ze=e("md-ripple",null,null,-1),et={class:"filters"},tt=["label"],st={class:"form-label"},at=["label","selected","onClick"],lt={class:"buttons"},ot=["onClick"],nt={class:"table-responsive"},dt={class:"table"},ct=["checked","indeterminate"],it=e("th",null,"ID",-1),rt=e("th",null,null,-1),ut=["onClick"],_t=["checked"],pt=["innerHTML"],mt={class:"nowrap"},ht={class:"action-btns"},gt=["onClick"],ft=e("md-ripple",null,null,-1),kt={class:"nowrap"},vt={class:"nowrap"},yt={class:"nowrap"},bt={key:0},$t={colspan:"8"},Tt={class:"no-data-placeholder"},f=50,qt=he({__name:"MessagesView",setup(Ct){var K,P;const k=ge(),{app:J}=fe(ke()),p=g([]),A=g(),{t:O}=ve(),c=ye({text:"",tags:[]}),u=be.SMS,R=$e(),I=R.query,v=g(parseInt(((K=I.page)==null?void 0:K.toString())??"1")),i=g(Te(((P=I.q)==null?void 0:P.toString())??"")),V=g(""),{tags:y}=We(u,i,c,async t=>{_&&t.push({name:"type",op:"",value:se[_].toString()}),V.value=Ae(t),await Re(),te()}),{addToTags:W}=Xe(u,p,y),{allChecked:L,realAllChecked:U,selectRealAll:X,allCheckedAlertVisible:Y,clearSelection:B,toggleAllChecked:Q,toggleItemChecked:H,toggleRow:Z,total:m,checked:N}=ue(p),{loading:ee,load:te,refetch:F}=Ce({handle:(t,l)=>{l?Ie(O(l),"error"):t&&(p.value=t.messages.map(h=>({...h,checked:!1})),m.value=t.messageCount)},document:Le,variables:()=>({offset:(v.value-1)*f,limit:f,query:V.value}),appApi:!0}),_=R.params.type,se={inbox:1,sent:2,drafts:3,outbox:4};Se(v,t=>{_?S(k,`/messages/${_}?page=${t}&q=${w(i.value)}`):S(k,`/messages?page=${t}&q=${w(i.value)}`)});function ae(t){c.tags.includes(t)?xe(c.tags,l=>l.id===t.id):c.tags.push(t)}function le(){i.value=Ee(c),z(),A.value.dismiss()}function oe(t){Ke(Pe,{type:u,tags:y.value,item:{key:t.id,title:"",size:0},selected:y.value.filter(l=>t.tags.some(h=>h.id===l.id))})}function z(){_?S(k,`/messages/${_}?q=${w(i.value)}`):S(k,`/messages?q=${w(i.value)}`)}const x=t=>{t.type===u&&(B(),F())},E=t=>{t.type===u&&F()};return we(()=>{$.on("item_tags_updated",E),$.on("items_tags_updated",x)}),Ve(()=>{$.off("item_tags_updated",E),$.off("items_tags_updated",x)}),(t,l)=>{const h=Oe,j=je,ne=_e,de=pe,ce=Ge,ie=Je,re=me,D=De("tooltip");return n(),d(q,null,[e("div",Ye,[r(h,{current:()=>`${t.$t("page_title.messages")} (${a(m)})`},null,8,["current"]),a(N)?T((n(),d("button",{key:0,class:"icon-button",onClick:l[0]||(l[0]=C(s=>a(W)(a(U),V.value),["stop"]))},[Ze,r(j)])),[[D,t.$t("add_to_tags")]]):M("",!0),r(ne,{ref_key:"searchInputRef",ref:A,modelValue:i.value,"onUpdate:modelValue":l[2]||(l[2]=s=>i.value=s),search:z},{filters:Me(()=>[e("div",et,[T(e("md-outlined-text-field",{label:t.$t("keywords"),"onUpdate:modelValue":l[1]||(l[1]=s=>c.text=s),"keyup.enter":"applyAndDoSearch"},null,8,tt),[[Ue,c.text]]),e("label",st,o(t.$t("tags")),1),e("md-chip-set",null,[(n(!0),d(q,null,G(a(y),s=>(n(),d("md-filter-chip",{key:s.id,label:s.name,selected:c.tags.includes(s),onClick:b=>ae(s)},null,8,at))),128))]),e("div",lt,[e("md-filled-button",{onClick:C(le,["stop"])},o(t.$t("search")),9,ot)])])]),_:1},8,["modelValue"])]),r(de,{limit:f,total:a(m),"all-checked-alert-visible":a(Y),"real-all-checked":a(U),"select-real-all":a(X),"clear-selection":a(B)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),e("div",nt,[e("table",dt,[e("thead",null,[e("tr",null,[e("th",null,[e("md-checkbox",{"touch-target":"wrapper",onChange:l[3]||(l[3]=(...s)=>a(Q)&&a(Q)(...s)),checked:a(L),indeterminate:!a(L)&&a(N)},null,40,ct)]),it,e("th",null,o(t.$t("content")),1),rt,e("th",null,o(t.$t("sms_address")),1),e("th",null,o(t.$t("type")),1),e("th",null,o(t.$t("tags")),1),e("th",null,o(t.$t("time")),1)])]),e("tbody",null,[(n(!0),d(q,null,G(p.value,s=>(n(),d("tr",{key:s.id,class:Be({selected:s.checked}),onClick:C(b=>a(Z)(s),["stop"])},[e("td",null,[e("md-checkbox",{"touch-target":"wrapper",onChange:l[4]||(l[4]=(...b)=>a(H)&&a(H)(...b)),checked:s.checked},null,40,_t)]),e("td",null,[r(ce,{id:s.id,raw:s},null,8,["id","raw"])]),e("td",{innerHTML:a(Qe)(s.body)},null,8,pt),e("td",mt,[e("div",ht,[T((n(),d("button",{class:"icon-button",onClick:C(b=>oe(s),["stop"])},[ft,r(j)],8,gt)),[[D,t.$t("add_to_tags")]])])]),e("td",kt,o(s.address),1),e("td",vt,o(t.$t(`message_type.${s.type}`)),1),e("td",null,[r(ie,{tags:s.tags,type:a(u)},null,8,["tags","type"])]),e("td",yt,[T((n(),d("span",null,[Ne(o(a(Fe)(s.date)),1)])),[[D,a(He)(s.date)]])])],10,ut))),128))]),p.value.length?M("",!0):(n(),d("tfoot",bt,[e("tr",null,[e("td",$t,[e("div",Tt,o(t.$t(a(ze)(a(ee),a(J).permissions,"READ_SMS"))),1)])])]))])]),a(m)>f?(n(),qe(re,{key:0,modelValue:v.value,"onUpdate:modelValue":l[5]||(l[5]=s=>v.value=s),total:a(m),limit:f},null,8,["modelValue","total"])):M("",!0)],64)}}});export{qt as default};
