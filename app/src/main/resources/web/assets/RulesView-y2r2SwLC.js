import{d as ne,I as de,h as I,g as le,j as L,ac as k,cs as C,ct as ce,au as re,k as ue,av as F,o as c,c as r,a as e,t as a,m as d,x as m,cu as N,cv as O,O as b,P as w,y as X,z as Y,p as J,q as x,e as A,V as j,ao as pe,l as me,C as _e,cw as ve,cx as fe,Z as R,S as he,ap as ee,U as te,w as oe,ad as ge,a3 as $e}from"./index-R8dLcqG_.js";import{T as g,a as $,_ as be,A as ke}from"./question-mark-rounded-BC93NM4N.js";import{u as ye,a as we}from"./vee-validate.esm-vpr6zxQb.js";const Ce={slot:"headline"},Ve={slot:"content"},Te={class:"row"},De={class:"col-md-3 col-form-label"},Fe={class:"col-md-9 form-checks"},Ne={class:"form-check form-check-inline"},Ae={class:"form-check-label",for:"action-allow"},Ie={class:"form-check form-check-inline"},Me={class:"form-check-label",for:"action-block"},Se={class:"row mb-2"},Ue={for:"action",class:"col-md-3 col-form-label"},Ee={class:"col-md-9 form-checks"},qe={class:"form-check form-check-inline"},Oe={class:"form-check-label",for:"direction-inbound"},Re={class:"form-check form-check-inline"},Le={class:"form-check-label",for:"direction-outbound"},Je={class:"row mb-3"},je={class:"col-md-3 col-form-label"},Be={class:"col-md-9"},Qe=["value"],ze={key:0,class:"input-group"},Ge=["placeholder"],Pe={class:"inner"},Ze={class:"help-block"},He={value:""},Ke=["value"],We={key:2,class:"invalid-feedback"},Xe={class:"row mb-3"},Ye={class:"col-md-3 col-form-label"},xe={class:"col-md-9"},et={value:"all"},tt=["value"],ot=["value"],at={class:"row mb-3"},nt={class:"col-md-3 col-form-label"},lt={class:"col-md-9"},st={slot:"actions"},it=["disabled"],dt={key:0,indeterminate:"",slot:"icon"},ae=ne({__name:"EditRuleModal",props:{data:{type:Object},devices:{type:Array},networks:{type:Array}},setup(y){var B,Q,z,G,P,Z,H;const{handleSubmit:V}=ye(),s=de({action:"block",direction:"inbound",protocol:"all",apply_to:"all",notes:"",target:"",is_enabled:!0}),u=I(g.DNS),M=Object.values(g),{t:S}=le(),f=y,{mutate:U,loading:T,onDone:E}=L({document:k`
    mutation createConfig($input: ConfigInput!) {
      createConfig(input: $input) {
        ...ConfigFragment
      }
    }
    ${C}
  `,options:{update:(n,i)=>{ce(n,i.data.createConfig,k`
          query {
            configs {
              ...ConfigFragment
            }
          }
          ${C}
        `)}}}),{mutate:q,loading:D,onDone:l}=L({document:k`
    mutation updateConfig($id: ID!, $input: ConfigInput!) {
      updateConfig(id: $id, input: $input) {
        ...ConfigFragment
      }
    }
    ${C}
  `}),{value:p,resetField:_,errorMessage:v}=we("inputValue",re().test("required",n=>"valid.required",n=>!$.hasInput(u.value)||!!n).test("target-value",n=>"invalid_value",n=>$.isValid(u.value,n??""))),o=(B=f.data)==null?void 0:B.data;s.action=(o==null?void 0:o.action)??"block",s.direction=(o==null?void 0:o.direction)??"inbound",s.protocol=(o==null?void 0:o.protocol)??"all",u.value=((z=(Q=f.data)==null?void 0:Q.target)==null?void 0:z.type)??g.DNS,p.value=((P=(G=f.data)==null?void 0:G.target)==null?void 0:P.value)??"",s.apply_to=((H=(Z=f.data)==null?void 0:Z.applyTo)==null?void 0:H.toValue())??"all",s.notes=(o==null?void 0:o.notes)??"",s.is_enabled=(o==null?void 0:o.is_enabled)??!0,o||_(),ue(u,(n,i)=>{(n===g.INTERFACE||i===g.INTERFACE)&&(p.value="")});const h=V(()=>{const n=new $;n.type=u.value,n.value=p.value??"",s.target=n.toValue(),f.data?q({id:f.data.id,input:{group:"rule",value:JSON.stringify(s)}}):U({input:{group:"rule",value:JSON.stringify(s)}})});return E(()=>{F()}),l(()=>{F()}),(n,i)=>{var K,W;const se=be,ie=pe;return c(),r("md-dialog",null,[e("div",Ce,a(d(o)?n.$t("edit"):n.$t("create")),1),e("div",Ve,[e("div",Te,[e("label",De,a(n.$t("actions")),1),e("div",Fe,[e("div",Ne,[m(e("input",{class:"form-check-input",type:"radio",name:"action",id:"action-allow",value:"allow","onUpdate:modelValue":i[0]||(i[0]=t=>s.action=t)},null,512),[[N,s.action]]),e("label",Ae,a(n.$t("allow")),1)]),e("div",Ie,[m(e("input",{class:"form-check-input",type:"radio",name:"action",id:"action-block",value:"block","onUpdate:modelValue":i[1]||(i[1]=t=>s.action=t)},null,512),[[N,s.action]]),e("label",Me,a(n.$t("block")),1)])])]),e("div",Se,[e("label",Ue,a(n.$t("direction")),1),e("div",Ee,[e("div",qe,[m(e("input",{class:"form-check-input",type:"radio",name:"direction",id:"direction-inbound",value:"inbound","onUpdate:modelValue":i[2]||(i[2]=t=>s.direction=t)},null,512),[[N,s.direction]]),e("label",Oe,a(n.$t("inbound")),1)]),e("div",Re,[m(e("input",{class:"form-check-input",type:"radio",name:"direction",id:"direction-outbound",value:"outbound","onUpdate:modelValue":i[3]||(i[3]=t=>s.direction=t)},null,512),[[N,s.direction]]),e("label",Le,a(n.$t("outbound")),1)])])]),e("div",Je,[e("label",je,a(n.$t("match")),1),e("div",Be,[m(e("select",{class:"form-select","onUpdate:modelValue":i[4]||(i[4]=t=>u.value=t)},[(c(!0),r(b,null,w(d(M),t=>(c(),r("option",{value:t},a(n.$t(`target_type.${t}`)),9,Qe))),256))],512),[[O,u.value]]),d($).hasInput(u.value)?(c(),r("div",ze,[m(e("input",{type:"text",class:"form-control","onUpdate:modelValue":i[5]||(i[5]=t=>Y(p)?p.value=t:null),placeholder:n.$t("for_example")+" "+d($).hint(u.value)},null,8,Ge),[[X,d(p)]]),J(ie,{class:"input-group-text"},{content:x(()=>[e("pre",Ze,a(n.$t(`examples_${u.value}`)),1)]),default:x(()=>[e("span",Pe,[J(se)])]),_:1})])):A("",!0),u.value===d(g).INTERFACE?m((c(),r("select",{key:1,class:"form-select","onUpdate:modelValue":i[6]||(i[6]=t=>Y(p)?p.value=t:null)},[e("option",He,a(n.$t("all_local_networks")),1),(c(!0),r(b,null,w((K=y.networks)==null?void 0:K.filter(t=>t.type!=="wan"),t=>(c(),r("option",{value:t.ifName},a(t.name),9,Ke))),256))],512)),[[O,d(p)]]):A("",!0),d(v)?(c(),r("div",We,a(d(v)?n.$t(d(v)):""),1)):A("",!0)])]),e("div",Xe,[e("label",Ye,a(d(S)("apply_to")),1),e("div",xe,[m(e("select",{class:"form-select","onUpdate:modelValue":i[7]||(i[7]=t=>s.apply_to=t)},[e("option",et,a(n.$t("all_devices")),1),(c(!0),r(b,null,w((W=y.networks)==null?void 0:W.filter(t=>t.type!=="wan"),t=>(c(),r("option",{key:t.ifName,value:"iface:"+t.ifName},a(t.name),9,tt))),128)),(c(!0),r(b,null,w(y.devices,t=>(c(),r("option",{value:"mac:"+t.mac},a(t.name),9,ot))),256))],512),[[O,s.apply_to]])])]),e("div",at,[e("label",nt,a(n.$t("notes")),1),e("div",lt,[m(e("textarea",{class:"form-control","onUpdate:modelValue":i[8]||(i[8]=t=>s.notes=t),rows:"3"},null,512),[[X,s.notes]])])])]),e("div",st,[e("md-outlined-button",{value:"cancel",onClick:i[9]||(i[9]=(...t)=>d(F)&&d(F)(...t))},a(n.$t("cancel")),1),e("md-filled-button",{value:"save",disabled:d(T)||d(D),onClick:i[10]||(i[10]=(...t)=>d(h)&&d(h)(...t)),autofocus:""},[d(T)||d(D)?(c(),r("md-circular-progress",dt)):A("",!0),j(" "+a(n.$t("save")),1)],8,it)])])}}}),ct={class:"top-app-bar"},rt={class:"title"},ut={class:"top-app-bar"},pt={class:"title"},mt={class:"actions"},_t={class:"table-responsive"},vt={class:"table"},ft=e("th",null,"ID",-1),ht={class:"actions two"},gt={class:"form-check"},$t=["disabled","onChange","checked"],bt={class:"nowrap"},kt={class:"nowrap"},yt={class:"actions two"},wt=["onClick"],Ct=["onClick"],Ft=ne({__name:"RulesView",setup(y){const V=I([]),s=I([]),u=I([]),{t:M}=le();me({handle:(l,p)=>{p?_e(M(p),"error"):(V.value=l.configs.filter(_=>_.group==="rule").map(_=>{const v=JSON.parse(_.value),o=new ke;o.parse(v.apply_to);const h=new $;return h.parse(v.target),{id:_.id,createdAt:_.createdAt,updatedAt:_.updatedAt,data:v,applyTo:o,target:h}}),s.value=[...l.devices],u.value=[...l.networks])},document:k`
    query {
      configs {
        ...ConfigFragment
      }
      devices {
        ...DeviceFragment
      }
      networks {
        ...NetworkFragment
      }
    }
    ${ve}
    ${C}
    ${fe}
  `});const S=k`
  mutation DeleteConfig($id: ID!) {
    deleteConfig(id: $id)
  }
`;function f(l){R(ge,{id:l.id,name:l.id,gql:S,appApi:!1,typeName:"Config"})}function U(l){R(ae,{data:l,devices:s,networks:u})}function T(){R(ae,{data:null,devices:s,networks:u})}const{mutate:E,loading:q}=L({document:k`
    mutation updateConfig($id: ID!, $input: ConfigInput!) {
      updateConfig(id: $id, input: $input) {
        ...ConfigFragment
      }
    }
    ${C}
  `});function D(l){E({id:l.id,input:{group:"rule",value:JSON.stringify(l.data)}})}return(l,p)=>{const _=$e,v=he("tooltip");return c(),r(b,null,[e("div",ct,[e("div",rt,a(l.$t("page_title.rules")),1)]),e("div",ut,[e("div",pt,a(l.$t("page_title.rules")),1),e("div",mt,[e("button",{type:"button",class:"btn",onClick:T},a(l.$t("create")),1)])]),e("div",_t,[e("table",vt,[e("thead",null,[e("tr",null,[ft,e("th",null,a(l.$t("apply_to")),1),e("th",null,a(l.$t("description")),1),e("th",null,a(l.$t("notes")),1),e("th",null,a(l.$t("enabled")),1),e("th",null,a(l.$t("created_at")),1),e("th",null,a(l.$t("updated_at")),1),e("th",ht,a(l.$t("actions")),1)])]),e("tbody",null,[(c(!0),r(b,null,w(V.value,o=>(c(),r("tr",{key:o.id},[e("td",null,[J(_,{id:o.id,raw:o.data},null,8,["id","raw"])]),e("td",null,a(o.applyTo.getText(l.$t,s.value,u.value)),1),e("td",null,a(l.$t(`rule_${o.data.direction}`,{action:l.$t(o.data.action),target:o.target.getText(l.$t,u.value)})),1),e("td",null,a(o.data.notes),1),e("td",null,[e("div",gt,[e("md-checkbox",{"touch-target":"wrapper",disabled:d(q),onChange:h=>D(o),checked:o.data.is_enabled},null,40,$t)])]),e("td",bt,[m((c(),r("time",null,[j(a(d(te)(o.createdAt)),1)])),[[v,d(ee)(o.createdAt)]])]),e("td",kt,[m((c(),r("time",null,[j(a(d(te)(o.updatedAt)),1)])),[[v,d(ee)(o.updatedAt)]])]),e("td",yt,[e("a",{href:"#",class:"v-link",onClick:oe(h=>U(o),["prevent"])},a(l.$t("edit")),9,wt),e("a",{href:"#",class:"v-link",onClick:oe(h=>f(o),["prevent"])},a(l.$t("delete")),9,Ct)])]))),128))])])])],64)}}});export{Ft as default};
