import{d as ye,Z as ge,a2 as et,ad as tt,o as c,U as P,y as q,e as l,j as o,g as m,u as st,r as V,p as at,D as ot,a5 as nt,q as lt,s as ue,a as it,aZ as rt,ar as ct,a_ as ut,a$ as dt,b0 as pt,b1 as mt,b2 as _t,a3 as de,b3 as ht,H as ft,K as bt,L as vt,M as kt,c as d,f as $,F as C,w as pe,l as h,N as L,Q as O,R as yt,A as me,z as gt,b4 as _e,b5 as he,an as Ct,k as B,T as Dt,m as k,a9 as wt,b6 as Vt,a1 as U,b7 as $t,av as It,b8 as Ft,b9 as xt,ba as St,_ as Tt}from"./index-cf22a9d8.js";import{_ as Mt}from"./download-rounded-1a2e3353.js";import{_ as Bt}from"./delete-outline-rounded-11fb4e46.js";import{_ as Ut}from"./Breadcrumb-99ff7c19.js";import{c as fe}from"./index-a6eeb602.js";import{g as be,M as Pt}from"./splitpanes.es-dd05a209.js";import{n as qt}from"./list-6498ebd9.js";import{_ as At}from"./VModal.vuevuetypescriptsetuptruelang-83ac7574.js";import{t as Rt}from"./truncate-fe00352a.js";import{_ as ve}from"./EditValueModal.vuevuetypescriptsetuptruelang-5fd4f7ed.js";import"./stringToArray-2bab501e.js";import"./vee-validate.esm-dd3b5249.js";const Et=["disabled"],ke=ye({__name:"DeleteFileConfirm",props:{onDone:{type:Function,required:!0},files:{type:Array,required:!0}},setup(A){const a=A,{mutate:I,loading:F,onDone:R}=ge({document:et`
    mutation DeleteFiles($paths: [String!]!) {
      deleteFiles(paths: $paths)
    }
  `,appApi:!0});function u(){I({paths:a.files.map(v=>v.path)})}return R(()=>{a.onDone(a.files),tt()}),(v,x)=>{const _=At;return c(),P(_,{class:"delete-modal",title:v.$t("confirm_to_delete_name",{name:o(Rt)(A.files.map(y=>y.name).join(", "),{length:200})})},{action:q(()=>[l("button",{type:"button",disabled:o(F),class:"btn",onClick:u},m(v.$t("delete")),9,Et)]),_:1},8,["title"])}}}),Nt={class:"v-toolbar"},Wt={class:"right-actions"},zt=["onClick","title"],Ht=["onClick","title"],Lt={class:"form-check mt-2 me-3 ms-3"},Ot={class:"form-check-label",for:"select-mode"},Qt={class:"form-check mt-2"},jt={class:"form-check-label",for:"show-hidden"},Gt={class:"file-items"},Kt=["onClick","onDblclick","onContextmenu"],Zt=["onUpdate:modelValue"],Jt=["src"],Xt={class:"title"},Yt={style:{"font-size":"0.75rem"}},es=["onContextmenu"],ts={key:0,class:"no-files"},ss={key:0,class:"file-item-info"},as=ye({__name:"FilesVIew",setup(A){var ne,le,ie,re;const{t:a}=st(),I=V([]),F=at(),R=F.query,u=F.params.type,v=V(ot(((ne=R.q)==null?void 0:ne.toString())??"")),x=nt(v.value),_=V(((le=x.find(e=>e.name==="path"))==null?void 0:le.value)??"");let y=((ie=x.find(e=>e.name==="dir"))==null?void 0:ie.value)??"";y||(((re=x.find(t=>t.name==="isDir"))==null?void 0:re.value)==="1"?y=_.value:y=_.value.substring(0,_.value.lastIndexOf("/")));const Ce=V(y),D=V(!1),Q=lt(),{app:f}=ue(it());let S=f.value.internalStoragePath;u&&(u==="sdcard"?S=f.value.sdcardPath:u.startsWith("usb")?S=f.value.usbDiskPaths[parseInt(u.substring(3))-1]:u==="app"&&(S=f.value.externalFilesDir));const{loading:De,panels:p,currentDir:E,refetch:j}=rt(f,S,Ce.value),{visible:we,index:Ve,view:$e,hide:Ie}=ct(),{createPath:Fe,createVariables:xe,createMutation:Se}=ut(f,p),{renameValue:Te,renamePath:Me,renameDone:Be,renameMutation:Ue,renameVariables:Pe}=dt(p),{internal:G,sdcard:K,usb:qe,refetch:N}=pt(),{onDeleted:Z}=Ft(p,E,N),{downloadFile:J,downloadDir:Ae,downloadFiles:Re}=wt(f),{view:W}=xt(I,$e),{selectedItem:T,select:Ee}=mt(E,u,v,Q),{canPaste:X,copy:Y,cut:Ne,paste:z}=_t(j,N),{input:We,upload:ee,uploadChanged:te}=de(),{input:ze,upload:se,uploadChanged:ae}=de(),{mutate:He,onDone:Le}=ge({document:ht,appApi:!0});Le(e=>{Re(e.data.setTempValue.key)});const H=()=>{const e=[];return p.value.forEach(t=>{t.items.forEach(s=>{s.checked&&e.push(s)})}),e},Oe=()=>{He({key:Vt(),value:JSON.stringify(H().map(e=>({path:e.path})))})},Qe=ft(()=>H().length>0),je=()=>{U(ke,{files:H(),onDone:Z})},{fileShowHidden:g}=ue(Q);_.value&&bt(()=>p.value.length,()=>{if(p.value.length>0&&_.value){const t=p.value[p.value.length-1].items.find(s=>s.path===_.value);t&&(T.value=t,_.value="")}});function Ge(){var e,t,s,i;if(u){if(u==="sdcard")return`${a("sdcard")} (${a("storage_free_total",{free:k(((e=K.value)==null?void 0:e.freeBytes)??0),total:k(((t=K.value)==null?void 0:t.totalBytes)??0)})})`;if(u==="app")return a("app_name");if(u.startsWith("usb")){const M=parseInt(u.substring(3)),b=qe.value[M-1];return`${a("usb_storage")} ${M} (${a("storage_free_total",{free:k((b==null?void 0:b.freeBytes)??0),total:k((b==null?void 0:b.totalBytes)??0)})})`}}return`${a("page_title.files")} (${a("storage_free_total",{free:k(((s=G.value)==null?void 0:s.freeBytes)??0),total:k(((i=G.value)==null?void 0:i.totalBytes)??0)})})`}function Ke(e,t){if(D.value){t.checked=!t.checked;return}Ee(e,t)}function oe(e){return _e(e.name)||he(e.name)||St(e.name)}function Ze(e,t){t.isDir||(oe(t)?W(g?e.items:e.items.filter(s=>!s.name.startsWith(".")),t):J(t.path))}function Je(e,t){e.preventDefault();const s=[{label:a("create_folder"),onClick:()=>{Fe.value=t,U(ve,{title:a("name"),placeholder:a("name"),mutation:Se,getVariables:xe})}},{label:a("upload_files"),onClick:()=>{ee(t)}},{label:a("upload_folder"),onClick:()=>{se(t)}}];X()&&s.push({label:a("paste"),onClick:()=>{z(t)}}),fe({x:e.x,y:e.y,items:s})}function Xe(e,t,s){e.preventDefault();let i;s.isDir?i=[{label:a("upload_files"),onClick:()=>{ee(s.path)}},{label:a("upload_folder"),onClick:()=>{se(s.path)}},{label:a("download"),onClick:()=>{Ae(s.path)}}]:(i=[],oe(s)&&i.push({label:a("open"),onClick:()=>{W(t.items,s)}}),i.push({label:a("download"),onClick:()=>{J(s.path)}})),i.push({label:a("duplicate"),onClick:()=>{Y(s),z(t.dir)}}),i.push({label:a("cut"),onClick:()=>{Ne(t,s)}}),i.push({label:a("copy"),onClick:()=>{Y(s)}}),s.isDir&&X()&&i.push({label:a("paste"),onClick:()=>{z(s.path)}}),i=[...i,{label:a("rename"),onClick:()=>{Te.value=s.name,Me.value=s.path,U(ve,{title:a("rename"),placeholder:a("name"),value:s.name,mutation:Ue,getVariables:Pe,done:Be})}},{label:a("delete"),onClick:()=>{U(ke,{files:[s],onDone:Z})}}],fe({x:e.x,y:e.y,items:i})}return vt(()=>{kt.on("upload_task_done",e=>{e.status==="done"&&setTimeout(()=>{j(e.dir),N()},1e3)})}),(e,t)=>{const s=Ut,i=Bt,M=Mt,b=$t,Ye=It;return c(),d(C,null,[l("div",Nt,[$(s,{current:Ge}),l("div",Wt,[D.value&&o(Qe)?(c(),d(C,{key:0},[l("button",{type:"button",class:"btn btn-action",onClick:pe(je,["stop"]),title:e.$t("delete")},[$(i,{class:"bi"})],8,zt),l("button",{type:"button",class:"btn btn-action",onClick:pe(Oe,["stop"]),title:e.$t("download")},[$(M,{class:"bi"})],8,Ht)],64)):h("",!0),l("div",Lt,[L(l("input",{class:"form-check-input","onUpdate:modelValue":t[0]||(t[0]=r=>D.value=r),id:"select-mode",type:"checkbox"},null,512),[[O,D.value]]),l("label",Ot,m(e.$t("select_mode")),1)]),l("div",Qt,[L(l("input",{class:"form-check-input","onUpdate:modelValue":t[1]||(t[1]=r=>yt(g)?g.value=r:null),id:"show-hidden",type:"checkbox"},null,512),[[O,o(g)]]),l("label",jt,m(e.$t("show_hidden")),1)])])]),$(o(Pt),{class:"panel-container"},{default:q(()=>[(c(!0),d(C,null,me(o(p),r=>(c(),P(o(be),{key:r.dir},{default:q(()=>[l("div",Gt,[(c(!0),d(C,null,me(r.items,n=>{var ce;return c(),d(C,{key:n.path},[!n.name.startsWith(".")||o(g)?(c(),d("div",{key:0,class:gt(["file-item",{active:(o(E)+"/").startsWith(n.path+"/")||((ce=o(T))==null?void 0:ce.path)===n.path}]),onClick:w=>Ke(r,n),onDblclick:w=>Ze(r,n),onContextmenu:w=>Xe(w,r,n)},[D.value?L((c(),d("input",{key:0,class:"form-check-input","onUpdate:modelValue":w=>n.checked=w,type:"checkbox"},null,8,Zt)),[[O,n.checked]]):h("",!0),n.isDir?(c(),P(b,{key:1,class:"bi"})):h("",!0),o(_e)(n.name)||o(he)(n.name)?(c(),d("img",{key:2,src:o(Ct)(n.fileId)+"&w=50&h=50",width:"50",height:"50"},null,8,Jt)):h("",!0),l("div",Xt,[B(m(n.name)+" ",1),l("div",Yt,[B(m(o(Dt)(n.updatedAt)),1),n.isDir?h("",!0):(c(),d(C,{key:0},[B(", "+m(o(k)(n.size)),1)],64))])])],42,Kt)):h("",!0)],64)}),128)),l("div",{class:"empty",onContextmenu:n=>Je(n,r.dir)},[r.items.filter(n=>!n.name.startsWith(".")||o(g)).length===0?(c(),d("div",ts,m(e.$t("no_files")),1)):h("",!0)],40,es)])]),_:2},1024))),128)),o(p).length===0?(c(),P(o(be),{key:0,class:"no-data-placeholder"},{default:q(()=>[B(m(e.$t(o(qt)(o(De),o(f).permissions,"WRITE_EXTERNAL_STORAGE"))),1)]),_:1})):h("",!0)]),_:1}),o(T)?(c(),d("div",ss,m(e.$t("path"))+": "+m(o(T).path),1)):h("",!0),$(Ye,{visible:o(we),index:o(Ve),sources:I.value,onHide:o(Ie)},null,8,["visible","index","sources","onHide"]),l("input",{ref_key:"fileInput",ref:We,style:{display:"none"},type:"file",multiple:"",onChange:t[2]||(t[2]=(...r)=>o(te)&&o(te)(...r))},null,544),l("input",{ref_key:"dirFileInput",ref:ze,style:{display:"none"},type:"file",multiple:"",webkitdirectory:"",mozdirectory:"",directory:"",onChange:t[3]||(t[3]=(...r)=>o(ae)&&o(ae)(...r))},null,544)],64)}}});const fs=Tt(as,[["__scopeId","data-v-e99004f3"]]);export{fs as default};
