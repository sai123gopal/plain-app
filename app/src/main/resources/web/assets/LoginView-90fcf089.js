import{d as J,r as h,u as G,ac as Q,cd as X,ce as Y,cf as Z,cg as ee,ch as se,ci as ne,cj as te,n as C,o as S,c as A,e as m,f as oe,g as p,N as _,ae as E,w as re,j as f,R as ie,O as ae,l as R,k as ce,F as le,ck as ue,cl as de,cm as me,_ as fe}from"./index-5f5c60b6.js";import{u as ve,a as we}from"./vee-validate.esm-e0a551fe.js";function M(n){let t=n;if(typeof t>"u"){if(typeof navigator>"u"||!navigator)return"";t=navigator.userAgent||""}return t.toLowerCase()}function x(n,t){try{return new RegExp(n,"g").exec(t)}catch{return null}}function O(){if(typeof navigator>"u"||!navigator||!navigator.userAgentData)return!1;const t=navigator.userAgentData.brands;return!!(t&&t.length)}function be(n,t){const o=x(`(${n})((?:\\/|\\s|:)([0-9|\\.|_]+))`,t);return o?o[3]:""}function I(n){return n.replace(/_/g,".")}function k(n,t){let o=null,e="-1";return n.some(r=>{const a=x(`(${r.test})((?:\\/|\\s|:)([0-9|\\.|_]+))?`,t);return!a||r.brand?!1:(o=r,e=a[3]||"-1",r.versionAlias?e=r.versionAlias:r.versionTest&&(e=be(r.versionTest.toLowerCase(),t)||e),e=I(e),!0)}),{preset:o,version:e}}function V(n,t){const o={brand:"",version:"-1"};return n.some(e=>{const r=W(t,e);return r?(o.brand=e.id,o.version=e.versionAlias||r.version,o.version!=="-1"):!1}),o}function W(n,t){return n.find(o=>x(`${t.test}`,o.brand.toLowerCase()))}const P=[{test:"phantomjs",id:"phantomjs"},{test:"whale",id:"whale"},{test:"edgios|edge|edg",id:"edge"},{test:"msie|trident|windows phone",id:"ie",versionTest:"iemobile|msie|rv"},{test:"miuibrowser",id:"miui browser"},{test:"samsungbrowser",id:"samsung internet"},{test:"samsung",id:"samsung internet",versionTest:"version"},{test:"chrome|crios",id:"chrome"},{test:"firefox|fxios",id:"firefox"},{test:"android",id:"android browser",versionTest:"version"},{test:"safari|iphone|ipad|ipod",id:"safari",versionTest:"version"}],D=[{test:"(?=.*applewebkit/(53[0-7]|5[0-2]|[0-4]))(?=.*\\schrome)",id:"chrome",versionTest:"chrome"},{test:"chromium",id:"chrome"},{test:"whale",id:"chrome",versionAlias:"-1",brand:!0}],$=[{test:"applewebkit",id:"webkit",versionTest:"applewebkit|safari"}],F=[{test:"(?=(iphone|ipad))(?!(.*version))",id:"webview"},{test:"(?=(android|iphone|ipad))(?=.*(naver|daum|; wv))",id:"webview"},{test:"webview",id:"webview"}],U=[{test:"windows phone",id:"windows phone"},{test:"windows 2000",id:"window",versionAlias:"5.0"},{test:"windows nt",id:"window"},{test:"win32|windows",id:"window"},{test:"iphone|ipad|ipod",id:"ios",versionTest:"iphone os|cpu os"},{test:"macos|macintel|mac os x",id:"mac"},{test:"android|linux armv81",id:"android"},{test:"tizen",id:"tizen"},{test:"webos|web0s",id:"webos"}];function H(n){return!!k(F,n).preset}function pe(n){const t=M(n),o=!!/mobi/g.exec(t),e={name:"unknown",version:"-1",majorVersion:-1,webview:H(t),chromium:!1,chromiumVersion:"-1",webkit:!1,webkitVersion:"-1"},r={name:"unknown",version:"-1",majorVersion:-1},{preset:a,version:v}=k(P,t),{preset:s,version:c}=k(U,t),b=k(D,t);if(e.chromium=!!b.preset,e.chromiumVersion=b.version,!e.chromium){const d=k($,t);e.webkit=!!d.preset,e.webkitVersion=d.version}return s&&(r.name=s.id,r.version=c,r.majorVersion=parseInt(c,10)),a&&(e.name=a.id,e.version=v,e.webview&&r.name==="ios"&&e.name!=="safari"&&(e.webview=!1)),e.majorVersion=parseInt(e.version,10),{browser:e,os:r,isMobile:o,isHints:!1}}function q(n){const t=navigator.userAgentData,o=[...t.brands],e=n&&n.fullVersionList,r=t.mobile||!1,a=o[0],v=(n&&n.platform||t.platform||navigator.platform).toLowerCase(),s={name:a.brand,version:a.version,majorVersion:-1,webkit:!1,webkitVersion:"-1",chromium:!1,chromiumVersion:"-1",webview:!!V(F,o).brand||H(M())},c={name:"unknown",version:"-1",majorVersion:-1};s.webkit=!s.chromium&&$.some(i=>W(o,i));const b=V(D,o);if(s.chromium=!!b.brand,s.chromiumVersion=b.version,!s.chromium){const i=V($,o);s.webkit=!!i.brand,s.webkitVersion=i.version}const d=U.find(i=>new RegExp(`${i.test}`,"g").exec(v));if(c.name=d?d.id:"",n&&(c.version=n.platformVersion),e&&e.length){const i=V(P,e);s.name=i.brand||s.name,s.version=i.version||s.version}else{const i=V(P,o);s.name=i.brand||s.name,s.version=i.brand&&n?n.uaFullVersion:i.version}return s.webkit&&(c.name=r?"ios":"mac"),c.name==="ios"&&s.webview&&(s.version="-1"),c.version=I(c.version),s.version=I(s.version),c.majorVersion=parseInt(c.version,10),s.majorVersion=parseInt(s.version,10),{browser:s,os:c,isMobile:r,isHints:!0}}async function ge(){if(O()){const n=await navigator.userAgentData.getHighEntropyValues(["architecture","model","platform","platformVersion","uaFullVersion","fullVersionList"]);return q(n)}return he()}function he(n){return typeof n>"u"&&O()?q():pe(n)}const _e={class:"header"},Ve={class:"logo"},ke={class:"login-block"},ye=["placeholder"],Se={key:1,class:"d-grid mt-4"},Ae=["disabled"],Ee={class:"d-grid mt-4"},Te={key:0,class:"tips"},Be=J({__name:"LoginView",setup(n){const{handleSubmit:t,isSubmitting:o}=ve(),e=h(!1),r=h(!0),a=h(!1),v=h("");let s;const c=window.location.protocol==="http:"?!1:!window.navigator.userAgentData,{t:b}=G(),{value:d,errorMessage:i}=we("password",Q().required()),T=h(!1);async function K(){const l=await fetch(`${ue()}/init`,{method:"POST",headers:de()});if(l.status===403){e.value=!0,r.value=!0,v.value="web_access_disabled";return}r.value=!1;const w=await l.text();w?(d.value=w,T.value=!1):T.value=!0}K();const j=t(async()=>{const l=localStorage.getItem("client_id");s=new WebSocket(`${X()}?cid=${l}&auth=1`);const w=d.value??"",y=Y(w),g=Z(y);v.value="",e.value=!1,s.onopen=async()=>{o.value=!0;const u=await ge(),B=ee(g,JSON.stringify({password:y,browserName:u.browser.name,browserVersion:u.browser.version,osName:u.os.name,osVersion:u.os.version,isMobile:u.isMobile}));s.send(se(B))},s.onmessage=async u=>{var N;const B=ne(g,te(await u.data.arrayBuffer())),L=JSON.parse(B);L.status==="PENDING"?a.value=!0:(localStorage.setItem("auth_token",L.token),s.close(),C.push({path:((N=C.currentRoute.value.query.redirect)==null?void 0:N.toString())??"/",replace:!0}))},s.onclose=u=>{u.reason==="abort"||u.reason==="OK"||(o.value=!1,e.value=!0,a.value=!1,v.value=`login.${u.reason?u.reason:"failed"}`)},window.setTimeout(function(){s.readyState!==1&&s.close(3001,"timeout")},2e3)});function z(){a.value=!1,e.value=!1,o.value=!1,s.close(3001,"abort")}return(l,w)=>{const y=me;return S(),A(le,null,[m("div",_e,[oe(y,{"logged-in":!1})]),m("div",Ve,[m("div",null,p(l.$t("app_name")),1)]),m("div",ke,[_(m("form",{onSubmit:w[1]||(w[1]=re((...g)=>f(j)&&f(j)(...g),["prevent"]))},[_(m("div",{class:"alert alert-danger",role:"alert"},p(v.value?l.$t(v.value):""),513),[[E,e.value]]),T.value?_((S(),A("input",{key:0,type:"password",class:"form-control","onUpdate:modelValue":w[0]||(w[0]=g=>ie(d)?d.value=g:null),placeholder:f(b)("password")},null,8,ye)),[[ae,f(d)]]):R("",!0),_(m("div",{class:"invalid-feedback"},p(f(i)?l.$t(f(i)):""),513),[[E,f(i)]]),r.value?R("",!0):(S(),A("div",Se,[m("button",{class:"btn",type:"submit",disabled:f(o)},p(l.$t(f(o)?"logging_in":"log_in")),9,Ae)]))],544),[[E,!a.value]]),_(m("div",null,[ce(p(l.$t("login.to_continue"))+" ",1),m("div",Ee,[m("button",{onClick:z,class:"btn",type:"button"},p(l.$t("cancel")),1)])],512),[[E,a.value]])]),f(c)?(S(),A("div",Te,p(l.$t("browser_warning")),1)):R("",!0)],64)}}});const Pe=fe(Be,[["__scopeId","data-v-9c469ae9"]]);export{Pe as default};
