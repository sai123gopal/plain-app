import{o as i,c,a as l,d as dt,u as _t,r as V,E as pt,N as mt,ah as ht,e as ft,s as ve,f as bt,ba as vt,bb as kt,bc as yt,bd as gt,be as Tt,bf as Ct,af as ke,i as qt,aC as Dt,w as wt,P as $t,Q as H,R as St,S as It,q as m,F as k,n as T,m as M,l as h,j as C,t as p,k as n,I as E,am as Vt,bg as Mt,at as Et,K as G,T as J,J as Ft,bh as xt,bi as Bt,ax as Zt,$ as At,A as y,a0 as Ht,B as Pt,C as Nt,bj as Lt,bk as zt,a3 as P,bl as ye,bm as ge,ai as Te,bn as X,aH as Ce,ae as Rt,an as Ut,bo as Wt,bp as Ot,_ as Kt}from"./index-2583f876.js";import{_ as Qt}from"./refresh-rounded-282e5642.js";import{_ as jt}from"./Breadcrumb-ef080890.js";import{g as qe,M as Gt}from"./splitpanes.es-96eec7b1.js";import{E as De}from"./EditValueModal-13c70216.js";import"./vee-validate.esm-b0601c3b.js";const Jt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Xt=l("path",{fill:"currentColor",d:"M8 18H4q-.425 0-.713-.288T3 17q0-.425.288-.713T4 16h4q.425 0 .713.288T9 17q0 .425-.288.713T8 18ZM20 8H4q-.425 0-.713-.288T3 7q0-.425.288-.713T4 6h16q.425 0 .713.288T21 7q0 .425-.288.713T20 8Zm-6 5H4q-.425 0-.713-.288T3 12q0-.425.288-.713T4 11h10q.425 0 .713.288T15 12q0 .425-.288.713T14 13Z"},null,-1),Yt=[Xt];function es(b,o){return i(),c("svg",Jt,Yt)}const ts={name:"material-symbols-sort-rounded",render:es},ss={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},os=l("path",{fill:"currentColor",d:"M19.6 21.6L12 14l-2.35 2.35q.2.375.275.8T10 18q0 1.65-1.175 2.825T6 22q-1.65 0-2.825-1.175T2 18q0-1.65 1.175-2.825T6 14q.425 0 .85.075t.8.275L10 12L7.65 9.65q-.375.2-.8.275T6 10q-1.65 0-2.825-1.175T2 6q0-1.65 1.175-2.825T6 2q1.65 0 2.825 1.175T10 6q0 .425-.075.85t-.275.8L21.6 19.6q.425.425.425 1t-.425 1q-.425.425-1 .425t-1-.425ZM15 11l-2-2l6.6-6.6q.425-.425 1-.425t1 .425q.425.425.425 1t-.425 1L15 11ZM6 8q.825 0 1.413-.588T8 6q0-.825-.588-1.413T6 4q-.825 0-1.413.588T4 6q0 .825.588 1.413T6 8Zm6 4.5q.225 0 .363-.138T12.5 12q0-.225-.138-.363T12 11.5q-.225 0-.363.138T11.5 12q0 .225.138.363T12 12.5ZM6 20q.825 0 1.413-.588T8 18q0-.825-.588-1.413T6 16q-.825 0-1.413.588T4 18q0 .825.588 1.413T6 20Z"},null,-1),ns=[os];function ls(b,o){return i(),c("svg",ss,ns)}const as={name:"material-symbols-content-cut-rounded",render:ls},is={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},cs=l("path",{fill:"currentColor",d:"M9 18q-.825 0-1.413-.588T7 16V4q0-.825.588-1.413T9 2h9q.825 0 1.413.588T20 4v12q0 .825-.588 1.413T18 18H9Zm0-2h9V4H9v12Zm-4 6q-.825 0-1.413-.588T3 20V7q0-.425.288-.713T4 6q.425 0 .713.288T5 7v13h10q.425 0 .713.288T16 21q0 .425-.288.713T15 22H5ZM9 4v12V4Z"},null,-1),rs=[cs];function us(b,o){return i(),c("svg",is,rs)}const ds={name:"material-symbols-content-copy-outline-rounded",render:us},q=b=>(Pt("data-v-a5e6c12f"),b=b(),Nt(),b),_s={class:"v-toolbar"},ps={class:"right-actions"},ms=q(()=>l("md-ripple",null,null,-1)),hs=q(()=>l("md-ripple",null,null,-1)),fs=["onClick"],bs=q(()=>l("md-ripple",null,null,-1)),vs=["onClick"],ks=q(()=>l("md-ripple",null,null,-1)),ys={class:"form-check"},gs={class:"form-check-label"},Ts=["checked"],Cs={class:"form-check"},qs={class:"form-check-label"},Ds=["checked"],ws=q(()=>l("md-ripple",null,null,-1)),$s={class:"icon-button btn-sort"},Ss=q(()=>l("md-ripple",null,null,-1)),Is={class:"menu-items"},Vs=["onClick","selected"],Ms={slot:"headline"},Es={class:"file-items"},Fs=["onClick","onDblclick","onContextmenu"],xs=["checked"],Bs=["src"],Zs={class:"title"},As={style:{"font-size":"0.75rem"}},Hs=["onContextmenu"],Ps={key:0,class:"no-files"},Ns={key:0,class:"file-item-info"},Ls=dt({__name:"FilesView",setup(b){var me,he,fe,be;const{t:o}=_t(),we=V([]),Y=pt(),$e=Y.query,d=Y.params.type,ee=V(mt(((me=$e.q)==null?void 0:me.toString())??"")),N=ht(ee.value),v=V(((he=N.find(e=>e.name==="path"))==null?void 0:he.value)??"");let F=((fe=N.find(e=>e.name==="dir"))==null?void 0:fe.value)??"";F||(((be=N.find(t=>t.name==="isDir"))==null?void 0:be.value)==="1"?F=v.value:F=v.value.substring(0,v.value.lastIndexOf("/")));const Se=V(F),Ie=[{label:"sort_by.date_asc",value:"DATE_ASC"},{label:"sort_by.date_desc",value:"DATE_DESC"},{label:"sort_by.size_asc",value:"SIZE_ASC"},{label:"sort_by.size_desc",value:"SIZE_DESC"},{label:"sort_by.name_asc",value:"NAME_ASC"},{label:"sort_by.name_desc",value:"NAME_DESC"}],D=V(!1),te=ft(),{fileShowHidden:w,fileSortBy:L}=ve(te),se=bt(),{app:$,urlTokenKey:S,selectedFiles:Ve}=ve(se);let x=$.value.internalStoragePath;d&&(d==="sdcard"?x=$.value.sdcardPath:d.startsWith("usb")?x=$.value.usbDiskPaths[parseInt(d.substring(3))-1]:d==="app"&&(x=$.value.externalFilesDir));const{loading:Me,panels:_,currentDir:B,refetch:z}=vt(S,x,Se.value,L),{createPath:Ee,createVariables:Fe,createMutation:xe}=kt(S,_),{renameValue:Be,renamePath:Ze,renameDone:Ae,renameMutation:He,renameVariables:Pe}=yt(_),{internal:oe,sdcard:ne,usb:Ne,refetch:R}=gt(),{onDeleted:U}=Lt(_,B,R),{downloadFile:le,downloadDir:Le,downloadFiles:ze}=Vt(S),{view:W}=Ot(we,(e,t)=>{se.lightbox={sources:e,index:t,visible:!0}}),{selectedItem:Z,select:Re}=Tt(B,d,ee,te),{canPaste:ae,copy:O,cut:ie,paste:K}=Ct(Ve,z,R),{input:Ue,upload:ce,uploadChanged:re}=ke(),{input:We,upload:ue,uploadChanged:de}=ke(),{mutate:Oe,onDone:Ke}=qt({document:Mt,appApi:!0});Ke(e=>{ze(e.data.setTempValue.key),_.value.forEach(t=>{t.items.forEach(s=>{s.checked=!1})})});const I=()=>{const e=[];return _.value.forEach(t=>{t.items.forEach(s=>{s.checked&&(s.panel=t,e.push(s))})}),e};function Qe(e){D.value=e.target.checked}function je(e){w.value=e.target.checked}const Ge=()=>{Oe({key:zt(),value:JSON.stringify(I().map(e=>({path:e.path})))})},Je=Dt(()=>I().length>0),Xe=()=>{P(ye,{files:I(),onDone:U})};v.value&&wt(()=>_.value.length,()=>{if(_.value.length>0&&v.value){const t=_.value[_.value.length-1].items.find(s=>s.path===v.value);t&&(Z.value=t,v.value="")}});function Ye(){var e,t,s,r;if(d){if(d==="sdcard")return`${o("sdcard")} (${o("storage_free_total",{free:y(((e=ne.value)==null?void 0:e.freeBytes)??0),total:y(((t=ne.value)==null?void 0:t.totalBytes)??0)})})`;if(d==="app")return o("app_name");if(d.startsWith("usb")){const A=parseInt(d.substring(3)),f=Ne.value[A-1];return`${o("usb_storage")} ${A} (${o("storage_free_total",{free:y((f==null?void 0:f.freeBytes)??0),total:y((f==null?void 0:f.totalBytes)??0)})})`}}return`${o("page_title.files")} (${o("storage_free_total",{free:y(((s=oe.value)==null?void 0:s.freeBytes)??0),total:y(((r=oe.value)==null?void 0:r.totalBytes)??0)})})`}function et(e,t){if(D.value){t.checked=!t.checked;return}Re(e,t)}function tt(e,t){L.value=t,e.close()}function st(){z(B.value)}function ot(e,t){t.isDir||(ge(t.name)?window.open(Te(S.value,t.path),"_blank"):X(t.name)?W(w?e.items:e.items.filter(s=>!s.name.startsWith(".")),t):le(t.path))}function nt(e,t){e.preventDefault();const s=[{label:o("create_folder"),onClick:()=>{Ee.value=t,P(De,{title:o("name"),placeholder:o("name"),mutation:xe,getVariables:Fe})}},{label:o("upload_files"),onClick:()=>{ce(t)}},{label:o("upload_folder"),onClick:()=>{ue(t)}}];ae()&&s.push({label:o("paste"),onClick:()=>{K(t)}}),Ce({x:e.x,y:e.y,items:s})}function lt(e,t,s){e.preventDefault();let r;s.isDir?r=[{label:o("upload_files"),onClick:()=>{ce(s.path)}},{label:o("upload_folder"),onClick:()=>{ue(s.path)}},{label:o("download"),onClick:()=>{Le(s.path)}}]:(r=[],(ge(s.name)||X(s.name))&&r.push({label:o("open"),onClick:()=>{X(s.name)?W(t.items,s):window.open(Te(S.value,s.path),"_blank")}}),r.push({label:o("download"),onClick:()=>{le(s.path)}})),r.push({label:o("duplicate"),onClick:()=>{O([s]),K(t.dir)}}),r.push({label:o("cut"),onClick:()=>{s.panel=t,ie([s])}}),r.push({label:o("copy"),onClick:()=>{O([s])}}),s.isDir&&ae()&&r.push({label:o("paste"),onClick:()=>{K(s.path)}}),r=[...r,{label:o("rename"),onClick:()=>{Be.value=s.name,Ze.value=s.path,P(De,{title:o("rename"),placeholder:o("name"),value:s.name,mutation:He,getVariables:Pe,done:Ae})}},{label:o("delete"),onClick:()=>{P(ye,{files:[s],onDone:U})}}],Ce({x:e.x,y:e.y,items:r})}const _e=e=>{e.status==="done"&&setTimeout(()=>{z(e.dir),R()},1e3)},pe=e=>{U([e.item])};return $t(()=>{H.on("upload_task_done",_e),H.on("file_deleted",pe)}),St(()=>{H.off("upload_task_done",_e),H.off("file_deleted",pe)}),(e,t)=>{const s=jt,r=ds,A=as,f=Rt,at=Ut,it=Qt,ct=ts,rt=Et,ut=Wt,g=It("tooltip");return i(),c(k,null,[l("div",_s,[m(s,{current:Ye}),l("div",ps,[D.value&&Je.value?(i(),c(k,{key:0},[T((i(),c("button",{class:"icon-button",onClick:t[0]||(t[0]=M(()=>n(O)(I()),["stop"]))},[ms,m(r)])),[[g,e.$t("copy")]]),T((i(),c("button",{class:"icon-button",onClick:t[1]||(t[1]=M(()=>n(ie)(I()),["stop"]))},[hs,m(A)])),[[g,e.$t("cut")]]),T((i(),c("button",{class:"icon-button",onClick:M(Xe,["stop"])},[bs,m(f)],8,fs)),[[g,e.$t("delete")]]),T((i(),c("button",{class:"icon-button",onClick:M(Ge,["stop"])},[ks,m(at)],8,vs)),[[g,e.$t("download")]])],64)):h("",!0),l("div",ys,[l("label",gs,[l("md-checkbox",{"touch-target":"wrapper",onChange:Qe,checked:D.value},null,40,Ts),C(" "+p(e.$t("select_mode")),1)])]),l("div",Cs,[l("label",qs,[l("md-checkbox",{"touch-target":"wrapper",onChange:je,checked:n(w)},null,40,Ds),C(p(e.$t("show_hidden")),1)])]),T((i(),c("button",{class:"icon-button btn-refresh",onClick:st},[ws,m(it)])),[[g,e.$t("refresh")]]),m(rt,null,{content:E(u=>[l("div",Is,[(i(),c(k,null,G(Ie,a=>l("md-menu-item",{onClick:Q=>tt(u,a.value),selected:a.value===n(L)},[l("div",Ms,p(e.$t(a.label)),1)],8,Vs)),64))])]),default:E(()=>[T((i(),c("button",$s,[Ss,m(ct)])),[[g,e.$t("sort")]])]),_:1})])]),m(n(Gt),{class:"panel-container"},{default:E(()=>[(i(!0),c(k,null,G(n(_),u=>(i(),J(n(qe),{key:u.dir},{default:E(()=>[l("div",Es,[(i(!0),c(k,null,G(u.items,a=>{var Q;return i(),c(k,{key:a.path},[!a.name.startsWith(".")||n(w)?(i(),c("div",{key:0,class:Ft(["file-item",{active:(n(B)+"/").startsWith(a.path+"/")||((Q=n(Z))==null?void 0:Q.path)===a.path}]),onClick:j=>et(u,a),onDblclick:M(j=>ot(u,a),["prevent"]),onContextmenu:j=>lt(j,u,a)},[D.value?(i(),c("md-checkbox",{key:0,"touch-target":"wrapper",checked:a.checked},null,8,xs)):h("",!0),a.isDir?(i(),J(ut,{key:1})):h("",!0),n(xt)(a.name)||n(Bt)(a.name)?(i(),c("img",{key:2,src:n(Zt)(a.fileId)+"&w=50&h=50",width:"50",height:"50"},null,8,Bs)):h("",!0),l("div",Zs,[C(p(a.name)+" ",1),l("div",As,[C(p(n(At)(a.updatedAt)),1),a.isDir?h("",!0):(i(),c(k,{key:0},[C(", "+p(n(y)(a.size)),1)],64))])])],42,Fs)):h("",!0)],64)}),128)),l("div",{class:"empty",onContextmenu:a=>nt(a,u.dir)},[u.items.filter(a=>!a.name.startsWith(".")||n(w)).length===0?(i(),c("div",Ps,p(e.$t("no_files")),1)):h("",!0)],40,Hs)])]),_:2},1024))),128)),n(_).length===0?(i(),J(n(qe),{key:0,class:"no-data-placeholder"},{default:E(()=>[C(p(e.$t(n(Ht)(n(Me),n($).permissions,"WRITE_EXTERNAL_STORAGE"))),1)]),_:1})):h("",!0)]),_:1}),n(Z)?(i(),c("div",Ns,p(e.$t("path"))+": "+p(n(Z).path),1)):h("",!0),l("input",{ref_key:"fileInput",ref:Ue,style:{display:"none"},type:"file",multiple:"",onChange:t[2]||(t[2]=(...u)=>n(re)&&n(re)(...u))},null,544),l("input",{ref_key:"dirFileInput",ref:We,style:{display:"none"},type:"file",multiple:"",webkitdirectory:"",mozdirectory:"",directory:"",onChange:t[3]||(t[3]=(...u)=>n(de)&&n(de)(...u))},null,544)],64)}}});const Qs=Kt(Ls,[["__scopeId","data-v-a5e6c12f"]]);export{Qs as default};
