import{o as y,c as T,a as s,d as B,r as L,bX as D,i as A,bY as Q,bZ as V,t as h,p as M,F as G,J as x,j as d,m as z,aW as E,ao as k,P as S,a0 as j,a4 as N,_ as H,u as C,x as F,a2 as J,g as P,ag as R,bG as W,aT as X}from"./index-9c78c93b.js";import{u as Y,a as Z}from"./vee-validate.esm-2d465d6a.js";const K={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},O=s("path",{fill:"currentColor",d:"M19.125 14.625q-.275.425-.687.45t-.713-.2t-.413-.612t.188-.813L18.55 12L15 7h-4.725q-.5 0-.75-.312T9.275 6t.25-.687t.75-.313H15q.5 0 .925.213t.725.637l3.525 5q.2.275.288.563t.087.587t-.088.588t-.287.562zM5 19q-.825 0-1.412-.587T3 17V7q0-.275.063-.5t.187-.45L2.1 4.9q-.275-.275-.275-.7t.275-.7t.7-.275t.7.275l17 17q.275.275.275.7t-.275.7t-.7.275t-.7-.275l-3.15-3.15q-.225.125-.45.188T15 19zm9.2-2L5 7.8V17z"},null,-1),U=[O];function ee(_,a){return y(),T("svg",K,U)}const te={name:"material-symbols-label-off-outline-rounded",render:ee},ae={slot:"headline"},se={slot:"content"},oe=["label","selected"],ne=["label","selected"],de=["label","selected","onClick"],le={slot:"actions"},ie=["disabled"],ue=B({__name:"AddToTagsModal",props:{type:{type:String,required:!0},tags:{type:Array,default:()=>[]},query:{type:String,required:!0}},setup(_){const a=_,{handleSubmit:l}=Y(),i=L("add_to_tags");function g(e){const{button:r}=e.detail,q=r.dataset.value;i.value=q}const{value:o,errorMessage:n}=Z("selectedTags",D().test("required",()=>"valid.required",e=>e.length),{initialValue:[]}),{mutate:m,loading:u,onDone:p}=A({document:Q,appApi:!0}),{mutate:f,loading:t,onDone:v}=A({document:V,appApi:!0}),b=()=>{S.emit("items_tags_updated",{type:a.type}),S.emit("refetch_tags",a.type),k()};v(b),p(b);function I(e){o.value.includes(e)?j(o.value,r=>r.id===e.id):o.value.push(e)}const $=l(()=>{i.value==="add_to_tags"?f({type:a.type,tagIds:o.value.map(e=>e.id),query:a.query}):m({type:a.type,tagIds:o.value.map(e=>e.id),query:a.query})});return(e,r)=>{const q=N,w=te;return y(),T("md-dialog",null,[s("div",ae,h(e.$t("tags")),1),s("div",se,[s("md-outlined-segmented-button-set",{onSegmentedButtonSetSelection:g},[s("md-outlined-segmented-button",{"data-value":"add_to_tags",label:e.$t("add_to_tags"),selected:i.value==="add_to_tags"},[M(q,{slot:"icon"})],8,oe),s("md-outlined-segmented-button",{"data-value":"remove_from_tags",label:e.$t("remove_from_tags"),selected:i.value==="remove_from_tags"},[M(w,{slot:"icon"})],8,ne)],32),s("md-chip-set",null,[(y(!0),T(G,null,x(_.tags,c=>(y(),T("md-filter-chip",{key:c.id,label:c.name,selected:d(o).includes(c),onClick:ce=>I(c)},null,8,de))),128))]),z(s("div",{class:"invalid-feedback"},h(d(n)?e.$t(d(n)):""),513),[[E,d(n)]])]),s("div",le,[s("md-outlined-button",{value:"cancel",onClick:r[0]||(r[0]=(...c)=>d(k)&&d(k)(...c))},h(e.$t("cancel")),1),s("md-filled-button",{value:"save",disabled:d(t)||d(u),onClick:r[1]||(r[1]=(...c)=>d($)&&d($)(...c)),autofocus:""},h(e.$t("save")),9,ie)])])}}});const re=H(ue,[["__scopeId","data-v-ad35e7a6"]]),ge=(_,a,l)=>{const{t:i}=C();return{addToTags:(g,o)=>{let n=o;if(!g){const m=a.value.filter(u=>u.checked);if(m.length===0){F(i("select_first"),"error");return}n=`ids:${m.map(u=>u.id).join(",")}`}J(re,{type:_,tags:l.value,query:n})}}},pe=(_,a,l,i)=>{const g=L([]),{t:o}=C();return P({handle:async(n,m)=>{if(m)F(o(m),"error");else if(n){g.value=n.tags;const u=R(a.value);l.tags=[];const p=[];u.forEach(t=>{if(t.name==="text")l.text=t.value;else if(t.name==="tag"){const v=n.tags.find(b=>W(b.name)===t.value);v?(l.tags.push(v),p.push(v.id)):p.push("invalid")}else t.name==="bucket_id"&&(l.bucketId=t.value)});const f=[...u].filter(t=>t.name!=="tag");p.forEach(t=>{f.push({name:"tag_id",op:"",value:t})}),i(f)}},document:X,variables:{type:_},appApi:!0}),{tags:g}};export{ge as a,pe as u};
