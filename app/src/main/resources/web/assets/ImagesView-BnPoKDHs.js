import{_ as fo}from"./VPagination.vuevuetypescriptsetuptruelang-goYu96wT.js";import{_ as Co,a as $o,b as bo,c as wo,d as Io}from"./grid-view-outline-rounded-D3vSSmrh.js";import{d as To,u as Do,s as Ue,h as W,g as So,I as Ao,i as Eo,ai as qe,aF as Mo,J as Fo,aG as Vo,aH as Be,aI as Lo,aj as zo,K as Ro,aJ as Uo,aK as qo,L as Bo,M as Ho,c as m,a as r,m as e,t as y,O as f,x as u,v as i,q as d,w as a,e as M,p as l,aL as No,N as q,P as j,Q as Ko,aM as Qo,f as Po,C as Go,aN as Oo,aO as Wo,aP as jo,ao as Jo,S as Xo,o as t,aQ as J,aR as X,aC as _e,aS as F,E as He,U as Zo,V as Yo,W as xo,X as es,ar as os,aq as ss,Z as ts,$ as ns,a0 as as,a1 as V,ae as ls,aT as is,as as cs,aU as ds,a2 as rs,aV as us,a4 as _s,a3 as ps,aW as ms}from"./index-R8dLcqG_.js";import{_ as ks,a as gs}from"./SearchInput-DhaE-3h8.js";import{_ as vs}from"./sort-rounded-CsJpi3ce.js";import{_ as hs}from"./upload-rounded-CQIzYelP.js";import{u as ys}from"./search-ByVbj6Ls.js";import{a as fs}from"./tags-Dbpv368M.js";import{u as Cs,a as $s}from"./key-events-BNCM8SMB.js";import"./search-rounded-CULEMJ2O.js";import"./rss-feed-rounded-BCiGdgJ5.js";import"./vee-validate.esm-vpr6zxQb.js";const bs={class:"top-app-bar"},ws=["checked","indeterminate"],Is={class:"title"},Ts={key:0},Ds={key:1},Ss={class:"actions"},As=["onClick"],Es={slot:"headline"},Ms=["onClick"],Fs={slot:"headline"},Vs={class:"menu-items"},Ls=["onClick","selected"],zs={slot:"headline"},Rs={class:"sm"},Us=["selected"],qs=["selected"],Bs=["onClick","onMouseover"],Hs=["src"],Ns={key:1,class:"actions"},Ks={class:"right"},Qs=["onClick","onMouseover"],Ps={class:"start"},Gs=["onClick","checked"],Os=["onClick","checked"],Ws={class:"number"},js=["src"],Js={class:"title"},Xs={class:"subtitle"},Zs=["onClick"],Ys={class:"actions"},xs={class:"time"},et={key:2,class:"no-data-placeholder"},D=55,mt=To({__name:"ImagesView",setup(ot){var Ve;const I=Do(),{imageSortBy:B}=Ue(I),T=W([]),{t:Ne}=So(),{parseQ:Ke}=ys(),S=Ao({tagIds:[]}),pe=Eo(),{app:A,urlTokenKey:Z,uploads:Y}=Ue(pe),{input:Qe,upload:Pe,uploadChanged:me}=qe(Y),{input:Ge,upload:Oe,uploadChanged:ke}=qe(Y),{dropping:We,fileDragEnter:ge,fileDragLeave:ve,dropFiles:je}=Mo(Y),x=W(!1),_=Fo.IMAGE,he=Ko(),ye=he.query,ee=W(parseInt(((Ve=ye.page)==null?void 0:Ve.toString())??"1")),{tags:H,buckets:oe,fetch:Je}=Vo(_),Xe=Be(()=>{const o={};return oe.value.forEach(n=>{o[n.id]=n}),o}),$=W(""),{addToTags:Ze}=fs(_,H),{deleteItems:se,deleteItem:N}=Lo(),{view:Ye}=Qo(_),{selectedIds:h,allChecked:fe,realAllChecked:w,selectRealAll:xe,allCheckedAlertVisible:eo,clearSelection:L,toggleAllChecked:Ce,toggleSelect:z,total:b,checked:R,shiftEffectingIds:K,handleItemClick:$e,handleMouseOver:be,selectAll:oo,shouldSelect:we}=Cs(T),{downloadItems:Ie}=zo(Z,_,L,"images.zip"),{downloadFile:Q}=os(Z),Te=o=>{const n=he.query.q;Po(I,n?`/images?page=${o}&q=${n}`:`/images?page=${o}`)},{keyDown:De,keyUp:Se}=$s(b,D,ee,oo,L,Te,()=>{J(X.MEDIA_TRASH,A.value.osVersion)?O(_,U()):se(_,h.value,w.value,b.value,$.value)}),so=ss(),to=Be(()=>T.value.map(o=>({src:_e(o.fileId),name:F(o.path),duration:0,size:o.size,path:o.path,type:_,data:o})));function te(o){pe.lightbox={sources:to.value,index:o,visible:!0}}const U=()=>{let o=$.value;return w.value||(o=`ids:${h.value.join(",")}`),o};function Ae(o){ts(ns,{type:_,tags:H.value,item:{key:o.id,title:o.title,size:o.size},selected:H.value.filter(n=>o.tags.some(C=>C.id===n.id))})}function no(o,n){if(B.value===n){o.close();return}x.value=!0,B.value=n,o.close()}const{loading:P,fetch:G}=Ro({handle:async(o,n)=>{if(x.value=!1,n)Go(Ne(n),"error");else if(o){const C=[];for(const c of o.images)C.push({...c,fileId:Oo(Z.value,c.path,c.id)});T.value=C,b.value=o.imageCount}},document:Wo,variables:()=>({offset:(ee.value-1)*D,limit:D,query:$.value,sortBy:B.value}),appApi:!0}),{trashLoading:ne,trash:O}=Uo(),{restoreLoading:ae,restore:le}=qo();function ao(o){return o?`/images?q=${o}`:"/images"}function ie(){const o=oe.value.find(n=>n.id===S.bucketId);return o?ms(o.topItems[0]):`${A.value.internalStoragePath}/Pictures`}function lo(o){Pe(ie()),o.close()}function io(o){Oe(ie()),o.close()}function co(o){je(o,ie(),"image")}const Ee=o=>{o.type===_&&(L(),G())},Me=o=>{o.type===_&&G()},Fe=o=>{o.type===_&&(L(),G())};return Bo(()=>{var o;$.value=as(((o=ye.q)==null?void 0:o.toString())??""),Ke(S,$.value),Je(),G(),V.on("item_tags_updated",Me),V.on("items_tags_updated",Ee),V.on("media_items_actioned",Fe),window.addEventListener("keydown",De),window.addEventListener("keyup",Se)}),Ho(()=>{V.off("item_tags_updated",Me),V.off("items_tags_updated",Ee),V.off("media_items_actioned",Fe),window.removeEventListener("keydown",De),window.removeEventListener("keyup",Se)}),(o,n)=>{const C=ls,c=jo,ce=is,E=cs,de=ds,re=rs,ro=ks,uo=hs,Le=Jo,_o=vs,po=Co,mo=$o,ko=gs,ue=bo,ze=wo,go=us,Re=_s,vo=ps,ho=Io,yo=fo,p=Xo("tooltip");return t(),m(f,null,[r("div",bs,[r("md-checkbox",{"touch-target":"wrapper",onChange:n[0]||(n[0]=(...s)=>e(Ce)&&e(Ce)(...s)),checked:e(fe),indeterminate:!e(fe)&&e(R)},null,40,ws),r("div",Is,[e(h).length?(t(),m("span",Ts,y(o.$t("x_selected",{count:e(w)?e(b).toLocaleString():e(h).length.toLocaleString()})),1)):(t(),m("span",Ds,y(o.$t("page_title.images"))+" ("+y(e(b).toLocaleString())+")",1)),e(R)?(t(),m(f,{key:2},[S.trash?(t(),m(f,{key:0},[u((t(),i(c,{onClick:n[1]||(n[1]=a(s=>e(se)(e(_),e(h),e(w),e(b),$.value),["stop"]))},{icon:d(()=>[l(C)]),_:1})),[[p,o.$t("delete")]]),u((t(),i(c,{onClick:n[2]||(n[2]=a(s=>e(le)(e(_),U()),["stop"])),loading:e(ae)(U())},{icon:d(()=>[l(ce)]),_:1},8,["loading"])),[[p,o.$t("restore")]]),u((t(),i(c,{onClick:n[3]||(n[3]=a(s=>e(Ie)(e(w),e(h),$.value),["stop"]))},{icon:d(()=>[l(E)]),_:1})),[[p,o.$t("download")]])],64)):(t(),m(f,{key:1},[e(J)(e(X).MEDIA_TRASH,e(A).osVersion)?u((t(),i(c,{key:0,onClick:n[4]||(n[4]=a(s=>e(O)(e(_),U()),["stop"])),loading:e(ne)(U())},{icon:d(()=>[l(de)]),_:1},8,["loading"])),[[p,o.$t("move_to_trash")]]):u((t(),i(c,{key:1,onClick:n[5]||(n[5]=a(s=>e(se)(e(_),e(h),e(w),e(b),$.value),["stop"]))},{icon:d(()=>[l(C)]),_:1})),[[p,o.$t("delete")]]),u((t(),i(c,{onClick:n[6]||(n[6]=a(s=>e(Ie)(e(w),e(h),$.value),["stop"]))},{icon:d(()=>[l(E)]),_:1})),[[p,o.$t("download")]]),u((t(),i(c,{onClick:n[7]||(n[7]=a(s=>e(Ze)(e(h),e(w),$.value),["stop"]))},{icon:d(()=>[l(re)]),_:1})),[[p,o.$t("add_to_tags")]])],64))],64)):M("",!0)]),r("div",Ss,[l(ro,{filter:S,tags:e(H),buckets:e(oe),"get-url":ao},null,8,["filter","tags","buckets"]),S.trash?M("",!0):(t(),i(Le,{key:0},{content:d(s=>[r("md-menu-item",{onClick:a(g=>lo(s),["stop"])},[r("div",Es,y(o.$t("upload_files")),1)],8,As),r("md-menu-item",{onClick:a(g=>io(s),["stop"])},[r("div",Fs,y(o.$t("upload_folder")),1)],8,Ms)]),default:d(()=>[u((t(),i(c,null,{icon:d(()=>[l(uo)]),_:1})),[[p,o.$t("upload")]])]),_:1})),l(Le,null,{content:d(s=>[r("div",Vs,[(t(!0),m(f,null,j(e(so),g=>(t(),m("md-menu-item",{onClick:k=>no(s,g.value),key:g.value,selected:g.value===e(B)},[r("div",zs,y(o.$t(g.label)),1)],8,Ls))),128))])]),default:d(()=>[u((t(),i(c,{loading:x.value},{icon:d(()=>[l(_o)]),_:1},8,["loading"])),[[p,o.$t("sort")]])]),_:1}),r("md-outlined-segmented-button-set",Rs,[r("md-outlined-segmented-button",{"data-value":"grid","no-checkmark":"",selected:!e(I).imagesCardView,onClick:n[8]||(n[8]=s=>e(I).imagesCardView=!1)},[l(po,{slot:"icon"})],8,Us),r("md-outlined-segmented-button",{"data-value":"card","no-checkmark":"",selected:e(I).imagesCardView,onClick:n[9]||(n[9]=s=>e(I).imagesCardView=!0)},[l(mo,{slot:"icon"})],8,qs)])])]),l(ko,{limit:D,total:e(b),"all-checked-alert-visible":e(eo),"real-all-checked":e(w),"select-real-all":e(xe),"clear-selection":e(L)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),r("div",{class:"scroll-content",onDragover:n[13]||(n[13]=a((...s)=>e(ge)&&e(ge)(...s),["stop","prevent"]))},[u(r("div",{class:"drag-mask",onDrop:a(co,["stop","prevent"]),onDragleave:n[10]||(n[10]=a((...s)=>e(ve)&&e(ve)(...s),["stop","prevent"]))},y(o.$t("release_to_send_files")),545),[[No,e(We)]]),e(I).imagesCardView?(t(),m("div",{key:1,class:q(["media-list",{"select-mode":e(R)}])},[(t(!0),m(f,null,j(T.value,(s,g)=>{var k;return t(),m("section",{class:q(["media-item selectable-card",{selected:e(h).includes(s.id),selecting:e(K).includes(s.id)}]),key:s.id,onClick:a(v=>e($e)(v,s,g,te),["stop"]),onMouseover:v=>e(be)(v,g)},[r("div",Ps,[e(K).includes(s.id)?(t(),m("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",onClick:a(v=>e(z)(v,s,g),["stop"]),checked:e(we)},null,8,Gs)):(t(),m("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",onClick:a(v=>e(z)(v,s,g),["stop"]),checked:e(h).includes(s.id)},null,8,Os)),r("span",Ws,[l(vo,{id:g+1,raw:s},null,8,["id","raw"])])]),r("img",{class:"image",src:e(_e)(s.fileId,"&w=200&h=200"),onerror:"this.src='/broken-image.png'"},null,8,js),r("div",Js,y(e(F)(s.path)),1),r("div",Xs,[r("span",null,y(e(He)(s.size)),1),r("a",{onClick:a(v=>e(Ye)(e(I),s.bucketId),["stop","prevent"])},y((k=Xe.value[s.bucketId])==null?void 0:k.name),9,Zs),l(Re,{tags:s.tags,type:e(_),"only-links":!0},null,8,["tags","type"])]),r("div",Ys,[S.trash?(t(),m(f,{key:0},[u((t(),i(c,{class:"sm",onClick:a(v=>e(N)(e(_),s),["stop"])},{icon:d(()=>[l(C)]),_:2},1032,["onClick"])),[[p,o.$t("delete")]]),u((t(),i(c,{class:"sm",onClick:a(v=>e(le)(e(_),`ids:${s.id}`),["stop"]),loading:e(ae)(`ids:${s.id}`)},{icon:d(()=>[l(ce)]),_:2},1032,["onClick","loading"])),[[p,o.$t("restore")]]),u((t(),i(c,{class:"sm",onClick:a(v=>e(Q)(s.path,e(F)(s.path).replace(" ","-")),["stop"])},{icon:d(()=>[l(E)]),_:2},1032,["onClick"])),[[p,o.$t("download")]])],64)):(t(),m(f,{key:1},[e(J)(e(X).MEDIA_TRASH,e(A).osVersion)?u((t(),i(c,{key:0,class:"sm",onClick:a(v=>e(O)(e(_),`ids:${s.id}`),["stop"]),loading:e(ne)(`ids:${s.id}`)},{icon:d(()=>[l(de)]),_:2},1032,["onClick","loading"])),[[p,o.$t("move_to_trash")]]):u((t(),i(c,{key:1,class:"sm",onClick:a(v=>e(N)(e(_),s),["stop"])},{icon:d(()=>[l(C)]),_:2},1032,["onClick"])),[[p,o.$t("delete")]]),u((t(),i(c,{class:"sm",onClick:a(v=>e(Q)(s.path,e(F)(s.path).replace(" ","-")),["stop"])},{icon:d(()=>[l(E)]),_:2},1032,["onClick"])),[[p,o.$t("download")]]),u((t(),i(c,{class:"sm",onClick:a(v=>Ae(s),["stop"])},{icon:d(()=>[l(re)]),_:2},1032,["onClick"])),[[p,o.$t("add_to_tags")]])],64))]),r("div",xs,[u((t(),m("span",null,[Yo(y(e(xo)(s.createdAt)),1)])),[[p,e(Zo)(s.createdAt)]])])],42,Qs)}),128)),e(P)&&T.value.length===0?(t(),i(ho,{key:0,limit:D})):M("",!0)],2)):(t(),m("div",{key:0,class:q(["media-grid",{"select-mode":e(R)}])},[(t(!0),m(f,null,j(T.value,(s,g)=>(t(),m("section",{class:q(["media-item",{selected:e(h).includes(s.id),selecting:e(K).includes(s.id)}]),key:s.id,onClick:a(k=>e($e)(k,s,g,te),["stop"]),onMouseover:k=>e(be)(k,g)},[r("img",{class:"image-thumb image",src:e(_e)(s.fileId,"&w=200&h=200"),onerror:"this.src='/broken-image.png'"},null,8,Hs),e(K).includes(s.id)?(t(),i(c,{key:0,class:"btn-checkbox",onClick:a(k=>e(z)(k,s,g),["stop"])},{icon:d(()=>[e(we)?(t(),i(ue,{key:0})):(t(),i(ze,{key:1}))]),_:2},1032,["onClick"])):e(h).includes(s.id)?(t(),i(c,{key:1,class:"btn-checkbox",onClick:a(k=>e(z)(k,s,g),["stop"])},{icon:d(()=>[l(ue)]),_:2},1032,["onClick"])):(t(),m(f,{key:2},[l(c,{class:"btn-checkbox",onClick:a(k=>e(z)(k,s,g),["stop"])},{icon:d(()=>[e(h).includes(s.id)?(t(),i(ue,{key:0})):(t(),i(ze,{key:1}))]),_:2},1032,["onClick"]),e(R)?u((t(),i(c,{key:0,class:"btn-zoom sm",onClick:a(k=>te(g),["stop"])},{icon:d(()=>[l(go)]),_:2},1032,["onClick"])),[[p,o.$t("open")]]):(t(),m("div",Ns,[S.trash?(t(),m(f,{key:0},[u((t(),i(c,{class:"sm",onClick:a(k=>e(N)(e(_),s),["stop"])},{icon:d(()=>[l(C)]),_:2},1032,["onClick"])),[[p,o.$t("delete")]]),u((t(),i(c,{class:"sm",onClick:a(k=>e(le)(e(_),`ids:${s.id}`),["stop"]),loading:e(ae)(`ids:${s.id}`)},{icon:d(()=>[l(ce)]),_:2},1032,["onClick","loading"])),[[p,o.$t("restore")]]),u((t(),i(c,{class:"sm",onClick:a(k=>e(Q)(s.path,e(F)(s.path).replace(" ","-")),["stop"])},{icon:d(()=>[l(E)]),_:2},1032,["onClick"])),[[p,o.$t("download")]])],64)):(t(),m(f,{key:1},[e(J)(e(X).MEDIA_TRASH,e(A).osVersion)?u((t(),i(c,{key:0,class:"sm",onClick:a(k=>e(O)(e(_),`ids:${s.id}`),["stop"]),loading:e(ne)(`ids:${s.id}`)},{icon:d(()=>[l(de)]),_:2},1032,["onClick","loading"])),[[p,o.$t("move_to_trash")]]):u((t(),i(c,{key:1,class:"sm",onClick:a(k=>e(N)(e(_),s),["stop"])},{icon:d(()=>[l(C)]),_:2},1032,["onClick"])),[[p,o.$t("delete")]]),u((t(),i(c,{class:"sm",onClick:a(k=>e(Q)(s.path,e(F)(s.path).replace(" ","-")),["stop"])},{icon:d(()=>[l(E)]),_:2},1032,["onClick"])),[[p,o.$t("download")]]),u((t(),i(c,{class:"sm",onClick:a(k=>Ae(s),["stop"])},{icon:d(()=>[l(re)]),_:2},1032,["onClick"])),[[p,o.$t("add_to_tags")]])],64))])),r("div",{class:q(["info",{"has-tags":s.tags.length>0}])},[l(Re,{tags:s.tags,type:e(_)},null,8,["tags","type"]),r("span",Ks,y(e(He)(s.size)),1)],2)],64))],42,Bs))),128)),e(P)&&T.value.length===0?(t(),m(f,{key:0},j(D,s=>r("section",{class:"skeleton-image media-item",key:s})),64)):M("",!0)],2)),!e(P)&&T.value.length===0?(t(),m("div",et,y(o.$t(e(es)(e(P),e(A).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):M("",!0),e(b)>D?(t(),i(yo,{key:3,page:ee.value,go:Te,total:e(b),limit:D},null,8,["page","total"])):M("",!0),r("input",{ref_key:"fileInput",ref:Qe,style:{display:"none"},type:"file",accept:"image/*",multiple:"",onChange:n[11]||(n[11]=(...s)=>e(me)&&e(me)(...s))},null,544),r("input",{ref_key:"dirFileInput",ref:Ge,style:{display:"none"},type:"file",accept:"image/*",multiple:"",webkitdirectory:"",mozdirectory:"",directory:"",onChange:n[12]||(n[12]=(...s)=>e(ke)&&e(ke)(...s))},null,544)],32)],64)}}});export{mt as default};
