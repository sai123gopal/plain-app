import{d as z,r as h,u as J,g as G,cn as Y,co as Q,cp as X,cq as Z,cr as ee,cs as se,ct as ne,aY as te,c as S,a as p,q as oe,t as g,n as A,aV as x,m as re,k as d,p as ie,ap as ae,v as le,l as I,j as ue,F as ce,cu as de,cv as me,o as E,cw as fe,_ as we}from"./index-2583f876.js";import{u as ve,a as be}from"./vee-validate.esm-b0601c3b.js";function N(n){let t=n;if(typeof t>"u"){if(typeof navigator>"u"||!navigator)return"";t=navigator.userAgent||""}return t.toLowerCase()}function L(n,t){try{return new RegExp(n,"g").exec(t)}catch{return null}}function M(){if(typeof navigator>"u"||!navigator||!navigator.userAgentData)return!1;const t=navigator.userAgentData.brands;return!!(t&&t.length)}function pe(n,t){const o=L(`(${n})((?:\\/|\\s|:)([0-9|\\.|_]+))`,t);return o?o[3]:""}function P(n){return n.replace(/_/g,".")}function V(n,t){let o=null,e="-1";return n.some(r=>{const a=L(`(${r.test})((?:\\/|\\s|:)([0-9|\\.|_]+))?`,t);return!a||r.brand?!1:(o=r,e=a[3]||"-1",r.versionAlias?e=r.versionAlias:r.versionTest&&(e=pe(r.versionTest.toLowerCase(),t)||e),e=P(e),!0)}),{preset:o,version:e}}function _(n,t){const o={brand:"",version:"-1"};return n.some(e=>{const r=W(t,e);return r?(o.brand=e.id,o.version=e.versionAlias||r.version,o.version!=="-1"):!1}),o}function W(n,t){return n.find(o=>L(`${t.test}`,o.brand.toLowerCase()))}const R=[{test:"phantomjs",id:"phantomjs"},{test:"whale",id:"whale"},{test:"edgios|edge|edg",id:"edge"},{test:"msie|trident|windows phone",id:"ie",versionTest:"iemobile|msie|rv"},{test:"miuibrowser",id:"miui browser"},{test:"samsungbrowser",id:"samsung internet"},{test:"samsung",id:"samsung internet",versionTest:"version"},{test:"chrome|crios",id:"chrome"},{test:"firefox|fxios",id:"firefox"},{test:"android",id:"android browser",versionTest:"version"},{test:"safari|iphone|ipad|ipod",id:"safari",versionTest:"version"}],D=[{test:"(?=.*applewebkit/(53[0-7]|5[0-2]|[0-4]))(?=.*\\schrome)",id:"chrome",versionTest:"chrome"},{test:"chromium",id:"chrome"},{test:"whale",id:"chrome",versionAlias:"-1",brand:!0}],$=[{test:"applewebkit",id:"webkit",versionTest:"applewebkit|safari"}],F=[{test:"(?=(iphone|ipad))(?!(.*version))",id:"webview"},{test:"(?=(android|iphone|ipad))(?=.*(naver|daum|; wv))",id:"webview"},{test:"webview",id:"webview"}],O=[{test:"windows phone",id:"windows phone"},{test:"windows 2000",id:"window",versionAlias:"5.0"},{test:"windows nt",id:"window"},{test:"win32|windows",id:"window"},{test:"iphone|ipad|ipod",id:"ios",versionTest:"iphone os|cpu os"},{test:"macos|macintel|mac os x",id:"mac"},{test:"android|linux armv81",id:"android"},{test:"tizen",id:"tizen"},{test:"webos|web0s",id:"webos"}];function U(n){return!!V(F,n).preset}function ge(n){const t=N(n),o=!!/mobi/g.exec(t),e={name:"unknown",version:"-1",majorVersion:-1,webview:U(t),chromium:!1,chromiumVersion:"-1",webkit:!1,webkitVersion:"-1"},r={name:"unknown",version:"-1",majorVersion:-1},{preset:a,version:w}=V(R,t),{preset:s,version:l}=V(O,t),b=V(D,t);if(e.chromium=!!b.preset,e.chromiumVersion=b.version,!e.chromium){const m=V($,t);e.webkit=!!m.preset,e.webkitVersion=m.version}return s&&(r.name=s.id,r.version=l,r.majorVersion=parseInt(l,10)),a&&(e.name=a.id,e.version=w,e.webview&&r.name==="ios"&&e.name!=="safari"&&(e.webview=!1)),e.majorVersion=parseInt(e.version,10),{browser:e,os:r,isMobile:o,isHints:!1}}function H(n){const t=navigator.userAgentData,o=[...t.brands],e=n&&n.fullVersionList,r=t.mobile||!1,a=o[0],w=(n&&n.platform||t.platform||navigator.platform).toLowerCase(),s={name:a.brand,version:a.version,majorVersion:-1,webkit:!1,webkitVersion:"-1",chromium:!1,chromiumVersion:"-1",webview:!!_(F,o).brand||U(N())},l={name:"unknown",version:"-1",majorVersion:-1};s.webkit=!s.chromium&&$.some(i=>W(o,i));const b=_(D,o);if(s.chromium=!!b.brand,s.chromiumVersion=b.version,!s.chromium){const i=_($,o);s.webkit=!!i.brand,s.webkitVersion=i.version}const m=O.find(i=>new RegExp(`${i.test}`,"g").exec(w));if(l.name=m?m.id:"",n&&(l.version=n.platformVersion),e&&e.length){const i=_(R,e);s.name=i.brand||s.name,s.version=i.version||s.version}else{const i=_(R,o);s.name=i.brand||s.name,s.version=i.brand&&n?n.uaFullVersion:i.version}return s.webkit&&(l.name=r?"ios":"mac"),l.name==="ios"&&s.webview&&(s.version="-1"),l.version=P(l.version),s.version=P(s.version),l.majorVersion=parseInt(l.version,10),s.majorVersion=parseInt(s.version,10),{browser:s,os:l,isMobile:r,isHints:!0}}async function he(){if(M()){const n=await navigator.userAgentData.getHighEntropyValues(["architecture","model","platform","platformVersion","uaFullVersion","fullVersionList"]);return H(n)}return _e()}function _e(n){return typeof n>"u"&&M()?H():ge(n)}const Ve={class:"header"},ye={class:"login-block"},ke=["label","error","error-text"],Se=["disabled"],Ae={key:0,class:"tips"},Ee=z({__name:"LoginView",setup(n){const{handleSubmit:t,isSubmitting:o}=ve(),e=h(!1),r=h(!0),a=h(!1),w=h("");let s;const l=window.location.protocol==="http:"?!1:!window.navigator.userAgentData,{t:b}=J(),{value:m,errorMessage:i}=be("password",G().required()),T=h(!1);async function q(){const u=await fetch(`${de()}/init`,{method:"POST",headers:me()});if(u.status===403){e.value=!0,r.value=!0,w.value="web_access_disabled";return}r.value=!1;const f=await u.text();f?(m.value=f,T.value=!1):T.value=!0}q();const y=t(async()=>{const u=localStorage.getItem("client_id");s=new WebSocket(`${Y()}?cid=${u}&auth=1`);const f=m.value??"",k=Q(f),v=X(k);w.value="",e.value=!1,s.onopen=async()=>{o.value=!0;const c=await he(),B=Z(v,JSON.stringify({password:k,browserName:c.browser.name,browserVersion:c.browser.version,osName:c.os.name,osVersion:c.os.version,isMobile:c.isMobile}));s.send(ee(B))},s.onmessage=async c=>{var C;const B=se(v,ne(await c.data.arrayBuffer())),j=JSON.parse(B);j.status==="PENDING"?a.value=!0:(localStorage.setItem("auth_token",j.token),s.close(),window.location.href=((C=te.currentRoute.value.query.redirect)==null?void 0:C.toString())??"/")},s.onclose=c=>{c.reason==="abort"||c.reason==="OK"||(o.value=!1,e.value=!0,a.value=!1,w.value=`login.${c.reason?c.reason:"failed"}`)},window.setTimeout(function(){s.readyState!==1&&s.close(3001,"timeout")},2e3)});function K(){a.value=!1,e.value=!1,o.value=!1,s.close(3001,"abort")}return(u,f)=>{const k=fe;return E(),S(ce,null,[p("header",Ve,[oe(k,{"logged-in":!1})]),p("h1",null,g(u.$t("app_name")),1),p("div",ye,[A(p("form",{onSubmit:f[2]||(f[2]=re((...v)=>d(y)&&d(y)(...v),["prevent"]))},[A(p("div",{class:"alert alert-danger",role:"alert"},g(w.value?u.$t(w.value):""),513),[[x,e.value]]),T.value?A((E(),S("md-outlined-text-field",{key:0,label:d(b)("password"),"onUpdate:modelValue":f[0]||(f[0]=v=>ie(m)?m.value=v:null),onKeydown:f[1]||(f[1]=ae((...v)=>d(y)&&d(y)(...v),["enter"])),type:"password",class:"form-control",error:d(i),"error-text":d(i)?u.$t(d(i)):""},null,40,ke)),[[le,d(m)]]):I("",!0),r.value?I("",!0):(E(),S("md-filled-button",{key:1,disabled:d(o)},g(u.$t(d(o)?"logging_in":"log_in")),9,Se))],544),[[x,!a.value]]),A(p("div",null,[ue(g(u.$t("login.to_continue"))+" ",1),p("md-outlined-button",{onClick:K},g(u.$t("cancel")),1)],512),[[x,a.value]])]),d(l)?(E(),S("div",Ae,g(u.$t("browser_warning")),1)):I("",!0)],64)}}});const xe=we(Ee,[["__scopeId","data-v-4531ffbc"]]);export{xe as default};
