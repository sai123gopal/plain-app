import{o as m,c as _,a,d as F,h as k,bX as G,j as q,bY as w,bZ as z,t as p,p as $,O as I,P as N,m as t,x as Q,aG as j,at as f,e as H,V as Z,a1 as S,bG as x,a2 as E,H as K,g as A,C as L,Z as O,K as P,b2 as R}from"./index-Dn0O6zoH.js";import{u as X,a as Y}from"./vee-validate.esm-0lx5owW0.js";const J={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},U=a("path",{fill:"currentColor",d:"M19.125 14.625q-.275.425-.687.45t-.713-.2t-.413-.612t.188-.813L18.55 12L15 7h-4.725q-.5 0-.75-.312T9.275 6t.25-.687t.75-.313H15q.5 0 .925.213t.725.637l3.525 5q.2.275.288.563t.087.587t-.088.588t-.287.562zM5 19q-.825 0-1.412-.587T3 17V7q0-.275.063-.5t.187-.45L2.1 4.9q-.275-.275-.275-.7t.275-.7t.7-.275t.7.275l17 17q.275.275.275.7t-.275.7t-.7.275t-.7-.275l-3.15-3.15q-.225.125-.45.188T15 19zm9.2-2L5 7.8V17z"},null,-1),W=[U];function ee(r,u){return m(),_("svg",J,[...W])}const te={name:"material-symbols-label-off-outline-rounded",render:ee},oe={slot:"headline"},ae={slot:"content"},se=["label","selected"],ne=["label","selected"],de=["label","selected","onClick"],le={slot:"actions"},ie=["disabled"],re={key:0,indeterminate:"",slot:"icon"},ue=F({__name:"AddToTagsModal",props:{type:{type:String,required:!0},tags:{type:Array,default:()=>[]},query:{type:String,required:!0}},setup(r){const{handleSubmit:u}=X(),n=k("add_to_tags"),o=r;function c(e){const{button:l}=e.detail,v=l.dataset.value;n.value=v}const{value:s,errorMessage:d}=Y("selectedTags",G().test("required","valid.required",e=>e.length),{initialValue:[]}),{mutate:g,loading:b,onDone:M}=q({document:w,appApi:!0}),{mutate:C,loading:h,onDone:V}=q({document:z,appApi:!0}),y=()=>{S.emit("items_tags_updated",{type:o.type}),S.emit("refetch_tags",o.type),f()};V(y),M(y);function B(e){s.value.includes(e)?x(s.value,l=>l.id===e.id):s.value.push(e)}const T=u(()=>{n.value==="add_to_tags"?C({type:o.type,tagIds:s.value.map(e=>e.id),query:o.query}):g({type:o.type,tagIds:s.value.map(e=>e.id),query:o.query})});return(e,l)=>{const v=E,D=te;return m(),_("md-dialog",null,[a("div",oe,p(e.$t("tags")),1),a("div",ae,[a("md-outlined-segmented-button-set",{onSegmentedButtonSetSelection:c},[a("md-outlined-segmented-button",{"data-value":"add_to_tags",label:e.$t("add_to_tags"),selected:n.value==="add_to_tags"},[$(v,{slot:"icon"})],8,se),a("md-outlined-segmented-button",{"data-value":"remove_from_tags",label:e.$t("remove_from_tags"),selected:n.value==="remove_from_tags"},[$(D,{slot:"icon"})],8,ne)],32),a("md-chip-set",null,[(m(!0),_(I,null,N(r.tags,i=>(m(),_("md-filter-chip",{key:i.id,label:i.name,selected:t(s).includes(i),onClick:me=>B(i)},null,8,de))),128))]),Q(a("div",{class:"invalid-feedback"},p(t(d)?e.$t(t(d)):""),513),[[j,t(d)]])]),a("div",le,[a("md-outlined-button",{value:"cancel",onClick:l[0]||(l[0]=(...i)=>t(f)&&t(f)(...i))},p(e.$t("cancel")),1),a("md-filled-button",{value:"save",disabled:t(h)||t(b),onClick:l[1]||(l[1]=(...i)=>t(T)&&t(T)(...i)),autofocus:""},[t(h)||t(b)?(m(),_("md-circular-progress",re)):H("",!0),Z(" "+p(e.$t("save")),1)],8,ie)])])}}}),ce=K(ue,[["__scopeId","data-v-b5495c1b"]]),pe=(r,u)=>{const{t:n}=A();return{addToTags:(o,c,s)=>{let d=s;if(!c){if(o.length===0){L(n("select_first"),"error");return}d=`ids:${o.join(",")}`}O(ce,{type:r,tags:u.value,query:d})}}},ve=(r,u=()=>{})=>{const n=k([]),{t:o}=A(),{loading:c,fetch:s}=P({handle:async(d,g)=>{g?L(o(g),"error"):d&&(n.value=d.tags,u())},document:R,variables:{type:r},appApi:!0});return{tags:n,loading:c,fetch:s}};export{pe as a,ve as u};
