import{u as ye,_ as $e,a as be,b as we}from"./list-002e9cb7.js";import{d as Ce,af as Se,e as Ae,r as k,u as De,s as Ie,f as Ve,L as Te,ag as Ue,M as qe,E as Qe,N as Be,ah as Fe,U as J,h as Le,w as Pe,i as Me,O as Re,P as ze,Q as O,R as Ne,S as Ge,c as i,a as e,q as r,k as l,n as p,m as f,l as T,j as U,t as a,I as Ke,F as X,K as Ee,T as je,y as xe,ai as He,aj as Je,D as S,X as A,ak as Oe,al as Xe,o,v as Ze,J as We,A as Ye,Z,$ as W,a0 as et,am as tt,an as st,a6 as lt,ae as nt}from"./index-2583f876.js";import{_ as at}from"./Breadcrumb-ef080890.js";function ot(D,I){const g=D.findIndex(y=>y.id===I);g!==-1&&D.splice(g,1)}const it={class:"v-toolbar"},ct=e("md-ripple",null,null,-1),dt=["onClick"],ut=e("md-ripple",null,null,-1),rt={class:"filters"},pt={class:"form-row"},_t=["label"],ht={class:"buttons"},ft=["onClick"],mt={class:"table-responsive"},kt={class:"table"},vt=["checked","indeterminate"],gt=e("th",null,null,-1),yt=e("th",null,null,-1),$t=["onClick"],bt=["checked"],wt=["src"],Ct={class:"v-center"},St={class:"nowrap"},At={class:"action-btns"},Dt={key:0,indeterminate:"",class:"spinner-sm"},It=["onClick"],Vt=e("md-ripple",null,null,-1),Tt=["onClick"],Ut=e("md-ripple",null,null,-1),qt={class:"nowrap"},Qt={class:"nowrap"},Bt={class:"nowrap"},Ft={class:"nowrap"},Lt={key:0},Pt={colspan:"8"},Mt={class:"no-data-placeholder"},v=50,Gt=Ce({__name:"AppsView",setup(D){var j,x;const{input:I,upload:g,uploadChanged:y}=Se(),$=Ae(),c=k([]),q=k(),{t:Y}=De(),{app:ee,urlTokenKey:V}=Ie(Ve()),b=Te({text:"",tags:[]}),{allChecked:Q,realAllChecked:B,selectRealAll:te,allCheckedAlertVisible:se,clearSelection:F,toggleAllChecked:L,toggleItemChecked:P,toggleRow:le,total:m,checked:M}=ye(c),{downloadItems:ne}=Ue(V,qe.PACKAGE,c,F,"apps.zip"),{downloadFile:ae}=tt(V),R=Qe(),z=R.query,w=k(parseInt(((j=z.page)==null?void 0:j.toString())??"1")),d=k(Be(((x=z.q)==null?void 0:x.toString())??"")),N=Fe(d.value),_=R.params.type;_&&N.push({name:"type",op:"",value:_});const G=k(J(N)),oe=()=>{g(ee.value.downloadsDir)},{loading:ie}=Le({handle:(t,n)=>{n?xe(Y(n),"error"):t&&(c.value=t.packages.map(u=>({...u,checked:!1,icon:He(V.value,"pkgicon://"+u.id)})),m.value=t.packageCount)},document:Je,variables:()=>({offset:(w.value-1)*v,limit:v,query:G.value}),appApi:!0});Pe(w,t=>{_?S($,`/apps/${_}?page=${t}&q=${A(d.value)}`):S($,`/apps?page=${t}&q=${A(d.value)}`)});function ce(){const t=[];b.text&&t.push({name:"text",op:"",value:b.text}),d.value=J(t),K(),q.value.dismiss()}function K(){_?S($,`/apps/${_}?q=${A(d.value)}`):S($,`/apps?q=${A(d.value)}`)}const{mutate:de,onDone:ue}=Me({document:Oe,appApi:!0});function re(t){ue(()=>{t.isUninstalling=!0}),de({id:t.id})}const{loading:pe,load:_e,refetch:he}=Re({handle:(t,n)=>{if(t)for(const u of t.packageStatuses)u.exist||ot(c.value,u.id)},document:Xe,variables:()=>({ids:c.value.filter(t=>t.isUninstalling).map(t=>t.id)}),appApi:!0}),E=t=>{t.status};return ze(()=>{O.on("upload_task_done",E);let t=!0;setInterval(()=>{c.value.some(n=>n.isUninstalling)&&!pe.value&&(t?(_e(),t=!1):he())},1e3)}),Ne(()=>{O.off("upload_task_done",E)}),(t,n)=>{const u=at,H=st,fe=$e,me=be,ke=lt,ve=nt,ge=we,h=Ge("tooltip");return o(),i(X,null,[e("div",it,[r(u,{current:()=>`${t.$t("page_title.apps")} (${l(m)})`},null,8,["current"]),l(M)?p((o(),i("button",{key:0,class:"icon-button",onClick:n[0]||(n[0]=f(s=>l(ne)(l(B),G.value),["stop"]))},[ct,r(H)])),[[h,t.$t("download")]]):T("",!0),e("button",{class:"icon-button",onClick:f(oe,["stop"]),style:{display:"none"}},[ut,U(" "+a(t.$t("install")),1)],8,dt),r(fe,{ref_key:"searchInputRef",ref:q,modelValue:d.value,"onUpdate:modelValue":n[2]||(n[2]=s=>d.value=s),search:K},{filters:Ke(()=>[e("div",rt,[e("div",pt,[p(e("md-outlined-text-field",{label:t.$t("keywords"),"onUpdate:modelValue":n[1]||(n[1]=s=>b.text=s),"keyup.enter":"applyAndDoSearch"},null,8,_t),[[Ze,b.text]])]),e("div",ht,[e("md-filled-button",{onClick:f(ce,["stop"])},a(t.$t("search")),9,ft)])])]),_:1},8,["modelValue"])]),r(me,{limit:v,total:l(m),"all-checked-alert-visible":l(se),"real-all-checked":l(B),"select-real-all":l(te),"clear-selection":l(F)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),e("div",mt,[e("table",kt,[e("thead",null,[e("tr",null,[e("th",null,[e("md-checkbox",{"touch-target":"wrapper",onChange:n[3]||(n[3]=(...s)=>l(L)&&l(L)(...s)),checked:l(Q),indeterminate:!l(Q)&&l(M)},null,40,vt)]),gt,e("th",null,a(t.$t("name")),1),yt,e("th",null,a(t.$t("size")),1),e("th",null,a(t.$t("type")),1),e("th",null,a(t.$t("installed_at")),1),e("th",null,a(t.$t("updated_at")),1)])]),e("tbody",null,[(o(!0),i(X,null,Ee(c.value,s=>(o(),i("tr",{key:s.id,class:We({selected:s.checked}),onClick:f(C=>l(le)(s),["stop"])},[e("td",null,[e("md-checkbox",{"touch-target":"wrapper",onChange:n[4]||(n[4]=(...C)=>l(P)&&l(P)(...C)),checked:s.checked},null,40,bt)]),e("td",null,[e("img",{width:"50",height:"50",src:s.icon},null,8,wt)]),e("td",null,[e("strong",Ct,a(s.name)+" ("+a(s.version)+")",1),r(ke,{id:s.id,raw:s},null,8,["id","raw"])]),e("td",St,[e("div",At,[s.isUninstalling?p((o(),i("md-circular-progress",Dt,null,512)),[[h,t.$t("uninstalling")]]):p((o(),i("button",{key:1,class:"icon-button",onClick:f(C=>re(s),["stop"])},[Vt,r(ve)],8,It)),[[h,t.$t("uninstall")]]),p((o(),i("button",{class:"icon-button",onClick:f(C=>l(ae)(s.path,`${s.name.replace(" ","")}-${s.id}.apk`),["stop"])},[Ut,r(H)],8,Tt)),[[h,t.$t("download")]])])]),e("td",qt,a(l(Ye)(s.size)),1),e("td",Qt,a(t.$t("app_type."+s.type)),1),e("td",Bt,[p((o(),i("span",null,[U(a(l(W)(s.installedAt)),1)])),[[h,l(Z)(s.installedAt)]])]),e("td",Ft,[p((o(),i("span",null,[U(a(l(W)(s.updatedAt)),1)])),[[h,l(Z)(s.updatedAt)]])])],10,$t))),128))]),c.value.length?T("",!0):(o(),i("tfoot",Lt,[e("tr",null,[e("td",Pt,[e("div",Mt,a(t.$t(l(et)(l(ie)))),1)])])]))])]),l(m)>v?(o(),je(ge,{key:0,modelValue:w.value,"onUpdate:modelValue":n[5]||(n[5]=s=>w.value=s),total:l(m),limit:v},null,8,["modelValue","total"])):T("",!0),e("input",{ref_key:"fileInput",ref:I,style:{display:"none"},type:"file",accept:".apk",multiple:"",onChange:n[6]||(n[6]=(...s)=>l(y)&&l(y)(...s))},null,544)],64)}}});export{Gt as default};
