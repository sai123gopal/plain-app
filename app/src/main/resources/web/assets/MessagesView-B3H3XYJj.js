import{_ as ye}from"./VPagination.vuevuetypescriptsetuptruelang-CFupeDJR.js";import{d as be,u as we,s as Ce,i as Se,h as w,g as Te,I as $e,J as Le,K as Me,j as Ie,L as xe,M as Ae,c as n,a,m as e,t as i,x as C,w as u,p as r,e as S,N as J,O as q,P as W,v as De,Q as qe,f as Ve,C as Ee,R as Ue,B as Be,S as Ne,o,T as Re,U as He,V as Ke,W as Qe,X as ze,F as Ge,G as Pe,Y as Fe,Z as Oe,$ as je,a0 as Je,a1 as T,a2 as We,a3 as Xe,a4 as Ye,H as Ze}from"./index-Dn0O6zoH.js";import{_ as es}from"./call-outline-rounded-BpLo2E1r.js";import{_ as ss,a as ts}from"./SearchInput-aem6tEJK.js";import{u as as,a as os}from"./tags-CvPqo38V.js";import{u as ns,a as ls}from"./key-events-CgPzNP0J.js";import{u as cs}from"./search-DrT1IjAg.js";import"./search-rounded-C8Nl_ZR1.js";import"./rss-feed-rounded-Dqku7i1k.js";import"./vee-validate.esm-0lx5owW0.js";const $=h=>(Ge("data-v-68325306"),h=h(),Pe(),h),is={class:"top-app-bar"},ds=["checked","indeterminate"],rs={class:"title"},_s={key:0},us={key:1},ps=$(()=>a("md-ripple",null,null,-1)),ms={class:"actions"},vs={class:"scroll-content"},gs=["onClick","onMouseover"],hs={class:"start"},ks=["onClick","checked"],fs=["onClick","checked"],ys={class:"number"},bs={class:"title"},ws=["innerHTML"],Cs={class:"actions"},Ss=["onClick"],Ts=$(()=>a("md-ripple",null,null,-1)),$s={key:0,indeterminate:"",class:"spinner-sm"},Ls=["onClick"],Ms=$(()=>a("md-ripple",null,null,-1)),Is={class:"info"},xs={class:"time"},As={class:"start"},Ds=$(()=>a("div",{class:"checkbox"},[a("div",{class:"skeleton-checkbox"})],-1)),qs={class:"number"},Vs=Fe('<div class="title" data-v-68325306><div class="skeleton-text skeleton-title" data-v-68325306></div></div><div class="subtitle" data-v-68325306><div class="skeleton-text skeleton-subtitle" data-v-68325306></div><div class="skeleton-text skeleton-subtitle" data-v-68325306></div></div><div class="actions" data-v-68325306><div class="skeleton-text skeleton-actions" data-v-68325306></div></div><div class="info" data-v-68325306><div class="skeleton-text skeleton-info" data-v-68325306></div></div><div class="time" data-v-68325306><div class="skeleton-text skeleton-time" data-v-68325306></div></div>',5),Es={key:0,class:"no-data-placeholder"},p=50,Us=be({__name:"MessagesView",setup(h){var j;const X=we(),{app:Y}=Ce(Se()),m=w([]),{t:V}=Te(),{parseQ:Z}=cs(),E=$e({tagIds:[]}),_=Le.SMS,U=qe(),B=U.query,L=w(parseInt(((j=B.page)==null?void 0:j.toString())??"1")),k=w(""),{tags:f,fetch:ee}=as(_),{addToTags:se}=os(_,f),{selectedIds:v,allChecked:N,realAllChecked:M,selectRealAll:te,allCheckedAlertVisible:ae,clearSelection:I,toggleAllChecked:R,toggleSelect:H,total:d,checked:x,shiftEffectingIds:K,handleItemClick:oe,handleMouseOver:ne,selectAll:le,shouldSelect:ce}=ns(m),Q=s=>{const l=U.query.q;Ve(X,l?`/messages?page=${s}&q=${l}`:`/messages?page=${s}`)},{keyDown:z,keyUp:G}=ls(d,p,L,le,I,Q,()=>{}),{loading:A,fetch:D}=Me({handle:(s,l)=>{l?Ee(V(l),"error"):s&&(m.value=s.messages,d.value=s.messageCount)},document:Ue,variables:()=>({offset:(L.value-1)*p,limit:p,query:k.value}),appApi:!0}),ie=["1","2","3"].map(s=>({id:s,name:V("message_type."+s)}));function de(s){Oe(je,{type:_,tags:f.value,item:{key:s.id,title:"",size:0},selected:f.value.filter(l=>s.tags.some(y=>y.id===l.id))})}const P=w(""),{mutate:re,loading:_e}=Ie({document:Be,appApi:!0});function ue(s){P.value=s.id,re({number:s.address})}function pe(s){return s?`/messages?q=${s}`:"/messages"}const F=s=>{s.type===_&&(I(),D())},O=s=>{s.type===_&&D()};return xe(()=>{var s;k.value=Je(((s=B.q)==null?void 0:s.toString())??""),Z(E,k.value),ee(),D(),T.on("item_tags_updated",O),T.on("items_tags_updated",F),window.addEventListener("keydown",z),window.addEventListener("keyup",G)}),Ae(()=>{T.off("item_tags_updated",O),T.off("items_tags_updated",F),window.removeEventListener("keydown",z),window.removeEventListener("keyup",G)}),(s,l)=>{const y=We,me=ss,ve=ts,ge=Xe,he=es,ke=Ye,fe=ye,b=Ne("tooltip");return o(),n(q,null,[a("div",is,[a("md-checkbox",{"touch-target":"wrapper",onChange:l[0]||(l[0]=(...t)=>e(R)&&e(R)(...t)),checked:e(N),indeterminate:!e(N)&&e(x)},null,40,ds),a("div",rs,[e(v).length?(o(),n("span",_s,i(s.$t("x_selected",{count:e(M)?e(d).toLocaleString():e(v).length.toLocaleString()})),1)):(o(),n("span",us,i(s.$t("page_title.messages"))+" ("+i(e(d).toLocaleString())+")",1)),e(x)?C((o(),n("button",{key:2,class:"btn-icon",onClick:l[1]||(l[1]=u(t=>e(se)(e(v),e(M),k.value),["stop"]))},[ps,r(y)])),[[b,s.$t("add_to_tags")]]):S("",!0)]),a("div",ms,[r(me,{filter:E,tags:e(f),types:e(ie),"get-url":pe},null,8,["filter","tags","types"])])]),r(ve,{limit:p,total:e(d),"all-checked-alert-visible":e(ae),"real-all-checked":e(M),"select-real-all":e(te),"clear-selection":e(I)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),a("div",vs,[a("div",{class:J(["sms-list",{"select-mode":e(x)}])},[(o(!0),n(q,null,W(m.value,(t,g)=>(o(),n("section",{class:J(["sms-item selectable-card",{selected:e(v).includes(t.id),selecting:e(K).includes(t.id)}]),key:t.id,onClick:u(c=>e(oe)(c,t,g,()=>{}),["stop"]),onMouseover:c=>e(ne)(c,g)},[a("div",hs,[e(K).includes(t.id)?(o(),n("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",onClick:u(c=>e(H)(c,t,g),["stop"]),checked:e(ce)},null,8,ks)):(o(),n("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",onClick:u(c=>e(H)(c,t,g),["stop"]),checked:e(v).includes(t.id)},null,8,fs)),a("span",ys,[r(ge,{id:g+1,raw:t},null,8,["id","raw"])])]),a("div",bs,i(t.address),1),a("div",{class:"subtitle",innerHTML:e(Re)(t.body)},null,8,ws),a("div",Cs,[C((o(),n("button",{class:"btn-icon sm",onClick:u(c=>de(t),["stop"])},[Ts,r(y)],8,Ss)),[[b,s.$t("add_to_tags")]]),e(_e)&&P.value===t.id?(o(),n("md-circular-progress",$s)):C((o(),n("button",{key:1,class:"btn-icon sm",onClick:u(c=>ue(t),["stop"])},[Ms,r(he)],8,Ls)),[[b,s.$t("make_a_phone_call")]])]),a("div",Is,[a("span",null,i(s.$t(`message_type.${t.type}`)),1),r(ke,{tags:t.tags,type:e(_),"only-links":!0},null,8,["tags","type"])]),a("div",xs,[C((o(),n("span",null,[Ke(i(e(Qe)(t.date)),1)])),[[b,e(He)(t.date)]])])],42,gs))),128)),e(A)&&m.value.length===0?(o(),n(q,{key:0},W(20,t=>a("section",{class:"sms-item selectable-card-skeleton",key:t},[a("div",As,[Ds,a("span",qs,i(t),1)]),Vs])),64)):S("",!0)],2),!e(A)&&m.value.length===0?(o(),n("div",Es,i(s.$t(e(ze)(e(A),e(Y).permissions,"READ_SMS"))),1)):S("",!0),e(d)>p?(o(),De(fe,{key:1,page:L.value,go:Q,total:e(d),limit:p},null,8,["page","total"])):S("",!0)])],64)}}}),Os=Ze(Us,[["__scopeId","data-v-68325306"]]);export{Os as default};
