import{_ as J}from"./MonacoEditor.vuevuetypescriptsetuptruelang-DhAxQ-me.js";import{_ as ee}from"./print-outline-rounded-DvaTkNLN.js";import{aZ as te,a_ as W,a$ as ne,o as g,c as k,a as d,d as ae,u as oe,g as se,h as y,s as ie,i as ue,l as le,K as re,j as ce,b0 as de,aX as _e,a1 as E,aY as me,x as I,w as H,p as S,V as F,t as pe,m as O,aG as ve,v as fe,e as z,O as j,Q as ge,b1 as he,k as Te,C as K,b2 as be,b3 as ye,b4 as ke,U as we,a3 as $e,a4 as Se,S as Ce,F as xe,G as Le,a6 as Me,f as Ne,Z as Ee,$ as Ie,a2 as qe,H as Ve}from"./index-Dn0O6zoH.js";import{u as Ae}from"./markdown-CIqC0UQZ.js";var Q=function(){return te.Date.now()},De="Expected a function",Re=Math.max,He=Math.min;function Qe(_,u,l){var m,a,o,i,s,r,v=0,x=!1,f=!1,h=!0;if(typeof _!="function")throw new TypeError(De);u=W(u)||0,ne(l)&&(x=!!l.leading,f="maxWait"in l,o=f?Re(W(l.maxWait)||0,u):o,h="trailing"in l?!!l.trailing:h);function w(n){var c=m,e=a;return m=a=void 0,v=n,i=_.apply(e,c),i}function L(n){return v=n,s=setTimeout(p,u),x?w(n):i}function q(n){var c=n-r,e=n-v,t=u-c;return f?He(t,o-e):t}function T(n){var c=n-r,e=n-v;return r===void 0||c>=u||c<0||f&&e>=o}function p(){var n=Q();if(T(n))return M(n);s=setTimeout(p,q(n))}function M(n){return s=void 0,h&&m?w(n):(m=a=void 0,i)}function V(){s!==void 0&&clearTimeout(s),v=0,m=r=a=s=void 0}function A(){return s===void 0?i:M(Q())}function $(){var n=Q(),c=T(n);if(m=arguments,a=this,r=n,c){if(s===void 0)return L(r);if(f)return clearTimeout(s),s=setTimeout(p,u),w(r)}return s===void 0&&(s=setTimeout(p,u)),i}return $.cancel=V,$.flush=A,$}const Ue={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Be=d("path",{fill:"currentColor",d:"m7.825 13l4.9 4.9q.3.3.288.7t-.313.7q-.3.275-.7.288t-.7-.288l-6.6-6.6q-.15-.15-.213-.325T4.426 12t.063-.375t.212-.325l6.6-6.6q.275-.275.688-.275t.712.275q.3.3.3.713t-.3.712L7.825 11H19q.425 0 .713.288T20 12t-.288.713T19 13z"},null,-1),Ge=[Be];function We(_,u){return g(),k("svg",Ue,[...Ge])}const Fe={name:"material-symbols-arrow-back-rounded",render:We},U=_=>(xe("data-v-977015b7"),_=_(),Le(),_),Oe={class:"top-app-bar"},ze=U(()=>d("md-ripple",null,null,-1)),je={class:"title"},Ke={class:"state-point"},Pe={class:"actions"},Xe=U(()=>d("md-ripple",null,null,-1)),Ze=U(()=>d("md-ripple",null,null,-1)),Ye={class:"panel-container"},Je=["innerHTML"],C="NOTE",et=ae({__name:"NoteEditView",setup(_){const u=oe(),{t:l}=se(),m=ge(),a=y(""),o=y(),i=y(""),s=y(""),r=y(!1),{app:v,urlTokenKey:x}=ie(ue());function f(){const e=Me.currentRoute.value.query.q;let t="/notes";e&&(t+=`?q=${e}`),Ne(u,t)}const{render:h}=Ae(v,x),w=Qe(()=>{r.value=!1,M({id:a.value,input:{content:i.value,title:he(i.value,{length:250,omission:""})}})},500),L=()=>{Te(i,async e=>{r.value=!0,s.value=await h(e),w()})},q=()=>{window.print()},T=y();le({handle:(e,t)=>{t?K(l(t),"error"):e&&(T.value=e.tags)},document:be,variables:{type:C},appApi:!0});const{fetch:p}=re({handle:async(e,t)=>{t?K(l(t),"error"):(o.value=e.note,i.value=e.note.content,s.value=await h(i.value),L())},document:ye,variables:()=>({id:a.value}),appApi:!0}),{mutate:M,onDone:V}=ce({document:ke,appApi:!0});V(e=>{var t,b;o.value=e.data.saveNote,!a.value&&((t=o.value)!=null&&t.id)&&(a.value=(b=o.value)==null?void 0:b.id,de(u,`/notes/${a.value}`))});function A(){var t;const e=(t=o==null?void 0:o.value)==null?void 0:t.updatedAt;return e?`(${l("updated_at")}: ${we(e)})`:""}function $(){var e,t;Ee(Ie,{type:C,tags:T.value,item:{key:(e=o.value)==null?void 0:e.id,title:"",size:0},selected:(t=T.value)==null?void 0:t.filter(b=>{var N;return(N=o.value)==null?void 0:N.tags.some(D=>D.id===b.id)})})}const n=e=>{e.type===C&&p()},c=e=>{e.type===C&&p()};return _e(()=>{a.value=m.params.id,a.value==="create"&&(a.value=""),a.value?p():L(),E.on("item_tags_updated",c),E.on("items_tags_updated",n)}),me(()=>{E.off("item_tags_updated",c),E.off("items_tags_updated",n)}),(e,t)=>{var B,G;const b=Fe,N=$e,D=Se,P=qe,X=ee,Z=J,R=Ce("tooltip");return g(),k(j,null,[d("div",Oe,[I((g(),k("button",{class:"btn-icon",onClick:H(f,["prevent"])},[ze,S(b)])),[[R,e.$t("back")]]),d("div",je,[F(pe(a.value?O(l)("edit"):O(l)("create"))+" ",1),I(d("span",Ke,"*",512),[[ve,r.value]]),F(),(B=o.value)!=null&&B.updatedAt?(g(),fe(N,{key:0,class:"time",id:A(),raw:o.value},null,8,["id","raw"])):z("",!0)]),d("div",Pe,[S(D,{tags:(G=o.value)==null?void 0:G.tags,type:C,"only-links":!0},null,8,["tags"]),a.value?(g(),k(j,{key:0},[I((g(),k("button",{class:"btn-icon",onClick:H($,["prevent"])},[Xe,S(P)])),[[R,e.$t("add_to_tags")]]),I((g(),k("button",{class:"btn-icon",onClick:H(q,["prevent"])},[Ze,S(X)])),[[R,e.$t("print")]])],64)):z("",!0)])]),d("div",Ye,[S(Z,{language:"html",modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=Y=>i.value=Y)},null,8,["modelValue"]),d("div",{class:"md-container",innerHTML:s.value},null,8,Je)])],64)}}}),st=Ve(et,[["__scopeId","data-v-977015b7"]]);export{st as default};
