import{_ as te}from"./MonacoEditor.vuevuetypescriptsetuptruelang-8db4cdf0.js";import{_ as ne}from"./print-outline-rounded-f43d6e40.js";import{aO as ae,aP as j,aQ as se,d as oe,e as ie,u as re,D as ue,r as x,s as le,f as ce,aC as de,g as z,i as _e,aR as me,O as pe,P as D,Q as fe,R as ve,c as L,a as E,p as y,H as R,F as ge,J as he,m as H,l as J,k as O,j as A,aS as Te,w as ye,x as K,aT as ke,aU as be,aV as we,o as S,h as Ce,t as X,aW as xe,S as Se,A as Ee,B as Me,Z as Ne,a2 as Ie,a3 as Ve,a5 as Le,a4 as Ae,_ as $e}from"./index-9c78c93b.js";import{_ as De}from"./Breadcrumb-56c0fca0.js";import{g as Z,M as Re}from"./splitpanes.es-3e76f333.js";import{u as Qe}from"./markdown-de24da33.js";var Ue=function(){return ae.Date.now()};const F=Ue;var We="Expected a function",Be=Math.max,He=Math.min;function Oe(f,l,i){var _,r,n,o,a,u,v=0,$=!1,g=!1,k=!0;if(typeof f!="function")throw new TypeError(We);l=j(l)||0,se(i)&&($=!!i.leading,g="maxWait"in i,n=g?Be(j(i.maxWait)||0,l):n,k="trailing"in i?!!i.trailing:k);function b(t){var c=_,p=r;return _=r=void 0,v=t,o=f.apply(p,c),o}function m(t){return v=t,a=setTimeout(w,l),$?b(t):o}function U(t){var c=t-u,p=t-v,V=l-c;return g?He(V,n-p):V}function M(t){var c=t-u,p=t-v;return u===void 0||c>=l||c<0||g&&p>=n}function w(){var t=F();if(M(t))return C(t);a=setTimeout(w,U(t))}function C(t){return a=void 0,k&&_?b(t):(_=r=void 0,o)}function N(){a!==void 0&&clearTimeout(a),v=0,_=u=r=a=void 0}function W(){return a===void 0?o:C(F())}function I(){var t=F(),c=M(t);if(_=arguments,r=this,u=t,c){if(a===void 0)return m(u);if(g)return clearTimeout(a),a=setTimeout(w,l),b(u)}return a===void 0&&(a=setTimeout(w,l)),o}return I.cancel=N,I.flush=W,I}const q=f=>(Ee("data-v-364ba9f9"),f=f(),Me(),f),Fe={class:"page-container"},Ge={class:"main"},Pe={class:"v-toolbar"},je={class:"state-point"},ze=["onClick"],Je=q(()=>E("md-ripple",null,null,-1)),Ke=["onClick"],Xe=q(()=>E("md-ripple",null,null,-1)),Ze=["innerHTML"],Q="NOTE",qe=oe({__name:"NoteEditView",setup(f){const l=ie(),{t:i}=re(),_=ue(),r=x(_.params.id),n=x(),o=x(""),a=x(""),u=x(!1),{app:v,urlTokenKey:$}=le(ce()),g=de(()=>{var e;return(e=n.value)!=null&&e.deletedAt?["/notes","/notes/trash"]:["/notes"]}),{render:k}=Qe(v,$);let b=!1;function m(){return r.value==="create"}const U=Oe(()=>{u.value=!1,W({id:m()?"":r.value,input:{content:o.value,title:Te(o.value,{length:100,omission:""})}})},500),M=()=>{ye(o,async e=>{u.value=!0,a.value=await k(e),U()})},w=()=>{window.print()},C=x();z({handle:(e,s)=>{s?K(i(s),"error"):e&&(C.value=e.tags)},document:ke,variables:{type:Q},appApi:!0});let N=()=>{};if(m())M();else{const{refetch:e}=z({handle:async(s,d)=>{if(d)K(i(d),"error");else{if(n.value=s.note,b)return;o.value=s.note.content,a.value=await k(o.value),b=!0,M()}},document:be,variables:()=>({id:r.value}),appApi:!0});N=e}const{mutate:W,onDone:I}=_e({document:we,appApi:!0});I(e=>{var d,h;n.value=e.data.saveNote,m()&&((d=n.value)!=null&&d.id)&&(r.value=(h=n.value)==null?void 0:h.id,me(l,`/notes/${r.value}`))});function t(){var s;const e=(s=n==null?void 0:n.value)==null?void 0:s.updatedAt;return e?`(${i("updated_at")}: ${Ne(e)})`:""}function c(){var e,s;Ie(Ve,{type:Q,tags:C.value,item:{key:(e=n.value)==null?void 0:e.id,title:"",size:0},selected:(s=C.value)==null?void 0:s.filter(d=>{var h;return(h=n.value)==null?void 0:h.tags.some(B=>B.id===d.id)})})}const p=e=>{e.type===Q&&N()},V=e=>{e.type===Q&&N()};return pe(()=>{D.on("item_tags_updated",V),D.on("items_tags_updated",p)}),fe(()=>{D.off("item_tags_updated",V),D.off("items_tags_updated",p)}),(e,s)=>{var P;const d=Le,h=De,B=Ae,Y=ne,ee=te,G=ve("tooltip");return S(),L("div",Fe,[E("div",Ge,[E("div",Pe,[y(h,{paths:g.value},{current:R(()=>{var T;return[Ce(X(m()?A(i)("create"):A(i)("edit"))+" ",1),H(E("span",je,"*",512),[[xe,u.value]]),(T=n.value)!=null&&T.updatedAt?(S(),Se(d,{key:0,class:"time",id:t(),raw:n.value},null,8,["id","raw"])):O("",!0)]}),_:1},8,["paths"]),(S(!0),L(ge,null,he((P=n.value)==null?void 0:P.tags,T=>(S(),L("span",{key:T.id,class:"badge"},X(T.name),1))),128)),m()?O("",!0):H((S(),L("button",{key:0,class:"icon-button",onClick:J(c,["prevent"]),style:{"margin-inline-start":"8px"}},[Je,y(B)],8,ze)),[[G,e.$t("add_to_tags")]]),m()?O("",!0):H((S(),L("button",{key:1,class:"icon-button",onClick:J(w,["prevent"])},[Xe,y(Y)],8,Ke)),[[G,e.$t("print")]])]),y(A(Re),{class:"panel-container"},{default:R(()=>[y(A(Z),null,{default:R(()=>[y(ee,{language:"html",modelValue:o.value,"onUpdate:modelValue":s[0]||(s[0]=T=>o.value=T)},null,8,["modelValue"])]),_:1}),y(A(Z),null,{default:R(()=>[E("div",{class:"md-container",innerHTML:a.value},null,8,Ze)]),_:1})]),_:1})])])}}});const ot=$e(qe,[["__scopeId","data-v-364ba9f9"]]);export{ot as default};
