import{d as Ce,Z as De,a2 as Ze,ad as Je,o as c,U as q,y as A,e as l,j as o,g as d,u as Ye,r as V,p as et,D as tt,a5 as st,q as at,a as ot,s as me,aX as nt,aY as lt,aZ as it,a_ as rt,a$ as ct,b0 as ut,a3 as _e,b1 as dt,H as pt,K as mt,L as _t,M as ht,c as p,f as M,F as C,w as B,l as h,N as j,Q as G,R as ft,A as he,z as bt,b2 as fe,b3 as be,an as kt,k as U,T as yt,m as y,a9 as vt,b4 as gt,a1 as P,b5 as Ct,b6 as Dt,b7 as $t,b8 as wt,_ as Vt}from"./index-5f5c60b6.js";import{_ as Ft}from"./download-rounded-2da2fb73.js";import{_ as It}from"./delete-outline-rounded-fee50069.js";import{_ as St}from"./Breadcrumb-d5bdebe4.js";import{c as ke}from"./index-23cdd2f2.js";import{g as ye,M as Tt}from"./splitpanes.es-5e471b0b.js";import{n as xt}from"./list-6498ebd9.js";import{_ as Mt}from"./VModal.vuevuetypescriptsetuptruelang-61cd4dae.js";import{t as Bt}from"./truncate-95b28e60.js";import{_ as ve}from"./EditValueModal.vuevuetypescriptsetuptruelang-27a0512e.js";import"./stringToArray-06dd1adb.js";import"./vee-validate.esm-e0a551fe.js";const Ut=["disabled"],ge=Ce({__name:"DeleteFileConfirm",props:{onDone:{type:Function,required:!0},files:{type:Array,required:!0}},setup(R){const a=R,{mutate:E,loading:F,onDone:N}=De({document:Ze`
    mutation DeleteFiles($paths: [String!]!) {
      deleteFiles(paths: $paths)
    }
  `,appApi:!0});function u(){E({paths:a.files.map(k=>k.path)})}return N(()=>{a.onDone(a.files),Je()}),(k,I)=>{const _=Mt;return c(),q(_,{class:"delete-modal",title:k.$t("confirm_to_delete_name",{name:o(Bt)(R.files.map(v=>v.name).join(", "),{length:200})})},{action:A(()=>[l("button",{type:"button",disabled:o(F),class:"btn",onClick:u},d(k.$t("delete")),9,Ut)]),_:1},8,["title"])}}}),Pt={class:"v-toolbar"},qt={class:"right-actions"},At=["onClick","title"],Rt=["onClick","title"],Et={class:"form-check mt-2 me-3 ms-3"},Nt={class:"form-check-label",for:"select-mode"},Wt={class:"form-check mt-2"},zt={class:"form-check-label",for:"show-hidden"},Lt={class:"file-items"},Ot=["onClick","onDblclick","onContextmenu"],Qt=["onUpdate:modelValue"],jt=["src"],Gt={class:"title"},Ht={style:{"font-size":"0.75rem"}},Kt=["onContextmenu"],Xt={key:0,class:"no-files"},Zt={key:0,class:"file-item-info"},Jt=Ce({__name:"FilesVIew",setup(R){var re,ce,ue,de;const{t:a}=Ye(),E=V([]),F=et(),N=F.query,u=F.params.type,k=V(tt(((re=N.q)==null?void 0:re.toString())??"")),I=st(k.value),_=V(((ce=I.find(e=>e.name==="path"))==null?void 0:ce.value)??"");let v=((ue=I.find(e=>e.name==="dir"))==null?void 0:ue.value)??"";v||(((de=I.find(t=>t.name==="isDir"))==null?void 0:de.value)==="1"?v=_.value:v=_.value.substring(0,_.value.lastIndexOf("/")));const $e=V(v),D=V(!1),H=at(),K=ot(),{app:f,selectedFiles:we}=me(K);let S=f.value.internalStoragePath;u&&(u==="sdcard"?S=f.value.sdcardPath:u.startsWith("usb")?S=f.value.usbDiskPaths[parseInt(u.substring(3))-1]:u==="app"&&(S=f.value.externalFilesDir));const{loading:Ve,panels:m,currentDir:W,refetch:X}=nt(f,S,$e.value),{createPath:Fe,createVariables:Ie,createMutation:Se}=lt(f,m),{renameValue:Te,renamePath:xe,renameDone:Me,renameMutation:Be,renameVariables:Ue}=it(m),{internal:Z,sdcard:J,usb:Pe,refetch:z}=rt(),{onDeleted:Y}=Dt(m,W,z),{downloadFile:ee,downloadDir:qe,downloadFiles:Ae}=vt(f),{view:L}=$t(E,(e,t)=>{K.lightbox={sources:e,index:t,visible:!0}}),{selectedItem:T,select:Re}=ct(W,u,k,H),{canPaste:te,copy:O,cut:se,paste:Q}=ut(we,X,z),{input:Ee,upload:ae,uploadChanged:oe}=_e(),{input:Ne,upload:ne,uploadChanged:le}=_e(),{mutate:We,onDone:ze}=De({document:dt,appApi:!0});ze(e=>{Ae(e.data.setTempValue.key)});const $=()=>{const e=[];return m.value.forEach(t=>{t.items.forEach(s=>{s.checked&&(s.panel=t,e.push(s))})}),e},Le=()=>{We({key:gt(),value:JSON.stringify($().map(e=>({path:e.path})))})},Oe=pt(()=>$().length>0),Qe=()=>{P(ge,{files:$(),onDone:Y})},{fileShowHidden:g}=me(H);_.value&&mt(()=>m.value.length,()=>{if(m.value.length>0&&_.value){const t=m.value[m.value.length-1].items.find(s=>s.path===_.value);t&&(T.value=t,_.value="")}});function je(){var e,t,s,i;if(u){if(u==="sdcard")return`${a("sdcard")} (${a("storage_free_total",{free:y(((e=J.value)==null?void 0:e.freeBytes)??0),total:y(((t=J.value)==null?void 0:t.totalBytes)??0)})})`;if(u==="app")return a("app_name");if(u.startsWith("usb")){const x=parseInt(u.substring(3)),b=Pe.value[x-1];return`${a("usb_storage")} ${x} (${a("storage_free_total",{free:y((b==null?void 0:b.freeBytes)??0),total:y((b==null?void 0:b.totalBytes)??0)})})`}}return`${a("page_title.files")} (${a("storage_free_total",{free:y(((s=Z.value)==null?void 0:s.freeBytes)??0),total:y(((i=Z.value)==null?void 0:i.totalBytes)??0)})})`}function Ge(e,t){if(D.value){t.checked=!t.checked;return}Re(e,t)}function ie(e){return fe(e.name)||be(e.name)||wt(e.name)}function He(e,t){t.isDir||(ie(t)?L(g?e.items:e.items.filter(s=>!s.name.startsWith(".")),t):ee(t.path))}function Ke(e,t){e.preventDefault();const s=[{label:a("create_folder"),onClick:()=>{Fe.value=t,P(ve,{title:a("name"),placeholder:a("name"),mutation:Se,getVariables:Ie})}},{label:a("upload_files"),onClick:()=>{ae(t)}},{label:a("upload_folder"),onClick:()=>{ne(t)}}];te()&&s.push({label:a("paste"),onClick:()=>{Q(t)}}),ke({x:e.x,y:e.y,items:s})}function Xe(e,t,s){e.preventDefault();let i;s.isDir?i=[{label:a("upload_files"),onClick:()=>{ae(s.path)}},{label:a("upload_folder"),onClick:()=>{ne(s.path)}},{label:a("download"),onClick:()=>{qe(s.path)}}]:(i=[],ie(s)&&i.push({label:a("open"),onClick:()=>{L(t.items,s)}}),i.push({label:a("download"),onClick:()=>{ee(s.path)}})),i.push({label:a("duplicate"),onClick:()=>{O([s]),Q(t.dir)}}),i.push({label:a("cut"),onClick:()=>{s.panel=t,se([s])}}),i.push({label:a("copy"),onClick:()=>{O([s])}}),s.isDir&&te()&&i.push({label:a("paste"),onClick:()=>{Q(s.path)}}),i=[...i,{label:a("rename"),onClick:()=>{Te.value=s.name,xe.value=s.path,P(ve,{title:a("rename"),placeholder:a("name"),value:s.name,mutation:Be,getVariables:Ue,done:Me})}},{label:a("delete"),onClick:()=>{P(ge,{files:[s],onDone:Y})}}],ke({x:e.x,y:e.y,items:i})}return _t(()=>{ht.on("upload_task_done",e=>{e.status==="done"&&setTimeout(()=>{X(e.dir),z()},1e3)})}),(e,t)=>{const s=St,i=It,x=Ft,b=Ct;return c(),p(C,null,[l("div",Pt,[M(s,{current:je}),l("div",qt,[D.value&&o(Oe)?(c(),p(C,{key:0},[l("button",{type:"button",class:"btn btn-action",onClick:t[0]||(t[0]=B(()=>o(O)($()),["stop"]))},d(e.$t("copy")),1),l("button",{type:"button",class:"btn btn-action",onClick:t[1]||(t[1]=B(()=>o(se)($()),["stop"]))},d(e.$t("cut")),1),l("button",{type:"button",class:"btn btn-action",onClick:B(Qe,["stop"]),title:e.$t("delete")},[M(i,{class:"bi"})],8,At),l("button",{type:"button",class:"btn btn-action",onClick:B(Le,["stop"]),title:e.$t("download")},[M(x,{class:"bi"})],8,Rt)],64)):h("",!0),l("div",Et,[j(l("input",{class:"form-check-input","onUpdate:modelValue":t[2]||(t[2]=r=>D.value=r),id:"select-mode",type:"checkbox"},null,512),[[G,D.value]]),l("label",Nt,d(e.$t("select_mode")),1)]),l("div",Wt,[j(l("input",{class:"form-check-input","onUpdate:modelValue":t[3]||(t[3]=r=>ft(g)?g.value=r:null),id:"show-hidden",type:"checkbox"},null,512),[[G,o(g)]]),l("label",zt,d(e.$t("show_hidden")),1)])])]),M(o(Tt),{class:"panel-container"},{default:A(()=>[(c(!0),p(C,null,he(o(m),r=>(c(),q(o(ye),{key:r.dir},{default:A(()=>[l("div",Lt,[(c(!0),p(C,null,he(r.items,n=>{var pe;return c(),p(C,{key:n.path},[!n.name.startsWith(".")||o(g)?(c(),p("div",{key:0,class:bt(["file-item",{active:(o(W)+"/").startsWith(n.path+"/")||((pe=o(T))==null?void 0:pe.path)===n.path}]),onClick:w=>Ge(r,n),onDblclick:w=>He(r,n),onContextmenu:w=>Xe(w,r,n)},[D.value?j((c(),p("input",{key:0,class:"form-check-input","onUpdate:modelValue":w=>n.checked=w,type:"checkbox"},null,8,Qt)),[[G,n.checked]]):h("",!0),n.isDir?(c(),q(b,{key:1,class:"bi"})):h("",!0),o(fe)(n.name)||o(be)(n.name)?(c(),p("img",{key:2,src:o(kt)(n.fileId)+"&w=50&h=50",width:"50",height:"50"},null,8,jt)):h("",!0),l("div",Gt,[U(d(n.name)+" ",1),l("div",Ht,[U(d(o(yt)(n.updatedAt)),1),n.isDir?h("",!0):(c(),p(C,{key:0},[U(", "+d(o(y)(n.size)),1)],64))])])],42,Ot)):h("",!0)],64)}),128)),l("div",{class:"empty",onContextmenu:n=>Ke(n,r.dir)},[r.items.filter(n=>!n.name.startsWith(".")||o(g)).length===0?(c(),p("div",Xt,d(e.$t("no_files")),1)):h("",!0)],40,Kt)])]),_:2},1024))),128)),o(m).length===0?(c(),q(o(ye),{key:0,class:"no-data-placeholder"},{default:A(()=>[U(d(e.$t(o(xt)(o(Ve),o(f).permissions,"WRITE_EXTERNAL_STORAGE"))),1)]),_:1})):h("",!0)]),_:1}),o(T)?(c(),p("div",Zt,d(e.$t("path"))+": "+d(o(T).path),1)):h("",!0),l("input",{ref_key:"fileInput",ref:Ee,style:{display:"none"},type:"file",multiple:"",onChange:t[4]||(t[4]=(...r)=>o(oe)&&o(oe)(...r))},null,544),l("input",{ref_key:"dirFileInput",ref:Ne,style:{display:"none"},type:"file",multiple:"",webkitdirectory:"",mozdirectory:"",directory:"",onChange:t[5]||(t[5]=(...r)=>o(le)&&o(le)(...r))},null,544)],64)}}});const ds=Vt(Jt,[["__scopeId","data-v-c08cf989"]]);export{ds as default};
