import{_ as vt}from"./VPagination.vuevuetypescriptsetuptruelang-CFupeDJR.js";import{_ as kt,a as ht,b as gt,c as ft,d as yt}from"./grid-view-outline-rounded-BqaCP9ek.js";import{d as bt,u as Ct,s as Te,h as S,g as $t,I as wt,i as It,ag as Ae,aD as Dt,J as St,aE as Fe,aF as Et,aH as Tt,ah as At,K as Le,L as Ft,M as Lt,c as a,a as o,m as e,t as _,O as b,x as p,w as i,p as c,e as V,q as K,aG as Vt,N as z,P as Q,v as E,Q as zt,f as Mt,C as Ve,aJ as qt,aP as Bt,aI as Ut,am as Nt,S as Kt,o as n,aQ as ze,aA as Y,aL as R,E as Me,ab as qe,U as Qt,V as Rt,W as Ht,X as Pt,ap as Gt,ao as Ot,Z as Zt,$ as Jt,a0 as Wt,a1 as C,ae as Xt,aq as jt,a2 as Yt,aM as xt,a4 as es,a3 as ts,aN as ss}from"./index-Dn0O6zoH.js";import{_ as os,a as ns}from"./SearchInput-aem6tEJK.js";import{_ as ls}from"./sort-rounded-BSs7VajO.js";import{_ as as}from"./upload-rounded-q7e5EuXT.js";import{a as is}from"./tags-CvPqo38V.js";import{u as cs,a as ds}from"./key-events-CgPzNP0J.js";import{u as us}from"./search-DrT1IjAg.js";import"./search-rounded-C8Nl_ZR1.js";import"./rss-feed-rounded-Dqku7i1k.js";import"./vee-validate.esm-0lx5owW0.js";const rs={class:"top-app-bar"},_s=["checked","indeterminate"],ps={class:"title"},ms={key:0},vs={key:1},ks=o("md-ripple",null,null,-1),hs=o("md-ripple",null,null,-1),gs=o("md-ripple",null,null,-1),fs={class:"actions"},ys={class:"btn-icon"},bs=o("md-ripple",null,null,-1),Cs=["onClick"],$s={slot:"headline"},ws=["onClick"],Is={slot:"headline"},Ds={class:"btn-icon btn-sort"},Ss=o("md-ripple",null,null,-1),Es={class:"menu-items"},Ts=["onClick","selected"],As={slot:"headline"},Fs={class:"sm"},Ls=["selected"],Vs=["selected"],zs=["onClick","onMouseover"],Ms=["src"],qs=["src","onError"],Bs=["onClick"],Us=o("md-ripple",null,null,-1),Ns=["onClick"],Ks=o("md-ripple",null,null,-1),Qs=["onClick"],Rs=o("md-ripple",null,null,-1),Hs={class:"actions"},Ps=["onClick"],Gs=o("md-ripple",null,null,-1),Os=["onClick"],Zs=o("md-ripple",null,null,-1),Js=["onClick"],Ws=o("md-ripple",null,null,-1),Xs=["onClick"],js=o("md-ripple",null,null,-1),Ys={class:"right"},xs=["onClick","onMouseover"],eo={class:"start"},to=["onClick","checked"],so=["onClick","checked"],oo={class:"number"},no={class:"image"},lo=["src"],ao=["src","onError"],io={class:"title"},co={class:"subtitle"},uo=["onClick"],ro={class:"actions"},_o=["onClick"],po=o("md-ripple",null,null,-1),mo=["onClick"],vo=o("md-ripple",null,null,-1),ko=["onClick"],ho=o("md-ripple",null,null,-1),go={class:"time"},fo={key:2,class:"no-data-placeholder"},$=55,Vo=bt({__name:"VideosView",setup(yo){var Ie;const g=Ct(),{videoSortBy:M}=Te(g),f=S([]),{t:x}=$t(),{parseQ:Be}=us(),H=wt({tagIds:[]}),ee=It(),{app:te,urlTokenKey:P,uploads:G}=Te(ee),{input:Ue,upload:Ne,uploadChanged:se}=Ae(G),{input:Ke,upload:Qe,uploadChanged:oe}=Ae(G),{dropping:Re,fileDragEnter:ne,fileDragLeave:le,dropFiles:He}=Dt(G),r=St.VIDEO,ae=zt(),ie=ae.query,O=S(parseInt(((Ie=ie.page)==null?void 0:Ie.toString())??"1")),T=S([]),q=S([]),Pe=Fe(()=>{const t={};return q.value.forEach(l=>{t[l.id]=l}),t}),w=S(""),{addToTags:Ge}=is(r,T),{deleteItems:ce,deleteItem:de}=Et(),{view:Oe}=Tt(r),{selectedIds:k,allChecked:ue,realAllChecked:D,selectRealAll:Ze,allCheckedAlertVisible:Je,clearSelection:A,toggleAllChecked:re,toggleSelect:F,total:h,checked:L,shiftEffectingIds:B,handleItemClick:_e,handleMouseOver:pe,selectAll:We,shouldSelect:me}=cs(f),{downloadItems:Xe}=At(P,r,A,"videos.zip"),{downloadFile:ve}=Gt(P),ke=t=>{const l=ae.query.q;Mt(g,l?`/videos?page=${t}&q=${l}`:`/videos?page=${t}`)},{keyDown:he,keyUp:ge}=ds(h,$,O,We,A,ke,()=>{ce(r,k.value,D.value,h.value,w.value)}),Z=S([]),je=Ot(),Ye=Fe(()=>f.value.map(t=>({src:Y(t.fileId),name:R(t.path),duration:t.duration,size:t.size,path:t.path,data:t,type:r}))),fe=t=>{Z.value.push(t)},{loading:U,fetch:N}=Le({handle:async(t,l)=>{if(l)Ve(x(l),"error");else if(t){const y=[];for(const I of t.videos)y.push({...I,fileId:qt(P.value,I.path,I.id)});f.value=y,h.value=t.videoCount}},document:Bt,variables:()=>({offset:(O.value-1)*$,limit:$,query:w.value,sortBy:M.value}),appApi:!0});function J(t){ee.lightbox={sources:Ye.value,index:t,visible:!0}}const{fetch:xe}=Le({handle:async(t,l)=>{l?Ve(x(l),"error"):t&&(T.value=t.tags,q.value=t.mediaBuckets)},document:Ut,variables:{type:r},appApi:!0});function et(t,l){M.value=l,t.close()}function tt(t){return t?`/videos?q=${t}`:"/videos"}function ye(t){Zt(Jt,{type:r,tags:T.value,item:{key:t.id,title:t.title,size:t.size},selected:T.value.filter(l=>t.tags.some(y=>y.id===l.id))})}function W(){const t=q.value.find(l=>l.id===H.bucketId);return t?ss(t.topItems[0]):`${te.value.internalStoragePath}/Movies`}function st(t){Ne(W()),t.close()}function ot(t){Qe(W()),t.close()}function nt(t){He(t,W(),"video")}const be=t=>{t.type===r&&(A(),N())},Ce=t=>{t.type===r&&N()},$e=t=>{t.type===r&&(A(),N())},we=()=>{h.value--};return Ft(()=>{var t;w.value=Wt(((t=ie.q)==null?void 0:t.toString())??""),Be(H,w.value),xe(),N(),C.on("item_tags_updated",Ce),C.on("items_tags_updated",be),C.on("media_item_deleted",we),C.on("media_items_deleted",$e),window.addEventListener("keydown",he),window.addEventListener("keyup",ge)}),Lt(()=>{C.off("item_tags_updated",Ce),C.off("items_tags_updated",be),C.off("media_item_deleted",we),C.off("media_items_deleted",$e),window.removeEventListener("keydown",he),window.removeEventListener("keyup",ge)}),(t,l)=>{const y=Xt,I=jt,X=Yt,lt=os,at=as,De=Nt,it=ls,ct=kt,dt=ht,ut=ns,j=gt,Se=ft,rt=xt,Ee=es,_t=ts,pt=yt,mt=vt,m=Kt("tooltip");return n(),a(b,null,[o("div",rs,[o("md-checkbox",{"touch-target":"wrapper",onChange:l[0]||(l[0]=(...s)=>e(re)&&e(re)(...s)),checked:e(ue),indeterminate:!e(ue)&&e(L)},null,40,_s),o("div",ps,[e(k).length?(n(),a("span",ms,_(t.$t("x_selected",{count:e(D)?e(h).toLocaleString():e(k).length.toLocaleString()})),1)):(n(),a("span",vs,_(t.$t("page_title.videos"))+" ("+_(e(h).toLocaleString())+")",1)),e(L)?(n(),a(b,{key:2},[p((n(),a("button",{class:"btn-icon",onClick:l[1]||(l[1]=i(s=>e(ce)(e(r),e(k),e(D),e(h),w.value),["stop"]))},[ks,c(y)])),[[m,t.$t("delete")]]),p((n(),a("button",{class:"btn-icon",onClick:l[2]||(l[2]=i(s=>e(Xe)(e(D),e(k),w.value),["stop"]))},[hs,c(I)])),[[m,t.$t("download")]]),p((n(),a("button",{class:"btn-icon",onClick:l[3]||(l[3]=i(s=>e(Ge)(e(k),e(D),w.value),["stop"]))},[gs,c(X)])),[[m,t.$t("add_to_tags")]])],64)):V("",!0)]),o("div",fs,[c(lt,{filter:H,tags:T.value,buckets:q.value,"get-url":tt},null,8,["filter","tags","buckets"]),c(De,null,{content:K(s=>[o("md-menu-item",{onClick:i(d=>st(s),["stop"])},[o("div",$s,_(t.$t("upload_files")),1)],8,Cs),o("md-menu-item",{onClick:i(d=>ot(s),["stop"])},[o("div",Is,_(t.$t("upload_folder")),1)],8,ws)]),default:K(()=>[p((n(),a("button",ys,[bs,c(at)])),[[m,t.$t("upload")]])]),_:1}),c(De,null,{content:K(s=>[o("div",Es,[(n(!0),a(b,null,Q(e(je),d=>(n(),a("md-menu-item",{key:d.value,onClick:u=>et(s,d.value),selected:d.value===e(M)},[o("div",As,_(t.$t(d.label)),1)],8,Ts))),128))])]),default:K(()=>[p((n(),a("button",Ds,[Ss,c(it)])),[[m,t.$t("sort")]])]),_:1}),o("md-outlined-segmented-button-set",Fs,[o("md-outlined-segmented-button",{"data-value":"grid","no-checkmark":"",selected:!e(g).videosCardView,onClick:l[4]||(l[4]=s=>e(g).videosCardView=!1)},[c(ct,{slot:"icon"})],8,Ls),o("md-outlined-segmented-button",{"data-value":"card","no-checkmark":"",selected:e(g).videosCardView,onClick:l[5]||(l[5]=s=>e(g).videosCardView=!0)},[c(dt,{slot:"icon"})],8,Vs)])])]),c(ut,{limit:$,total:e(h),"all-checked-alert-visible":e(Je),"real-all-checked":e(D),"select-real-all":e(Ze),"clear-selection":e(A)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),o("div",{class:"scroll-content",onDragover:l[9]||(l[9]=i((...s)=>e(ne)&&e(ne)(...s),["stop","prevent"]))},[p(o("div",{class:"drag-mask",onDrop:i(nt,["stop","prevent"]),onDragleave:l[6]||(l[6]=i((...s)=>e(le)&&e(le)(...s),["stop","prevent"]))},_(t.$t("release_to_send_files")),545),[[Vt,e(Re)]]),e(g).videosCardView?(n(),a("div",{key:1,class:z(["media-list",{"select-mode":e(L)}])},[(n(!0),a(b,null,Q(f.value,(s,d)=>{var u;return n(),a("section",{class:z(["media-item selectable-card",{selected:e(k).includes(s.id),selecting:e(B).includes(s.id)}]),key:s.id,onClick:i(v=>e(_e)(v,s,d,J),["stop"]),onMouseover:v=>e(pe)(v,d)},[o("div",eo,[e(B).includes(s.id)?(n(),a("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",onClick:i(v=>e(F)(v,s,d),["stop"]),checked:e(me)},null,8,to)):(n(),a("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",onClick:i(v=>e(F)(v,s,d),["stop"]),checked:e(k).includes(s.id)},null,8,so)),o("span",oo,[c(_t,{id:d+1,raw:s},null,8,["id","raw"])])]),o("div",no,[Z.value.includes(s.id)?(n(),a("img",{key:0,src:`/ficons/${e(ze)(s.path)}.svg`,class:"svg"},null,8,lo)):(n(),a("img",{key:1,class:"image-thumb",src:e(Y)(s.fileId,"&w=200&h=200"),onError:v=>fe(s.id)},null,40,ao))]),o("div",io,_(e(R)(s.path)),1),o("div",co,[o("span",null,_(e(Me)(s.size)),1),o("span",null,_(e(qe)(s.duration)),1),o("a",{onClick:i(v=>e(Oe)(e(g),s.bucketId),["stop","prevent"])},_((u=Pe.value[s.bucketId])==null?void 0:u.name),9,uo),c(Ee,{tags:s.tags,type:e(r),"only-links":!0},null,8,["tags","type"])]),o("div",ro,[p((n(),a("button",{class:"btn-icon sm",onClick:i(v=>e(de)(e(r),s),["stop"])},[po,c(y)],8,_o)),[[m,t.$t("delete")]]),p((n(),a("button",{class:"btn-icon sm",onClick:i(v=>e(ve)(s.path,e(R)(s.path).replace(" ","-")),["stop"])},[vo,c(I)],8,mo)),[[m,t.$t("download")]]),p((n(),a("button",{class:"btn-icon sm",onClick:i(v=>ye(s),["stop"])},[ho,c(X)],8,ko)),[[m,t.$t("add_to_tags")]])]),o("div",go,[p((n(),a("span",null,[Rt(_(e(Ht)(s.createdAt)),1)])),[[m,e(Qt)(s.createdAt)]])])],42,xs)}),128)),e(U)&&f.value.length===0?(n(),E(pt,{key:0,limit:$})):V("",!0)],2)):(n(),a("div",{key:0,class:z(["media-grid",{"select-mode":e(L)}])},[(n(!0),a(b,null,Q(f.value,(s,d)=>(n(),a("section",{class:z(["media-item",{selected:e(k).includes(s.id),selecting:e(B).includes(s.id)}]),key:s.id,onClick:i(u=>e(_e)(u,s,d,J),["stop"]),onMouseover:u=>e(pe)(u,d)},[Z.value.includes(s.id)?(n(),a("img",{key:0,src:`/ficons/${e(ze)(s.path)}.svg`,class:"image svg"},null,8,Ms)):(n(),a("img",{key:1,class:"image image-thumb",src:e(Y)(s.fileId,"&w=200&h=200"),onError:u=>fe(s.id)},null,40,qs)),e(B).includes(s.id)?(n(),a("button",{key:2,class:"btn-icon btn-checkbox",onClick:i(u=>e(F)(u,s,d),["stop"])},[Us,e(me)?(n(),E(j,{key:0})):(n(),E(Se,{key:1}))],8,Bs)):e(k).includes(s.id)?(n(),a("button",{key:3,class:"btn-icon btn-checkbox",onClick:i(u=>e(F)(u,s,d),["stop"])},[Ks,c(j)],8,Ns)):(n(),a(b,{key:4},[o("button",{class:"btn-icon btn-checkbox",onClick:i(u=>e(F)(u,s,d),["stop"])},[Rs,e(k).includes(s.id)?(n(),E(j,{key:0})):(n(),E(Se,{key:1}))],8,Qs),o("div",Hs,[e(L)?p((n(),a("button",{key:0,class:"btn-icon sm",onClick:i(u=>J(d),["stop"])},[Gs,c(rt)],8,Ps)),[[m,t.$t("open")]]):(n(),a(b,{key:1},[p((n(),a("button",{class:"btn-icon sm",onClick:i(u=>e(de)(e(r),s),["stop"])},[Zs,c(y)],8,Os)),[[m,t.$t("delete")]]),p((n(),a("button",{class:"btn-icon sm",onClick:i(u=>e(ve)(s.path,e(R)(s.path).replace(" ","-")),["stop"])},[Ws,c(I)],8,Js)),[[m,t.$t("download")]]),p((n(),a("button",{class:"btn-icon sm",onClick:i(u=>ye(s),["stop"])},[js,c(X)],8,Xs)),[[m,t.$t("add_to_tags")]])],64))]),o("div",{class:z(["info",{"has-tags":s.tags.length>0}])},[c(Ee,{tags:s.tags,type:e(r)},null,8,["tags","type"]),o("span",Ys,_(["SIZE_ASC","SIZE_DESC"].includes(e(M))?e(Me)(s.size):e(qe)(s.duration)),1)],2)],64))],42,zs))),128)),e(U)&&f.value.length===0?(n(),a(b,{key:0},Q($,s=>o("section",{class:"skeleton-image media-item",key:s})),64)):V("",!0)],2)),!e(U)&&f.value.length===0?(n(),a("div",fo,_(t.$t(e(Pt)(e(U),e(te).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):V("",!0),e(h)>$?(n(),E(mt,{key:3,page:O.value,go:ke,total:e(h),limit:$},null,8,["page","total"])):V("",!0),o("input",{ref_key:"fileInput",ref:Ue,style:{display:"none"},type:"file",accept:"video/*",multiple:"",onChange:l[7]||(l[7]=(...s)=>e(se)&&e(se)(...s))},null,544),o("input",{ref_key:"dirFileInput",ref:Ke,style:{display:"none"},type:"file",accept:"video/*",multiple:"",webkitdirectory:"",mozdirectory:"",directory:"",onChange:l[8]||(l[8]=(...s)=>e(oe)&&e(oe)(...s))},null,544)],32)],64)}}});export{Vo as default};
