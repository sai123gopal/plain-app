import{_ as te}from"./MonacoEditor.vuevuetypescriptsetuptruelang-b8a8a823.js";import{_ as ne}from"./print-outline-rounded-37f6ac96.js";import{aN as ae,aO as j,aP as se,d as oe,e as ie,u as re,E as ue,r as E,s as le,f as ce,aC as de,h as K,i as _e,aQ as me,P as pe,Q as R,R as fe,S as ve,c as L,a as S,q as y,I as D,F as ge,K as he,n as F,m as q,l as H,k as $,aR as Te,w as ye,y as z,aS as ke,aT as be,aU as we,o as N,j as Ce,t as X,aV as Ee,T as Ne,B as Se,C as xe,$ as Me,a3 as Ie,a4 as Ve,a6 as Le,a5 as $e,_ as Ae}from"./index-2583f876.js";import{_ as Re}from"./Breadcrumb-ef080890.js";import{g as J,M as De}from"./splitpanes.es-96eec7b1.js";import{u as Qe}from"./markdown-a075af52.js";var Ue=function(){return ae.Date.now()};const O=Ue;var Be="Expected a function",We=Math.max,Fe=Math.min;function He(f,l,i){var _,r,n,o,a,u,v=0,A=!1,g=!1,k=!0;if(typeof f!="function")throw new TypeError(Be);l=j(l)||0,se(i)&&(A=!!i.leading,g="maxWait"in i,n=g?We(j(i.maxWait)||0,l):n,k="trailing"in i?!!i.trailing:k);function b(t){var c=_,p=r;return _=r=void 0,v=t,o=f.apply(p,c),o}function m(t){return v=t,a=setTimeout(w,l),A?b(t):o}function U(t){var c=t-u,p=t-v,V=l-c;return g?Fe(V,n-p):V}function x(t){var c=t-u,p=t-v;return u===void 0||c>=l||c<0||g&&p>=n}function w(){var t=O();if(x(t))return C(t);a=setTimeout(w,U(t))}function C(t){return a=void 0,k&&_?b(t):(_=r=void 0,o)}function M(){a!==void 0&&clearTimeout(a),v=0,_=u=r=a=void 0}function B(){return a===void 0?o:C(O())}function I(){var t=O(),c=x(t);if(_=arguments,r=this,u=t,c){if(a===void 0)return m(u);if(g)return clearTimeout(a),a=setTimeout(w,l),b(u)}return a===void 0&&(a=setTimeout(w,l)),o}return I.cancel=M,I.flush=B,I}const Y=f=>(Se("data-v-b382585d"),f=f(),xe(),f),Oe={class:"page-container"},Ge={class:"main"},Pe={class:"v-toolbar"},je={class:"state-point"},Ke=["onClick"],qe=Y(()=>S("md-ripple",null,null,-1)),ze=["onClick"],Xe=Y(()=>S("md-ripple",null,null,-1)),Je=["innerHTML"],Q="NOTE",Ye=oe({__name:"NoteEditView",setup(f){const l=ie(),{t:i}=re(),_=ue(),r=E(_.params.id),n=E(),o=E(""),a=E(""),u=E(!1),{app:v,urlTokenKey:A}=le(ce()),g=de(()=>{var e;return(e=n.value)!=null&&e.deletedAt?["/notes","/notes/trash"]:["/notes"]}),{render:k}=Qe(v,A);let b=!1;function m(){return r.value==="create"}const U=He(()=>{u.value=!1,B({id:m()?"":r.value,input:{content:o.value,title:Te(o.value,{length:100,omission:""})}})},500),x=()=>{ye(o,async e=>{u.value=!0,a.value=await k(e),U()})},w=()=>{window.print()},C=E();K({handle:(e,s)=>{s?z(i(s),"error"):e&&(C.value=e.tags)},document:ke,variables:{type:Q},appApi:!0});let M=()=>{};if(m())x();else{const{refetch:e}=K({handle:async(s,d)=>{if(d)z(i(d),"error");else{if(n.value=s.note,b)return;o.value=s.note.content,a.value=await k(o.value),b=!0,x()}},document:be,variables:()=>({id:r.value}),appApi:!0});M=e}const{mutate:B,onDone:I}=_e({document:we,appApi:!0});I(e=>{var d,h;n.value=e.data.saveNote,m()&&((d=n.value)!=null&&d.id)&&(r.value=(h=n.value)==null?void 0:h.id,me(l,`/notes/${r.value}`))});function t(){var s;const e=(s=n==null?void 0:n.value)==null?void 0:s.updatedAt;return e?`(${i("updated_at")}: ${Me(e)})`:""}function c(){var e,s;Ie(Ve,{type:Q,tags:C.value,item:{key:(e=n.value)==null?void 0:e.id,title:"",size:0},selected:(s=C.value)==null?void 0:s.filter(d=>{var h;return(h=n.value)==null?void 0:h.tags.some(W=>W.id===d.id)})})}const p=e=>{e.type===Q&&M()},V=e=>{e.type===Q&&M()};return pe(()=>{R.on("item_tags_updated",V),R.on("items_tags_updated",p)}),fe(()=>{R.off("item_tags_updated",V),R.off("items_tags_updated",p)}),(e,s)=>{var P;const d=Le,h=Re,W=$e,Z=ne,ee=te,G=ve("tooltip");return N(),L("div",Oe,[S("div",Ge,[S("div",Pe,[y(h,{paths:g.value},{current:D(()=>{var T;return[Ce(X(m()?$(i)("create"):$(i)("edit"))+" ",1),F(S("span",je,"*",512),[[Ee,u.value]]),(T=n.value)!=null&&T.updatedAt?(N(),Ne(d,{key:0,class:"time",id:t(),raw:n.value},null,8,["id","raw"])):H("",!0)]}),_:1},8,["paths"]),(N(!0),L(ge,null,he((P=n.value)==null?void 0:P.tags,T=>(N(),L("span",{key:T.id,class:"badge"},X(T.name),1))),128)),m()?H("",!0):F((N(),L("button",{key:0,class:"icon-button",onClick:q(c,["prevent"]),style:{"margin-inline-start":"8px"}},[qe,y(W)],8,Ke)),[[G,e.$t("add_to_tags")]]),m()?H("",!0):F((N(),L("button",{key:1,class:"icon-button",onClick:q(w,["prevent"])},[Xe,y(Z)],8,ze)),[[G,e.$t("print")]])]),y($(De),{class:"panel-container"},{default:D(()=>[y($(J),null,{default:D(()=>[y(ee,{language:"html",modelValue:o.value,"onUpdate:modelValue":s[0]||(s[0]=T=>o.value=T)},null,8,["modelValue"])]),_:1}),y($(J),null,{default:D(()=>[S("div",{class:"md-container",innerHTML:a.value},null,8,Je)]),_:1})]),_:1})])])}}});const ot=Ae(Ye,[["__scopeId","data-v-b382585d"]]);export{ot as default};
