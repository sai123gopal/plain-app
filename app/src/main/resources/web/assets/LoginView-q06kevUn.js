import{d as G,h as g,g as Q,as as X,cJ as Y,cK as Z,cL as ee,cM as se,cN as ne,cO as te,cP as oe,a6 as re,cQ as N,c as A,a as v,p as P,t as p,x as E,aG as R,w as ie,m as c,z as ae,A as le,y as ue,e as x,O as ce,cR as de,o as T,bR as me,cS as we,cT as fe,H as ve}from"./index-Dn0O6zoH.js";import{u as be,a as pe}from"./vee-validate.esm-0lx5owW0.js";function O(n){let t=n;if(typeof t>"u"){if(typeof navigator>"u"||!navigator)return"";t=navigator.userAgent||""}return t.toLowerCase()}function j(n,t){try{return new RegExp(n,"g").exec(t)}catch{return null}}function W(){if(typeof navigator>"u"||!navigator||!navigator.userAgentData)return!1;const t=navigator.userAgentData.brands;return!!(t&&t.length)}function ge(n,t){const o=j(`(${n})((?:\\/|\\s|:)([0-9|\\.|_]+))`,t);return o?o[3]:""}function $(n){return n.replace(/_/g,".")}function _(n,t){let o=null,e="-1";return n.some(r=>{const l=j(`(${r.test})((?:\\/|\\s|:)([0-9|\\.|_]+))?`,t);return!l||r.brand?!1:(o=r,e=l[3]||"-1",r.versionAlias?e=r.versionAlias:r.versionTest&&(e=ge(r.versionTest.toLowerCase(),t)||e),e=$(e),!0)}),{preset:o,version:e}}function h(n,t){const o={brand:"",version:"-1"};return n.some(e=>{const r=D(t,e);return r?(o.brand=e.id,o.version=e.versionAlias||r.version,o.version!=="-1"):!1}),o}function D(n,t){return n.find(o=>j(`${t.test}`,o.brand.toLowerCase()))}const I=[{test:"phantomjs",id:"phantomjs"},{test:"whale",id:"whale"},{test:"edgios|edge|edg",id:"edge"},{test:"msie|trident|windows phone",id:"ie",versionTest:"iemobile|msie|rv"},{test:"miuibrowser",id:"miui browser"},{test:"samsungbrowser",id:"samsung internet"},{test:"samsung",id:"samsung internet",versionTest:"version"},{test:"chrome|crios",id:"chrome"},{test:"firefox|fxios",id:"firefox"},{test:"android",id:"android browser",versionTest:"version"},{test:"safari|iphone|ipad|ipod",id:"safari",versionTest:"version"}],H=[{test:"(?=.*applewebkit/(53[0-7]|5[0-2]|[0-4]))(?=.*\\schrome)",id:"chrome",versionTest:"chrome"},{test:"chromium",id:"chrome"},{test:"whale",id:"chrome",versionAlias:"-1",brand:!0}],L=[{test:"applewebkit",id:"webkit",versionTest:"applewebkit|safari"}],U=[{test:"(?=(iphone|ipad))(?!(.*version))",id:"webview"},{test:"(?=(android|iphone|ipad))(?=.*(naver|daum|; wv))",id:"webview"},{test:"webview",id:"webview"}],F=[{test:"windows phone",id:"windows phone"},{test:"windows 2000",id:"window",versionAlias:"5.0"},{test:"windows nt",id:"window"},{test:"win32|windows",id:"window"},{test:"iphone|ipad|ipod",id:"ios",versionTest:"iphone os|cpu os"},{test:"macos|macintel|mac os x",id:"mac"},{test:"android|linux armv81",id:"android"},{test:"tizen",id:"tizen"},{test:"webos|web0s",id:"webos"}];function K(n){return!!_(U,n).preset}function he(n){const t=O(n),o=!!/mobi/g.exec(t),e={name:"unknown",version:"-1",majorVersion:-1,webview:K(t),chromium:!1,chromiumVersion:"-1",webkit:!1,webkitVersion:"-1"},r={name:"unknown",version:"-1",majorVersion:-1},{preset:l,version:f}=_(I,t),{preset:s,version:u}=_(F,t),b=_(H,t);if(e.chromium=!!b.preset,e.chromiumVersion=b.version,!e.chromium){const m=_(L,t);e.webkit=!!m.preset,e.webkitVersion=m.version}return s&&(r.name=s.id,r.version=u,r.majorVersion=parseInt(u,10)),l&&(e.name=l.id,e.version=f,e.webview&&r.name==="ios"&&e.name!=="safari"&&(e.webview=!1)),e.majorVersion=parseInt(e.version,10),{browser:e,os:r,isMobile:o,isHints:!1}}function q(n){const t=navigator.userAgentData,o=[...t.brands],e=n&&n.fullVersionList,r=t.mobile||!1,l=o[0],f=(n&&n.platform||t.platform||navigator.platform).toLowerCase(),s={name:l.brand,version:l.version,majorVersion:-1,webkit:!1,webkitVersion:"-1",chromium:!1,chromiumVersion:"-1",webview:!!h(U,o).brand||K(O())},u={name:"unknown",version:"-1",majorVersion:-1};s.webkit=!s.chromium&&L.some(a=>D(o,a));const b=h(H,o);if(s.chromium=!!b.brand,s.chromiumVersion=b.version,!s.chromium){const a=h(L,o);s.webkit=!!a.brand,s.webkitVersion=a.version}const m=F.find(a=>new RegExp(`${a.test}`,"g").exec(f));if(u.name=m?m.id:"",n&&(u.version=n.platformVersion),e&&e.length){const a=h(I,e);s.name=a.brand||s.name,s.version=a.version||s.version}else{const a=h(I,o);s.name=a.brand||s.name,s.version=a.brand&&n?n.uaFullVersion:a.version}return s.webkit&&(u.name=r?"ios":"mac"),u.name==="ios"&&s.webview&&(s.version="-1"),u.version=$(u.version),s.version=$(s.version),u.majorVersion=parseInt(u.version,10),s.majorVersion=parseInt(s.version,10),{browser:s,os:u,isMobile:r,isHints:!0}}async function _e(){if(W()){const n=await navigator.userAgentData.getHighEntropyValues(["architecture","model","platform","platformVersion","uaFullVersion","fullVersionList"]);return q(n)}return Ve()}function Ve(n){return W()?q():he(n)}const ye={class:"header"},ke={class:"login-block"},Se={class:"alert alert-danger show",role:"alert"},Ae={class:"body"},Ee=["label","error","error-text"],Te=["disabled"],Be={class:"tap-phone"},Pe={class:"tap-phone-text"},Re={key:0,class:"tips"},xe=G({__name:"LoginView",setup(n){const{handleSubmit:t,isSubmitting:o}=be(),e=g(!1),r=g(!0),l=g(!1),f=g("");let s;const u=window.location.protocol==="http:"?!1:!window.navigator.userAgentData,{t:b}=Q(),{value:m,errorMessage:a}=pe("password",X().required()),B=g(!1);async function z(){const d=await fetch(`${N()}/init`,{method:"POST",headers:de()});if(d.status===403){e.value=!0,r.value=!0,f.value="web_access_disabled";return}r.value=!1;const w=await d.text();w?(m.value=w,B.value=!1):B.value=!0}z();const V=t(async()=>{const d=localStorage.getItem("client_id");s=new WebSocket(`${Y()}?cid=${d}&auth=1`);const w=m.value??"",y=Z(w),k=ee(y);f.value="",e.value=!1,s.onopen=async()=>{o.value=!0;const i=await _e(),S=se(k,JSON.stringify({password:y,browserName:i.browser.name,browserVersion:i.browser.version,osName:i.os.name,osVersion:i.os.version,isMobile:i.isMobile}));s.send(ne(S))},s.onmessage=async i=>{var M;const S=te(k,oe(await i.data.arrayBuffer())),C=JSON.parse(S);C.status==="PENDING"?l.value=!0:(localStorage.setItem("auth_token",C.token),s.close(),window.location.href=((M=re.currentRoute.value.query.redirect)==null?void 0:M.toString())??"/")},s.onclose=async i=>{if(!(i.reason==="abort"||i.reason==="OK")){if(o.value=!1,e.value=!0,l.value=!1,!i.reason&&(await fetch(`${N()}/health_check`)).status===200){f.value="failed_connect_ws";return}f.value=`login.${i.reason?i.reason:"failed"}`}},window.setTimeout(function(){s.readyState!==1&&s.close(3001,"timeout")},2e3)});function J(){l.value=!1,e.value=!1,o.value=!1,s.close(3001,"abort")}return(d,w)=>{const y=we,k=fe;return T(),A(ce,null,[v("header",ye,[P(y,{"logged-in":!1})]),v("h1",null,p(d.$t("app_name")),1),v("div",ke,[E(v("form",{onSubmit:w[2]||(w[2]=ie((...i)=>c(V)&&c(V)(...i),["prevent"]))},[E(v("div",Se,[P(k),v("div",Ae,p(f.value?d.$t(f.value):""),1)],512),[[R,e.value]]),B.value?E((T(),A("md-outlined-text-field",{key:0,label:c(b)("password"),"onUpdate:modelValue":w[0]||(w[0]=i=>ae(m)?m.value=i:null),onKeydown:w[1]||(w[1]=le((...i)=>c(V)&&c(V)(...i),["enter"])),type:"password",class:"form-control",error:c(a),autocomplete:"current-password","error-text":c(a)?d.$t(c(a)):""},null,40,Ee)),[[ue,c(m)]]):x("",!0),r.value?x("",!0):(T(),A("md-filled-button",{key:1,disabled:c(o)},p(d.$t(c(o)?"logging_in":"log_in")),9,Te))],544),[[R,!l.value]]),E(v("div",null,[v("div",Be,[P(c(me))]),v("div",Pe,p(d.$t("login.to_continue")),1),v("md-outlined-button",{onClick:J},p(d.$t("cancel")),1)],512),[[R,l.value]])]),c(u)?(T(),A("div",Re,p(d.$t("browser_warning")),1)):x("",!0)],64)}}}),Le=ve(xe,[["__scopeId","data-v-596f5fe4"]]);export{Le as default};
