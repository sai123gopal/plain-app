import{u as Qe,_ as Ge,a as Ke,b as Oe}from"./list-b0a0d32c.js";import{d as We,aA as Pe,e as Xe,s as pe,r as D,u as je,f as Je,K as Ye,L as Ze,D as et,M as tt,aB as st,af as ot,aC as nt,N as lt,w as at,O as it,P as b,Q as dt,R as ct,c as a,a as s,p as i,j as e,F as $,m,l as _,k as v,H as G,S as K,h as ut,t as r,J as N,T as _t,U as rt,x as pt,aD as mt,aE as ht,C as me,W as he,at as gt,o as l,v as vt,ax as O,z as ge,I as ft,aF as q,$ as ve,A as kt,B as bt,al as yt,aG as Ct,a2 as wt,a3 as $t,a0 as Tt,a1 as It,as as Vt,aH as St,aI as Dt,ad as At,am as Rt,a4 as zt,a5 as Et,a6 as Bt,_ as Ft}from"./index-e895cc69.js";import{_ as Mt,a as Ut}from"./grid-view-outline-rounded-955d2f66.js";import{_ as Nt}from"./sort-rounded-aafba70e.js";import{_ as qt}from"./upload-rounded-1d53d75a.js";import{_ as xt}from"./Breadcrumb-d0e8b352.js";import{u as Ht,a as Lt}from"./tags-916cb9c2.js";import"./vee-validate.esm-9c2411c6.js";const p=R=>(kt("data-v-4d2aa1ca"),R=R(),bt(),R),Qt={class:"v-toolbar"},Gt=p(()=>s("md-ripple",null,null,-1)),Kt=p(()=>s("md-ripple",null,null,-1)),Ot=p(()=>s("md-ripple",null,null,-1)),Wt=["onClick"],Pt=p(()=>s("md-ripple",null,null,-1)),Xt={class:"icon-button btn-sort"},jt=p(()=>s("md-ripple",null,null,-1)),Jt={class:"menu-items"},Yt=["onClick","selected"],Zt={slot:"headline"},es=["onClick"],ts=p(()=>s("md-ripple",null,null,-1)),ss={class:"filters"},os=["label"],ns={class:"form-label"},ls=["label","selected","onClick"],as={class:"buttons"},is=["onClick"],ds={key:0},cs={class:"form-check-label"},us=["checked","indeterminate"],_s={key:1,class:"image-container",style:{"margin-bottom":"24px"}},rs={class:"item"},ps=["checked","onClick"],ms=["src","onClick","onContextmenu"],hs={class:"duration"},gs={key:2,class:"table-responsive"},vs={class:"table"},fs=["checked","indeterminate"],ks=p(()=>s("th",null,"ID",-1)),bs=p(()=>s("th",null,null,-1)),ys=p(()=>s("th",null,null,-1)),Cs=["onClick"],ws=["checked"],$s=["src","onClick"],Ts={class:"nowrap"},Is={class:"action-btns"},Vs=["onClick"],Ss=p(()=>s("md-ripple",null,null,-1)),Ds=["onClick"],As=p(()=>s("md-ripple",null,null,-1)),Rs=["onClick"],zs=p(()=>s("md-ripple",null,null,-1)),Es={class:"nowrap"},Bs={key:0},Fs={colspan:"7"},Ms={class:"no-data-placeholder"},Us={key:3,class:"no-data-placeholder"},A=48,Ns=We({__name:"ImagesView",setup(R){var ce,ue;const fe=Pe(),d=Xe(),{imageSortBy:x}=pe(d),h=D([]),W=D(),{t:T}=je(),P=Je(),{app:X,urlTokenKey:H}=pe(P),f=Ye({text:"",tags:[]}),u=Ze.IMAGE,j=et().query,I=D(parseInt(((ce=j.page)==null?void 0:ce.toString())??"1")),y=D(tt(((ue=j.q)==null?void 0:ue.toString())??"")),V=D(""),{tags:z}=Ht(u,y,f,async t=>{V.value=_t(t),await rt(),Ie()}),{addToTags:ke}=Lt(u,h,z),{deleteItems:be,deleteItem:J}=st(),{allChecked:E,realAllChecked:B,selectRealAll:ye,allCheckedAlertVisible:Ce,clearSelection:F,toggleAllChecked:M,toggleItemChecked:U,toggleRow:Y,total:C,checked:L}=Qe(h),{downloadItems:we}=ot(H,u,h,F,"images.zip"),{downloadFile:Z}=yt(H),$e=Ct(),ee=nt(()=>h.value.map(t=>({src:O(t.fileId),name:q(t.path),duration:0,size:t.size,path:t.path,type:u,data:t})));function te(t){P.lightbox={sources:ee.value,index:t,visible:!0}}function se(t){wt($t,{type:u,tags:z.value,item:{key:t.id,title:t.title,size:t.size},selected:z.value.filter(n=>t.tags.some(w=>w.id===n.id))})}function Te(t,n){x.value=n,t.close()}const{loading:oe,load:Ie,refetch:Q}=lt({handle:async(t,n)=>{if(n)pt(T(n),"error");else if(t){const w=[];for(const S of t.images)w.push({...S,checked:!1,fileId:mt(H.value,S.path)});h.value=w,C.value=t.imageCount}},document:ht,variables:()=>({offset:(I.value-1)*A,limit:A,query:V.value,sortBy:x.value}),appApi:!0});function Ve(){me(d,`/images?page=${I.value}&q=${he(y.value)}`)}at(I,()=>{Ve()});function Se(t){f.tags.includes(t)?Tt(f.tags,n=>n.id===t.id):f.tags.push(t)}function De(){y.value=It(f),ne(),W.value.dismiss()}function ne(){me(d,`/images?q=${he(y.value)}`)}function Ae(){d.imageViewType==="grid"?d.imageViewType="list":d.imageViewType="grid"}function Re(){fe.push("/files"),Vt(St,{message:T("upload_images")})}function ze(t,n){t.preventDefault(),Dt({x:t.x,y:t.y,items:[{label:T("add_to_tags"),onClick:()=>{se(n)}},{label:T("download"),onClick:()=>{Z(n.path,q(n.path).replace(" ","-"))}},{label:T("delete"),onClick:()=>{J(u,n)}}]})}const le=t=>{t.type===u&&(F(),Q())},ae=t=>{t.type===u&&Q()},ie=t=>{t.type===u&&(F(),Q())},de=()=>{C.value--};return it(()=>{b.on("item_tags_updated",ae),b.on("items_tags_updated",le),b.on("media_item_deleted",de),b.on("media_items_deleted",ie)}),dt(()=>{b.off("item_tags_updated",ae),b.off("items_tags_updated",le),b.off("media_item_deleted",de),b.off("media_items_deleted",ie)}),(t,n)=>{const w=xt,S=At,_e=Rt,re=zt,Ee=qt,Be=Nt,Fe=gt,Me=Mt,Ue=Ut,Ne=Ge,qe=Ke,xe=Et,He=Bt,Le=Oe,g=ct("tooltip");return l(),a($,null,[s("div",Qt,[i(w,{current:()=>`${t.$t("page_title.images")} (${e(C)})`},null,8,["current"]),e(L)?(l(),a($,{key:0},[m((l(),a("button",{class:"icon-button",onClick:n[0]||(n[0]=_(o=>e(be)(e(u),h.value,e(B),V.value),["stop"]))},[Gt,i(S)])),[[g,t.$t("delete")]]),m((l(),a("button",{class:"icon-button",onClick:n[1]||(n[1]=_(o=>e(we)(e(B),V.value),["stop"]))},[Kt,i(_e)])),[[g,t.$t("download")]]),m((l(),a("button",{class:"icon-button",onClick:n[2]||(n[2]=_(o=>e(ke)(e(B),V.value),["stop"]))},[Ot,i(re)])),[[g,t.$t("add_to_tags")]])],64)):v("",!0),m((l(),a("button",{class:"icon-button",onClick:_(Re,["prevent"])},[Pt,i(Ee)],8,Wt)),[[g,t.$t("upload")]]),i(Fe,null,{content:G(o=>[s("div",Jt,[(l(!0),a($,null,N(e($e),k=>(l(),a("md-menu-item",{onClick:c=>Te(o,k.value),selected:k.value===e(x)},[s("div",Zt,r(t.$t(k.label)),1)],8,Yt))),256))])]),default:G(()=>[m((l(),a("button",Xt,[jt,i(Be)])),[[g,t.$t("sort")]])]),_:1}),m((l(),a("button",{class:"icon-button",onClick:_(Ae,["stop"])},[ts,e(d).imageViewType==="list"?(l(),K(Me,{key:0})):v("",!0),e(d).imageViewType==="grid"?(l(),K(Ue,{key:1})):v("",!0)],8,es)),[[g,t.$t(e(d).imageViewType==="list"?"view_as_grid":"view_as_list")]]),i(Ne,{ref_key:"searchInputRef",ref:W,modelValue:y.value,"onUpdate:modelValue":n[4]||(n[4]=o=>y.value=o),search:ne},{filters:G(()=>[s("div",ss,[m(s("md-outlined-text-field",{label:t.$t("keywords"),"onUpdate:modelValue":n[3]||(n[3]=o=>f.text=o),"keyup.enter":"applyAndDoSearch"},null,8,os),[[vt,f.text]]),s("label",ns,r(t.$t("tags")),1),s("md-chip-set",null,[(l(!0),a($,null,N(e(z),o=>(l(),a("md-filter-chip",{key:o.id,label:o.name,selected:f.tags.includes(o),onClick:k=>Se(o)},null,8,ls))),128))]),s("div",as,[s("md-filled-button",{onClick:_(De,["stop"])},r(t.$t("search")),9,is)])])]),_:1},8,["modelValue"])]),i(qe,{limit:A,total:e(C),"all-checked-alert-visible":e(Ce),"real-all-checked":e(B),"select-real-all":e(ye),"clear-selection":e(F)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),e(d).imageViewType==="grid"?(l(),a("div",ds,[s("label",cs,[s("md-checkbox",{"touch-target":"wrapper",onChange:n[5]||(n[5]=(...o)=>e(M)&&e(M)(...o)),checked:e(E),indeterminate:!e(E)&&e(L)},null,40,us),ut(r(t.$t("select_all")),1)])])):v("",!0),e(d).imageViewType==="grid"?(l(),a("div",_s,[(l(!0),a($,null,N(h.value,(o,k)=>(l(),a("div",rs,[s("md-checkbox",{class:"checkbox","touch-target":"wrapper",onChange:n[6]||(n[6]=(...c)=>e(U)&&e(U)(...c)),checked:o.checked,onClick:_(c=>e(Y)(o),["stop"])},null,40,ps),s("img",{class:"image",src:e(O)(o.fileId,"&w=200&h=200"),onClick:c=>te(k),onContextmenu:c=>ze(c,o)},null,40,ms),s("span",hs,r(e(ge)(o.size)),1)]))),256))])):v("",!0),e(d).imageViewType==="list"?(l(),a("div",gs,[s("table",vs,[s("thead",null,[s("tr",null,[s("th",null,[s("md-checkbox",{"touch-target":"wrapper",onChange:n[7]||(n[7]=(...o)=>e(M)&&e(M)(...o)),checked:e(E),indeterminate:!e(E)&&e(L)},null,40,fs)]),ks,bs,s("th",null,r(t.$t("name")),1),ys,s("th",null,r(t.$t("tags")),1),s("th",null,r(t.$t("file_size")),1)])]),s("tbody",null,[(l(!0),a($,null,N(h.value,(o,k)=>(l(),a("tr",{key:o.id,class:ft({selected:o.checked}),onClick:_(c=>e(Y)(o),["stop"])},[s("td",null,[s("md-checkbox",{"touch-target":"wrapper",onChange:n[8]||(n[8]=(...c)=>e(U)&&e(U)(...c)),checked:o.checked},null,40,ws)]),s("td",null,[i(xe,{id:o.id,raw:o},null,8,["id","raw"])]),s("td",null,[s("img",{src:e(O)(o.fileId,"&w=200&h=200"),width:"50",height:"50",onClick:_(c=>te(k),["stop"]),style:{cursor:"pointer"}},null,8,$s)]),s("td",null,r(e(q)(o.path)),1),s("td",Ts,[s("div",Is,[m((l(),a("button",{class:"icon-button",onClick:_(c=>e(J)(e(u),o),["stop"])},[Ss,i(S)],8,Vs)),[[g,t.$t("delete")]]),m((l(),a("button",{class:"icon-button",onClick:_(c=>e(Z)(o.path,e(q)(o.path).replace(" ","-")),["stop"])},[As,i(_e)],8,Ds)),[[g,t.$t("download")]]),m((l(),a("button",{class:"icon-button",onClick:_(c=>se(o),["stop"])},[zs,i(re)],8,Rs)),[[g,t.$t("add_to_tags")]])])]),s("td",null,[i(He,{tags:o.tags,type:e(u)},null,8,["tags","type"])]),s("td",Es,r(e(ge)(o.size)),1)],10,Cs))),128))]),h.value.length?v("",!0):(l(),a("tfoot",Bs,[s("tr",null,[s("td",Fs,[s("div",Ms,r(t.$t(e(ve)(e(oe),e(X).permissions,"WRITE_EXTERNAL_STORAGE"))),1)])])]))])])):v("",!0),e(d).imageViewType==="grid"&&ee.value.length===0?(l(),a("div",Us,r(t.$t(e(ve)(e(oe),e(X).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):v("",!0),e(C)>A?(l(),K(Le,{key:4,modelValue:I.value,"onUpdate:modelValue":n[9]||(n[9]=o=>I.value=o),total:e(C),limit:A},null,8,["modelValue","total"])):v("",!0)],64)}}});const Ps=Ft(Ns,[["__scopeId","data-v-4d2aa1ca"]]);export{Ps as default};
