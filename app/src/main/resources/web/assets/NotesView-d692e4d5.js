import{u as ve,_ as fe,a as ge,b as ke}from"./list-002e9cb7.js";import{o as l,c as a,a as t,d as be,e as $e,r as f,u as ye,L as Te,M as Ce,E as qe,N as we,O as Ve,w as Se,i as Ae,Q as g,P as De,R as Me,S as Ie,q as d,k as s,F as C,n as k,m as r,l as A,t as i,I as Ne,K as O,T as Be,U as Qe,V as Ue,y as P,aW as Re,aX as Le,D as X,X as j,v as Ze,J as He,$ as J,a0 as ze,a3 as Ee,a4 as Fe,a1 as Ge,a2 as Ke,aY as W,a5 as Oe,a7 as Pe}from"./index-2583f876.js";import{_ as Xe}from"./Breadcrumb-ef080890.js";import{u as je,a as Je}from"./tags-7ff9be78.js";import"./vee-validate.esm-b0601c3b.js";const We={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Ye=t("path",{fill:"currentColor",d:"M7 21q-.825 0-1.413-.588T5 19V6q-.425 0-.713-.288T4 5q0-.425.288-.713T5 4h4q0-.425.288-.713T10 3h4q.425 0 .713.288T15 4h4q.425 0 .713.288T20 5q0 .425-.288.713T19 6v13q0 .825-.588 1.413T17 21H7ZM7 6v13h10V6H7Zm2 10q0 .425.288.713T10 17q.425 0 .713-.288T11 16V9q0-.425-.288-.713T10 8q-.425 0-.713.288T9 9v7Zm4 0q0 .425.288.713T14 17q.425 0 .713-.288T15 16V9q0-.425-.288-.713T14 8q-.425 0-.713.288T13 9v7ZM7 6v13V6Z"},null,-1),xe=[Ye];function et(Y,q){return l(),a("svg",We,xe)}const tt={name:"material-symbols-delete-outline-rounded",render:et},st={class:"v-toolbar"},ot=["onClick"],nt=t("md-ripple",null,null,-1),lt=t("md-ripple",null,null,-1),at=["onClick"],it={class:"filters"},ct=["label"],dt={class:"form-label"},rt=["label","selected","onClick"],ut={class:"buttons"},_t=["onClick"],pt={class:"table-responsive"},ht={class:"table"},mt=["checked","indeterminate"],vt=t("th",null,null,-1),ft=["onClick"],gt=["checked"],kt={style:{"min-width":"200px"}},bt=["onClick"],$t={class:"nowrap"},yt={class:"action-btns"},Tt=["onClick"],Ct=t("md-ripple",null,null,-1),qt=["onClick"],wt=t("md-ripple",null,null,-1),Vt={class:"nowrap"},St={class:"nowrap"},At={key:0},Dt={colspan:"6"},Mt={class:"no-data-placeholder"},b=50,Lt=be({__name:"NotesView",setup(Y){var E,F;const q=$e(),u=f([]),D=f(),{t:M}=ye(),c=Te({text:"",tags:[]}),_=Ce.NOTE,I=qe().query,$=f(parseInt(((E=I.page)==null?void 0:E.toString())??"1")),p=f(we(((F=I.q)==null?void 0:F.toString())??"")),w=f(""),{tags:y}=je(_,p,c,async e=>{e.push({name:"trash",op:"",value:"false"}),w.value=Qe(e),await Ue(),ne()}),{addToTags:x}=Je(_,u,y),{allChecked:N,realAllChecked:B,selectRealAll:ee,allCheckedAlertVisible:te,clearSelection:V,toggleAllChecked:Q,toggleItemChecked:U,toggleRow:se,total:m,checked:R}=ve(u),{loading:oe,load:ne,refetch:S}=Ve({handle:(e,n)=>{n?P(M(n),"error"):e&&(u.value=e.notes.map(v=>({...v,checked:!1})),m.value=e.noteCount)},document:Re,variables:()=>({offset:($.value-1)*b,limit:b,query:w.value}),appApi:!0});function le(e){Ee(Fe,{type:_,tags:y.value,item:{key:e.id,title:"",size:0},selected:y.value.filter(n=>e.tags.some(v=>v.id===n.id))})}Se($,e=>{X(q,`/notes?page=${e}&q=${j(p.value)}`)});const{mutate:L,onDone:ae}=Ae({document:Le,appApi:!0});function ie(){const e=u.value.filter(n=>n.checked);if(e.length===0){P(M("select_first"),"error");return}L({query:`ids:${e.map(n=>n.id).join(",")}`})}ae(()=>{V(),S(),u.value.some(e=>e.tags.length)&&g.emit("refetch_tags",_)});function ce(e){c.tags.includes(e)?Ge(c.tags,n=>n.id===e.id):c.tags.push(e)}function de(){p.value=Ke(c),Z(),D.value.dismiss()}function Z(){X(q,`/notes?q=${j(p.value)}`)}const H=e=>{e.type===_&&(V(),S())},z=e=>{e.type===_&&S()};De(()=>{g.on("item_tags_updated",z),g.on("items_tags_updated",H)}),Me(()=>{g.off("item_tags_updated",z),g.off("items_tags_updated",H)});function re(e){W.push(`/notes/${e.id}`)}function ue(){W.push("/notes/create")}return(e,n)=>{const v=Xe,G=tt,K=Oe,_e=fe,pe=ge,he=Pe,me=ke,T=Ie("tooltip");return l(),a(C,null,[t("div",st,[d(v,{current:()=>`${e.$t("page_title.notes")} (${s(m)})`},null,8,["current"]),s(R)?(l(),a(C,{key:0},[k((l(),a("button",{class:"icon-button",onClick:r(ie,["stop"])},[nt,d(G)],8,ot)),[[T,e.$t("move_to_trash")]]),k((l(),a("button",{class:"icon-button",onClick:n[0]||(n[0]=r(o=>s(x)(s(B),w.value),["stop"]))},[lt,d(K)])),[[T,e.$t("add_to_tags")]])],64)):A("",!0),t("md-outlined-button",{onClick:r(ue,["prevent"])},i(e.$t("create")),9,at),d(_e,{ref_key:"searchInputRef",ref:D,modelValue:p.value,"onUpdate:modelValue":n[2]||(n[2]=o=>p.value=o),search:Z},{filters:Ne(()=>[t("div",it,[k(t("md-outlined-text-field",{label:e.$t("keywords"),"onUpdate:modelValue":n[1]||(n[1]=o=>c.text=o),"keyup.enter":"applyAndDoSearch"},null,8,ct),[[Ze,c.text]]),t("label",dt,i(e.$t("tags")),1),t("md-chip-set",null,[(l(!0),a(C,null,O(s(y),o=>(l(),a("md-filter-chip",{key:o.id,label:o.name,selected:c.tags.includes(o),onClick:h=>ce(o)},null,8,rt))),128))]),t("div",ut,[t("md-filled-button",{onClick:r(de,["stop"])},i(e.$t("search")),9,_t)])])]),_:1},8,["modelValue"])]),d(pe,{limit:b,total:s(m),"all-checked-alert-visible":s(te),"real-all-checked":s(B),"select-real-all":s(ee),"clear-selection":s(V)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),t("div",pt,[t("table",ht,[t("thead",null,[t("tr",null,[t("th",null,[t("md-checkbox",{"touch-target":"wrapper",onChange:n[3]||(n[3]=(...o)=>s(Q)&&s(Q)(...o)),checked:s(N),indeterminate:!s(N)&&s(R)},null,40,mt)]),t("th",null,i(e.$t("title")),1),vt,t("th",null,i(e.$t("tags")),1),t("th",null,i(e.$t("updated_at")),1),t("th",null,i(e.$t("created_at")),1)])]),t("tbody",null,[(l(!0),a(C,null,O(u.value,o=>(l(),a("tr",{key:o.id,class:He({selected:o.checked}),onClick:r(h=>s(se)(o),["stop"])},[t("td",null,[t("md-checkbox",{"touch-target":"wrapper",onChange:n[4]||(n[4]=(...h)=>s(U)&&s(U)(...h)),checked:o.checked},null,40,gt)]),t("td",kt,[t("a",{style:{"text-overflow":"clip"},href:"#",onClick:r(h=>re(o),["stop","prevent"])},i(o.title.split(`
`)[0].trimStart()||e.$t("meta_no_title")),9,bt)]),t("td",$t,[t("div",yt,[k((l(),a("button",{class:"icon-button",onClick:r(h=>s(L)({query:`ids:${o.id}`}),["stop"])},[Ct,d(G)],8,Tt)),[[T,e.$t("move_to_trash")]]),k((l(),a("button",{class:"icon-button",onClick:r(h=>le(o),["stop"])},[wt,d(K)],8,qt)),[[T,e.$t("add_to_tags")]])])]),t("td",null,[d(he,{tags:o.tags,type:s(_)},null,8,["tags","type"])]),t("td",Vt,i(s(J)(o.updatedAt)),1),t("td",St,i(s(J)(o.createdAt)),1)],10,ft))),128))]),u.value.length?A("",!0):(l(),a("tfoot",At,[t("tr",null,[t("td",Dt,[t("div",Mt,i(e.$t(s(ze)(s(oe)))),1)])])]))])]),s(m)>b?(l(),Be(me,{key:0,modelValue:$.value,"onUpdate:modelValue":n[5]||(n[5]=o=>$.value=o),total:s(m),limit:b},null,8,["modelValue","total"])):A("",!0)],64)}}});export{Lt as default};
