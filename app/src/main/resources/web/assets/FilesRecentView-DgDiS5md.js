import{d as ce,g as ie,h as m,i as de,s as re,j as ue,K as _e,L as pe,M as he,c as a,a as o,m as s,t as i,x as g,w as _,p as h,e as f,O,P as ve,v as ke,q as D,ap as me,by as ge,C as fe,bw as ye,bH as be,S as we,o as n,N as Ee,aA as Ce,E as De,U as Ie,V as Se,W as Te,bc as Le,X as Ve,Y as Ae,bC as $e,ai as Fe,bD as xe,bA as Ne,a1 as y,aq as Ue,a3 as Be,bE as Ke,am as Me,bF as ze,bG as Oe}from"./index-Dn0O6zoH.js";import{_ as R}from"./default-BQXvEOng.js";import{u as Re,c as Ge}from"./key-events-CgPzNP0J.js";const He={class:"top-app-bar"},Pe=["checked","indeterminate"],Qe={key:0},qe={key:1},We=o("md-ripple",null,null,-1),Xe={key:0,class:"scroller"},je={class:"start"},Je=o("div",{class:"checkbox"},[o("div",{class:"skeleton-checkbox"})],-1),Ye={class:"number"},Ze=Ae('<div class="image"><div class="skeleton-image"></div></div><div class="title"><div class="skeleton-text skeleton-title"></div></div><div class="subtitle"><div class="skeleton-text skeleton-subtitle"></div></div><div class="actions"><div class="skeleton-text skeleton-actions"></div></div>',4),es=["onClick","onMouseover"],ss={class:"start"},ts=["onClick","checked"],os=["onClick","checked"],ns={class:"number"},as=["onClick"],ls={key:0,class:"svg",src:R},cs=["src","onError"],is=["src","onError"],ds={key:3,class:"svg",src:R},rs={class:"title"},us={class:"subtitle"},_s={class:"actions"},ps=["onClick"],hs=o("md-ripple",null,null,-1),vs={class:"btn-icon sm"},ks=o("md-ripple",null,null,-1),ms={class:"card card-info"},gs={class:"key-value vertical"},fs={class:"key"},ys={class:"value"},bs={key:2,class:"no-data-placeholder"},Is=ce({__name:"FilesRecentView",setup(ws){const{t:G}=ie(),H=m([]),I=de(),{app:P,urlTokenKey:b}=re(I),r=m([]),{selectedIds:p,allChecked:S,realAllChecked:Q,clearSelection:w,toggleAllChecked:T,toggleSelect:L,total:v,checked:V,shiftEffectingIds:A,handleItemClick:q,handleMouseOver:W,selectAll:X,shouldSelect:j}=Re(r),{downloadFile:$,downloadFiles:J}=me(b),{view:Y}=ze(H,(e,d)=>{I.lightbox={sources:e,index:d,visible:!0}}),{keyDown:F,keyUp:x}=Ge(v,X,w,()=>{}),N=m([]),U=m([]),Z=e=>{N.value.push(e)},ee=e=>{U.value.push(e)},{mutate:se,onDone:te}=ue({document:ge,appApi:!0});te(e=>{J(e.data.setTempValue.key),w()});const B=e=>{$e(e.name)?window.open(Fe(b.value,e.path),"_blank"):xe(e.name)?Y(r.value,e):$(e.path)},{loading:E,fetch:K}=_e({handle:async(e,d)=>{if(d)fe(G(d),"error");else{const u=[];for(const C of e.recentFiles)u.push(ye(C,b.value));r.value=u,v.value=u.length}},document:be,appApi:!0}),oe=()=>{se({key:Ne(),value:JSON.stringify(p.value.map(e=>({path:e})))})},M=e=>{e.status==="done"&&setTimeout(()=>{K()},1e3)},ne=e=>{e.forEach(d=>{Oe(r.value,u=>u.id===d.id)}),w()},z=e=>{ne([e.item])};return pe(()=>{K(),y.on("upload_task_done",M),y.on("file_deleted",z),window.addEventListener("keydown",F),window.addEventListener("keyup",x)}),he(()=>{y.off("upload_task_done",M),y.off("file_deleted",z),window.removeEventListener("keydown",F),window.removeEventListener("keyup",x)}),(e,d)=>{const u=Ue,C=Be,ae=Ke,le=Me,k=we("tooltip");return n(),a(O,null,[o("div",He,[o("md-checkbox",{"touch-target":"wrapper",onChange:d[0]||(d[0]=(...c)=>s(T)&&s(T)(...c)),checked:s(S),indeterminate:!s(S)&&s(V)},null,40,Pe),s(p).length?(n(),a("span",Qe,i(e.$t("x_selected",{count:s(Q)?s(v).toLocaleString():s(p).length.toLocaleString()})),1)):(n(),a("span",qe,i(e.$t("recent_files"))+" ("+i(s(v).toLocaleString())+")",1)),s(V)?g((n(),a("button",{key:2,class:"btn-icon",onClick:_(oe,["stop"])},[We,h(u)])),[[k,e.$t("download")]]):f("",!0)]),s(E)&&r.value.length===0?(n(),a("div",Xe,[(n(),a(O,null,ve(20,c=>o("section",{class:"file-item selectable-card-skeleton",key:c},[o("div",je,[Je,o("span",Ye,i(c),1)]),Ze])),64))])):f("",!0),r.value.length>0?(n(),ke(s(Le),{key:1,class:"scroller","data-key":"id","data-sources":r.value,"estimate-size":80},{item:D(({index:c,item:t})=>[(n(),a("section",{class:Ee(["file-item selectable-card",{selected:s(p).includes(t.id),selecting:s(A).includes(t.id)}]),key:t.id,onClick:_(l=>s(q)(l,t,c,()=>{B(t)}),["stop"]),onMouseover:l=>s(W)(l,c)},[o("div",ss,[s(A).includes(t.id)?(n(),a("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",onClick:_(l=>s(L)(l,t,c),["stop"]),checked:s(j)},null,8,ts)):(n(),a("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",onClick:_(l=>s(L)(l,t,c),["stop"]),checked:s(p).includes(t.id)},null,8,os)),o("span",ns,[h(C,{id:c+1,raw:t},null,8,["id","raw"])])]),o("div",{class:"image",onClick:_(l=>B(t),["stop"])},[U.value.includes(t.id)?(n(),a("img",ls)):!N.value.includes(t.id)&&t.fileId?(n(),a("img",{key:1,class:"image-thumb",src:s(Ce)(t.fileId,"&w=50&h=50"),onError:l=>Z(t.id)},null,40,cs)):t.extension?(n(),a("img",{key:2,src:`/ficons/${t.extension}.svg`,class:"svg",onError:l=>ee(t.id)},null,40,is)):(n(),a("img",ds))],8,as),o("div",rs,i(t.name),1),o("div",us,[o("span",null,i(s(De)(t.size)),1),g((n(),a("span",null,[Se(i(s(Te)(t.updatedAt)),1)])),[[k,s(Ie)(t.updatedAt)]])]),o("div",_s,[g((n(),a("button",{class:"btn-icon sm",onClick:_(l=>s($)(t.path),["stop"])},[hs,h(u)],8,ps)),[[k,e.$t("download")]]),h(le,null,{content:D(l=>[o("section",ms,[o("div",gs,[o("div",fs,i(e.$t("path")),1),o("div",ys,i(t.path),1)])])]),default:D(()=>[g((n(),a("button",vs,[ks,h(ae)])),[[k,e.$t("info")]])]),_:2},1024)])],42,es))]),_:1},8,["data-sources"])):f("",!0),!s(E)&&r.value.length===0?(n(),a("div",bs,i(e.$t(s(Ve)(s(E),s(P).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):f("",!0)],64)}}});export{Is as default};
