import{_ as Pe}from"./VPagination.vuevuetypescriptsetuptruelang-CFupeDJR.js";import{a1 as F,d as Ve,s as W,i as xe,ag as Fe,u as Me,h as V,g as Te,I as Ke,ah as Ne,J as Qe,K as Z,j as ze,L as Ge,M as Re,c as l,a,m as t,t as i,x as k,w as r,p as _,e as $,V as S,q as ee,N as te,O as w,P as x,v as je,Q as He,f as Oe,C as Je,ai as Xe,aj as Ye,ak as We,al as Ze,am as et,S as tt,o,E as st,an as se,U as ae,X as at,F as nt,G as ot,Y as lt,ao as it,ap as ct,a0 as dt,aq as pt,a3 as ut,ae as rt,H as _t}from"./index-Dn0O6zoH.js";import{_ as vt,a as ht}from"./SearchInput-aem6tEJK.js";import{_ as kt}from"./sort-rounded-BSs7VajO.js";import{u as mt,a as gt}from"./key-events-CgPzNP0J.js";import{u as ft}from"./search-DrT1IjAg.js";import"./search-rounded-C8Nl_ZR1.js";import"./rss-feed-rounded-Dqku7i1k.js";const ne=p=>{F.emit("tap_phone",p)};function yt(p,I){const m=p.findIndex(A=>A.id===I);m!==-1&&p.splice(m,1)}const f=p=>(nt("data-v-e16c47d6"),p=p(),ot(),p),bt={class:"top-app-bar"},wt=["checked","indeterminate"],Ct={class:"title"},$t={key:0},St={key:1},It=f(()=>a("md-ripple",null,null,-1)),At={class:"actions"},Dt=f(()=>a("md-ripple",null,null,-1)),Lt={class:"btn-icon btn-sort"},Ut=f(()=>a("md-ripple",null,null,-1)),qt={class:"menu-items"},Bt=["onClick","selected"],Et={slot:"headline"},Pt={class:"scroll-content"},Vt=["onClick","onMouseover"],xt={class:"start"},Ft=["onClick","checked"],Mt=["onClick","checked"],Tt={class:"number"},Kt=["src"],Nt={class:"title"},Qt={class:"subtitle"},zt={class:"actions"},Gt={indeterminate:"",class:"spinner-sm"},Rt=["onClick"],jt=["onClick"],Ht=f(()=>a("md-ripple",null,null,-1)),Ot=["onClick"],Jt=f(()=>a("md-ripple",null,null,-1)),Xt={class:"time"},Yt={class:"start"},Wt=f(()=>a("div",{class:"checkbox"},[a("div",{class:"skeleton-checkbox"})],-1)),Zt={class:"number"},es=lt('<div class="image" data-v-e16c47d6><div class="skeleton-image" data-v-e16c47d6></div></div><div class="title" data-v-e16c47d6><div class="skeleton-text skeleton-title" data-v-e16c47d6></div></div><div class="subtitle" data-v-e16c47d6><div class="skeleton-text skeleton-subtitle" data-v-e16c47d6></div></div><div class="actions" data-v-e16c47d6><div class="skeleton-text skeleton-actions" data-v-e16c47d6></div></div><div class="time" data-v-e16c47d6><div class="skeleton-text skeleton-time" data-v-e16c47d6></div><div class="skeleton-text skeleton-time" data-v-e16c47d6></div></div>',5),ts={key:0,class:"no-data-placeholder"},g=50,ss=Ve({__name:"AppsView",setup(p){var Y;const{app:I,urlTokenKey:m,uploads:A}=W(xe()),{input:oe,upload:le,uploadChanged:M}=Fe(A),T=Me(),u=V([]),{t:D}=Te(),{appSortBy:L}=W(T),{parseQ:ie}=ft(),K=Ke({tagIds:[]}),ce=it(),N=He(),Q=N.query,U=V(parseInt(((Y=Q.page)==null?void 0:Y.toString())??"1")),C=V(""),{selectedIds:y,allChecked:z,realAllChecked:q,selectRealAll:de,allCheckedAlertVisible:pe,clearSelection:B,toggleAllChecked:G,toggleSelect:R,total:v,checked:E,shiftEffectingIds:j,handleItemClick:ue,handleMouseOver:re,selectAll:_e,shouldSelect:ve}=mt(u),{downloadItems:he}=Ne(m,Qe.PACKAGE,B,"apps.zip"),{downloadFile:ke}=ct(m),H=e=>{const n=N.query.q;Oe(T,n?`/apps?page=${e}&q=${n}`:`/apps?page=${e}`)},{keyDown:O,keyUp:J}=gt(v,g,U,_e,B,H,()=>{}),me=()=>{le(I.value.downloadsDir)},ge=["user","system"].map(e=>({id:e,name:D("app_type."+e)})),fe=e=>{e.isUninstalling=!1},{loading:P,fetch:ye}=Z({handle:(e,n)=>{n?Je(D(n),"error"):e&&(u.value=e.packages.map(b=>({...b,isUninstalling:!1,icon:Xe(m.value,"pkgicon://"+b.id)})),v.value=e.packageCount)},document:Ye,variables:()=>({offset:(U.value-1)*g,limit:g,query:C.value,sortBy:L.value}),appApi:!0});function be(e){return e?`/apps?q=${e}`:"/apps"}function we(e,n){L.value=n,e.close()}const{mutate:Ce}=ze({document:We,appApi:!0});function $e(e){e.isUninstalling=!0,ne(D("confirm_uninstallation_on_phone")),Ce({id:e.id})}const{loading:Se,fetch:Ie}=Z({handle:e=>{if(e)for(const n of e.packageStatuses)n.exist||(yt(u.value,n.id),ne(""))},document:Ze,variables:()=>({ids:u.value.filter(e=>e.isUninstalling).map(e=>e.id)}),appApi:!0}),X=e=>{e.status};return Ge(()=>{var e;setInterval(()=>{u.value.some(n=>n.isUninstalling)&&!Se.value&&Ie()},1e3),C.value=dt(((e=Q.q)==null?void 0:e.toString())??""),ie(K,C.value),ye(),F.on("upload_task_done",X),window.addEventListener("keydown",O),window.addEventListener("keyup",J)}),Re(()=>{F.off("upload_task_done",X),window.removeEventListener("keydown",O),window.removeEventListener("keyup",J)}),(e,n)=>{const b=pt,Ae=vt,De=kt,Le=et,Ue=ht,qe=ut,Be=rt,Ee=Pe,h=tt("tooltip");return o(),l(w,null,[a("div",bt,[a("md-checkbox",{"touch-target":"wrapper",onChange:n[0]||(n[0]=(...s)=>t(G)&&t(G)(...s)),checked:t(z),indeterminate:!t(z)&&t(E)},null,40,wt),a("div",Ct,[t(y).length?(o(),l("span",$t,i(e.$t("x_selected",{count:t(q)?t(v).toLocaleString():t(y).length.toLocaleString()})),1)):(o(),l("span",St,i(e.$t("page_title.apps"))+" ("+i(t(v).toLocaleString())+")",1)),t(E)?k((o(),l("button",{key:2,class:"btn-icon",onClick:n[1]||(n[1]=r(s=>t(he)(t(q),t(y),C.value),["stop"]))},[It,_(b)])),[[h,e.$t("download")]]):$("",!0)]),a("div",At,[_(Ae,{filter:K,types:t(ge),"get-url":be},null,8,["filter","types"]),a("button",{class:"btn-icon",onClick:r(me,["stop"]),style:{display:"none"}},[Dt,S(" "+i(e.$t("install")),1)]),_(Le,null,{content:ee(s=>[a("div",qt,[(o(!0),l(w,null,x(t(ce),d=>(o(),l("md-menu-item",{onClick:c=>we(s,d.value),key:d.value,selected:d.value===t(L)},[a("div",Et,i(e.$t(d.label)),1)],8,Bt))),128))])]),default:ee(()=>[k((o(),l("button",Lt,[Ut,_(De)])),[[h,e.$t("sort")]])]),_:1})])]),_(Ue,{limit:g,total:t(v),"all-checked-alert-visible":t(pe),"real-all-checked":t(q),"select-real-all":t(de),"clear-selection":t(B)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),a("div",Pt,[a("div",{class:te(["app-list",{"select-mode":t(E)}])},[(o(!0),l(w,null,x(u.value,(s,d)=>(o(),l("section",{class:te(["app-item selectable-card",{selected:t(y).includes(s.id),selecting:t(j).includes(s.id)}]),key:s.id,onClick:r(c=>t(ue)(c,s,d,()=>{}),["stop"]),onMouseover:c=>t(re)(c,d)},[a("div",xt,[t(j).includes(s.id)?(o(),l("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",onClick:r(c=>t(R)(c,s,d),["stop"]),checked:t(ve)},null,8,Ft)):(o(),l("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",onClick:r(c=>t(R)(c,s,d),["stop"]),checked:t(y).includes(s.id)},null,8,Mt)),a("span",Tt,[_(qe,{id:d+1,raw:s},null,8,["id","raw"])])]),a("img",{class:"image",width:"50",height:"50",src:s.icon},null,8,Kt),a("div",Nt,i(s.name)+" ("+i(s.version)+")",1),a("div",Qt,[a("span",null,i(s.id),1),a("span",null,i(t(st)(s.size)),1),a("span",null,i(e.$t("app_type."+s.type)),1)]),a("div",zt,[s.isUninstalling?(o(),l(w,{key:0},[k(a("md-circular-progress",Gt,null,512),[[h,e.$t("uninstalling")]]),S(" Â "),a("md-outlined-button",{class:"btn-sm",onClick:r(c=>fe(s),["stop"])},i(e.$t("cancel")),9,Rt)],64)):k((o(),l("button",{key:1,class:"btn-icon sm",onClick:r(c=>$e(s),["stop"])},[Ht,_(Be)],8,jt)),[[h,e.$t("uninstall")]]),k((o(),l("button",{class:"btn-icon sm",onClick:r(c=>t(ke)(s.path,`${s.name.replace(" ","")}-${s.id}.apk`),["stop"])},[Jt,_(b)],8,Ot)),[[h,e.$t("download")]])]),a("div",Xt,[k((o(),l("span",null,[S(i(e.$t("installed_at"))+": "+i(t(ae)(s.installedAt)),1)])),[[h,t(se)(s.installedAt)]]),k((o(),l("span",null,[S(i(e.$t("updated_at"))+": "+i(t(ae)(s.updatedAt)),1)])),[[h,t(se)(s.updatedAt)]])])],42,Vt))),128)),t(P)&&u.value.length===0?(o(),l(w,{key:0},x(20,s=>a("section",{class:"app-item selectable-card-skeleton",key:s},[a("div",Yt,[Wt,a("span",Zt,i(s),1)]),es])),64)):$("",!0)],2),!t(P)&&u.value.length===0?(o(),l("div",ts,i(e.$t(t(at)(t(P)))),1)):$("",!0),t(v)>g?(o(),je(Ee,{key:1,page:U.value,go:H,total:t(v),limit:g},null,8,["page","total"])):$("",!0),a("input",{ref_key:"fileInput",ref:oe,style:{display:"none"},type:"file",accept:".apk",multiple:"",onChange:n[2]||(n[2]=(...s)=>t(M)&&t(M)(...s))},null,544)])],64)}}}),us=_t(ss,[["__scopeId","data-v-e16c47d6"]]);export{us as default};
