import{u as Qe,_ as Ge,a as Oe,b as Ke}from"./list-b0a0d32c.js";import{d as We,aA as Je,e as Pe,s as pe,r as D,u as Xe,f as je,K as Ye,L as Ze,D as et,M as tt,aB as ot,af as st,aC as nt,N as lt,w as at,O as it,P as b,Q as dt,R as ct,c as a,a as o,p as i,j as e,F as $,m,l as _,k as g,H as Q,S as G,h as ut,t as d,J as N,T as rt,U as _t,x as pt,aD as mt,aJ as ht,C as me,W as he,at as vt,o as l,v as gt,ax as O,a9 as ve,$ as ge,I as kt,aF as K,z as ft,A as bt,B as yt,al as Ct,aG as wt,a0 as $t,a2 as Tt,a3 as It,a1 as Vt,as as St,aH as Dt,aI as At,ad as Rt,am as zt,a4 as Bt,a5 as Et,a6 as Ft,_ as Ut}from"./index-e895cc69.js";import{_ as Mt,a as Nt}from"./grid-view-outline-rounded-955d2f66.js";import{_ as qt}from"./sort-rounded-aafba70e.js";import{_ as xt}from"./upload-rounded-1d53d75a.js";import{_ as Ht}from"./Breadcrumb-d0e8b352.js";import{u as Lt,a as Qt}from"./tags-916cb9c2.js";import"./vee-validate.esm-9c2411c6.js";const p=R=>(bt("data-v-ecb9908a"),R=R(),yt(),R),Gt={class:"v-toolbar"},Ot=p(()=>o("md-ripple",null,null,-1)),Kt=p(()=>o("md-ripple",null,null,-1)),Wt=p(()=>o("md-ripple",null,null,-1)),Jt=["onClick"],Pt=p(()=>o("md-ripple",null,null,-1)),Xt={class:"icon-button btn-sort"},jt=p(()=>o("md-ripple",null,null,-1)),Yt={class:"menu-items"},Zt=["onClick","selected"],eo={slot:"headline"},to=["onClick"],oo=p(()=>o("md-ripple",null,null,-1)),so={class:"filters"},no=["label"],lo={class:"form-label"},ao=["label","selected","onClick"],io={class:"buttons"},co=["onClick"],uo={key:0},ro={class:"form-check-label"},_o=["checked","indeterminate"],po={key:1,class:"image-container",style:{"margin-bottom":"24px"}},mo={class:"item"},ho=["checked","onClick"],vo=["src","onClick","onContextmenu"],go={class:"duration"},ko={key:2,class:"no-data-placeholder"},fo={key:3,class:"table-responsive"},bo={class:"table"},yo=["checked","indeterminate"],Co=p(()=>o("th",null,"ID",-1)),wo=p(()=>o("th",null,null,-1)),$o=p(()=>o("th",null,null,-1)),To=["onClick"],Io=["checked"],Vo=["src","onClick"],So={class:"nowrap"},Do={class:"action-btns"},Ao=["onClick"],Ro=p(()=>o("md-ripple",null,null,-1)),zo=["onClick"],Bo=p(()=>o("md-ripple",null,null,-1)),Eo=["onClick"],Fo=p(()=>o("md-ripple",null,null,-1)),Uo={class:"nowrap"},Mo={class:"nowrap"},No={key:0},qo={colspan:"8"},xo={class:"no-data-placeholder"},A=48,Ho=We({__name:"VideosView",setup(R){var ce,ue;const ke=Je(),c=Pe(),{videoSortBy:q}=pe(c),h=D([]),W=D(),{t:T}=Xe(),J=je(),{app:P,urlTokenKey:x}=pe(J),k=Ye({text:"",tags:[]}),r=Ze.VIDEO,X=et().query,I=D(parseInt(((ce=X.page)==null?void 0:ce.toString())??"1")),y=D(tt(((ue=X.q)==null?void 0:ue.toString())??"")),V=D(""),{tags:z}=Lt(r,y,k,async t=>{V.value=rt(t),await _t(),Te()}),{addToTags:fe}=Qt(r,h,z),{deleteItems:be,deleteItem:j}=ot(),{allChecked:B,realAllChecked:E,selectRealAll:ye,allCheckedAlertVisible:Ce,clearSelection:F,toggleAllChecked:U,toggleItemChecked:M,toggleRow:Y,total:C,checked:H}=Qe(h),{downloadItems:we}=st(x,r,h,F,"videos.zip"),{downloadFile:Z}=Ct(x),$e=wt(),ee=nt(()=>h.value.map(t=>({src:O(t.fileId),name:K(t.path),duration:t.duration,size:t.size,path:t.path,data:t,type:r}))),{loading:te,load:Te,refetch:L}=lt({handle:async(t,n)=>{if(n)pt(T(n),"error");else if(t){const w=[];for(const S of t.videos)w.push({...S,checked:!1,fileId:mt(x.value,S.path)});h.value=w,C.value=t.videoCount}},document:ht,variables:()=>({offset:(I.value-1)*A,limit:A,query:V.value,sortBy:q.value}),appApi:!0});function Ie(){me(c,`/videos?page=${I.value}&q=${he(y.value)}`)}function oe(t){J.lightbox={sources:ee.value,index:t,visible:!0}}function Ve(t,n){q.value=n,t.close()}at(I,()=>{Ie()});function Se(t){k.tags.includes(t)?$t(k.tags,n=>n.id===t.id):k.tags.push(t)}function se(t){Tt(It,{type:r,tags:z.value,item:{key:t.id,title:t.title,size:t.size},selected:z.value.filter(n=>t.tags.some(w=>w.id===n.id))})}function De(){y.value=Vt(k),ne(),W.value.dismiss()}function ne(){me(c,`/videos?q=${he(y.value)}`)}function Ae(){c.videoViewType==="grid"?c.videoViewType="list":c.videoViewType="grid"}function Re(){ke.push("/files"),St(Dt,{message:T("upload_videos")})}function ze(t,n){t.preventDefault(),At({x:t.x,y:t.y,items:[{label:T("add_to_tags"),onClick:()=>{se(n)}},{label:T("download"),onClick:()=>{Z(n.path,K(n.path).replace(" ","-"))}},{label:T("delete"),onClick:()=>{j(r,n)}}]})}const le=t=>{t.type===r&&(F(),L())},ae=t=>{t.type===r&&L()},ie=t=>{t.type===r&&(F(),L())},de=()=>{C.value--};return it(()=>{b.on("item_tags_updated",ae),b.on("items_tags_updated",le),b.on("media_item_deleted",de),b.on("media_items_deleted",ie)}),dt(()=>{b.off("item_tags_updated",ae),b.off("items_tags_updated",le),b.off("media_item_deleted",de),b.off("media_items_deleted",ie)}),(t,n)=>{const w=Ht,S=Rt,re=zt,_e=Bt,Be=xt,Ee=qt,Fe=vt,Ue=Mt,Me=Nt,Ne=Ge,qe=Oe,xe=Et,He=Ft,Le=Ke,v=ct("tooltip");return l(),a($,null,[o("div",Gt,[i(w,{current:()=>`${t.$t("page_title.videos")} (${e(C)})`},null,8,["current"]),e(H)?(l(),a($,{key:0},[m((l(),a("button",{class:"icon-button",onClick:n[0]||(n[0]=_(s=>e(be)(e(r),h.value,e(E),V.value),["stop"]))},[Ot,i(S)])),[[v,t.$t("delete")]]),m((l(),a("button",{class:"icon-button",onClick:n[1]||(n[1]=_(s=>e(we)(e(E),V.value),["stop"]))},[Kt,i(re)])),[[v,t.$t("download")]]),m((l(),a("button",{class:"icon-button",onClick:n[2]||(n[2]=_(s=>e(fe)(e(E),V.value),["stop"]))},[Wt,i(_e)])),[[v,t.$t("add_to_tags")]])],64)):g("",!0),m((l(),a("button",{class:"icon-button",onClick:_(Re,["prevent"])},[Pt,i(Be)],8,Jt)),[[v,t.$t("upload")]]),i(Fe,null,{content:Q(s=>[o("div",Yt,[(l(!0),a($,null,N(e($e),f=>(l(),a("md-menu-item",{onClick:u=>Ve(s,f.value),selected:f.value===e(q)},[o("div",eo,d(t.$t(f.label)),1)],8,Zt))),256))])]),default:Q(()=>[m((l(),a("button",Xt,[jt,i(Ee)])),[[v,t.$t("sort")]])]),_:1}),m((l(),a("button",{class:"icon-button",onClick:_(Ae,["prevent"])},[oo,e(c).videoViewType==="list"?(l(),G(Ue,{key:0})):g("",!0),e(c).videoViewType==="grid"?(l(),G(Me,{key:1})):g("",!0)],8,to)),[[v,t.$t(e(c).videoViewType==="list"?"view_as_grid":"view_as_list")]]),i(Ne,{ref_key:"searchInputRef",ref:W,modelValue:y.value,"onUpdate:modelValue":n[4]||(n[4]=s=>y.value=s),search:ne},{filters:Q(()=>[o("div",so,[m(o("md-outlined-text-field",{label:t.$t("keywords"),"onUpdate:modelValue":n[3]||(n[3]=s=>k.text=s),"keyup.enter":"applyAndDoSearch"},null,8,no),[[gt,k.text]]),o("label",lo,d(t.$t("tags")),1),o("md-chip-set",null,[(l(!0),a($,null,N(e(z),s=>(l(),a("md-filter-chip",{key:s.id,label:s.name,selected:k.tags.includes(s),onClick:f=>Se(s)},null,8,ao))),128))]),o("div",io,[o("md-filled-button",{onClick:_(De,["stop"])},d(t.$t("search")),9,co)])])]),_:1},8,["modelValue"])]),i(qe,{limit:A,total:e(C),"all-checked-alert-visible":e(Ce),"real-all-checked":e(E),"select-real-all":e(ye),"clear-selection":e(F)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),e(c).videoViewType==="grid"?(l(),a("div",uo,[o("label",ro,[o("md-checkbox",{"touch-target":"wrapper",onChange:n[5]||(n[5]=(...s)=>e(U)&&e(U)(...s)),checked:e(B),indeterminate:!e(B)&&e(H)},null,40,_o),ut(d(t.$t("select_all")),1)])])):g("",!0),e(c).videoViewType==="grid"?(l(),a("div",po,[(l(!0),a($,null,N(h.value,(s,f)=>(l(),a("div",mo,[o("md-checkbox",{class:"checkbox","touch-target":"wrapper",onChange:n[6]||(n[6]=(...u)=>e(M)&&e(M)(...u)),checked:s.checked,onClick:_(u=>e(Y)(s),["stop"])},null,40,ho),o("img",{class:"image",src:e(O)(s.fileId,"&w=200&h=200"),onerror:"this.src='/broken-image.png'",onClick:u=>oe(f),onContextmenu:u=>ze(u,s)},null,40,vo),o("span",go,d(e(ve)(s.duration)),1)]))),256))])):g("",!0),e(c).videoViewType==="grid"&&ee.value.length===0?(l(),a("div",ko,d(t.$t(e(ge)(e(te),e(P).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):g("",!0),e(c).videoViewType==="list"?(l(),a("div",fo,[o("table",bo,[o("thead",null,[o("tr",null,[o("th",null,[o("md-checkbox",{"touch-target":"wrapper",onChange:n[7]||(n[7]=(...s)=>e(U)&&e(U)(...s)),checked:e(B),indeterminate:!e(B)&&e(H)},null,40,yo)]),Co,wo,o("th",null,d(t.$t("name")),1),$o,o("th",null,d(t.$t("tags")),1),o("th",null,d(t.$t("duration")),1),o("th",null,d(t.$t("file_size")),1)])]),o("tbody",null,[(l(!0),a($,null,N(h.value,(s,f)=>(l(),a("tr",{key:s.id,class:kt({selected:s.checked}),onClick:_(u=>e(Y)(s),["stop"])},[o("td",null,[o("md-checkbox",{"touch-target":"wrapper",onChange:n[8]||(n[8]=(...u)=>e(M)&&e(M)(...u)),checked:s.checked},null,40,Io)]),o("td",null,[i(xe,{id:s.id,raw:s},null,8,["id","raw"])]),o("td",null,[o("img",{class:"img-video",src:e(O)(s.fileId,"&w=200&h=200"),width:"50",height:"50",style:{cursor:"pointer"},onClick:_(u=>oe(f),["stop"]),onerror:"this.src='/broken-image.png'"},null,8,Vo)]),o("td",null,d(s.title),1),o("td",So,[o("div",Do,[m((l(),a("button",{class:"icon-button",onClick:_(u=>e(j)(e(r),s),["stop"])},[Ro,i(S)],8,Ao)),[[v,t.$t("delete")]]),m((l(),a("button",{class:"icon-button",onClick:_(u=>e(Z)(s.path,e(K)(s.path).replace(" ","-")),["stop"])},[Bo,i(re)],8,zo)),[[v,t.$t("download")]]),m((l(),a("button",{class:"icon-button",onClick:_(u=>se(s),["stop"])},[Fo,i(_e)],8,Eo)),[[v,t.$t("add_to_tags")]])])]),o("td",null,[i(He,{tags:s.tags,type:e(r)},null,8,["tags","type"])]),o("td",Uo,d(e(ve)(s.duration)),1),o("td",Mo,d(e(ft)(s.size)),1)],10,To))),128))]),h.value.length?g("",!0):(l(),a("tfoot",No,[o("tr",null,[o("td",qo,[o("div",xo,d(t.$t(e(ge)(e(te),e(P).permissions,"WRITE_EXTERNAL_STORAGE"))),1)])])]))])])):g("",!0),e(C)>A?(l(),G(Le,{key:4,modelValue:I.value,"onUpdate:modelValue":n[9]||(n[9]=s=>I.value=s),total:e(C),limit:A},null,8,["modelValue","total"])):g("",!0)],64)}}});const jo=Ut(Ho,[["__scopeId","data-v-ecb9908a"]]);export{jo as default};
