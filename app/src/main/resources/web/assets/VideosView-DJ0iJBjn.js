import{_ as wo}from"./VPagination.vuevuetypescriptsetuptruelang-goYu96wT.js";import{_ as Io,a as So,b as Eo,c as Do,d as To}from"./grid-view-outline-rounded-D3vSSmrh.js";import{d as Ao,u as Vo,s as Be,h as B,g as Fo,I as Mo,i as Lo,ai as He,aF as zo,J as Ro,aG as Uo,aH as Ne,aI as qo,aM as Bo,aj as Ho,K as No,aJ as Ko,aK as Qo,L as Oo,M as Po,c as u,a as r,m as e,t as y,O as f,x as _,v as i,q as d,w as a,e as V,p as l,aL as Zo,N as H,P as W,Q as Go,f as Wo,C as jo,aN as Jo,aY as Xo,aP as Yo,ao as xo,S as es,o as t,aQ as j,aR as J,aZ as Ke,aC as pe,aS as F,E as Qe,ab as Oe,U as os,V as ss,W as ts,X as ns,ar as as,aq as ls,Z as is,$ as cs,a0 as ds,a1 as M,ae as rs,aT as us,as as _s,aU as ps,a2 as ks,aV as vs,a4 as ms,a3 as gs,aW as hs}from"./index-R8dLcqG_.js";import{_ as ys,a as fs}from"./SearchInput-DhaE-3h8.js";import{_ as $s}from"./sort-rounded-CsJpi3ce.js";import{_ as Cs}from"./upload-rounded-CQIzYelP.js";import{a as bs}from"./tags-Dbpv368M.js";import{u as ws,a as Is}from"./key-events-BNCM8SMB.js";import{u as Ss}from"./search-ByVbj6Ls.js";import"./search-rounded-CULEMJ2O.js";import"./rss-feed-rounded-BCiGdgJ5.js";import"./vee-validate.esm-vpr6zxQb.js";const Es={class:"top-app-bar"},Ds=["checked","indeterminate"],Ts={class:"title"},As={key:0},Vs={key:1},Fs={class:"actions"},Ms=["onClick"],Ls={slot:"headline"},zs=["onClick"],Rs={slot:"headline"},Us={class:"menu-items"},qs=["onClick","selected"],Bs={slot:"headline"},Hs={class:"sm"},Ns=["selected"],Ks=["selected"],Qs=["onClick","onMouseover"],Os=["src"],Ps=["src","onError"],Zs={key:1,class:"actions"},Gs={class:"right"},Ws=["onClick","onMouseover"],js={class:"start"},Js=["onClick","checked"],Xs=["onClick","checked"],Ys={class:"number"},xs={class:"image"},et=["src"],ot=["src","onError"],st={class:"title"},tt={class:"subtitle"},nt=["onClick"],at={class:"actions"},lt={class:"time"},it={key:2,class:"no-data-placeholder"},E=55,$t=Ao({__name:"VideosView",setup(ct){var ze;const I=Vo(),{videoSortBy:L}=Be(I),S=B([]),{t:Pe}=Fo(),{parseQ:Ze}=Ss(),D=Mo({tagIds:[]}),ke=Lo(),{app:T,urlTokenKey:X,uploads:Y}=Be(ke),{input:Ge,upload:We,uploadChanged:ve}=He(Y),{input:je,upload:Je,uploadChanged:me}=He(Y),{dropping:Xe,fileDragEnter:ge,fileDragLeave:he,dropFiles:Ye}=zo(Y),x=B(!1),p=Ro.VIDEO,ye=Go(),fe=ye.query,ee=B(parseInt(((ze=fe.page)==null?void 0:ze.toString())??"1")),{tags:N,buckets:oe,fetch:xe}=Uo(p),eo=Ne(()=>{const s={};return oe.value.forEach(n=>{s[n.id]=n}),s}),C=B(""),{addToTags:oo}=bs(p,N),{deleteItems:se,deleteItem:K}=qo(),{view:so}=Bo(p),{selectedIds:h,allChecked:$e,realAllChecked:w,selectRealAll:to,allCheckedAlertVisible:no,clearSelection:z,toggleAllChecked:Ce,toggleSelect:R,total:b,checked:U,shiftEffectingIds:Q,handleItemClick:be,handleMouseOver:we,selectAll:ao,shouldSelect:Ie}=ws(S),{downloadItems:Se}=Ho(X,p,z,"videos.zip"),{downloadFile:O}=as(X),Ee=s=>{const n=ye.query.q;Wo(I,n?`/videos?page=${s}&q=${n}`:`/videos?page=${s}`)},{keyDown:De,keyUp:Te}=Is(b,E,ee,ao,z,Ee,()=>{j(J.MEDIA_TRASH,T.value.osVersion)?G(p,q()):se(p,h.value,w.value,b.value,C.value)}),te=B([]),lo=ls(),io=Ne(()=>S.value.map(s=>({src:pe(s.fileId),name:F(s.path),duration:s.duration,size:s.size,path:s.path,data:s,type:p}))),Ae=s=>{te.value.push(s)},{loading:P,fetch:Z}=No({handle:async(s,n)=>{if(x.value=!1,n)jo(Pe(n),"error");else if(s){const $=[];for(const c of s.videos)$.push({...c,fileId:Jo(X.value,c.path,c.id)});S.value=$,b.value=s.videoCount}},document:Xo,variables:()=>({offset:(ee.value-1)*E,limit:E,query:C.value,sortBy:L.value}),appApi:!0}),{trashLoading:ne,trash:G}=Ko(),{restoreLoading:ae,restore:le}=Qo();function ie(s){ke.lightbox={sources:io.value,index:s,visible:!0}}const q=()=>{let s=C.value;return w.value||(s=`ids:${h.value.join(",")}`),s};function co(s,n){if(L.value===n){s.close();return}x.value=!0,L.value=n,s.close()}function ro(s){return s?`/videos?q=${s}`:"/videos"}function Ve(s){is(cs,{type:p,tags:N.value,item:{key:s.id,title:s.title,size:s.size},selected:N.value.filter(n=>s.tags.some($=>$.id===n.id))})}function ce(){const s=oe.value.find(n=>n.id===D.bucketId);return s?hs(s.topItems[0]):`${T.value.internalStoragePath}/Movies`}function uo(s){We(ce()),s.close()}function _o(s){Je(ce()),s.close()}function po(s){Ye(s,ce(),"video")}const Fe=s=>{s.type===p&&(z(),Z())},Me=s=>{s.type===p&&Z()},Le=s=>{s.type===p&&(z(),Z())};return Oo(()=>{var s;C.value=ds(((s=fe.q)==null?void 0:s.toString())??""),Ze(D,C.value),xe(),Z(),M.on("item_tags_updated",Me),M.on("items_tags_updated",Fe),M.on("media_items_actioned",Le),window.addEventListener("keydown",De),window.addEventListener("keyup",Te)}),Po(()=>{M.off("item_tags_updated",Me),M.off("items_tags_updated",Fe),M.off("media_items_actioned",Le),window.removeEventListener("keydown",De),window.removeEventListener("keyup",Te)}),(s,n)=>{const $=rs,c=Yo,de=us,A=_s,re=ps,ue=ks,ko=ys,vo=Cs,Re=xo,mo=$s,go=Io,ho=So,yo=fs,_e=Eo,Ue=Do,fo=vs,qe=ms,$o=gs,Co=To,bo=wo,k=es("tooltip");return t(),u(f,null,[r("div",Es,[r("md-checkbox",{"touch-target":"wrapper",onChange:n[0]||(n[0]=(...o)=>e(Ce)&&e(Ce)(...o)),checked:e($e),indeterminate:!e($e)&&e(U)},null,40,Ds),r("div",Ts,[e(h).length?(t(),u("span",As,y(s.$t("x_selected",{count:e(w)?e(b).toLocaleString():e(h).length.toLocaleString()})),1)):(t(),u("span",Vs,y(s.$t("page_title.videos"))+" ("+y(e(b).toLocaleString())+")",1)),e(U)?(t(),u(f,{key:2},[D.trash?(t(),u(f,{key:0},[_((t(),i(c,{onClick:n[1]||(n[1]=a(o=>e(se)(e(p),e(h),e(w),e(b),C.value),["stop"]))},{icon:d(()=>[l($)]),_:1})),[[k,s.$t("delete")]]),_((t(),i(c,{onClick:n[2]||(n[2]=a(o=>e(le)(e(p),q()),["stop"])),loading:e(ae)(q())},{icon:d(()=>[l(de)]),_:1},8,["loading"])),[[k,s.$t("restore")]]),_((t(),i(c,{onClick:n[3]||(n[3]=a(o=>e(Se)(e(w),e(h),C.value),["stop"]))},{icon:d(()=>[l(A)]),_:1})),[[k,s.$t("download")]])],64)):(t(),u(f,{key:1},[e(j)(e(J).MEDIA_TRASH,e(T).osVersion)?_((t(),i(c,{key:0,onClick:n[4]||(n[4]=a(o=>e(G)(e(p),q()),["stop"])),loading:e(ne)(q())},{icon:d(()=>[l(re)]),_:1},8,["loading"])),[[k,s.$t("move_to_trash")]]):_((t(),i(c,{key:1,onClick:n[5]||(n[5]=a(o=>e(se)(e(p),e(h),e(w),e(b),C.value),["stop"]))},{icon:d(()=>[l($)]),_:1})),[[k,s.$t("delete")]]),_((t(),i(c,{onClick:n[6]||(n[6]=a(o=>e(Se)(e(w),e(h),C.value),["stop"]))},{icon:d(()=>[l(A)]),_:1})),[[k,s.$t("download")]]),_((t(),i(c,{onClick:n[7]||(n[7]=a(o=>e(oo)(e(h),e(w),C.value),["stop"]))},{icon:d(()=>[l(ue)]),_:1})),[[k,s.$t("add_to_tags")]])],64))],64)):V("",!0)]),r("div",Fs,[l(ko,{filter:D,tags:e(N),buckets:e(oe),"get-url":ro},null,8,["filter","tags","buckets"]),D.trash?V("",!0):(t(),i(Re,{key:0},{content:d(o=>[r("md-menu-item",{onClick:a(m=>uo(o),["stop"])},[r("div",Ls,y(s.$t("upload_files")),1)],8,Ms),r("md-menu-item",{onClick:a(m=>_o(o),["stop"])},[r("div",Rs,y(s.$t("upload_folder")),1)],8,zs)]),default:d(()=>[_((t(),i(c,null,{icon:d(()=>[l(vo)]),_:1})),[[k,s.$t("upload")]])]),_:1})),l(Re,null,{content:d(o=>[r("div",Us,[(t(!0),u(f,null,W(e(lo),m=>(t(),u("md-menu-item",{key:m.value,onClick:v=>co(o,m.value),selected:m.value===e(L)},[r("div",Bs,y(s.$t(m.label)),1)],8,qs))),128))])]),default:d(()=>[_((t(),i(c,{loading:x.value},{icon:d(()=>[l(mo)]),_:1},8,["loading"])),[[k,s.$t("sort")]])]),_:1}),r("md-outlined-segmented-button-set",Hs,[r("md-outlined-segmented-button",{"data-value":"grid","no-checkmark":"",selected:!e(I).videosCardView,onClick:n[8]||(n[8]=o=>e(I).videosCardView=!1)},[l(go,{slot:"icon"})],8,Ns),r("md-outlined-segmented-button",{"data-value":"card","no-checkmark":"",selected:e(I).videosCardView,onClick:n[9]||(n[9]=o=>e(I).videosCardView=!0)},[l(ho,{slot:"icon"})],8,Ks)])])]),l(yo,{limit:E,total:e(b),"all-checked-alert-visible":e(no),"real-all-checked":e(w),"select-real-all":e(to),"clear-selection":e(z)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),r("div",{class:"scroll-content",onDragover:n[13]||(n[13]=a((...o)=>e(ge)&&e(ge)(...o),["stop","prevent"]))},[_(r("div",{class:"drag-mask",onDrop:a(po,["stop","prevent"]),onDragleave:n[10]||(n[10]=a((...o)=>e(he)&&e(he)(...o),["stop","prevent"]))},y(s.$t("release_to_send_files")),545),[[Zo,e(Xe)]]),e(I).videosCardView?(t(),u("div",{key:1,class:H(["media-list",{"select-mode":e(U)}])},[(t(!0),u(f,null,W(S.value,(o,m)=>{var v;return t(),u("section",{class:H(["media-item selectable-card",{selected:e(h).includes(o.id),selecting:e(Q).includes(o.id)}]),key:o.id,onClick:a(g=>e(be)(g,o,m,ie),["stop"]),onMouseover:g=>e(we)(g,m)},[r("div",js,[e(Q).includes(o.id)?(t(),u("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",onClick:a(g=>e(R)(g,o,m),["stop"]),checked:e(Ie)},null,8,Js)):(t(),u("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",onClick:a(g=>e(R)(g,o,m),["stop"]),checked:e(h).includes(o.id)},null,8,Xs)),r("span",Ys,[l($o,{id:m+1,raw:o},null,8,["id","raw"])])]),r("div",xs,[te.value.includes(o.id)?(t(),u("img",{key:0,src:`/ficons/${e(Ke)(o.path)}.svg`,class:"svg"},null,8,et)):(t(),u("img",{key:1,class:"image-thumb",src:e(pe)(o.fileId,"&w=200&h=200"),onError:g=>Ae(o.id)},null,40,ot))]),r("div",st,y(e(F)(o.path)),1),r("div",tt,[r("span",null,y(e(Qe)(o.size)),1),r("span",null,y(e(Oe)(o.duration)),1),r("a",{onClick:a(g=>e(so)(e(I),o.bucketId),["stop","prevent"])},y((v=eo.value[o.bucketId])==null?void 0:v.name),9,nt),l(qe,{tags:o.tags,type:e(p),"only-links":!0},null,8,["tags","type"])]),r("div",at,[D.trash?(t(),u(f,{key:0},[_((t(),i(c,{class:"sm",onClick:a(g=>e(K)(e(p),o),["stop"])},{icon:d(()=>[l($)]),_:2},1032,["onClick"])),[[k,s.$t("delete")]]),_((t(),i(c,{class:"sm",onClick:a(g=>e(le)(e(p),`ids:${o.id}`),["stop"]),loading:e(ae)(`ids:${o.id}`)},{icon:d(()=>[l(de)]),_:2},1032,["onClick","loading"])),[[k,s.$t("restore")]]),_((t(),i(c,{class:"sm",onClick:a(g=>e(O)(o.path,e(F)(o.path).replace(" ","-")),["stop"])},{icon:d(()=>[l(A)]),_:2},1032,["onClick"])),[[k,s.$t("download")]])],64)):(t(),u(f,{key:1},[e(j)(e(J).MEDIA_TRASH,e(T).osVersion)?_((t(),i(c,{key:0,class:"sm",onClick:a(g=>e(G)(e(p),`ids:${o.id}`),["stop"]),loading:e(ne)(`ids:${o.id}`)},{icon:d(()=>[l(re)]),_:2},1032,["onClick","loading"])),[[k,s.$t("move_to_trash")]]):_((t(),i(c,{key:1,class:"sm",onClick:a(g=>e(K)(e(p),o),["stop"])},{icon:d(()=>[l($)]),_:2},1032,["onClick"])),[[k,s.$t("delete")]]),_((t(),i(c,{class:"sm",onClick:a(g=>e(O)(o.path,e(F)(o.path).replace(" ","-")),["stop"])},{icon:d(()=>[l(A)]),_:2},1032,["onClick"])),[[k,s.$t("download")]]),_((t(),i(c,{class:"sm",onClick:a(g=>Ve(o),["stop"])},{icon:d(()=>[l(ue)]),_:2},1032,["onClick"])),[[k,s.$t("add_to_tags")]])],64))]),r("div",lt,[_((t(),u("span",null,[ss(y(e(ts)(o.createdAt)),1)])),[[k,e(os)(o.createdAt)]])])],42,Ws)}),128)),e(P)&&S.value.length===0?(t(),i(Co,{key:0,limit:E})):V("",!0)],2)):(t(),u("div",{key:0,class:H(["media-grid",{"select-mode":e(U)}])},[(t(!0),u(f,null,W(S.value,(o,m)=>(t(),u("section",{class:H(["media-item",{selected:e(h).includes(o.id),selecting:e(Q).includes(o.id)}]),key:o.id,onClick:a(v=>e(be)(v,o,m,ie),["stop"]),onMouseover:v=>e(we)(v,m)},[te.value.includes(o.id)?(t(),u("img",{key:0,src:`/ficons/${e(Ke)(o.path)}.svg`,class:"image svg"},null,8,Os)):(t(),u("img",{key:1,class:"image image-thumb",src:e(pe)(o.fileId,"&w=200&h=200"),onError:v=>Ae(o.id)},null,40,Ps)),e(Q).includes(o.id)?(t(),i(c,{key:2,class:"btn-checkbox",onClick:a(v=>e(R)(v,o,m),["stop"])},{icon:d(()=>[e(Ie)?(t(),i(_e,{key:0})):(t(),i(Ue,{key:1}))]),_:2},1032,["onClick"])):e(h).includes(o.id)?(t(),i(c,{key:3,class:"btn-checkbox",onClick:a(v=>e(R)(v,o,m),["stop"])},{icon:d(()=>[l(_e)]),_:2},1032,["onClick"])):(t(),u(f,{key:4},[l(c,{class:"btn-checkbox",onClick:a(v=>e(R)(v,o,m),["stop"])},{icon:d(()=>[e(h).includes(o.id)?(t(),i(_e,{key:0})):(t(),i(Ue,{key:1}))]),_:2},1032,["onClick"]),e(U)?_((t(),i(c,{key:0,class:"btn-zoom sm",onClick:a(v=>ie(m),["stop"])},{icon:d(()=>[l(fo)]),_:2},1032,["onClick"])),[[k,s.$t("open")]]):(t(),u("div",Zs,[D.trash?(t(),u(f,{key:0},[_((t(),i(c,{class:"sm",onClick:a(v=>e(K)(e(p),o),["stop"])},{icon:d(()=>[l($)]),_:2},1032,["onClick"])),[[k,s.$t("delete")]]),_((t(),i(c,{class:"sm",onClick:a(v=>e(le)(e(p),`ids:${o.id}`),["stop"]),loading:e(ae)(`ids:${o.id}`)},{icon:d(()=>[l(de)]),_:2},1032,["onClick","loading"])),[[k,s.$t("restore")]]),_((t(),i(c,{class:"sm",onClick:a(v=>e(O)(o.path,e(F)(o.path).replace(" ","-")),["stop"])},{icon:d(()=>[l(A)]),_:2},1032,["onClick"])),[[k,s.$t("download")]])],64)):(t(),u(f,{key:1},[e(j)(e(J).MEDIA_TRASH,e(T).osVersion)?_((t(),i(c,{key:0,class:"sm",onClick:a(v=>e(G)(e(p),`ids:${o.id}`),["stop"]),loading:e(ne)(`ids:${o.id}`)},{icon:d(()=>[l(re)]),_:2},1032,["onClick","loading"])),[[k,s.$t("move_to_trash")]]):_((t(),i(c,{key:1,class:"sm",onClick:a(v=>e(K)(e(p),o),["stop"])},{icon:d(()=>[l($)]),_:2},1032,["onClick"])),[[k,s.$t("delete")]]),_((t(),i(c,{class:"sm",onClick:a(v=>e(O)(o.path,e(F)(o.path).replace(" ","-")),["stop"])},{icon:d(()=>[l(A)]),_:2},1032,["onClick"])),[[k,s.$t("download")]]),_((t(),i(c,{class:"sm",onClick:a(v=>Ve(o),["stop"])},{icon:d(()=>[l(ue)]),_:2},1032,["onClick"])),[[k,s.$t("add_to_tags")]])],64))])),r("div",{class:H(["info",{"has-tags":o.tags.length>0}])},[l(qe,{tags:o.tags,type:e(p)},null,8,["tags","type"]),r("span",Gs,y(["SIZE_ASC","SIZE_DESC"].includes(e(L))?e(Qe)(o.size):e(Oe)(o.duration)),1)],2)],64))],42,Qs))),128)),e(P)&&S.value.length===0?(t(),u(f,{key:0},W(E,o=>r("section",{class:"skeleton-image media-item",key:o})),64)):V("",!0)],2)),!e(P)&&S.value.length===0?(t(),u("div",it,y(s.$t(e(ns)(e(P),e(T).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):V("",!0),e(b)>E?(t(),i(bo,{key:3,page:ee.value,go:Ee,total:e(b),limit:E},null,8,["page","total"])):V("",!0),r("input",{ref_key:"fileInput",ref:Ge,style:{display:"none"},type:"file",accept:"video/*",multiple:"",onChange:n[11]||(n[11]=(...o)=>e(ve)&&e(ve)(...o))},null,544),r("input",{ref_key:"dirFileInput",ref:je,style:{display:"none"},type:"file",accept:"video/*",multiple:"",webkitdirectory:"",mozdirectory:"",directory:"",onChange:n[12]||(n[12]=(...o)=>e(me)&&e(me)(...o))},null,544)],32)],64)}}});export{$t as default};
