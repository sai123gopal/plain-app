import{_ as te}from"./MonacoEditor.vuevuetypescriptsetuptruelang-8e0dfdb1.js";import{_ as ne}from"./print-outline-rounded-cb227006.js";import{aN as ae,aO as K,aP as se,d as oe,a as ie,u as re,p as ue,r as C,s as le,c as ce,aC as de,i as P,a2 as _e,aQ as me,H as pe,I as D,J as fe,K as ve,e as V,f as N,x as y,y as R,F as ge,A as he,L as B,w as z,j as F,h as $,aR as Te,G as ye,k as J,aS as ke,aT as be,aU as we,o as M,g as xe,t as X,aV as Ce,M as Me,aw as Ne,ax as Ee,U as Se,Y as Ie,Z as Le,a0 as Ve,$ as $e,_ as Ae}from"./index-e23e99bf.js";import{_ as De}from"./Breadcrumb-ba8f6aaf.js";import{g as Y,M as Re}from"./splitpanes.es-951888f8.js";import{u as Ue}from"./markdown-beb3b221.js";var He=function(){return ae.Date.now()};const G=He;var Qe="Expected a function",We=Math.max,Be=Math.min;function Fe(f,l,i){var _,r,n,o,a,u,v=0,A=!1,g=!1,k=!0;if(typeof f!="function")throw new TypeError(Qe);l=K(l)||0,se(i)&&(A=!!i.leading,g="maxWait"in i,n=g?We(K(i.maxWait)||0,l):n,k="trailing"in i?!!i.trailing:k);function b(t){var c=_,p=r;return _=r=void 0,v=t,o=f.apply(p,c),o}function m(t){return v=t,a=setTimeout(w,l),A?b(t):o}function H(t){var c=t-u,p=t-v,L=l-c;return g?Be(L,n-p):L}function E(t){var c=t-u,p=t-v;return u===void 0||c>=l||c<0||g&&p>=n}function w(){var t=G();if(E(t))return x(t);a=setTimeout(w,H(t))}function x(t){return a=void 0,k&&_?b(t):(_=r=void 0,o)}function S(){a!==void 0&&clearTimeout(a),v=0,_=u=r=a=void 0}function Q(){return a===void 0?o:x(G())}function I(){var t=G(),c=E(t);if(_=arguments,r=this,u=t,c){if(a===void 0)return m(u);if(g)return clearTimeout(a),a=setTimeout(w,l),b(u)}return a===void 0&&(a=setTimeout(w,l)),o}return I.cancel=S,I.flush=Q,I}const Z=f=>(Ne("data-v-b382585d"),f=f(),Ee(),f),Ge={class:"page-container"},Oe={class:"main"},je={class:"v-toolbar"},Ke={class:"state-point"},Pe=["onClick"],ze=Z(()=>N("md-ripple",null,null,-1)),Je=["onClick"],Xe=Z(()=>N("md-ripple",null,null,-1)),Ye=["innerHTML"],U="NOTE",Ze=oe({__name:"NoteEditView",setup(f){const l=ie(),{t:i}=re(),_=ue(),r=C(_.params.id),n=C(),o=C(""),a=C(""),u=C(!1),{app:v,urlTokenKey:A}=le(ce()),g=de(()=>{var e;return(e=n.value)!=null&&e.deletedAt?["/notes","/notes/trash"]:["/notes"]}),{render:k}=Ue(v,A);let b=!1;function m(){return r.value==="create"}const H=Fe(()=>{u.value=!1,Q({id:m()?"":r.value,input:{content:o.value,title:Te(o.value,{length:100,omission:""})}})},500),E=()=>{ye(o,async e=>{u.value=!0,a.value=await k(e),H()})},w=()=>{window.print()},x=C();P({handle:(e,s)=>{s?J(i(s),"error"):e&&(x.value=e.tags)},document:ke,variables:{type:U},appApi:!0});let S=()=>{};if(m())E();else{const{refetch:e}=P({handle:async(s,d)=>{if(d)J(i(d),"error");else{if(n.value=s.note,b)return;o.value=s.note.content,a.value=await k(o.value),b=!0,E()}},document:be,variables:()=>({id:r.value}),appApi:!0});S=e}const{mutate:Q,onDone:I}=_e({document:we,appApi:!0});I(e=>{var d,h;n.value=e.data.saveNote,m()&&((d=n.value)!=null&&d.id)&&(r.value=(h=n.value)==null?void 0:h.id,me(l,`/notes/${r.value}`))});function t(){var s;const e=(s=n==null?void 0:n.value)==null?void 0:s.updatedAt;return e?`(${i("updated_at")}: ${Se(e)})`:""}function c(){var e,s;Ie(Le,{type:U,tags:x.value,item:{key:(e=n.value)==null?void 0:e.id,title:"",size:0},selected:(s=x.value)==null?void 0:s.filter(d=>{var h;return(h=n.value)==null?void 0:h.tags.some(W=>W.id===d.id)})})}const p=e=>{e.type===U&&S()},L=e=>{e.type===U&&S()};return pe(()=>{D.on("item_tags_updated",L),D.on("items_tags_updated",p)}),fe(()=>{D.off("item_tags_updated",L),D.off("items_tags_updated",p)}),(e,s)=>{var j;const d=Ve,h=De,W=$e,q=ne,ee=te,O=ve("tooltip");return M(),V("div",Ge,[N("div",Oe,[N("div",je,[y(h,{paths:g.value},{current:R(()=>{var T;return[xe(X(m()?$(i)("create"):$(i)("edit"))+" ",1),B(N("span",Ke,"*",512),[[Ce,u.value]]),(T=n.value)!=null&&T.updatedAt?(M(),Me(d,{key:0,class:"time",id:t(),raw:n.value},null,8,["id","raw"])):F("",!0)]}),_:1},8,["paths"]),(M(!0),V(ge,null,he((j=n.value)==null?void 0:j.tags,T=>(M(),V("span",{key:T.id,class:"badge"},X(T.name),1))),128)),m()?F("",!0):B((M(),V("button",{key:0,class:"icon-button",onClick:z(c,["prevent"]),style:{"margin-inline-start":"8px"}},[ze,y(W)],8,Pe)),[[O,e.$t("add_to_tags")]]),m()?F("",!0):B((M(),V("button",{key:1,class:"icon-button",onClick:z(w,["prevent"])},[Xe,y(q)],8,Je)),[[O,e.$t("print")]])]),y($(Re),{class:"panel-container"},{default:R(()=>[y($(Y),null,{default:R(()=>[y(ee,{language:"html",modelValue:o.value,"onUpdate:modelValue":s[0]||(s[0]=T=>o.value=T)},null,8,["modelValue"])]),_:1}),y($(Y),null,{default:R(()=>[N("div",{class:"md-container",innerHTML:a.value},null,8,Ye)]),_:1})]),_:1})])])}}});const ot=Ae(Ze,[["__scopeId","data-v-b382585d"]]);export{ot as default};
