import{c as fe,u as ve,_ as ke,a as be,b as $e}from"./list-bea8e7b0.js";import{d as Ce,e as ye,r as k,u as Ae,K as Te,L as we,D as Ie,M as Se,N as qe,w as De,O as Ve,P as b,Q as Qe,R as Ue,c as o,a as t,p as c,j as s,F as T,m as _,l as u,k as S,t as d,H as Be,J as K,S as Me,T as Ne,U as Re,b2 as Le,x as Fe,b9 as He,C as j,W as E,o as n,v as ze,I as Pe,aS as Ge,Y as J,h as O,Z as W,$ as Ke,a0 as je,a1 as Ee,ba as Y,a2 as Z,ab as Je,ac as Oe,a3 as We,ad as Ye,a4 as Ze,a5 as Xe,a6 as xe}from"./index-9c78c93b.js";import{_ as et}from"./Breadcrumb-56c0fca0.js";import{u as tt,a as at}from"./tags-2a301108.js";import"./vee-validate.esm-2d465d6a.js";const st={class:"v-toolbar"},lt=t("md-ripple",null,null,-1),nt=t("md-ripple",null,null,-1),ot=["onClick"],dt={class:"filters"},ct=["label"],it={class:"form-label"},ut=["label","selected","onClick"],rt={class:"buttons"},_t=["onClick"],pt={class:"table-responsive"},ht={class:"table"},mt=["checked","indeterminate"],gt=t("th",null,"ID",-1),ft=t("th",null,null,-1),vt=["onClick"],kt=["checked"],bt=["onClick"],$t={class:"nowrap"},Ct={class:"action-btns"},yt=["onClick"],At=t("md-ripple",null,null,-1),Tt=["onClick"],wt=t("md-ripple",null,null,-1),It={class:"nowrap"},St={class:"nowrap"},qt={key:0},Dt={colspan:"7"},Vt={class:"no-data-placeholder"},$=50,Ft=Ce({__name:"AIChatsView",setup(Qt){var H,z;const q=ye(),p=k([]),D=k(),{t:X}=Ae(),i=Te({text:"",tags:[]}),r=we.AI_CHAT,V=Ie().query,C=k(parseInt(((H=V.page)==null?void 0:H.toString())??"1")),h=k(Se(((z=V.q)==null?void 0:z.toString())??"")),y=k(""),{tags:A}=tt(r,h,i,async e=>{e.push({name:"parent_id",op:"",value:""}),y.value=Ne(e),await Re(),ne()}),{addToTags:x}=at(r,p,A),{deleteItems:ee}=fe(Le,()=>{I()},p),{allChecked:Q,realAllChecked:w,selectRealAll:te,allCheckedAlertVisible:ae,clearSelection:U,toggleAllChecked:B,toggleItemChecked:M,toggleRow:se,total:m,checked:N}=ve(p),{loading:le,load:ne,refetch:I}=qe({handle:(e,l)=>{l?Fe(X(l),"error"):e&&(p.value=e.aiChats.map(v=>({...v,checked:!1})),m.value=e.aiChatCount)},document:He,variables:()=>({offset:(C.value-1)*$,limit:$,query:y.value}),appApi:!0});De(C,e=>{j(q,`/aichats?page=${e}&q=${E(h.value)}`)});function oe(e){i.tags.includes(e)?je(i.tags,l=>l.id===e.id):i.tags.push(e)}function de(){h.value=Ee(i),R(),D.value.dismiss()}function R(){j(q,`/aichats?q=${E(h.value)}`)}const L=e=>{e.type===r&&(U(),I())},F=e=>{e.type===r&&I()};Ve(()=>{b.on("item_tags_updated",F),b.on("items_tags_updated",L)}),Qe(()=>{b.off("item_tags_updated",F),b.off("items_tags_updated",L)});function ce(e){Y(`/aichats/${e.id}`)}function ie(){Y("/aichats/create")}function ue(e){Z(Oe,{id:e.id,name:e.id,gql:Je`
      mutation DeleteAIChat($query: String!) {
        deleteAIChats(query: $query)
      }
    `,variables:()=>({query:`ids:${e.id}`}),appApi:!0,typeName:"AIChat",done:()=>{m.value--,e.tags.length&&b.emit("refetch_tags",r)}})}function re(e){Z(We,{type:r,tags:A.value,item:{key:e.id,title:"",size:0},selected:A.value.filter(l=>e.tags.some(v=>v.id===l.id))})}return(e,l)=>{const v=et,P=Ye,G=Ze,_e=ke,pe=be,he=Xe,me=xe,ge=$e,g=Ue("tooltip");return n(),o(T,null,[t("div",st,[c(v,{current:()=>`${e.$t("page_title.aichats")} (${s(m)})`},null,8,["current"]),s(N)?(n(),o(T,{key:0},[_((n(),o("button",{class:"icon-button",onClick:l[0]||(l[0]=u(a=>s(ee)(s(w),y.value),["stop"]))},[lt,c(P)])),[[g,e.$t("delete")]]),_((n(),o("button",{class:"icon-button",onClick:l[1]||(l[1]=u(a=>s(x)(s(w),y.value),["stop"]))},[nt,c(G)])),[[g,e.$t("add_to_tags")]])],64)):S("",!0),t("md-outlined-button",{onClick:u(ie,["prevent"])},d(e.$t("new_chat")),9,ot),c(_e,{ref_key:"searchInputRef",ref:D,modelValue:h.value,"onUpdate:modelValue":l[3]||(l[3]=a=>h.value=a),search:R},{filters:Be(()=>[t("div",dt,[_(t("md-outlined-text-field",{label:e.$t("keywords"),"onUpdate:modelValue":l[2]||(l[2]=a=>i.text=a),"keyup.enter":"applyAndDoSearch"},null,8,ct),[[ze,i.text]]),t("label",it,d(e.$t("tags")),1),t("md-chip-set",null,[(n(!0),o(T,null,K(s(A),a=>(n(),o("md-filter-chip",{key:a.id,label:a.name,selected:i.tags.includes(a),onClick:f=>oe(a)},null,8,ut))),128))]),t("div",rt,[t("md-filled-button",{onClick:u(de,["stop"])},d(e.$t("search")),9,_t)])])]),_:1},8,["modelValue"])]),c(pe,{limit:$,total:s(m),"all-checked-alert-visible":s(ae),"real-all-checked":s(w),"select-real-all":s(te),"clear-selection":s(U)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),t("div",pt,[t("table",ht,[t("thead",null,[t("tr",null,[t("th",null,[t("md-checkbox",{"touch-target":"wrapper",onChange:l[4]||(l[4]=(...a)=>s(B)&&s(B)(...a)),checked:s(Q),indeterminate:!s(Q)&&s(N)},null,40,mt)]),gt,t("th",null,d(e.$t("content")),1),ft,t("th",null,d(e.$t("tags")),1),t("th",null,d(e.$t("updated_at")),1),t("th",null,d(e.$t("created_at")),1)])]),t("tbody",null,[(n(!0),o(T,null,K(p.value,a=>(n(),o("tr",{key:a.id,class:Pe({selected:a.checked}),onClick:u(f=>s(se)(a),["stop"])},[t("td",null,[t("md-checkbox",{"touch-target":"wrapper",onChange:l[5]||(l[5]=(...f)=>s(M)&&s(M)(...f)),checked:a.checked},null,40,kt)]),t("td",null,[c(he,{id:a.id,raw:a},null,8,["id","raw"])]),t("td",null,[t("a",{href:"#",onClick:u(f=>ce(a),["prevent"])},d(s(Ge)(a.content,{length:200,omission:""})),9,bt)]),t("td",$t,[t("div",Ct,[_((n(),o("button",{class:"icon-button",onClick:u(f=>ue(a),["stop"])},[At,c(P)],8,yt)),[[g,e.$t("delete")]]),_((n(),o("button",{class:"icon-button",onClick:u(f=>re(a),["stop"])},[wt,c(G)],8,Tt)),[[g,e.$t("add_to_tags")]])])]),t("td",null,[c(me,{tags:a.tags,type:s(r)},null,8,["tags","type"])]),t("td",It,[_((n(),o("span",null,[O(d(s(W)(a.updatedAt)),1)])),[[g,s(J)(a.updatedAt)]])]),t("td",St,[_((n(),o("span",null,[O(d(s(W)(a.updatedAt)),1)])),[[g,s(J)(a.createdAt)]])])],10,vt))),128))]),p.value.length?S("",!0):(n(),o("tfoot",qt,[t("tr",null,[t("td",Dt,[t("div",Vt,d(e.$t(s(Ke)(s(le)))),1)])])]))])]),s(m)>$?(n(),Me(ge,{key:0,modelValue:C.value,"onUpdate:modelValue":l[6]||(l[6]=a=>C.value=a),total:s(m),limit:$},null,8,["modelValue","total"])):S("",!0)],64)}}});export{Ft as default};
