import{_ as Ge}from"./more-vert-De1QBMLo.js";import{g as _e,h as S,K as pe,C as D,cB as xe,d as Ke,u as We,s as He,i as Pe,I as je,J as Oe,aE as ne,j as le,L as Ye,M as Je,c as l,a as t,m as e,t as v,O as ce,x as q,w as m,p as r,e as A,P as Xe,v as Ze,q as ie,n as es,Q as ss,a1 as w,cC as ts,cD as os,cE as as,cF as ns,S as ls,o as a,N as cs,U as is,V as ds,W as rs,aA as us,bc as _s,X as ps,F as vs,G as ms,Y as fs,a6 as de,c8 as hs,f as re,a0 as gs,ae as ks,a2 as ys,a3 as bs,a4 as ws,H as Ss}from"./index-Dn0O6zoH.js";import{_ as $s,a as Cs}from"./SearchInput-aem6tEJK.js";import{_ as Ts,a as Ls}from"./add-notes-outline-rounded-BD-gpann.js";import{u as Es}from"./feeds-D1GKmDFN.js";import{u as Fs,b as Is,a as qs}from"./key-events-CgPzNP0J.js";import{a as As}from"./tags-CvPqo38V.js";import{u as Ds}from"./search-DrT1IjAg.js";import"./search-rounded-C8Nl_ZR1.js";import"./rss-feed-rounded-Dqku7i1k.js";import"./vee-validate.esm-0lx5owW0.js";const Ms=(u,_,$)=>{const{t:C}=_e(),h=S(1),M=50,i=S(!1),{loading:T,fetch:Q}=pe({handle:(g,L)=>{if(L)D(C(L),"error");else if(g){g.items.length<M&&(i.value=!0);const E=g.items;h.value===1?u.value=E:u.value=u.value.concat(E),$.value=g.total}},document:xe,variables:()=>({offset:(h.value-1)*M,limit:M,query:_.value}),appApi:!0});return{page:h,noMore:i,loading:T,fetch:Q,loadMore:()=>{i.value||T.value||h.value++}}},f=u=>(vs("data-v-73f705e0"),u=u(),ms(),u),Ns={class:"top-app-bar"},Qs=["checked","indeterminate"],Us={class:"title"},Vs={key:0},Bs={key:1},Rs=f(()=>t("md-ripple",null,null,-1)),zs=f(()=>t("md-ripple",null,null,-1)),Gs={key:0,indeterminate:"",class:"spinner-sm"},xs=f(()=>t("md-ripple",null,null,-1)),Ks={class:"actions"},Ws={key:0,indeterminate:"",class:"spinner-sm"},Hs=["disabled"],Ps=f(()=>t("md-ripple",null,null,-1)),js={key:0,class:"scroller"},Os=fs('<div class="title" data-v-73f705e0><div class="checkbox" data-v-73f705e0><div class="skeleton-checkbox" data-v-73f705e0></div></div><div class="text" data-v-73f705e0><div class="skeleton-text skeleton-title" data-v-73f705e0></div></div></div>',1),Ys={class:"subtitle"},Js={class:"number"},Xs=f(()=>t("div",{class:"info"},[t("div",{class:"skeleton-text skeleton-info"})],-1)),Zs=f(()=>t("div",{class:"image"},[t("div",{class:"skeleton-image"})],-1)),et=["href"],st=["onClick","onMouseover"],tt={class:"title"},ot=["onClick","checked"],at=["onClick","checked"],nt={class:"text"},lt={class:"subtitle"},ct={class:"number"},it={class:"info"},dt=["onClick"],rt=f(()=>t("span",null,"Â·",-1)),ut={class:"time"},_t={class:"btn-icon sm",style:{display:"none"}},pt=f(()=>t("md-ripple",null,null,-1)),vt=["src"],mt={key:0,indeterminate:"",class:"spinner-sm"},ft={key:2,class:"no-data-placeholder"},ue=50,ht=Ke({__name:"FeedsSidebar2",setup(u){var oe;const _=We(),{feedsSyncing:$}=He(Pe()),{t:C}=_e(),h=je({tagIds:[]}),{parseQ:M}=Ds(),i=Oe.FEED_ENTRY,T=ss(),Q=T.query,g=S(parseInt(((oe=Q.page)==null?void 0:oe.toString())??"1")),L=S([]),E=S([]),R=ne(()=>{const s={};return E.value.forEach(o=>{s[o.id]=o}),s}),k=S([]),y=S(""),{selectedIds:d,allChecked:z,realAllChecked:F,selectRealAll:ve,allCheckedAlertVisible:me,clearSelection:U,toggleAllChecked:G,toggleSelect:x,total:b,checked:K,shiftEffectingIds:W,handleItemClick:fe,handleMouseOver:he,selectAll:ge,shouldSelect:ke}=Fs(k),ye=s=>{g.value=s;const o=T.query.q;re(_,o?`/feeds?page=${s}&q=${o}`:`/feeds?page=${s}`)},{keyDown:H,keyUp:P}=qs(b,ue,g,ge,U,ye,()=>{Y(d.value,F.value,b.value,y.value)}),{page:j,loading:B,loadMore:be,fetch:we,noMore:O}=Ms(k,y,b),{addToTags:Se}=As(i,L),N=()=>{j.value=1,we()},{deleteItems:Y}=Is(ts,()=>{U(),N(),k.value.some(s=>s.tags.length)&&w.emit("refetch_tags",i)}),$e=ne(()=>de.currentRoute.value.path!=="/feeds"),{resizeWidth:J}=hs(300,()=>_.sidebar2Width,s=>{_.sidebar2Width=s}),{mutate:X,loading:Ce,onDone:Te}=le({document:os,appApi:!0});function Le(){if(F)X({query:y.value});else{if(d.value.length===0){D(C("select_first"),"error");return}X({query:`ids:${d.value.join(",")}`})}}Te(()=>{D(C("saved"))});function Ee(s){return s?`/feeds?q=${s}`:"/feeds"}const{fetch:Fe}=pe({handle:async(s,o)=>{o?D(C(o),"error"):s&&(L.value=s.tags,E.value=s.feeds)},document:as,variables:{type:i},appApi:!0});function Z(s){const o=de.currentRoute.value.query.q;return o?`/feeds/${s.feedId}/entries/${s.id}?q=${o}`:`/feeds/${s.feedId}/entries/${s.id}`}function Ie(s){re(_,Z(s))}const{viewFeed:qe}=Es(_),{mutate:Ae}=le({document:ns,appApi:!0});function De(){$.value=!0,Ae({id:""})}const ee=s=>{$.value=!1,N(),s.error?D(s.error,"error"):D(C("feeds_synced"))},se=s=>{s.type===i&&(U(),N())},te=s=>{s.type===i&&N()};return Ye(()=>{var o,V;const s=(o=document.getElementsByClassName("scroller"))==null?void 0:o[0];s&&(s.scrollTop=0),y.value=gs(((V=Q.q)==null?void 0:V.toString())??""),M(h,y.value),Fe(),N(),w.on("item_tags_updated",te),w.on("items_tags_updated",se),w.on("feeds_fetched",ee),window.addEventListener("keydown",H),window.addEventListener("keyup",P)}),Je(()=>{j.value=1,O.value=!1,w.off("item_tags_updated",te),w.off("items_tags_updated",se),w.off("feeds_fetched",ee),window.removeEventListener("keydown",H),window.removeEventListener("keyup",P)}),(s,o)=>{const V=ks,Me=ys,Ne=Ts,Qe=$s,Ue=Ls,Ve=Cs,Be=bs,Re=ws,ze=Ge,I=ls("tooltip");return a(),l("aside",{class:"sidebar2",style:es({width:e(T).params.id?e(_).sidebar2Width+"px":"auto"})},[t("div",Ns,[t("md-checkbox",{"touch-target":"wrapper",onChange:o[0]||(o[0]=(...c)=>e(G)&&e(G)(...c)),checked:e(z),indeterminate:!e(z)&&e(K)},null,40,Qs),t("div",Us,[e(d).length?(a(),l("span",Vs,v(s.$t("x_selected",{count:e(F)?e(b).toLocaleString():e(d).length.toLocaleString()})),1)):(a(),l("span",Bs,v(s.$t("page_title.feeds"))+" ("+v(e(b).toLocaleString())+")",1)),e(K)?(a(),l(ce,{key:2},[q((a(),l("button",{class:"btn-icon",onClick:o[1]||(o[1]=m(c=>e(Y)(e(d),e(F),e(b),y.value),["stop"]))},[Rs,r(V)])),[[I,s.$t("delete")]]),q((a(),l("button",{class:"btn-icon",onClick:o[2]||(o[2]=m(c=>e(Se)(e(d),e(F),y.value),["stop"]))},[zs,r(Me)])),[[I,s.$t("add_to_tags")]]),e(Ce)?(a(),l("md-circular-progress",Gs)):q((a(),l("button",{key:1,class:"btn-icon sm",onClick:m(Le,["prevent"])},[xs,r(Ne)])),[[I,s.$t("save_to_notes")]])],64)):A("",!0)]),t("div",Ks,[r(Qe,{filter:h,tags:L.value,feeds:E.value,"show-chips":!$e.value,"get-url":Ee,"show-today":!0},null,8,["filter","tags","feeds","show-chips"]),e($)?(a(),l("md-circular-progress",Ws)):q((a(),l("button",{key:1,class:"btn-icon",disabled:e($),onClick:m(De,["prevent"])},[Ps,r(Ue)],8,Hs)),[[I,s.$t("sync_feeds")]])])]),r(Ve,{limit:ue,total:e(b),"all-checked-alert-visible":e(me),"real-all-checked":e(F),"select-real-all":e(ve),"clear-selection":e(U)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),e(B)&&k.value.length===0?(a(),l("div",js,[(a(),l(ce,null,Xe(20,c=>t("section",{class:"feed-item selectable-card-skeleton",key:c},[Os,t("div",Ys,[t("span",Js,v(c),1),Xs]),Zs])),64))])):A("",!0),k.value.length>0?(a(),Ze(e(_s),{key:1,class:"scroller","data-key":"id","data-sources":k.value,"estimate-size":100,onTobottom:e(be)},{item:ie(({index:c,item:n})=>{var ae;return[t("a",{class:"item-link",href:Z(n)},[t("article",{class:cs(["feed-item selectable-card",{selected:e(d).includes(n.id)||n.id==s.$route.params.id,selecting:e(W).includes(n.id)}]),onClick:m(p=>e(fe)(p,n,c,()=>{Ie(n)}),["stop","prevent"]),onMouseover:p=>e(he)(p,c)},[t("div",tt,[e(W).includes(n.id)?(a(),l("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",onClick:m(p=>e(x)(p,n,c),["stop"]),checked:e(ke)},null,8,ot)):(a(),l("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",onClick:m(p=>e(x)(p,n,c),["stop"]),checked:e(d).includes(n.id)},null,8,at)),t("div",nt,v(n.title||s.$t("no_content")),1)]),t("div",lt,[t("span",ct,[r(Be,{id:c+1,raw:n},null,8,["id","raw"])]),t("div",it,[t("a",{onClick:m(p=>e(qe)(R.value[n.feedId]),["stop","prevent"])},v((ae=R.value[n.feedId])==null?void 0:ae.name),9,dt),rt,q((a(),l("span",ut,[ds(v(e(rs)(n.publishedAt)),1)])),[[I,e(is)(n.publishedAt)]]),r(Re,{tags:n.tags,type:e(i),"only-links":!0},null,8,["tags","type"])])]),q((a(),l("button",_t,[pt,r(ze)])),[[I,s.$t("actions")]]),n.image?(a(),l("img",{key:0,class:"image",src:e(us)(n.image,"&w=200&h=200")},null,8,vt)):A("",!0)],42,st)],8,et)]}),footer:ie(()=>[e(O)?A("",!0):(a(),l("md-circular-progress",mt))]),_:1},8,["data-sources","onTobottom"])):A("",!0),!e(B)&&k.value.length===0?(a(),l("div",ft,v(s.$t(e(ps)(e(B)))),1)):A("",!0),t("div",{class:"sidebar-drag-indicator",onMousedown:o[3]||(o[3]=(...c)=>e(J)&&e(J)(...c))},null,32)],4)}}}),Ft=Ss(ht,[["__scopeId","data-v-73f705e0"]]);export{Ft as default};
