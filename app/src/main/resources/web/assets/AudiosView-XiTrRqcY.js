import{_ as mt}from"./VPagination.vuevuetypescriptsetuptruelang-CFupeDJR.js";import{o as a,c as l,a as o,j as Ie,aS as vt,g as De,a1 as $,C as X,h as q,aT as ht,d as gt,u as kt,s as be,I as ft,i as yt,ag as $e,aD as bt,J as $t,aE as Ct,aF as Tt,aH as wt,ah as It,K as Ce,L as Dt,M as At,m as e,t as r,O as U,x as m,w as d,p as c,e as z,q as N,aG as Et,N as Te,P as W,v as St,Q as qt,f as Ft,aI as Lt,aU as Bt,am as Pt,S as Mt,aQ as Ut,aA as zt,E as Vt,ab as xt,aL as Nt,U as Rt,V as Qt,W as Gt,X as Ht,F as Kt,G as Ot,Y as jt,ap as Wt,ao as Xt,Z as Jt,$ as Yt,a0 as Zt,ae as es,aq as ts,a2 as ss,a3 as os,a4 as ns,aN as as,H as ls}from"./index-Dn0O6zoH.js";import{_ as is,a as ds}from"./SearchInput-aem6tEJK.js";import{_ as cs}from"./sort-rounded-BSs7VajO.js";import{_ as us}from"./upload-rounded-q7e5EuXT.js";import{u as rs}from"./search-DrT1IjAg.js";import{u as ps,a as _s}from"./key-events-CgPzNP0J.js";import{a as ms}from"./tags-CvPqo38V.js";import"./search-rounded-C8Nl_ZR1.js";import"./rss-feed-rounded-Dqku7i1k.js";import"./vee-validate.esm-0lx5owW0.js";const vs={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},hs=o("path",{fill:"currentColor",d:"M10 16q.425 0 .713-.288T11 15V9q0-.425-.288-.712T10 8t-.712.288T9 9v6q0 .425.288.713T10 16m4 0q.425 0 .713-.288T15 15V9q0-.425-.288-.712T14 8t-.712.288T13 9v6q0 .425.288.713T14 16m-2 6q-2.075 0-3.9-.788t-3.175-2.137T2.788 15.9T2 12t.788-3.9t2.137-3.175T8.1 2.788T12 2t3.9.788t3.175 2.137T21.213 8.1T22 12t-.788 3.9t-2.137 3.175t-3.175 2.138T12 22m0-2q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m0-8"},null,-1),gs=[hs];function ks(_,f){return a(),l("svg",vs,[...gs])}const fs={name:"material-symbols-pause-circle-outline-rounded",render:ks},ys={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},bs=o("path",{fill:"currentColor",d:"M3 16v-2h7v2zm0-4v-2h11v2zm0-4V6h11v2zm13 12v-4h-4v-2h4v-4h2v4h4v2h-4v4z"},null,-1),$s=[bs];function Cs(_,f){return a(),l("svg",ys,[...$s])}const Ts={name:"material-symbols-playlist-add",render:Cs};function we(_,f,C=500){const i=_.cloneNode(!0),p=_.getBoundingClientRect(),F=f.getBoundingClientRect();i.style.position="absolute",i.style.top=p.top+"px",i.style.left=p.left+"px",i.style.opacity=1,document.body.appendChild(i);let y=0;function b(I){y||(y=I);const E=I-y,T=Math.min(E/C,1);i.style.top=p.top+(F.top-p.top)*T+"px",i.style.left=p.left+(F.left-p.left)*T+"px",T<1?requestAnimationFrame(b):document.body.removeChild(i)}requestAnimationFrame(b)}const ws=(_,f)=>{const{mutate:C,loading:i,onDone:p}=Ie({document:vt,appApi:!0}),{t:F}=De();return p(()=>{$.emit("refetch_app"),f()}),{loading:i,addItemsToPlaylist:(y,b,I,E)=>{let T=E;if(!I){if(b.length===0){X(F("select_first"),"error");return}T=`ids:${b.join(",")}`}const R=y.target,Q=document.getElementById("quick-audio");we(R,Q),C({query:T})},addToPlaylist:(y,b)=>{const I=y.target,E=document.getElementById("quick-audio");we(I,E),C({query:`ids:${b.id}`})}}},Is=()=>{const _=q(""),{mutate:f,loading:C,onDone:i}=Ie({document:ht,appApi:!0});return i(()=>{$.emit("play_audio")}),{loading:C,playPath:_,play:p=>{_.value=p.path,f({path:p.path})},pause:()=>{$.emit("pause_audio")}}},k=_=>(Kt("data-v-ddce8864"),_=_(),Ot(),_),Ds={class:"top-app-bar"},As=["checked","indeterminate"],Es={class:"title"},Ss={key:0},qs={key:1},Fs=k(()=>o("md-ripple",null,null,-1)),Ls=k(()=>o("md-ripple",null,null,-1)),Bs=k(()=>o("md-ripple",null,null,-1)),Ps=k(()=>o("md-ripple",null,null,-1)),Ms={class:"actions"},Us={class:"btn-icon"},zs=k(()=>o("md-ripple",null,null,-1)),Vs=["onClick"],xs={slot:"headline"},Ns=["onClick"],Rs={slot:"headline"},Qs={class:"btn-icon btn-sort"},Gs=k(()=>o("md-ripple",null,null,-1)),Hs={class:"menu-items"},Ks=["onClick","selected"],Os={slot:"headline"},js=["onClick","onMouseover"],Ws={class:"start"},Xs=["onClick","checked"],Js=["onClick","checked"],Ys={class:"number"},Zs={class:"image"},eo=["src"],to=["src","onError"],so={class:"title"},oo={class:"subtitle"},no={class:"duration"},ao=["onClick"],lo={class:"actions"},io=["onClick"],co=k(()=>o("md-ripple",null,null,-1)),uo=["onClick"],ro=k(()=>o("md-ripple",null,null,-1)),po=["onClick"],_o=k(()=>o("md-ripple",null,null,-1)),mo=["onClick"],vo=k(()=>o("md-ripple",null,null,-1)),ho={key:0,indeterminate:"",class:"spinner-sm"},go=k(()=>o("md-ripple",null,null,-1)),ko={class:"artist"},fo={class:"time"},yo={class:"start"},bo=k(()=>o("div",{class:"checkbox"},[o("div",{class:"skeleton-checkbox"})],-1)),$o={class:"number"},Co=jt('<div class="image" data-v-ddce8864><div class="skeleton-image" data-v-ddce8864></div></div><div class="title" data-v-ddce8864><div class="skeleton-text skeleton-title" data-v-ddce8864></div></div><div class="subtitle" data-v-ddce8864><div class="skeleton-text skeleton-subtitle" data-v-ddce8864></div></div><div class="actions" data-v-ddce8864><div class="skeleton-text skeleton-actions" data-v-ddce8864></div></div><div class="artist" data-v-ddce8864><div class="skeleton-text skeleton-artist" data-v-ddce8864></div></div><div class="time" data-v-ddce8864><div class="skeleton-text skeleton-time" data-v-ddce8864></div></div>',6),To={key:0,class:"no-data-placeholder"},P=50,wo=gt({__name:"AudiosView",setup(_){var he;const f=kt(),{audioSortBy:C}=be(f),i=q([]),{t:p}=De(),{parseQ:F}=rs(),y=ft({tagIds:[]}),{app:b,urlTokenKey:I,audioPlaying:E,uploads:T}=be(yt()),R=t=>{var n;return E.value&&((n=b.value)==null?void 0:n.audioCurrent)===t.path},{input:Q,upload:Ae,uploadChanged:J}=$e(T),{input:Ee,upload:Se,uploadChanged:Y}=$e(T),{dropping:qe,fileDragEnter:Z,fileDragLeave:ee,dropFiles:Fe}=bt(T),v=$t.AUDIO,te=qt(),se=te.query,G=q(parseInt(((he=se.page)==null?void 0:he.toString())??"1")),M=q([]),V=q([]),Le=Ct(()=>{const t={};return V.value.forEach(n=>{t[n.id]=n}),t}),A=q(""),{addToTags:Be}=ms(v,M),{deleteItems:oe,deleteItem:Pe}=Tt(),{view:Me}=wt(v),{selectedIds:D,allChecked:ne,realAllChecked:S,selectRealAll:Ue,allCheckedAlertVisible:ze,clearSelection:L,toggleAllChecked:ae,toggleSelect:le,total:w,checked:H,shiftEffectingIds:ie,handleItemClick:Ve,handleMouseOver:xe,selectAll:Ne,shouldSelect:Re}=ps(i),{downloadItems:Qe}=It(I,v,L,"audios.zip"),{downloadFile:Ge}=Wt(I),de=t=>{const n=te.query.q;Ft(f,n?`/audios?page=${t}&q=${n}`:`/audios?page=${t}`)},{keyDown:ce,keyUp:ue}=_s(w,P,G,Ne,L,de,()=>{oe(v,D.value,S.value,w.value,A.value)}),{addItemsToPlaylist:He,addToPlaylist:Ke}=ws(i,L),Oe=Xt(),re=q([]),{play:je,playPath:We,loading:Xe,pause:Je}=Is(),{fetch:Ye}=Ce({handle:async(t,n)=>{n?X(p(n),"error"):t&&(M.value=t.tags,V.value=t.mediaBuckets)},document:Lt,variables:{type:v},appApi:!0}),Ze=t=>{re.value.push(t)},{loading:K,fetch:x}=Ce({handle:(t,n)=>{n?X(p(n),"error"):t&&(i.value=t.items,w.value=t.total)},document:Bt,variables:()=>({offset:(G.value-1)*P,limit:P,query:A.value,sortBy:C.value}),appApi:!0});function et(t){return t?`/audios?q=${t}`:"/audios"}function tt(t,n){C.value=n,t.close()}function O(){const t=V.value.find(n=>n.id===y.bucketId);return t?as(t.topItems[0]):`${b.value.internalStoragePath}/Music`}function st(t){Ae(O()),t.close()}function ot(t){Se(O()),t.close()}function nt(t){Fe(t,O(),"audio")}const pe=t=>{t.type===v&&(L(),x())},_e=t=>{t.type===v&&x()},me=t=>{t.type===v&&(L(),x())},ve=()=>{w.value--};function at(t){const n=t.tags.map(B=>B.id);Jt(Yt,{type:v,tags:M.value,item:{key:t.id,title:t.title,size:t.size},selected:M.value.filter(B=>n.includes(B.id))})}return Dt(()=>{var t;A.value=Zt(((t=se.q)==null?void 0:t.toString())??""),F(y,A.value),Ye(),x(),$.on("item_tags_updated",_e),$.on("items_tags_updated",pe),$.on("media_item_deleted",ve),$.on("media_items_deleted",me),window.addEventListener("keydown",ce),window.addEventListener("keyup",ue)}),At(()=>{$.off("item_tags_updated",_e),$.off("items_tags_updated",pe),$.off("media_item_deleted",ve),$.off("media_items_deleted",me),window.removeEventListener("keydown",ce),window.removeEventListener("keyup",ue)}),(t,n)=>{const B=es,ge=ts,ke=Ts,fe=ss,lt=is,it=us,ye=Pt,dt=cs,ct=ds,ut=os,rt=ns,pt=fs,_t=mt,h=Mt("tooltip");return a(),l(U,null,[o("div",Ds,[o("md-checkbox",{"touch-target":"wrapper",onChange:n[0]||(n[0]=(...s)=>e(ae)&&e(ae)(...s)),checked:e(ne),indeterminate:!e(ne)&&e(H)},null,40,As),o("div",Es,[e(D).length?(a(),l("span",Ss,r(t.$t("x_selected",{count:e(S)?e(w).toLocaleString():e(D).length.toLocaleString()})),1)):(a(),l("span",qs,r(t.$t("page_title.audios"))+" ("+r(e(w).toLocaleString())+")",1)),e(H)?(a(),l(U,{key:2},[m((a(),l("button",{class:"btn-icon",onClick:n[1]||(n[1]=d(s=>e(oe)(e(v),e(D),e(S),e(w),A.value),["stop"]))},[Fs,c(B)])),[[h,t.$t("delete")]]),m((a(),l("button",{class:"btn-icon",onClick:n[2]||(n[2]=d(s=>e(Qe)(e(S),e(D),A.value),["stop"]))},[Ls,c(ge)])),[[h,t.$t("download")]]),m((a(),l("button",{class:"btn-icon",onClick:n[3]||(n[3]=d(s=>e(He)(s,e(D),e(S),A.value),["stop"]))},[Bs,c(ke)])),[[h,t.$t("add_to_playlist")]]),m((a(),l("button",{class:"btn-icon",onClick:n[4]||(n[4]=d(s=>e(Be)(e(D),e(S),A.value),["stop"]))},[Ps,c(fe)])),[[h,t.$t("add_to_tags")]])],64)):z("",!0)]),o("div",Ms,[c(lt,{filter:y,tags:M.value,buckets:V.value,"get-url":et},null,8,["filter","tags","buckets"]),c(ye,null,{content:N(s=>[o("md-menu-item",{onClick:d(g=>st(s),["stop"])},[o("div",xs,r(t.$t("upload_files")),1)],8,Vs),o("md-menu-item",{onClick:d(g=>ot(s),["stop"])},[o("div",Rs,r(t.$t("upload_folder")),1)],8,Ns)]),default:N(()=>[m((a(),l("button",Us,[zs,c(it)])),[[h,t.$t("upload")]])]),_:1}),c(ye,null,{content:N(s=>[o("div",Hs,[(a(!0),l(U,null,W(e(Oe),g=>(a(),l("md-menu-item",{key:g.value,onClick:j=>tt(s,g.value),selected:g.value===e(C)},[o("div",Os,r(t.$t(g.label)),1)],8,Ks))),128))])]),default:N(()=>[m((a(),l("button",Qs,[Gs,c(dt)])),[[h,t.$t("sort")]])]),_:1})])]),c(ct,{limit:P,total:e(w),"all-checked-alert-visible":e(ze),"real-all-checked":e(S),"select-real-all":e(Ue),"clear-selection":e(L)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),o("div",{class:"scroll-content",onDragover:n[9]||(n[9]=d((...s)=>e(Z)&&e(Z)(...s),["stop","prevent"]))},[m(o("div",{class:"drag-mask",onDrop:d(nt,["stop","prevent"]),onDragleave:n[5]||(n[5]=d((...s)=>e(ee)&&e(ee)(...s),["stop","prevent"]))},r(t.$t("release_to_send_files")),545),[[Et,e(qe)]]),o("div",{class:Te(["audio-list",{"select-mode":e(H)}])},[(a(!0),l(U,null,W(i.value,(s,g)=>{var j;return a(),l("section",{class:Te(["media-item selectable-card",{selected:e(D).includes(s.id),selecting:e(ie).includes(s.id)}]),key:s.id,onClick:d(u=>e(Ve)(u,s,g,()=>{e(je)(s)}),["stop"]),onMouseover:u=>e(xe)(u,g)},[o("div",Ws,[e(ie).includes(s.id)?(a(),l("md-checkbox",{key:0,class:"checkbox","touch-target":"wrapper",onClick:d(u=>e(le)(u,s,g),["stop"]),checked:e(Re)},null,8,Xs)):(a(),l("md-checkbox",{key:1,class:"checkbox","touch-target":"wrapper",onClick:d(u=>e(le)(u,s,g),["stop"]),checked:e(D).includes(s.id)},null,8,Js)),o("span",Ys,[c(ut,{id:g+1,raw:s},null,8,["id","raw"])])]),o("div",Zs,[re.value.includes(s.id)?(a(),l("img",{key:0,src:`/ficons/${e(Ut)(s.path)}.svg`,class:"svg"},null,8,eo)):(a(),l("img",{key:1,class:"image-thumb",src:e(zt)(s.albumFileId,"&w=200&h=200"),onError:u=>Ze(s.id)},null,40,to))]),o("div",so,r(s.title),1),o("div",oo,[o("span",null,r(e(Vt)(s.size)),1),o("span",no,r(e(xt)(s.duration)),1),o("a",{onClick:d(u=>e(Me)(e(f),s.bucketId),["stop","prevent"])},r((j=Le.value[s.bucketId])==null?void 0:j.name),9,ao),c(rt,{tags:s.tags,type:e(v),"only-links":!0},null,8,["tags","type"])]),o("div",lo,[m((a(),l("button",{class:"btn-icon sm",onClick:d(u=>e(Pe)(e(v),s),["stop"])},[co,c(B)],8,io)),[[h,t.$t("delete")]]),m((a(),l("button",{class:"btn-icon sm",onClick:d(u=>e(Ge)(s.path,e(Nt)(s.path).replace(" ","-")),["stop"])},[ro,c(ge)],8,uo)),[[h,t.$t("download")]]),m((a(),l("button",{class:"btn-icon sm",onClick:d(u=>e(Ke)(u,s),["stop","prevent"])},[_o,c(ke)],8,po)),[[h,t.$t("add_to_playlist")]]),m((a(),l("button",{class:"btn-icon sm",onClick:d(u=>at(s),["stop"])},[vo,c(fe)],8,mo)),[[h,t.$t("add_to_tags")]]),e(Xe)&&s.path===e(We)?(a(),l("md-circular-progress",ho)):R(s)?m((a(),l("button",{key:1,class:"btn-icon sm",onClick:n[6]||(n[6]=d(u=>e(Je)(),["stop"]))},[go,c(pt)])),[[h,t.$t("pause")]]):z("",!0)]),o("div",ko,r(s.artist),1),o("div",fo,[m((a(),l("span",null,[Qt(r(e(Gt)(s.createdAt)),1)])),[[h,e(Rt)(s.createdAt)]])])],42,js)}),128)),e(K)&&i.value.length===0?(a(),l(U,{key:0},W(20,s=>o("section",{class:"media-item selectable-card-skeleton",key:s},[o("div",yo,[bo,o("span",$o,r(s),1)]),Co])),64)):z("",!0)],2),!e(K)&&i.value.length===0?(a(),l("div",To,r(t.$t(e(Ht)(e(K),e(b).permissions,"WRITE_EXTERNAL_STORAGE"))),1)):z("",!0),e(w)>P?(a(),St(_t,{key:1,page:G.value,go:de,total:e(w),limit:P},null,8,["page","total"])):z("",!0),o("input",{ref_key:"fileInput",ref:Q,style:{display:"none"},type:"file",accept:"audio/*",multiple:"",onChange:n[7]||(n[7]=(...s)=>e(J)&&e(J)(...s))},null,544),o("input",{ref_key:"dirFileInput",ref:Ee,style:{display:"none"},type:"file",accept:"audio/*",multiple:"",webkitdirectory:"",mozdirectory:"",directory:"",onChange:n[8]||(n[8]=(...s)=>e(Y)&&e(Y)(...s))},null,544)],32)],64)}}}),Uo=ls(wo,[["__scopeId","data-v-ddce8864"]]);export{Uo as default};
