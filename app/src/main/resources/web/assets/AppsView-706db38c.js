import{u as ye,_ as $e,a as be,b as Ce}from"./list-18c9d8b7.js";import{d as we,aa as Ae,a as Se,r as k,u as De,s as Ie,c as Ve,B as Te,ab as Ue,D as qe,p as Qe,C as Be,ac as Le,N as J,i as ze,G as Fe,a1 as Me,E as Re,H as Pe,I as O,J as Ge,K as Ne,e as i,f as t,x as u,h as a,L as r,w as f,j as V,g as T,t as n,y as Ke,F as W,A as xe,M as Ee,k as He,ad as je,n as A,Q as S,ae as Je,af as Oe,o,R as We,z as Xe,m as Ye,T as X,U as Y,ag as Ze,ah as et,$ as tt,a9 as st}from"./index-391e08bf.js";import{_ as at}from"./Breadcrumb-db40a1f3.js";import{n as lt}from"./list-6498ebd9.js";function nt(D,I){const g=D.findIndex(y=>y.id===I);g!==-1&&D.splice(g,1)}const ot={class:"v-toolbar"},it=t("md-ripple",null,null,-1),dt=["onClick"],ct=t("md-ripple",null,null,-1),ut={class:"filters"},rt={class:"form-row"},pt=["label"],_t={class:"buttons"},ht=["onClick"],ft={class:"table-responsive"},mt={class:"table"},kt=["checked","indeterminate"],vt=t("th",null,null,-1),gt=["onClick"],yt=["checked"],$t={class:"v-center"},bt={class:"nowrap"},Ct={class:"action-btns"},wt={key:0,indeterminate:"",class:"spinner-sm"},At=["onClick"],St=t("md-ripple",null,null,-1),Dt=["onClick"],It=t("md-ripple",null,null,-1),Vt={class:"nowrap"},Tt={class:"nowrap"},Ut={class:"nowrap"},qt={class:"nowrap"},Qt={key:0},Bt={colspan:"7"},Lt={class:"no-data-placeholder"},v=50,Pt=we({__name:"AppsView",setup(D){var E,H;const{input:I,upload:g,uploadChanged:y}=Ae(),$=Se(),d=k([]),U=k(),{t:Z}=De(),{app:ee,urlTokenKey:q}=Ie(Ve()),b=Te({text:"",tags:[]}),{allChecked:Q,realAllChecked:B,selectRealAll:te,allCheckedAlertVisible:se,clearSelection:L,toggleAllChecked:z,toggleItemChecked:F,toggleRow:ae,total:m,checked:M}=ye(d),{downloadItems:le}=Ue(q,qe.PACKAGE,d,L,"apps.zip"),{downloadFile:ne}=Ze(q),R=Qe(),P=R.query,C=k(parseInt(((E=P.page)==null?void 0:E.toString())??"1")),c=k(Be(((H=P.q)==null?void 0:H.toString())??"")),G=Le(c.value),p=R.params.type;p&&G.push({name:"type",op:"",value:p});const N=k(J(G)),oe=()=>{g(ee.value.downloadsDir)},{loading:ie}=ze({handle:(e,l)=>{l?He(Z(l),"error"):e&&(d.value=e.packages.map(_=>({..._,checked:!1})),m.value=e.packageCount)},document:je,variables:()=>({offset:(C.value-1)*v,limit:v,query:N.value}),appApi:!0});Fe(C,e=>{p?A($,`/apps/${p}?page=${e}&q=${S(c.value)}`):A($,`/apps?page=${e}&q=${S(c.value)}`)});function de(){const e=[];b.text&&e.push({name:"text",op:"",value:b.text}),c.value=J(e),K(),U.value.dismiss()}function K(){p?A($,`/apps/${p}?q=${S(c.value)}`):A($,`/apps?q=${S(c.value)}`)}const{mutate:ce,onDone:ue}=Me({document:Je,appApi:!0});function re(e){ue(()=>{e.isUninstalling=!0}),ce({id:e.id})}const{loading:pe,load:_e,refetch:he}=Re({handle:(e,l)=>{if(e)for(const _ of e.packageStatuses)_.exist||nt(d.value,_.id)},document:Oe,variables:()=>({ids:d.value.filter(e=>e.isUninstalling).map(e=>e.id)}),appApi:!0}),x=e=>{e.status};return Pe(()=>{O.on("upload_task_done",x);let e=!0;setInterval(()=>{d.value.some(l=>l.isUninstalling)&&!pe.value&&(e?(_e(),e=!1):he())},1e3)}),Ge(()=>{O.off("upload_task_done",x)}),(e,l)=>{const _=at,j=et,fe=$e,me=be,ke=tt,ve=st,ge=Ce,h=Ne("tooltip");return o(),i(W,null,[t("div",ot,[u(_,{current:()=>`${e.$t("page_title.apps")} (${a(m)})`},null,8,["current"]),a(M)?r((o(),i("button",{key:0,class:"icon-button",onClick:l[0]||(l[0]=f(s=>a(le)(a(B),N.value),["stop"]))},[it,u(j)])),[[h,e.$t("download")]]):V("",!0),t("button",{class:"icon-button",onClick:f(oe,["stop"]),style:{display:"none"}},[ct,T(" "+n(e.$t("install")),1)],8,dt),u(fe,{ref_key:"searchInputRef",ref:U,modelValue:c.value,"onUpdate:modelValue":l[2]||(l[2]=s=>c.value=s),search:K},{filters:Ke(()=>[t("div",ut,[t("div",rt,[r(t("md-outlined-text-field",{label:e.$t("keywords"),"onUpdate:modelValue":l[1]||(l[1]=s=>b.text=s),"keyup.enter":"applyAndDoSearch"},null,8,pt),[[We,b.text]])]),t("div",_t,[t("md-filled-button",{onClick:f(de,["stop"])},n(e.$t("search")),9,ht)])])]),_:1},8,["modelValue"])]),u(me,{limit:v,total:a(m),"all-checked-alert-visible":a(se),"real-all-checked":a(B),"select-real-all":a(te),"clear-selection":a(L)},null,8,["total","all-checked-alert-visible","real-all-checked","select-real-all","clear-selection"]),t("div",ft,[t("table",mt,[t("thead",null,[t("tr",null,[t("th",null,[t("md-checkbox",{"touch-target":"wrapper",onChange:l[3]||(l[3]=(...s)=>a(z)&&a(z)(...s)),checked:a(Q),indeterminate:!a(Q)&&a(M)},null,40,kt)]),t("th",null,n(e.$t("name")),1),vt,t("th",null,n(e.$t("size")),1),t("th",null,n(e.$t("type")),1),t("th",null,n(e.$t("installed_at")),1),t("th",null,n(e.$t("updated_at")),1)])]),t("tbody",null,[(o(!0),i(W,null,xe(d.value,s=>(o(),i("tr",{key:s.id,class:Xe({selected:s.checked}),onClick:f(w=>a(ae)(s),["stop"])},[t("td",null,[t("md-checkbox",{"touch-target":"wrapper",onChange:l[4]||(l[4]=(...w)=>a(F)&&a(F)(...w)),checked:s.checked},null,40,yt)]),t("td",null,[t("strong",$t,n(s.name)+" ("+n(s.version)+")",1),u(ke,{id:s.id,raw:s},null,8,["id","raw"])]),t("td",bt,[t("div",Ct,[s.isUninstalling?r((o(),i("md-circular-progress",wt,null,512)),[[h,e.$t("uninstalling")]]):r((o(),i("button",{key:1,class:"icon-button",onClick:f(w=>re(s),["stop"])},[St,u(ve)],8,At)),[[h,e.$t("uninstall")]]),r((o(),i("button",{class:"icon-button",onClick:f(w=>a(ne)(s.path,`${s.name.replace(" ","")}-${s.id}.apk`),["stop"])},[It,u(j)],8,Dt)),[[h,e.$t("download")]])])]),t("td",Vt,n(a(Ye)(s.size)),1),t("td",Tt,n(e.$t("app_type."+s.type)),1),t("td",Ut,[r((o(),i("span",null,[T(n(a(Y)(s.installedAt)),1)])),[[h,a(X)(s.installedAt)]])]),t("td",qt,[r((o(),i("span",null,[T(n(a(Y)(s.updatedAt)),1)])),[[h,a(X)(s.updatedAt)]])])],10,gt))),128))]),d.value.length?V("",!0):(o(),i("tfoot",Qt,[t("tr",null,[t("td",Bt,[t("div",Lt,n(e.$t(a(lt)(a(ie)))),1)])])]))])]),a(m)>v?(o(),Ee(ge,{key:0,modelValue:C.value,"onUpdate:modelValue":l[5]||(l[5]=s=>C.value=s),total:a(m),limit:v},null,8,["modelValue","total"])):V("",!0),t("input",{ref_key:"fileInput",ref:I,style:{display:"none"},type:"file",accept:".apk",multiple:"",onChange:l[6]||(l[6]=(...s)=>a(y)&&a(y)(...s))},null,544)],64)}}});export{Pt as default};
